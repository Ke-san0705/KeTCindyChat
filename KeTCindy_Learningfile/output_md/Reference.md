# Reference ドキュメント

## KeTCindyReferenceJ.pdf

### Page 1

K TCindy 関数リファレンス
E
KETCindy Project Team
2021年8月5日
- 第3.2版 -
目次
1 平面の図形とグラフ 2
1.1 設定・定義 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 2
1.1.1 環境設定 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 2
1.1.2 描画設定・定義 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4
1.2 描画 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10
1.2.1 書式とオプション . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10
1.2.2 点・線分・直線 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11
1.2.3 曲線 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22
1.2.4 関数のグラフ . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32
1.2.5 文字 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 38
1.2.6 マーキング . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 40
1.3 プロットデータの操作 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 44
1.4 計算 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59
1.5 値の取得と入出力 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 60
1.6 作表 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 63
1.7 ファイル操作 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 68
1.8 Tikzコマンドの利用. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 69
1.9 その他 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 70
2 他の数式処理ソフトなどとの連携 78
2.1 Rとの連携 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 78
2.1.1 Rの関数の利用 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 78
2.1.2 TEXのコマンド書き出し（メタコマンド） . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 84
2.2 KETCindyでのメタコマンドの利用例 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 85
2.3 Maximaとの連携 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 87
2.4 Wolfram Engineとの連携. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 95
2.5 Risa/Asirとの連携 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 95
2.6 FriCAS(Axiom)との連携 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 96
2.7 MeshLabとの連携. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 96
2.8 表計算ソフトとの連携 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 99
3 アニメーションPDF 102
3.1 概要 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 102
1

### Page 2

3.2 関数 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 102
3.3 制作例 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 104
4 KeTスライド 106
4.1 概要と制作手順 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 106
4.2 コンテンツファイル . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 107
4.3 関数 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 111
5 KETCindy3D 114
5.1 概要 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 114
5.2 設定 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 115
5.3 描画 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 116
5.3.1 点・線 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 116
5.3.2 多面体 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 120
5.3.3 曲面 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 124
5.4 プロットデータの操作 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 130
5.5 その他 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 139
6 KeTJS 146
6.1 CindyJSとKeTJS . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 146
6.2 KeTJSの動作環境 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 146
6.3 KeTJSの設定 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 147
6.4 KeTJSのコマンド . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 148
6.5 入力窓の利用 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 149
7 付録 150
7.1 用語解説 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 150
7.2 Cinderellaの作図ツール . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 150
7.3 他のテキストエディタの使用 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 151
7.4 色名とカラーコード一覧 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 152
7.5 点の作図についての比較表 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 153
8 関数一覧 154
2

### Page 3

1 平面の図形とグラフ
1.1 設定・定義
1.1.1 環境設定
関数 Ketinit(options)
機能 KETCindyを初期化する。平面図形ではDrawスロットに，空間図形ではInitialization スロットの冒頭に記
述する必要がある。
説明 option 作業サブフォルダ
通常は不要で，Ketinit() だけでよい。
関数 Initglist(), Setglist(), Addglist()
機能 ketlibスロットで作られる描画データを描画リストに追加する。
説明 Implicitplot,Hatchdataなど実行時間のかかるコマンドをfiguresスロットにおくと，その都度実行されてし
まう。それを避けるためketlibスロットにおいたときに用いる。
Initglist(); // ketlibスロットで
Implicitplot(''1'',fun,rng);
Setglist();
Ketinit(); // figuresスロットで
Addglist();
関数 Setfiles(filename）
機能 出力するファイル名の設定
説明 出力するTexのファイル名を指定する。
出力するファイル名は 初期設定では，作図しているCinderellaのファイル名。
たとえば，triangle.cdy で作図して出力すると，triangle.tex ができる。
これに対し，triangle.cdy で作図しているときに，grav.tex で出力したい場合は
Setfiles("grav");
とすると，grav.tex ができる。
関数 Setparent(filename）
機能 Parent ボタンで出力するファイル名の設定
説明 Figpdf() を使ってParent ボタンで出力するTexのファイル名を指定する。
Parent ボタンで出力するファイル名は 初期設定がないので，指定する必要がある。
たとえば，triangle.cdy で作図しているときに，図サイズの grav.pdf を作る場合，
Setparent("grav");
とすると，図のTeXファイルtriangle.tex と PDFを作る grav.tex ができ，ここから grav.pdf ができる。
関数 Changework(パス名）
機能 作業ディレクトリを指定（変更）する
説明 作業ディレクトリは， 初期設定では，現在作図しているファイルのあるフォルダ（ディレクトリ）の fig フォ
ルダである。これを変更する。
関数 Addpackage(パッケージ名)
3

### Page 4

機能 TeXのパッケージを追加する
説明 プレビュー用のTeXソースにパッケージを追加する。
【例】emathパッケージを追加する。
Addpackage("emath");
または
Addpackage(["emath"]);
により，プレビュー用のTeXのプリアンブルに
\usepackage{emath}
が追加されて，emath のコマンドが利用できる。
注）初期設定では，次のパッケージを利用している。
ketpic, ketlayer, amsmath, amssymb, graphicx, color
関数 Usegraphics(”tpic”/”pict2e”/”tikz”)
機能 TeXのグラフィクスパッケージを変更する。
説明 デフォルトのパッケージは Pluginsにある"ketcindy.ini" に記述されているが，これを変更する。
⇒関数一覧
4

### Page 5

1.1.2 描画設定・定義
関数 Addax(0または1)
機能 座標軸の表示
説明 引数が1のとき座標軸を描き，0のとき描かない。初期設定は1で，座標軸を描かない場合のみ Addax(0) と
すればよい。
【例】三角形を描く
左図が 初期設定（座標軸表示） Addax(0) をつけると右図になる。
Listplot([B,A,C]);
Letter([A,"ne","A",B,"se","B",C,"se","C"]);
y
A A
x
OB C B C
関数 Setax()
機能 座標軸の書式を設定する。
説明 Cinderellaの描画面には反映されない。（座標軸は描かれない）
引数はリストで与え，要素は順番に
1. 軸の形状（直線は ”l” ，矢印は ”a”） 初期設定は直線
矢印の大きさの倍率を指定するときは，”a0.5”のようにする。
また，矢印のスタイルは Setarrowで指定する。
2. 横軸名 初期設定は "x"
3. 横軸名の位置 初期設定は "e"
4. 縦軸名 初期設定は "y"
5. 縦軸名の位置 初期設定は "n"
6. 原点名 初期設定は "O"（文字として書かれる）
7. 原点名の位置 初期設定は "sw"
8. 線種
9. 線の色
10. ラベルの色
それぞれダブルクォートでくくる。色は，色名が使える。”red” など。
10の引数のうちn番目だけを指定する場合は，[n,”内容”]で指定できる。
また，後方は省略できる。
【例】座標軸の先端を矢印にし，原点の北西にOを書く。
Setax(["a","","","","","","nw"]);
【例】原点の北西にOを書く。
Setax([7,"nw"]);
【例】軸を赤の点線にする。
5

### Page 6

Setax(["","","","","","","","do","red"]);
【例】先端を矢印にし，横軸をθ，縦軸をxにして矢じりの左側に書く。
Setax(["a","\theta","","x","w"]);
x
θ
O
関数 Drwxy(), Drwxy(options)
機能 指定する手順で座標軸を描く
説明 座標軸は 初期設定では最後に描かれるが，座標軸上に白抜きの点を表示するなど，先に描くことが必要な場合
に用いる。描画面には座標軸は表示されない。
options は次のリストである。
[”Origin=”, ”Xrng=”, ”Yrng=”]
【例】点(−π, 0)と(π, 0)を白抜きの点で表示する。
y
Setax([7,"se"]);
Setpt(5);
Pointdata("1",[[-pi,0]],["Inside=white"]); O x
Drwxy();
Plotdata("1","sin(x)","x",["dr","Num=200"]);
Pointdata("2",[[pi,0]],["Inside=white"]);
このスクリプトでは， Pointdata("1",[[-pi,0]],["Inside=white"]);を実行したのち座標軸を描き，次
に，y = sinx のグラフを描いてから，再び ["Inside=white"]);にして実行するので，点(−π,0) の上を
座標軸が通り，点(π,0)は座標軸とグラフの上を通るので白抜きになる。
⇒関数一覧
関数 Definecolor(色名 , 定義のリスト)
機能 色名を定義する
説明 ユーザー命名の色名を定義する。定義リストは RGBまたはCMYKのリスト
各色０〜１の範囲で指定する。定義した色名は，Setcolor(color,options)で使うことができる。
なお，KETCindyでは，68色を色名で使うことができる。色の名称はカラーコード一覧 参照。
【例】暗い紫色を darkmaz の名称で定義して使う。
Definecolor("darkmaz",[0.8,0,0.8]);
Setcolor("darkmaz");
関数 Setcolor(color,options）
機能 描画色の設定
説明 引数colorはカラーコードまたは色の名称。
カラーコードはRGBまたはCMYKをリストで与える。各色０〜１。
色の名称はカラーコード一覧 の68色が指定できる。
6

### Page 7

【例】Cを大きさがBと一致するようにとり，Anglemarkと矢印を描く
C.xy=|B.xy|/|C.xy|*C.xy;
Listplot([B,A,C]);
Setcolor("red");
Anglemark("1",[B,A,C],[3]); //size=3
Arrowhead(1,"ag1",[2]); //position=1,size=2
座標軸を描く場合は，このあと Setcolor("black") で黒に戻しておかないと，座標軸が赤で表示されてしま
うので要注意。
y
x
O
⇒関数一覧
7

### Page 8

関数 Deffun(関数名 , 定義のリスト)
機能 関数を定義する
説明 関数定義は，CindyScript の関数定義 f(x):=式 でもできるが，Deffun()を使うことにより，Rでこの関数を
利用することができる。目的に応じて使い分けるとよい。
式のリストには if文を用いた場合分けの関数式を記述することもできる。
1
【例】f(x)= を定義し，グラフを描く。
x2+1
Deffun("f(x)",["regional(y)","y=1/(x^2+1)","y"]);
Plotdata("1","f(x)","x");
y
x
O
{
1 (x≥0)
【例】f(x)= を定義してグラフを描く。
−1 (x<0)
Deffun("f(x)",["regional(y)","if(x>=0,y=1,y=-1)","y"]);
Plotdata("1","f(x)","x",["Dis=1","Num=100"];
y
x
O
if 文はネストすることができる。
Deffun("f(x)",["regional y","if(x>1,y=1,if(x>-1,y=x,y=-1))","y"]);
y
x
O
関数 Defvar(文字列)
機能 変数を定義する
説明 変数の定義をRと共有する。
【例】Defvar("const=3");
複数の変数を定義するときはリストにする。
【例】Defvar([“a”,3,”b”,1]);
8

### Page 9

関数 Fontsize(記号)
機能 フォントサイズを設定する
説明 次に Fontsize() を実行するまで有効
記号は，”t” , ”ss” , ”f”, ”s” , ”n” , ”la”,”La”, ”LA”, ”h” , ”H”
【例】作図ツールの「点を加える」で，A〜Gの点をとっておく。小さい方からいくつか表示する。
Pointdata("1",[A,B,C,D,E,F,G],["Size=2"]);
Fontsize("t"); Letter([A,"s2","A"]);
Fontsize("ss"); Letter([B,"s2","B"]);
Fontsize("s"); Letter([C,"s2","C"]);
Fontsize("la"); Letter([D,"s2","D"]);
Fontsize("La"); Letter([E,"s2","E"]);
Fontsize("h"); Letter([F,"s2","F"]);
Fontsize("H"); Letter([G,"s2","G"]);
A B C D E F G
関数 Ptsize(n) , Setpt(n)
機能 表示する点の大きさを設定する。
説明 Ptsize() と Setpt() は同じである。 初期設定は１
全体の点の大きさを設定する。点の大きさを個々に変えたい場合は，sizeオプションを用いる。
【例】１から4までの点の大きさ
あらかじめ，Cinderellaの作図ツールで点A,B,C,Dを作図しておく。
Pointdata("1",A,["Size=1"]);
Pointdata("2",B,["Size=2"]);
Pointsize 1 2 3 4
Pointdata("3",C,["Size=3"]);
Pointdata("4",D,["Size=4"]);
⇒関数一覧
関数 Setmarklen(数)
機能 座標軸の目盛の長さを設定する
説明 Htickmark() , Vtickmark() で座標軸に目盛を入れるとき，その長さを設定する。
関数 Setorigin(座標）
機能 描画する座標軸の原点を設定（移動）する。座標系は変化しない。
説明 描画する座標軸の原点を引数の座標とする。座標は点の識別名でもよい。
【例】原点を (3,2) として座標軸を描く。
Setorigin([3,2]);
原点を点Aの位置にして座標軸を描く。
Setorigin(A);
【例】原点は(3,2)に移動するが，スクリプトではもとの座標系を使う。
Setorigin([3,2]);
Listplot([A,B,C,A]);
Pointdata("1",[1,1],["Size=3"]);
9

### Page 10

Letter([[1,1],"s2","P"]);
左が実行時のCinderellaの画面，右がTEXの結果。
y
x
O
P
関数 Setpen(数）
機能 線の太さの初期値を設定する
Listplot() などの描画関数のオプション dr で，個々の太さは指定できる。
関数 Setscaling(倍率)
機能 縦方向の倍率を設定する。倍率は実数またはリスト。実数の場合は縦方向，リストの場合は[横方向，縦方向]
の指定となる。
説明 2次関数の応用問題などでは，グラフが縦に大きくなる場合があり，y 軸方向のスケーリングを変えたいこと
がよくある。次のスクリプトは，f(x)=−x2+10x のグラフを縦軸方向を半分にして描くものである。
y
Setscaling(0.5); 25
A.xy=[0,25/4]; 2
B.xy=[5/2,25/4];
C.xy=[5/2,0];
Listplot([A,B],["do"]);
Listplot([C,B],["do"]);
Plotdata("1","-2*x^2+10*x","x");
Letter([[5,0],"s2w","5",[0,25/2],"w2",
"$\frac{25}{2}$",C,"s4","$\frac{5}{2}$"]);
x
O 5 5
2
ここで，点A,Bの座標が
A.xy=[0,25/4];
B.xy=[5/2,25/4];
となっていることに注意されたい。y座標をあらかじめ半分にしている。すなわち，Cinderellaで作図した幾
何要素に対してはSetscalingは無効である。これは，Putpoint関数を用いて点の位置を決めても同じである。
たとえば，次のスクリプトでは，Cinderellaの画面上では2本の線分が点Bでつながるが，書き出されたTEX
の図では離れてしまう。
Setscaling(0.5);
Putpoint("A",[0,2]);
Putpoint("B",[2,2]);
Listplot([A,B]);
Listplot("1",[[0,0],[2,2]]);
関数 Setunitlen(文字列)
機能 単位長を設定する。 初期設定は 1cm。
この関数は，スクリプトの初めの方に書くのがよい。
【例】Setunitlen(”8mm”)
10

### Page 11

関数 Unscaling(plotdata)
機能 scalingされたデータを論理値化する。
関数 Setwindow(xの範囲, yの範囲)
機能 出力する描画領域を設定する。
説明 出力する描画領域は，通常は2点SWとNEを対角とする矩形領域である。
この2点をドラッグすることによりビジュアルに描画領域を決められる。
しかし，これとは別に出力範囲を設定したい場合にこの関数を用いる。
また，表を作成したときは，表の範囲が出力範囲として優先される（Tabledata()を実行したとき）ので，表
外に図を描いた場合は，最後にこの関数で出力範囲を指定して書き出す。
【例】Setwindow([-5,5],[-1,3]);
⇒関数一覧
1.2 描画
1.2.1 書式とオプション
描画関数は曲線などを作図する関数である。
基本的な書式は次の通り。
関数名(name , 点リストなど , options);
name は，プロットデータの名称で，関数ごとに決められた頭部のあとに付けられる。たとえば，線分を描く
Listplot() でできるプロットデータは，頭部が”sg”であり，nameを”1”とすれば，”sg1” という名称のプロットデー
タができる。name指定は不要の場合もあり，その場合は KETCindyが自動的に名称を作成する。なお，name に演
算記号は使えないので，番号として負の数は使えない。
点リストなどには，点の座標，点の識別名，複数の点のリスト，複数の点を示す文字列などがあり，関数によって
異なる。点はCinderellaで作図した幾何要素の点を利用できる。
optionsは，線種・表示する文字列・解像度・出力の有無などを指定するオプション群。
線種はつぎの4通り。 初期設定は実線。
”dr, n” 太さnの実線で描く。
”da,m,n” 破線を描く。
mは破線の長さ，nは破線の間隔(m,nは省略可)
m,n オプションはCinderellaの描画面には反映されない。
”id,m,n” ギャップからはじまる破線を描く。
”do,m,n” 点線で描く。
mは点の間隔，nは太さ(m,nは省略可)
描画色指定は，RGBまたはCMYKのリストで指定するか，色名を用いる。
【例】"Color=[0,0.7,0]" で暗い緑になる。
出力の有無は
11

### Page 12

”notex” Cinderella画面上の図形を出力しない
”nodisp” Cinderella画面上にも出力しない
”nodisp”は画面上にも，Ｒへのデータにも出力されないが，プロットデータは作成されるので，プロットデータだ
けを利用したい場合に有効である。
【例】pdata=Circledata([A,B],["nodisp"]);
として，後にプロットデータ pdata を利用する。
その他，次のようなオプションがある。
”Size=n” 点の大きさ，線の太さの指定
”Num=n”曲線の場合の分割数（プロットデータの個数+1）
1.2.2 点・線分・直線
関数 Pointdata(name , 点リスト , options)
機能 点のデータを作成する。
説明 与えられた座標の点データを作成する。オプションは”Size=”,”Color=”,”Inside=”。
Inside オプションは，点の内部についての指定（n : 内部を塗らない，color：内部色）
【例】
(1) 座標指定で2つの点データを作る。
Pointdata("1",[[1,2],[-2,3]]);
(2) 作図した点A,Bについて，点データを作る。
Pointdata("1",[A,B]);
A,Bが作図されていない場合は作成されない。
Cinderellaの描画面上では既存の点A,Bに黒の点が重なって表示される。
(3) Aの位置に大きさ4で点を作る。
Pointdata("1",A,["Size=4"]);
(4) 点データを作り，オプション（内部を塗らない）で描く
Pointdata("1",[A,B],["Inside=n"]);
(5) 点データを作り，オプション（内部を白塗り）で描く
Pointdata("1",[A,B],["Inside=white"]);
(6) 点データを作るが，TeXには出力しない
Pointdata("1",[[3,4],[5,6]],["notex"]);
(7)点データを作るが，TeXには出力せず画面上にも表示しない。
Pointdata("1",[[3,4],[5,6]],["nodisp"]);
(7) 節点を明示した木を描く
Ptsize(3);
Pointdata("1",[[1,2],[3,4],[5,2]]);
Listplot("1",[[0,0],[1,2],[3,4],[5,2],[4,0]]);
Listplot("2",[[1,2],[2,0]]);
Listplot("3",[[5,2],[6,0]]);
注) 幾何点の有無など，付録の「点の作図についての比較表」を参照のこと。
関数 Putpoint(点名 , 座標１ ,座標2 )
12

### Page 13

機能 点を作る
説明 識別名が点名の点を，既存でなければ座標１に作る。既存ならば座標2に移動する。Texには出力されない。
【例】点Aを作る。
(1,1) に固定点Aを作る。 この点は動かすことができない。
Putpoint("A",[1,1]);
(1,1)に自由点を作るには次のようにする。
Putpoint("A",[1,1],[A.x,A.y]);
この点は座標2の効果により，自由点となり，ドラッグして動かすことができる。
注）点名は半角アルファベットとする。数字や漢字でもCinderellaでは点ができるが，Rでエラーとなる。
関数 Putintersect(点名 , PD1 , PD2 , [No] )
機能 2曲線の交点を作る
説明 PD1,PD2は2曲線のプロットデータ名。作成される点は幾何点。
描画範囲に交点が１つだけのとき，第4引数がなくても交点が作られる。
描画範囲に2つ以上の交点がある場合，第4引数を省略するとコンソールに交点の座標のリストと，「Choose
point number 」というガイドが表示される。そこで，引数のNoとして，その番号を指定すると，その点が作
られる。この関数で作成されるのは幾何点だけなので，TEXの図に点として明示するためにはPointdata()で
書き出す。
注）交点が存在しない場合は，「No intersect point」がコンソールに表示される。
13

### Page 14

次の例は，3次曲線と直線の交点を3つとも取ったものである。
y
Plotdata("1","x^3-4*x","x",["Num=200"]);
Plotdata("2","1/2*x+1","x");
Putintersect("P","gr1","gr2",1);
Putintersect("Q","gr1","gr2",2);
x
Putintersect("R","gr1","gr2",3); O
Pointdata("1",[P,Q,R],["size=4"]);
関数 Putoncurve(点の名前, プロットデータ, options)
機能 曲線上に点を乗せる。
説明 点が存在しない場合は新たに作る。すでにその点が存在する場合は，その点のx座標を使う。初期値のx座標
の 初期設定は 0。
optionsは，x座標の範囲をリストで与える。
【例】アステロイド上の動点P をとる。
Paramplot("1","[2*cos(t)^3,2*sin(t)^3]","t=[0,2*pi]");
Putoncurve("P","gp1",[-1,1]);
点Pがアステロイド上にでき，この点はドラッグするとアステロイド上を −1≤x≤1 の範囲で動かすことが
できる。ただし，-1,1の付近はy座標の判断の関係でぴったりはいかない。
y
P
x
O
⇒関数一覧
関数 Putonline(点名 , 座標１ ,座標2 )
機能 直線上に点を作る
説明 座標１，座標2を通る直線上に点名の点を作る。できた点は直線に対してインシデントとなる。
【例】点A, Bを通る直線上に点Pをとる。
Putonline("P",A,B);
関数 Putonseg(点名 , 座標１ ,座標2 )
機能 線分上に点を作る
説明 座標１，座標2を端点とする線分上に点名の点を作る。できた点は線分に対してインシデントとなる。指定し
た点がすでに存在する場合は動かさない。
【例】
線分AB上に点Cをとる。
14

### Page 15

Putonseg("C",A,B);
点(-1,0),(2,2)を通る線分上に点Cをとる。
Putonseg("C",[[-1,0],[2,2]]);
関数 Reflectpoint(点，対称点または対称軸)
機能 点の鏡映の座標を返す。
説明 点を指定された点または軸に関して対称移動した点の座標を返す。対称軸は[ 点1, 点2 ]で指定
【例】点A〜Fを作図しておき，C〜FをAの鏡映の位置に配置する。
ＣはBに関してAと対称な点
y
Ｄは点(2,3)に関してAと対称な点
Eは点(1,0) に関して (-1,1) と対称な点
D
Fは直線CEに関してAと対称な点
(2,3)
C
C.xy=Reflectpoint(A,B);
D.xy=Reflectpoint(A,[[2,3]]); (-1,1) B
E.xy=Reflectpoint([-1,1],[[1,0]]); A
F.xy=Reflectpoint(A,[C,E]); x
Lineplot([C,E],["do"]); O (1,0)
E
F
注）鏡映はCinderellaの作図ツールでも作成することができる。場合によってはCinderellaで作図する方が
簡明である。
関数 Rotatepoint(点 ，角度 , 中心)
機能 点の位置を回転する
説明 点を，中心で示された点の周りに回転した座標を返す。角度は弧度法で与える
【例】点A〜Eは作図しておき，C〜Eをそれぞれの位置に配置する。
y
2
点CはAを，Ｂに関して πだけ回転した点
3
D
π
点Dは点(5,2)を，Ｂに関して だけ回転した点
3
B C
π
点Eは点(3,0)をAに関して − だけ回転した点 (5,2)
4
A
C.xy=Rotatepoint(A,2*pi/3,B); x
O (3,0)
D.xy=Rotatepoint((5,2),pi/3,B);
E.xy=Rotatepoint([3,0],-pi/4,A); E
注）図の点線は位置関係を示すためのもの。
点名や座標は，実際にはLetter()関数で記述する。
関数 Scalepoint(点，比率ベクトル，中心)
機能 点の位置の拡大・縮小を行う
説明 点を，指定された中心を原点とする座標系で，比率ベクトルの分だけ拡大・縮小した位置の座標を返す。
【例】点A〜Fは作図ツールで適当な位置にとっておく。
点Dを，点Aを原点を中心に横に3倍，縦に2倍した位置に置く。
点Eを，点Aを点Bを中心に横に3倍，縦に2倍した位置に置く。
−−→
点Fを，点Aを原点を中心にベクトルOC で示された比率の位置に置く。
15

### Page 16

D.xy=Scalepoint(A,[3,2],[0,0]);
E.xy=Scalepoint(A,[3,2],B);
F.xy=Scalepoint(A,C.xy,[0,0]);
Arrowdata("1",[[0,0],C]);
Pointdata("1",[A,B,C,D,E,F],["size=2"]);
Letter([A,"e2","A("+A.x+","+A.y+")"]);
Letter([B,"e2","B("+B.x+","+B.y+")"]);
Letter([C,"e2","C("+C.x+","+C.y+")"]);
Letter([D,"e2","D("+D.x+","+D.y+")"]);
Letter([E,"e2","E("+E.x+","+E.y+")"]);
Letter([F,"e2","F("+F.x+","+F.y+")"]);
y
E(5,5)
D(9,4)
A(3,2) F(12,2)
C(4,1)
x
O
B(2,-1)
点A,B,Cをドラッグすると，インタラクティブにD,E,F の位置が変わる。
関数 Translatepoint(点 , 移動ベクトル)
機能 点を平行移動する
説明 点を移動ベクトルで示された分だけ平行移動した点の座標を返す
【例】点A〜Dは作図しておく。
点Cを点Aをx軸方向に2 , y軸方向に3だけ平行移動した点にする。
−−→
点Dを点AをベクトルOB だけ平行移動した点にする。
C.xy=Translatepoint(A,[2,3]);
D.xy=Translatepoint(A,B.xy);
y
5 C
4
3 D
2 A
1 B
x
O 1 2 3 4 5
⇒関数一覧
関数 Setarrow([arrowsize,angle,position,cut])
機能 Arrowdata,Arrowheadで描く矢印のスタイルを設定する。
説明 arrowsize,angle,position,cut,linestyle は，順に大きさ (1)，開き角 (18)，位置 (1)，切り込み (0.2) である。
（カッコ内はデフォルト値）
16

### Page 17

関数 Arrowdata(name,[始点 , 終点] , options)
機能 2点間を結ぶ矢線を描く。
説明 name はなくてもよい（自動的に通し番号をつける）。
optionsは矢じりの形状などの指定（リストで与える）。
数値は， 大きさ, 開き角, 位置,切り込み
”Line=n(y)”（矢印は線だけ），”Cutend=”（トリミング），”Color=”
開き角は60分法で与える。2.5未満の時は18°の倍数指定とする。
矢じり位置は，線分の長さを１とした始点からの距離。
切り込みのデフォルトは0.2
トリミング :”Cutend=m” または ”Cutend=[m,n]” で，右辺が数のときは両端をmだけカットする。リスト
のときは始点をm,終点をnだけカットする。mが負のときは延長する。
【例】オプションの設定とその結果を示す。
Arrowdata("1",[A,B]);
Arrowdata("2",[[1,0],[2,3]],[2]);
Arrowdata("3",[[2,0],[3,3]],[3,45]);
Arrowdata("4",[[3,0],[4,3]],[3,1,0.5]);
Arrowdata("5",[[4,0],[5,3]],[3,1,1,0]);
Arrowdata("6",[[5,0],[6,3]],[3,"Line=y"]);
Arrowdata("7",[[6,0],[7,3]],[3,"dr,2"]);
Arrowdata("8",[[7,0],[8,3]],[3,1,1,0.5,"Color=red"]);
y
x
O
【例】２つの円を矢線で結ぶ。
Circledata("1",[A,A.xy+[0.5,0]]);
B
Circledata("2",[B,B.xy+[0.7,0]]);
Arrowdata([A,B],["Cutend=[0.5,0.7]"]);
Letter([A,"c","A",B,"c","B"]);
A
Cinderellaの作図ツールで２点ABをとっておく。
円A,Bの半径が同じ（たとえば0.5）であれば，Arrowdata([A,B],["Cutend=0.5"]); でよい。
関数 （１）Arrowhead(点 , 方向 , options)
（２）Arrowhead(点または位置比 , プロットデータ, options)
機能 点に矢じりだけを描く（optionはSetarrowと同じ）
説明 （１）指定された位置に，指定された方向を向いた矢じりだけを描く。
点は座標または幾何要素名。方向は原点から見て座標[a,b]の方向。
（２）プロットデータ（曲線）を指定したときは，曲線上の点に矢じりをつける。
曲線には向きがあり，それによって矢じりの向きが決まる。
”Invert(曲線名)” とすると反対向きの矢じりになる。
曲線の向きとは，曲線を描くときの順序で，プロットデータの順序でもある。
位置比は曲線上の位置を表す比率（0から1）。
17

### Page 18

例えば，分割数が50で位置比が0.3のとき 1+50*0.3=2.5
2番目と3番目の点の中点
【例】 A が右図の位置のとき
y
(ア) Arrowhead(A,[-1,1]); A
1
(イ) Arrowhead([1,1],[-1,1],[2,60]);
(ウ) Arrowhead(A,[-1,1],[2,30,0.5]]);
x
O 1
(エ) Arrowhead([1,1],[-1,1],[2,20,0.5,"Line=y"]);
(ア) (イ) (ウ) (エ)
y y y y
1 1 1 1
x x x x
O 1 O 1 O 1 O 1
曲線 cr1 上の点 A の位置比が0.6のとき
A
(オ) Arrowhead(A,"cr1");
(カ) Arrowhead(0.6,"cr1",[2,1,0.5,"Color=red"]);
(キ) Arrowhead(1,"cr1");
(ク) Arrowhead(1,"Invert(cr1)",["Line=y"]);
オ) (カ) (キ) (ク)
関数 Lineplot（name , 2点のリスト , options)
機能 2点のリストで示された点を結ぶ直線を描く。
説明 2点のリストは座標または幾何要素の名前で与える。
options は次の通り。
線種”dr, n”, ”da,m,n” , ”do,m,n”
”+”半直線を描く。
”dr” , ”da” , ”do” と ”+” はリストにして両方指定することができる。
点のリストが，座標ではなく幾何要素名のリストの場合は，nameは省略できる。
いくつか例を示す。
各座標を結ぶ直線を引く
Lineplot("1",[[0,0],[1,2]])
Cinderellaの描画ツールで2点A,Bをとっておき，直線ABを引く
Lineplot([A,B]);
optionの働きの例
Lineplot([A,B],["dr,0.5","+"]); Aを端点とする半直線を引く
Lineplot([C,D],["dr,2"]); 直線CDを太さ2で描く
18

### Page 19

Lineplot([E,F],["da"]); 直線EFを破線で描く
Lineplot([G,H],["do"]); 直線GHを点線で描く
結果は，次図左上から。
y
A
x
O
⇒関数一覧
関数 Listplot（name , 点のリスト , options)
機能 点のリストで示された点を結ぶ。
説明 点のリストは座標または幾何要素名のリストで与える。点が，座標ではなく幾何要素名の場合は，nameは省
略可
プロットデータの名前は，”sg” に引数の name を付加したものとなる。
options は次の通り。
線種 ”dr, n”, ”da,m,n” , ”do,m,n”
トリミング :”Cutend=m” または ”Cutend=[m,n]”
数のときは両端をmだけカットする。リストのときは始点をm,終点をnだけカットする。mが負のときは
延長する。
optionsの使用例
Listplot([A,B]); 線分ABを描く。太さは 初期設定。
Listplot([C,D],["dr,2"]); 線分CDを描く。太さ2
Listplot([E,F],["da"]); 線分EFを破線で描く
Listplot([G,H],["da,3,1"]); 線分GHを破線で描く。線を長く
Listplot([K,L],["da,1,3"]); 線分KLを破線で描く。間隔を空ける
Listplot([M,N],["do"]); 線分MNを点線で描く。
Listplot([O,P],["do,3"]); 線分OPを点線で描く。間隔を空ける
Listplot([Q,R],["do,3,3"]); 線分QRを点線で描く。間隔を空けて太く
結果は次図左から。
【例】三角形を描く。
Cinderellaの作図ツールで三角形ABCを描いておく。あるいは，単に3点A,B,Cをとるだけでもよい。
Addax(0);
Listplot([A,B,C,A]);
19

### Page 20

点の位置は座標で指定してもよい。
その場合は name が必要。
Listplot("1",[[0,0],[2,0],[1,2],[0,0]]);
【例】２つの円を線分で結ぶ。
Circledata("1",[A,A.xy+[0.5,0]]);
B
Circledata("2",[B,B.xy+[0.7,0]]);
Listplot([A,B],["Cutend=[0.5,0.7]"]);
Letter([A,"c","A",B,"c","B"]);
A
Cinderellaの作図ツールで２点ABをとっておく。
円A,Bの半径が同じであれば，Listplot([A,B],["Cutend=0.5"]); でよい。
プロットデータは点の座標のリストである。したがって，プロットデータを自作してListplot()で表示するこ
とができる。
【例】有限フーリエ級数展開
π ∑30 1−(−1)n
+ sinnx
2 n
n=0
次のようにCindyscriptで関数を定義し，プロットデータpd を作って引数に渡す。
f(x):=(
s=pi/2;
repeat(30,n,s=s+(1-(-1)|^n)/n*sin(n*x));
);
pd=apply(0..200,t,
x=-2*pi+t*4*pi/200;
[x,f(x)];
);
Listplot("1",pd);
Expr([[-2*pi,-0.5],"s","-2\pi",[-pi,-0.5],"s","-\pi",[pi,-0.5],"s",
"\pi",[2*pi,-0.5],"s","2\pi",[0,pi],"w2","\pi"]);
y
π
x
O
−2π −π π 2π
リストの長さには制限がある。たとえば，タートルグラフィクスを用いたシェルピンスキーのギャスケットで
は200くらいずつのリストに分割する。
20

### Page 21

⇒関数一覧
関数 Mksegments()
機能 すべての幾何線分のPD を作成
説明 Cinderellaの「線分を加える」ツールで描いたすべての線分をそのままプロットデータとする。たとえば，線
分ABを作ると，プロットデータsgABが作成される。その後，インスペクタで点Bの識別名を変更（たとえ
ばQに）すると，プロットデータ名も変更される。線分はすでに描かれていてもよい。
【例】等比数列の例題
三角形の各辺の中点を結んでできる三角形を次々に作っていく，等比数列の図を描く。
まず「線分を加える」ツールで三角形ABCを描く。
「中点を加える」ツールで各辺の中点を取り，「線分を加える」ツールで中点を結ぶ。
これを繰り返す。Mksegments() を書いておけば，Listplot([A,B,C] などを書かなくても，作図ができた時
点で，図のデータができる。
関数 Framedata(name , リスト,options)
機能 矩形を描く
説明 リストの形は2通り。
その1：[中心 ,横 , 縦] で，矩形を描く。横，縦は中心からの距離。
その2：2点のリスト。点が座標でなく名称のときはnameは省略できる。
点の座標は点の名前でもよい。点を座標で与える場合はnameは省略できない。
リストを省略した場合は，描画範囲と同一の矩形を描く。
その2のタイプでは，option として，”center” または ”corner” がある。”center” のときは，中心と対角点
（ 初期設定），”corner” のときは2点を対角点として解釈する。
以下にいくつか例を示す
Framedata("1"); 描画範囲(SW,NE)と同一の矩形を描く
Framedata("2",[[0,0],2,2]); 原点を中心とする縦横幅4の正方形を描く
21

### Page 22

Framedata("3",[A,1.5,1.2]); 点Aを中心とする横3，縦2.4の矩形を描く。(図左)
Framedata([B,C]); 点Bを中心,点Cを頂点とする矩形を描く。(図中央)
Framedata([D,E],["corner"]); 点D,Eを対角点とする矩形を描く。(図右)
C E
1:2
A 1:5 B
D
矩形の角を丸めたい場合は，Framedata()ではなく，Ovaldata()を使うとよい。
関数 Polygonplot(name , 点リスト , 整数,options)
機能 2点を半径とする円に内接する正多角形を描く。
説明 点リストを[A,B] とすると，Aを中心とする半径ABの円周上に点をとって正多角形を描く。ただし円は描か
ない。A,B は座標でもよい。
点リストが座標ではなく作図してある点の名称のとき，オプションに”Geo=y” をつけると，頂点の幾何点を
作る。幾何点の名称はBに番号を付けたものとなる。整数でない数を指定した場合は，きちんと閉じない折れ
線が描かれる。
【例】点リストとoptionの違いによる作図と，TeXの図を示す。
Addax(0);
Polygonplot("1",[[-4,1],[-4,3]],7);
Polygonplot("2",[A,B],7);
Polygonplot("3",[C,D],7,["Geo=y"]);
円に内接する形でなく，与えられた線分ABを１辺とする正多角形を描くには次のようにする。
線分ABは，Cinderellaの作図ツールなどで描かれているものとする。ただし，線分でなく，両端の点が与え
られているだけでもよい。Cindyscriptで点A,Bが複素平面上にあるものとして，多角形の頂点の位置を計算
する。
【例】ABを1辺とする正五角形を描く。
n=5;
22
1

### Page 23

pti=[complex(A),complex(B)];
th=2*pi/n;
repeat(n-2,s,
z1=pti_s;
z2=pti_(s+1);
z=z2+(z2-z1)*(cos(th)+i*sin(th));
pti=append(pti,z);
);
pt=apply(pti,gauss(#));
pt=append(pt,A.xy);
Listplot("1",pt);
ptiは，各頂点に対応する複素数のリスト，ptが各頂点の座標のリストである。
⇒関数一覧
1.2.3 曲線
関数 Bezier(名前，節点リスト，制御点リスト，[オプション] )
機能 ベジェ曲線を描く
説明 制御点は，各区間に対して，3次の場合2個，2次の場合1個のリストで与える。
オプションは
”Num=n”: 節点間の分割数（分点数 −1）を指定できる。 ベジェ曲線とスプライン曲線の関数は節点間が短
い場合が多いので初期設定は10になっている。Plotdata()などと違い，大きい数（200など）を指定すると，
全体の分割数が増大して描画時間がかかるようになってしまうので注意。
C
【例】
2次ベジェ曲線
Bezier("1",[A,B],[C]);
A
B
C D
3次ベジェ曲線
Bezier("2",[A,B],[C,D]);
A
B
節点を増やす。2次と3次。 D E F
Bezier("3",[A,B,C],[[D],[E,F]]);
A B
C
全て同じ次数の場合，次のようにしてもよい。
Bezier("4",[A,B,C,D],[E,F,G,H,K,L] );
H
K
G
E F L
B C D
A
オプションの例
Bezier("5",[A,B,C],[[D],[E,F]],["Num=3"]);
23

### Page 24

D
C
A B
E F
Bezier("6",[A,B,C],[[D],[E,F]],["Num=40","da"]);
D
C
A B
E F
Numを（ベクトルとして）区間ごとに与えることもできる。
Bezier("1",[A,B,C,D],[E,F,G,H,K,L],["Num=[2,3,4]"]);
H
K
G
E F L
B C D
A
関数 Beziersmooth(名前，節点リスト，[オプション] )
機能 節点間を3次ベジェ曲線でスムーズに結んだ曲線を描く
説明 節点をはさむ制御点は１直線上にとる（したがって，１つは半自由点で，直線上しか動けない）。制御点は自動
的に配置される。その後，節点や制御点を動かして，描きたいものにする。
【例】
Beziersmooth("1",[A,B,C,D]);
B C2p
C1q D
C3q
C1p
C2q
A C C3p
bz1
その後，節点や制御点を動かして，描きたいものにする。ただし，C2p は C1q と B を通る直線上しか動けな
い。C3p は C2q と C を通る直線上しか動けない。
C2p
C1q B
D
C1p C3q
A bz1 C2q C
C3p
24

### Page 25

関数 Beziersym(名前，節点リスト，[オプション] )
機能 節点間を3次ベジェ曲線でスムーズに結んだ曲線を描く
説明 節点をはさむ制御点は節点に関し対称（片方は表示されず，動かせない）。制御点は自動的に配置される。その
後，節点や制御点を動かして描きたいものにする。
【例】
Beziersym("1",[A,B,C,D]); B C2p
C1q D
C2p と C3p は表示されない
C3q
C1p
C2q
A C
bz1 C3p
その後，節点や制御点を動かして，描きたいものにする。
C2p と C3p は表示されず，動かせない。
C1q
B D
C2p
C1p
C3q
A C2q C C3p
⇒関数一覧
関数 Mkbeziercrv(名前, [節点リスト,制御点リスト] のリスト,options )
機能 複数のベジェ曲線を描く
説明 [節点リスト,制御点リスト] が１つの場合は，Bezier()と同じ。
【例】ベジェ曲線を2つ描く。
Mkbeziercrv("5",[[[A,B,C],[[D],[E,F]]],[[G,H,K,L],[[M],[N,O],[P]]]]);
M N O P
D E F
H
A B G K L
C
関数 Mkbezierptcrv(節点リストptlist，[オプション] )
機能 ベジェ曲線を描く
説明 制御点は，自動的に配置される。
複数の場合は[ ptlist1, ptlist2.... ]
名前は，A から順に自動的につける。
オプション
"Deg=..." 次数指定ができる。（初期設定は3次）
"Num=..." 各区間の区間数（分点数−1）を指定できる。（初期設定は10）
25

### Page 26

B
【例】
Aq1 Ap2
Mkbezierptcrv([A,B,C]); Ap1 Aq2
A C
bzA
その後，節点や制御点を動かして，
Aq1
描きたいものにする。
Ap1
B
A C
Ap2 Aq2
bzA
Mkbezierptcrv([A,B,C],["Deg=2"]);
B
Deg=2 とすると2次になる。
Ap1 Ap2
制御点は各区間に１個ずつできる。
A C
bzA
複数の場合は[ ptlist1, ptlist2.... ]
Mkbezierptcrv([[A,B,C],[D,E,F,G]]);
G
B E
Aq1
Ap2 Bq1 Bp2
Ap1
Aq2 Bp1 Bq2 Bq3
Bp3
A
C
D F
bzA bzB
関数 Bspline(名前，制御点リスト，[オプション] )
機能 2次B-spline曲線を描く
説明 節点は自動的に計算され，表示されない
【例】Bspline("1",[A,B,C,D,E])
これは， Bezier("1",[A,(B+C)/2,(C+D)/2,E],[B,C,D]) と同じ。曲線の名前が bz1 ではなく bzb1 と
なる。
通常のB-spline曲線の端の制御点の代わりに，端点を動かせるようにしている。
D
B
A
C E
26

### Page 27

【例】Bspline("1",[A,B,C,D,A]);
リストの最初と最後が同じ場合は閉曲線になる。
Bezier("1",[(D+A)/2,(A+B)/2,(B+C)/2,(C+D)/2,(D+A)/2],[A,B,C,D]);
と同じ。
B C
D
A
参照：Ospline：大島のスプラインを描く
関数 CRspline(名前，節点リスト，[オプション] )
機能 単独のCatmull-Rom スプライン曲線を描く
説明 自由点は，節点のみで，制御点は節点から作られ移動はできない。
オプションに，通常のオプションのほか，次が使える。
size ->n:画面上での線の太さを指定する。
【例】CRspline("1",[A,B,C,D]);
D
B
A C
関数 Ospline(名前，制御点リスト，[オプション] )
機能 大島のspline曲線を描く
説明 制御点を通るスプライン曲線を描く
リストの最初と最後が同じ場合は閉曲線になる。
【例】Ospline("1",[A,B,C,D,E]);Ospline("1",[A,B,C,D,A]);
D
C
A B
スプライン曲線については次も参照されたい：Bspline：Ｂスプラインを描く
関数 Circledata(name,リスト,options)
機能 円または多角形を描く。
説明 中心の点と，円周上の1点（か半径），または3点をリストで与えて円を描く。
中心と円周上の点を，座標ではなく幾何要素名で指定する場合は name は省略可。
optionsは以下のものをリストで与える。省略した場合は実線で円が描かれる。
27

### Page 28

”Rng=[θ ,θ ]” 角θ からθ の範囲の弧を描く。角は弧度法で与える。
1 2 1 2
”Num=分割数” 円を描くときの分割数。値が小さい場合は多角形になる。
線種 ”dr, n”, ”da,m,n” , ”do,m,n”
【例】いろいろな円を描く。
原点中心，半径2の円 Circledata("1",[[0,0],[2,0]]);
（[[0,0],2]でもよい）
A中心，半径ABの円 Circledata([A,B]);
A中心，半径2の円 Circledata("1",[A,A+[2,0]]);
（[A,2]でもよい）
3点A,B,Cを通る円 Circledata([A,B,C]);
下図左より，オプションに ”dr,2” , ”da” , ”do” をつけた場合。
Circledata([A,B,C]);で，3点A,B,Cを通る円を描いたとき，できた円の中心はPointdata("1",[crABCcenter]);
で作図できる。
【例】A中心，半径AB，中心角60°の弧を描く。
Circledata([A,B],["Rng=[0,pi/3]"]);
【例】A中心，半径AB，中心角60°の扇型を描く。点A,B,Cを適当に取っておく。
th=arctan2(B-A);
C.xy=Rotatepoint(B,pi/3,A);
Circledata([A,B],[Assign("Rng=[th,th+pi/3]",["th",th])]);
Listplot([B,A,C]);
Letter([A,"s","A",B,"e","B",C,"nw","C"]);
C
B
A
””
１行目は，ABがx軸となす角を arctan2 関数 によって求めている。
【例】弧を太く描く
Circledata([C,D],["dr,3","Rng=[0,pi/3]"]);
円はNが大きな値の正N多角形として描いている。optionの [”Num=数値”] によってその細かさを指定で
きる。Nの値が小さければ正多角形が描けることになる。
【例】A中心，半径ABの円と，その円に内接する正六角形
28

### Page 29

Circledata("1",[A,B]);
Circledata("2",[A,B],["Num=6"]);
ここで，同じ[A,B]を使うため，nameを付与して区別する必要がある。(下図左)
また，頂点の位置を変えるのであれば，Rng= オプションを使う。（下図右）
Circledata("2",[A,B],["Num=6","Rng=[pi/6,13/6*pi]"]);
A A
B B
関数 Mkcircles()
機能 すべての幾何円のPD を作成
説明 Cinderellaの「円を加える」ツール（3種類いずれでも）で描いたすべての円をそのままプロットデータとす
る。たとえば，中心A，円周上の点をBとした円を作ると，プロットデータcrABが作成される。その後，イ
ンスペクタで点Bの識別名を変更（たとえばQに）すると，プロットデータ名も変更される。円はすでに描
かれていてもよい。
⇒関数一覧
関数 Ellipseplot(name,点リスト ,定義域, options)
機能 焦点と通る点を与えて楕円を描く。
説明 点リストで2つの焦点と通る点を与える。点はCinderellaの幾何点が使える。
また，通る点のかわりに，焦点からの距離の和を実数で与えることもできる。
実際には，媒介変数表示x=acosθ,y =bsinθ を，回転・平行移動して描いている。定義域はこのときのtの
定義域で，省略も可能。省略したときの初期値は[-5,5]
【例】点A,Bを焦点とする楕円を描く。
Ellipseplot("1",[A,B,C]); 点Cを通る楕円を描く。
Ellipseplot("1",[A,B,4]); 焦点からの距離の和が4である楕円を描く。
Ellipseplot("1",[A,B,C],"[0,pi]"); 楕円の半分を描く。
【例】Cinderellaの作図ツールを使う
作図ツールに，焦点と通る点で楕円を描くもの，点の極線を描くツールがある。（モードメニュー / 直線 / 点
の極線）これを利用すると，楕円上にとった点をインシデントにできるので，インタラクティブに図を変更す
ることができる。このCinderellaの作図機能と合わせて，一方の焦点から出た光が楕円上で反射して他方の焦
点に至る，という図を次のようにして描くことができる。
まず，3つの点，焦点A,Bと通る点Cを適当な位置に作図する。次に「焦点と通る点で決まる楕円」ツールを
選び，点A,B,Cを順に指定すると，楕円が描かれる。
モードメニューの「直線」から「点の極線」を選び，点Cと楕円を順に指定すると接線が引かれる。
「垂線を加える」ツールを用いて，点Cで垂線，すなわち法線を引く。（下図）
「点を加える」ツールを用いて，接線，法線上に適当に点を取る。(D,Eとなったとする)
次のスクリプトを書いて実行すると，楕円に関して入射角と反射角が等しくなるように光が反射する様子を図
29

### Page 30

にすることができる。
30

### Page 31

Ellipseplot("1",[A,B,C]);
Lineplot([C,D]);
Lineplot([C,E]);
Arrowdata([A,C]);
Arrowdata([C,B]);
Anglemark([A,C,B]);
Expr([A,"s2","F_1",B,"s2","F_2"]);
y
x
F O F
1 2
また，接線，法線を描かず，この楕円上に点D,E,・・をとり（個数は任意）次のスクリプトを書けば，何本か
の光線が一方の焦点を出て他方の焦点に集まる様子を描くことができる。
Ellipseplot("1",[A,B,C]);
Listplot([A,C,B]);
Listplot([A,D,B]);
Listplot([A,E,B]);
Expr([A,"s2","F_1",B,"s2","F_2"]);
y
x
F O F
1 2
関数 Hyperbolaplot(name,点リスト ,定義域, options)
機能 焦点と通る点を与えて双曲線を描く。
説明 点リストで2つの焦点と通る点を与える。点はCinderellaの幾何点が使える。
また，通る点のかわりに，焦点からの距離の差を実数で与えることもできる。
実際には，ハイパボリック関数を用いた媒介変数表示 x=cosht,y =sinhtを回転・平行移動している。
optionとして，”Asy=線種”を与えると，漸近線を指定した線種で表示する。 初期設定では漸近線は非表示。
【例】点A,Bを焦点とする双曲線を描く。
Hyperbolaplot("1",[A,B,C]); 点Cを通る双曲線を描く。
Hyperbolaplot("1",[A,B,2]);焦点からの距離の差が2の双曲線を描く。
Hyperbolaplot("1",[A,B,C],["Asy=do"]); 漸近線を点線で描く。
31

### Page 32

y
C
x
A O B
⇒関数一覧
関数 Parabolaplot(name，点リスト ,定義域, options)
機能 点リスト[A,B,C]で示された焦点，準線で決まる放物線を描く。
説明 焦点Aと準線BCで決定する放物線を描く。
実際には，2次関数 y =x2 のグラフを回転・平行移動して描いており，定義域は，y =x2 での定義域と考え
てよい。定義域は省略することもできる。省略したときの初期値は[-5,5]
【例】点Aを焦点，直線BCを準線とする放物線を描く
Parabolaplot("1",[A,B,C]);
定義域を −4≤x≤4 とする。
Parabolaplot("1",[A,B,C],"[-4,4]");
点(0,1)を焦点，直線y =−1を準線とする放物線を描く
Parabolaplot("1",[[0,1],[-1,-1],[1,-1]]);
【例】放物線上の2点で引かれた接線と放物線で囲まれた領域を斜線で描く。
Cinderella の作図ツールに，焦点と準線で放物線を描くものがある。また，点の極線を描くツールがある。
（モードメニュー/直線/点の極線）これを利用すると，放物線上にとった点をインシデントにできるので，イ
ンタラクティブに図を変更することができる。このCinderellaの作図機能と合わせて，次の手順で図を描く。
まず，焦点A(0,1)と準線y =−1：BCを作図する。次に「焦点と準線で決まる放物線」ツールを選び，点A
1
と直線BCを指定すると，放物線が描かれる。方程式ではy = x2の放物線である。
4
次に，放物線上に点D,Eをとる。Cinderellaの作図機能を用いているので，この2点は放物線上だけを動かす
ことができる。（インシデント）
モードメニューの「直線」から「点の極線」を選び，点Dと放物線，点Eと放物線を順に指定すると接線が引
かれる。その交点に点を取る。
32

### Page 33

以上で作図ができたので，次のスクリプトを書いて実行する。
Parabolaplot("1",[A,B,C]);
Lineplot([D,F]);
Lineplot([E,F]);
Hatchdata("1",["iii"],[["gr1para","s"],["lnEF","n"],["lnDF","n"]]);
これで，次図ができる。このあと，文字などは適当に追加する。
y
x
O
なお，Cinderellaの作図ツールで放物線を描かず，焦点Aと準線上の点B,Cだけを用意して，次のスクリプ
トで描くこともできる。
Parabolaplot("1",[A,B,C]);
Putoncurve("D","gr1para");
Putoncurve("E","gr1para");
Tangentplot("1","gr1para","x="+D.x);
Tangentplot("2","gr1para","x="+E.x);
Hatchdata("1",["iii"],[["gr1para","s"],["lntn1","n"],["lntn2","n"]]);
関数 Ovaldata(name, 点リスト,options)
機能 角を丸くした矩形を描く
説明 中心と対角の１点を指定し，角を丸くした矩形を描く
optionsは，角の落とし具合と線種など。 初期設定は0.2
【例】いくつかの例を示す。
Ovaldata("1", [A,B]);
Ovaldata("2", [C,D],[0]);
Ovaldata("3", [E,F],[1,"dr,3"]);
Ovaldata("4", [G,H],[1.5,"da"]);
B F
H
A C E G
D
1.2.4 関数のグラフ
関数 Plotdata(name , 式 , 変数と定義域 , options)
機能 関数のグラフを描く。プロットデータの名前は，gr
説明 式で表された関数のグラフを，指定された定義域で描く。
式，定義域は ” ” でくくって文字列とする。定義域はx=に続いてリストで指定。
options は次の通り。
33

### Page 34

線種 ”dr, n”, ”da,m,n” , ”do,m,n”
”Num=数値” 描画時の分割数
”Dis=数値” 値が指定数値以上ジャンプする場合は不連続点とみなす。
”Exc=数値リスト リストで示された点は除外する。
”Exc=関数” 関数の零点は除外する。
”Color=RGB” 色指定。RGBはCMYKでもよい。
【例】2次関数 f(x)=x2−2x のグラフを定義域指定なしで描く。
Plotdata("1","x^2-2*x","x");
y
x
O
Plotdata("1","x^2-2*x","x",["Color=[1,0,0]"]);
とすると赤で描かれる。
( )
π
【例】三角関数 2sin 2x− のグラフを，定義域 0≤x≤2πで描く。
4
Plotdata("3","2*sin(2*x-pi/4)","x=[0,2*pi]");
y
x
O
CindyScript では，plot( 式 , 定義域 ); で描くが， KETCindyを用いるときは，CindyScript のplot 関数の
かわりに，このPlotdata を使えばよい。
軸に数字を入れるのであれば，Letter() を用いる。
optionsの使用例
Plotdata("1","sin(x)+3","x"); 初期設定
Plotdata("2","sin(x)+2","x",["dr,2"]); 同じく，太さ2で描く
Plotdata("3","sin(x)+1","x",["da"]); 同じく，破線で描く
Plotdata("4","sin(x)","x",["do"]); 同じく，点線で描く
結果は次図上から。
y
x
O
34

### Page 35

Num=分割数の指定
グラフの描画は，区間を分割して関数値をとり，各点を結ぶという通常の方法によっている。Nの指定はこの
分割数の指定である。 初期設定は50。思うような結果が得られない場合はこの値を大きく指定するとよい。
下図左は 初期設定，右は Num=200。
y
x
O
不連続点の指定
Dis オプションにより，値がジャンプする不連続点を線で結ばないようにする。Numオプションと合わせて使
うと効果が上がる。
【例】f(x)=tanx のグラフは，そのままではあたかも漸近線が描かれたようになるが，これは，不連続点の前
後をそのまま結んでいるためである。（下図左）
Plotdata("1","tan(x)","x",["Num=200","Dis=50"]);
のように，”Dis” オプションを使えば余分な線が描かれなくなる。（下図右）
y y
x x
O O
【例】ガウス記号 [x] で表される関数（床関数 : floor()）のグラフ。
Plotdata("1","floor(x)","x",["Num=100","Dis=0.9"]);
Drwxy();
repeat(7,s,start -> -2,
Pointdata(text(s+3),[s+1,s],["Inside=0","Size=3"]);
);
y
x
O
35

### Page 36

なお，ここで，Pointdata() のname を text(s+3) としているのは，s が −2 から始まるので，負の数が使え
ない name を 1 から始まるようにするためである。
関数に文字係数がついており，文字係数の値を変化させながらグラフを描くには，Assign を使うか，Defvar
で変数を定義する。
【例】直線 y =bx−b2 の係数bを変化させて描き，包絡線をうかびあがらせる。
y
repeat(50,t,
cb=t/5-5;
Plotdata(text(t),Assign("b*x-b^2","b",cb),"x");
);
または
x
O
Defvar("b");
repeat(50,t,
b=t/5-5;
Plotdata(text(t),"b*x-b^2","x");
);
関数 Implicitplot(name,式,xの定義域,yの定義域, options)
機能 陰関数のグラフを描く。
説明 陰関数の式を与えてグラフを描く。式，定義域とも文字列。
options は，”r”,”m”,”Wait=n” が指定できる。Wait の初期値は10。
”r”,”m”に関しては，オプションなしのとき
i) データファイルがなければ，新しく作る
ii) データファイルが既にあればそれを読み込む
”m”のとき，強制的にデータファイルを作り直す。
”r” のとき，すでにあるデータファイルを読み込む。
【例】楕円を描く。
Implicitplot("1","x^2-x*y+2*y^2=4","x=[-3,3]","y=[-2,2]");
y
x
O
関数 Deqplot(name,式，変数名，初期値，options)
機能 微分方程式の解曲線を描く
説明 微分方程式と初期値を与えて解曲線を描く。
【例】y′′ =−yで，初期値がx=0のときy =1,y′ =0 の解曲線
Deqplot("1","y''=-y","x",0, [1,0]);
注） 微分記号のプライムは，シングルクォートまたはバッククォート。
36

### Page 37

y
x
O
【例】y′ =y∗(1−y)で，x=0のとき，y =0.5の解曲線
Deqplot("2","y'=y*(1-y)","x",0, 0.5,["Num=100"]);
y
x
O
【例】[x,y]′ =[x(1−y),0.3y(x−1)]で，変数はt，t=0（区間の左端）のときのx,yの値が1と0.5 である
ときの解曲線
Deqplot("3","[x,y]'=[x*(1-y),0.3*y*(x-1)]","t=[0,20]",
[1,0.5],["Num=200"]);
y
x
O
関数 Paramplot(name , 式 , 変数と定義域,options)
機能 媒介変数表示の曲線を描く。
説明 式は””でくくった媒介変数表示のリストで与える。
定義域も ” ” でくくって文字列とし，t=に続いてリストで指定する。
options は線種が有効
【例】サイクロイド曲線を描く。
Paramplot("1","[t-sin(t),1-cos(t)]","t=[0,2*pi]");
y
x
O
【例】optionsの使用例。左から， 初期設定，太線，破線，点線の楕円
Paramplot("1","[2*cos(t)-5,sin(t)]","t=[0,2*pi]");
Paramplot("2","[2*cos(t),sin(t)]","t=[0,2*pi]",["dr,2"]);
Paramplot("3","[2*cos(t)+5,sin(t)]","t=[0,2*pi]",["da"]);
Paramplot("4","[2*cos(t)+10,sin(t)]","t=[0,2*pi]",["do"]);
37

### Page 38

関数 Polarplot(name , 式 , 変数と定義域,options)
機能 極座標表示r =f(θ)の曲線を描く。
【例】カージオイド曲線を描く。
Polarplot("1","2*(1+cos(t))","t=[0,2*pi]",["Num=200"]);
y
x
O
関数 Periodfun(定義式,周期,options)
機能 周期関数のグラフを描く。戻り値はMaxima形式の式とperiodのリスト。
説明 周期関数の式を定義してグラフを描く。定義式は，関数式（文字列），区間，分割数のリスト。
この関数固有のオプションは ”Con=” で，不連続点を線で結ぶか否かと，その時の色。初期設定は破線。結ば
ない場合は ”Con=n”，色指定は線種に続いてコンマで区切って指定する。たとえば，”Con=do,Color=red”。
周期（描画回数）は，数またはリストで指定する。周期がmのとき，2m+1周期分描かれる。
注意）関数は左右対称な定義域 [-a,a] で定義すること。
【例】矩形関数のグラフ
defL=["0",[-1,0],1,"1",[0,1],1];
Periodfun(defL, 2,["dr,2"]);
memori=apply(-5..5,x,[x,text(x)]);
memori=flatten(remove(memori,[[0,"0"]]));
Htickmark(memori);
Vtickmark([1,"1"]);
y
1
x
−5 −4 −3 −2 −1 O 1 2 3 4 5
一方を放物線にした場合
defL=["0",[-1,0],1,"x^2",[0,1],50];
Periodfun(defL, 2, ["Con=n","dr,2"]);
memori=apply(-5..5,x,[x,text(x)]);
memori=flatten(remove(memori,[[0,"0"]]));
Htickmark(memori);
Vtickmark([1,"1"]);
38

### Page 39

y
1
x
−5 −4 −3 −2 −1 O 1 2 3 4 5
関数 Fourierseries(name,係数,周期,項数)
機能 フーリエ級数のグラフを描く。
∑∞
説明 a + (a cosnx+b sinnx) を描く。係数は a ,a ,b のリストで，それぞれの要素は文字列とする。
0 n n 0 n n
n=1
この関数固有のオプションは ”Con=y/n” で，不連続点を破線で結ぶか否か。 初期設定は y。
矩形波のフーリエ近似のような場合は，オプションとして，[”Num=200”]（100以上の値を指定）をつけると
よい。
【例】矩形波のフーリエ近似
Fourierseries("1",["1/2","0","(1-(-1)^n)/(pi*n)"],2,6,["Num=200"]);
y
x
O
関数 Tangentplot(name , PD , 位置 , options)
機能 接線を描く。プロットデータの名前は，lntn
説明 曲線PDの指定した位置での接線を描く。位置は ”x=n” で指定する。
使用例はParabolaplotの例を参照。
⇒関数一覧
1.2.5 文字
関数 Expr([座標 , 位置 , 文字列],option)
機能 TEX記法の文字列を与えて数式を書く。
説明 Letterで文字列の前後に$ $をおくのと同じ。
導関数の記号は，′（シングルクォート）を用いる。
複数の箇所に文字を書く場合は，Letter() と同様，引数をリストにして与える。
optionは サイズの倍率(”Size=”, Cinderraのみ)と色(”Color=”)。
1 1
【例】f(x)= x2とその導関数 f′(x)= x の式，軸上に必要な数を入れる。
4 2
Expr([[-3,3],"e","f(x)=\frac{1}{4} x^2",[3,1.5],"s2e2",
"f‘(x)=\frac{1}{2}x",[2,0],"s","2",[0,1],"w","1"]);
39

### Page 40

y
f(x)= 1x2
4
1 f′(x)= 1x
2
x
O 2
【例】対数関数の定積分の記号および積分値を図に書き込む。
Expr([Q+[0.2,0],"ne","\displaystyle \int_a^b \log x\,dx="+
text(L.x*(log(L.x)-1)-G.x*(log(G.x)-1)) ]);
L.x*(log(L.x)-1)-G.x*(log(G.x)-1) は，点L,G(図のa,b)をドラッグして
積分範囲を決めるようにしているので，そこから計算した値。
矢線は Arrowdata(Q,P); で表示している。矢線の始点がQ
∫
b
y
logxdx=3.55
a
(a=0.46, b=4.8)
1
a
x
O 1 e b
関数 Exprrot(座標 , 向き , 移動，文字列，option)
機能 TEX記法の文字列を与えて傾いた数式を書く。
説明 「座標」の位置に，指定された向きで数式を書く。
向きはベクトルで与える。
移動（オプション）は t (接線方向の移動) ， n (法線方向の移動) ，反転 (r)。
座標，向きとも，Cinderellaで作図した幾何点を用いることができる。
optionは サイズの倍率(”Size=”, Cinderraのみ)と色(”Color=”)。
Exprrot([3,2],[2,-1],"t0n1","\sqrt{3}");
Exprrot(C,B-A,"t0n0r","\frac{2}{3}");
y
√
3
2 3
x
O
⇒関数一覧
関数 Letter([位置, 方向, 文字列],option)
機能 文字列を表示する
説明 「位置（座標）」と方向で指定された場所に文字を書き込む。
40

### Page 41

位置（座標）は点の名前で指定することもできる。
場所は上下左右を東西南北で表し， n/s/w/e/c の方向で表す。cは中央。
指定位置からの距離を，数値で与えることもでき，e2, e3 は e より少し離して置く。
複数の文字列をリストの形にして渡すことができる。
注）導関数の記号′は，数式モード（$ ではさむ）で′（シングルクォート）を用いる。
optionは サイズの倍率(”Size=”, Cinderraのみ)と色(”Color=”)。
文字列が一つのときは，
Letter(位置, 方向, 文字列,option)
にできる。
【例】
座標 (2,1) の南東にＰを表示
Letter([[2,1] ,"se","P"]);
点Ｃを中央としてＣを表示
Letter([C ,"c", "C"]);
点Aの南西にA，Eの南に数式を表示
Letter([A,"sw","A",E,"s","$ f(x)=\frac{1}{4} x^2 $"]);
関数 Letterrot(座標, 方向ベクトル,移動, 文字列, option)
機能 文字列を回転して表示する
説明 座標で示された位置に，方向ベクトルで指定された向きに回転して文字を書き込む。
移動（オプション）は t (接線方向の移動) ， n (法線方向の移動) ，反転 (r)。
optionは サイズの倍率(”Size=”, Cinderraのみ)と色(”Color=”)。
Letterrot(C,B-A,"t2n5","AB");
移動を略して
Letterrot(C,B-A,"AB");
とすることもできる。この場合は，微小な移動はされない。
⇒関数一覧
1.2.6 マーキング
関数 Anglemark(name,点リスト , options)
機能 点リストで示された角に弧の形状の角の印をつける。
説明 Listplot() などと同様，点リストが点名の場合はnameは省略できる。弧を描かず文字だけを入れる場合は
options に ”nodisp” を指定する。
optionsは次の通り。
数値角の印の大きさ。 初期設定は１
線種”dr, n”, ”da,m,n” , ”do,m,n”
”Expr=文字” または ”Letter=文字” : 文字を入れる
”Expr=位置 , 文字”: 位置を指定して文字を入れる。位置は頂点からの距離。
【例】三角形の内角に印をいれ，文字を書き込む。（下図左）
Listplot([A,B,C,A]);
Letter([A,"n1","A",B,"w1","B",C,"e1","C"]);
Anglemark([B,A,C]);
41

### Page 42

Anglemark([C,B,A],["Expr=\theta"]);
Anglemark([A,C,B],[2,"dr,3","Expr=2,\alpha"]);
【例】三角形の内角に弧を描かず，◦ だけ書き込む。（下図右）
Listplot([A,B,C,A]);
Letter([A,"n1","A",B,"w1","B",C,"e1","C"]);
Anglemark([C,B,A],["Expr=\circ","nodisp"]);
A
A
α
θ
◦
B C
B C
※角の印には平行四辺形の形状のものもある。Paramark()を参照のこと。
関数 Paramark(name,点リスト , options)
機能 点リストで示された角に平行四辺形の形状の角の印をつける。
説明 Listplot() などと同様，点リストが点名の場合はnameは省略できる。
optionsは次の通り。
数値角の印の大きさ。 初期設定は1
線種”dr, n”, ”da,m,n” , ”do,m,n”
”Expr=文字”: 文字を入れる
”Expr=位置 , 文字”: 位置を指定して文字を入れる。位置は頂点からの距離。
A
【例】三角形の内角に印をいれ，文字を書き込む。
Listplot([A,B,C,A]);
Paramark([A,B,C]); α
Paramark([C,A,B],[3,"Expr=\alpha"]);
Paramark([B,C,A],["dr,2","Expr=2,\theta"]); θ
C
B
※角の印には弧の形状のものもある。Anglemark() を参照のこと。
関数 Bowdata(name,点リスト , options)
機能 弓形を描く
説明 点リストで与えられた2点を結ぶ弓形を描く。
2点を反時計回りに回る方向に弓形を描く。
optionsは，[曲がり , 空白サイズ, 文字, 線種]
曲がりは弧の曲がり具合の指定。 初期設定は1
空白サイズは中央にあける空白の大きさ
文字は，”Expr=文字”
また，”Expr=微小移動 , 文字”で位置を指定して文字を入れる。
微小移動は t,n。移動量は数字をつける（正負が可）。
42

### Page 43

t は線分方向の微小移動，n は線分と垂直方向の微小移動
微小移動の最後にr をつけると，上下反転する。
【例】三角形ABCの各辺に弓形マークをつけ記号を入れる。
A
Listplot("1",[A,B,C,A]);
Letter([A,"n1","A",B,"w1","B",C,"e1","C"]);
10
Bowdata("1",[A,B]);
Bowdata("2",[B,C],[1,"Expr=t0n3,a"]);
Bowdata("3",[C,A],[2,1.2,"Expr=10","da"]);
B C
a
これに加え，文字を回転して表示する方法がある。ただし，Cinderellaの画面には反映されない。文字をを回
転するには次のように書く。
”Exprrot=微小移動 , 文字”
以下にいくつか例を示す。
Bowdata([B,A],[1,1,"Exprrot=a"]);
Bowdata([D,C],[1,1,"Exprrot=t3n0,a"]);
Bowdata([F,E],[1,1,"Exprrot=t-3n0,a"]);
Bowdata([H,G],[1,1,"Exprrot=t0n3,a"]);
Bowdata([L,K],[1,1,"Exprrot=t0n0r,a"]);
Bowdata([N,M],[1,1,"Exprrot=t3n0r,a"]);
a a a a a a
no t3n0 t-3n0 t0n3 t0n0r t3n0r
option
関数 Segmark(name,リスト,options）
機能 線分に印をつける
説明 リストで与えられた2点を端点とする線分に印をつける。
オプション
Type=印の種類 ”seg(,n)”,”cir”,”poly(,n)”
Width：線の幅，Size：大きさ
【例】四角形ABCDを描き線分に印をつける。
Listplot([A,B,C,D,A]); A
D
Segmark("1",[A,B],["Type=seg,1"]);
Segmark("2",[B,C],["Type=seg,2","Width=1.2"]);
Segmark("3",[C,D],["Type=cir"]);
Segmark("4",[D,A],["Type=poly,4","Size=1.5"]);
B C
関数 Htickmark([横座標 , 方向 , 文字])
機能 横軸に目盛と文字を書く。
説明 引数は位置（横座標），方向，文字。複数点の情報を[ ]内にまとめて記入できる。方向を省略すると ”s1”に
なる。微調整は描画面には反映されないので，PDFにして確認する。目盛の長さは Setmarklen() で設定で
きる。
【例】 方向指定の例：Htickmark([1,"1",2,"n1","2",3,"se","3",4,"4"]);
43

### Page 44

y
2
x
O 1 3 4
【例】-5から5までの目盛を打つ。Cindyscriptのリスト処理を使って，次のように引数のリストを作って渡す。
memori=apply(-5..5,x,[x,text(x)]);
memori=flatten(remove(memori,[[0,"0"]]));
Htickmark(memori);
１行目，apply のカッコ内の -5..5 でリスト[-5,-4,-3,-2,-1,0,1,2,3,4,5] ができる。それを用いて，applyで[数,
数の文字] からなるリストができる。text(x) はxを文字にする関数。2行目で，このリストから，[0,”0”]を除
き，リストを平滑化する。 結果は次のようになる。
y
x
−5 −4 −3 −2 −1 O 1 2 3 4 5
関数 Vtickmark([横座標 , 方向 , 文字])
機能 縦軸に目盛と文字を書く。
説明 Htickmarkと同様。縦軸に目盛を書く。方向を省略すると ”w1”になる。
【例】点(0, 1), (0, 2)の西側に1, 2を表示する。
Vtickmark([1,"1",2,"2"]);
関数 Rulerscale(始点 ，横軸目盛 , 縦軸目盛)
機能 目盛を打つ
説明 始点の位置を縦横の起点として目盛りを打つ。目盛はリストで与える。[”r”,a,b,c,d]の形式では，aからbま
でc間隔で，倍率dの目盛を打つ。[”f”,n1,”str”,n2,”str”,・・] の形式では，nと”str”がセットで，nの位置
に”str”を書く。ただし，位置はCinderellaの描画面の原点を0とする。
Listplot() とともに用いると，座標軸とは異なる線分に目盛を打つことができる。
Framedata() とともに用いると矩形に目盛を打つことができる。
【例】x軸上の (2,1) から (9,1) まで線分を引き，1目盛を10として目盛を打つ。
Listplot("1",[[2,1],[9,1]]);
Rulerscale([2,1],["r",2,9,1,10],[]);
y
20 30 40 50 60 70 80 90
x
O
【例】Aを原点に置いた矩形枠を描き，横に0,1,2,3,4,5，縦に d1，d2 の目盛を打つ。
Framedata("1",[A,B],["corner"]);
Rulerscale(A,["r",0,5,1],["f",1,"d1",3,"d2"]);
44

### Page 45

d2
d1
0 1 2 3 4 5
⇒関数一覧
1.3 プロットデータの操作
関数 Drawfigures(or Drwfigs)(name ,データリスト,オプションリスト)
機能 複数のプロットデータのスタイル（オプション）をリストで与えて描画する
説明 複数のプロットデータをまとめて扱う。たとえば，円と，円周上の点の2つのプロットデータをまとめて扱え
ば，平行移動や回転で，それらのプロットデータをまとめて平行移動や回転ができる。
【例】サイクロイドの図を描く。
opcr=["dr"];
oppt=["Size=2","Color=red"];
Circledata("1",[[0,1],[0,0]],opcr);
Pointdata("1",[0,0],oppt);
ad1=["cr1","pt1"];
dt=2*pi/32;
opcr=["dr,0.3"];
nn=32;
forall(1..nn,
t=dt*#;
Rotatedata(2,ad1,-t,[[0,1],"nodisp"]);
Translatedata(2,"rt2",[t,0],["nodisp"]);
Drawfigures(text(#),["tr2_1","tr2_2"],[opcr,oppt]);
);
y
x
O
最初に，まとめて平行移動や回転をするデータをリスト化しておく。また，各データのオプションをリストと
して与えていることに注意。こうすることで，サイズや色などのスタイルを元のスタイルに合わせることがで
きる。
⇒関数一覧
関数 Changestyle(PDリスト, options)
機能 描画オプションを変更する
説明 複数の図形の描画オプションを一括して変更する。
【例】線分AB，円ABの線を破線にしてTEXに書き出さないようにする。
45

### Page 46

Changestyle(["sgAB","crAB"],["da","notex"]);
関数 Invert(PD)
機能 プロットデータを逆順にする
関数 Joincrvs(name, プロットデータのリスト, options)
機能 隣接する曲線プロットデータ のリストを繋いで1本の曲線を作る。
説明 曲線のリストは隣接する順番で指定する。
optionsは線種”dr, n”, ”da,m,n” , ”do,m,n”
√ √
【例】線分y =x (− 2≤x≤ 2)と半円で得られる閉曲線を描いて黄色で塗る。
点Aは原点に，点Bは適当なところに作図しておく。
y
Plotdata("1","x","x=[-sqrt(2),sqrt(2)]");
B.xy=[sqrt(2),sqrt(2)];
Circledata("2",[A,B],["Rng=[pi/4,pi/4*5]"]);
Joincrvs("1",["gr1","cr2"]);
Shade(["join1"],["Color=yellow"]);
x
O
関数 Partcrv(name, A, B, プロットデータ, options)
機能 曲線プロットデータ上の点A, B の間の部分曲線を描く。
説明 2点A, Bの順序は曲線の向きと同一であること。曲線の向きは，y = f(x)のグラフではx座標が増加する
向き。
optionsは線種”dr, n”, ”da,m,n” , ”do,m,n”
【例】放物線を点線で描き，一部を実線で描く。
Plotdata("1", "x^2", "x", ["do"]);（プロットデータの名前はgr1となる）
Partcrv("1", [0,0], [1,1], "gr1");
y
x
O
【例】円の一部を実線で描く。円のプロットデータは指定した円周上の点から反時計回りの順にできる。点A
は円の中心，Bは円周上の点とする。点P,Qは適当な位置に作図しておく。
Circledata([A,B], ["do"]);
Plotdata("1", "x^2", "x", ["do"]);
tmp=Intersectcrvs("crAB","gr1");
P.xy=tmp_1;
Q.xy=tmp_2;
Partcrv("1", P, Q, "crAB");
Partcrv("2", Q, P, "crAB");
46

### Page 47

y y
P P
Q Q
x x
O O
part1 の図 part2 の図
【例】放物線y =x2が円で切り取られる部分を実線で描く。 y
Circledata("1",[[0,2],[0,0]],["da"]);
Plotdata("1","x^2","x",["do"]);
tmp=Intersectcrvs("cr1","gr1");
Partcrv("2",tmp_2,tmp_1,"gr1",["dr,2"]);
x
O
関数 Enclosing(name , PDリスト , [開始位置, 交点計算の許容限界1, 2])
機能 複数の曲線から閉曲線を作る。
説明 開始位置は，最初と最後の曲線の交点が複数あるときに指定する。
開始点は近くに取ればよい。許容限界は，通常は指定しなくてよい。
【例】放物線と直線で囲まれる領域に色を塗るために Shade() を使う。
Plotdata("1","x^2","x");
Lineplot("1",[[0,0],[1,0]]);// axis x
Lineplot("2",[[2,0],[2,1]]);
Enclosing("1",["Invert(gr1)","ln1","ln2"],["nodisp"]);
Shade(["en1"],["Color=red"]);
y
x
O
注）閉曲線のとりかたでは，出発点を原点にした反時計回りまたは時計回りにすると
反時計回りでEnclosing("1",["ln1","ln2","Invert(gr1)"]);
時計回りでEnclosing("1",["gr1","Invert(ln2)","Invert(ln1)"]);
⇒関数一覧
47

### Page 48

関数 Hatchdata(name , 方向リスト , プロットデータ , options)
機能 閉曲線の内部に斜線を引く。
説明 引数は，曲線名，内部外部のパターンを与える”i”，”o”の文字列，閉曲線を与える曲線と領域の内部を定める
方向のリストとオプション。
オプション（カッコ内はデフォルト値）
角度(45)，間隔(1)，"Max=(20)" 斜線の最大本数，
"No=点リスト" 点リストの点が選ばれているときは実行しない
"File=y/m/n (n)" データファイルを作るか
"Check=点リスト" 点リストの点が変更されていたら，ファイルを作り直す
【例】円の内部。(次図左)
Circledata([A,B],["dr"]);
Hatchdata("1",["i"],[["crAB"]],["dr,0.7"]);
【例】3つの閉曲線の内側・外側のパターンが同一である領域（次図右）
Circledata([A,B],["dr"]);
Paramplot("1","[4*cos(t),2*sin(t)]","t=[0,2*pi]");
Paramplot("2","[2*cos(t),4*sin(t)]","t=[0,2*pi]");
Hatchdata("1",["ioi"],[["crAB"],["gp1"],["gp2"]],["dr,0.7"]);
Hatchdata("2",["iio"],[["crAB"],["gp1"],["gp2"]],["dr,0.7"]);
y y
x x
O O
【例】複数の領域。
Plotdata("1","2*sin(x)","x=[-pi,3*pi]",["Num=100"]);
Listplot([A,B]);
Listplot([A,C]);
Hatchdata("1",["ii"],[["sgAB","n"],["gr1","s"]],["dr,0.7"]);
Hatchdata("2",["ii"],[["sgAC","s"],["gr1","n"]],["dr,0.7"]);
y
2
x
O
−2
【例】複数の領域その2。
48

### Page 49

Plotdata("1","2*sin(x)","x=[-pi,3*pi]",["Num=100"]);
Listplot([A,B]);
Listplot([A,C]);
Hatchdata("1",["iio"],[["sgAB","s"],["sgAC","n"],["gr1","n"]]);
y
2
x
O
−2
【例】3次曲線と接線で囲まれた領域
点Aを原点付近に作図しておく。
Deffun("f(x)",["regional(y)","y=x^3-2*x","y"]);
Plotdata("1","f(x)","x",["Num=100"]);
Putoncurve("A","gr1");
coef=Derivative("f(x)","x",A.x);
Defvar(["coef",coef]);
Deffun("g(x)",["regional(y)","y=coef*(x-A.x)+A.y","y"]);
Plotdata("2","g(x)","x",["Num=1"]);
if(!Isptselected(A),
Enclosing("1",["gr2","Invert(gr1)"],[A,"nodisp"]);
Hatchdata("1",["i"],[["en1"]]);
);
y
点Aをドラッグして曲線上を動かすと，
if(!Isptselected(A),・・・の効果により，
その間は領域の斜線は引かれない。
点A以外の画面上の適当な位置をクリックして，
点Aが選択状態でなくなると斜線が引かれる。
x
引かれる斜線の向きや間隔を変えることもできる。 O
間隔は実数で指定できる。
【例】円の内部または円と直線で区切られた図形
Circledata([A,B]);のプロットデータ crAB を用いて，下図左から
Hatchdata("1",["i"],[["crAB"]]); 円内に傾き45◦の斜線を引く
Hatchdata("2",["i"],[["crAB"]],[-40,2]); 傾き−40◦，間隔を2倍に
Hatchdata("3",["i"],[["crAB"]],["dr,0.5"]);線の太さを0.3倍に
Hatchdata("4",["i"],[["crAB"]],[-45,2,"dr,0.3"]);
円のオプションに ”notex”をつけた場合と，破線で描いた場合。
Circledata([A,B],["notex"]);
Circledata([A,B],["da"]);
49

### Page 50

直線で分けられた領域を作り，対角の上下にハッチをかける。線を描き分ける。
Circledata([A,B]);
Lineplot("1",[A,B]);
Lineplot("2",[A,C]);
Hatchdata("1",["iii"],[["crAB"],["ln1","n"],["ln2","n"]]);
Hatchdata("2",["iii"],[["crAB"],["ln1","s"],["ln2","s"]],[90,0.5]);
⇒関数一覧
関数 Dotfilldata(name , 方向リスト , プロットデータ , options)
機能 領域を点で敷き詰める。
説明 Rとデータの授受をおこなって描画する。書式はHatchdata()と同様。
オプションは，ドットの密度で 0.1〜0.8 程度。 初期設定は0.3。
【例】円グラフ
Partcrv() と Enclosing() で閉曲線を作って点を敷き詰める。
r=3;
p0=r*[cos(pi/2),sin(pi/2)];
p1=r*[cos(-pi/6),sin(-pi/6)];
p2=r*[cos(-3*pi/4),sin(-3*pi/4)];
Circledata("1",[[0,0],[r,0]]);
Listplot("1",[[0,0],p0]);
Listplot("2",[[0,0],p1]);
Listplot("3",[[0,0],p2]);
Partcrv("1",p1,p0,"cr1");
Enclosing("1",["sg2","part1","Invert(sg1)"],[[0,0]]);
Partcrv("2",p2,p1,"cr1");
Enclosing("2",["sg3","part2","Invert(sg2)"],[[0,0]]);
Dotfilldata("1",["i"],[["en1"]]);
Dotfilldata("2",["i"],[["en2"]],[0.1]);
関数 Shade((”名前”), プロットデータのリスト , options)
機能 閉曲線で囲まれた領域を塗りつぶす。
説明 第１引数には，閉曲線を与える曲線分のプロットデータ名を並べる。
デフォルトでは，Joincrvs を使って閉曲線を作っている。ただし，プロットデータのリストに”Invert()”が
50

### Page 51

入っていれば，Enclosingを使う。
optionの Color は，Cinderellaの画面上での描画色をリストで与える。濃さを指定したい場合は色名やRGB
ではなくCMYKにする。
optionsには，他に，次のものがある。
・Enclosingを使うかどうか：”Enc=y/n”（初期値は n）
”Enc=y”のとき，複数のShadeを使うときは，名前をつける。
・Enclosingのときの開始点，描画色
・描画領域のトリミング：”Trim=y/n” （初期値は n ）
・TeXへの書き出しで，先頭に配置するか：”First=y/n” （初期値は n ）
”First=n” のときは，使われているGdataの書き出しの直前におく．
【例】y =2sinxのグラフと直線y =1 とで囲まれた部分に黒0.2の濃さで色を塗る。
Setax([7,"nw"]);
Plotdata("1","2*sin(x)","x",["Num=100"]);
Lineplot("1",[[0,1],[1,1]]);
Enclosing("1",["ln1","Invert(gr1)"],[[2,1],"nodisp"]);
Shade(["en1"],["Color=[0,0,0,0.2]"]);
y
O x
正弦曲線と直線の交点は簡単に計算できるので，次のように Partcrv() で部分曲線を求め，Enclosingで閉曲
線を求めずにShadeを使ってもよい。
Plotdata("1","2*sin(x)","x",["Num=100"]);
Lineplot("1",[[0,1],[1,1]]);
Partcrv("1",[5*pi/6,1],[13*pi/6,1],"gr1");
Shade(["ln1","Invert(part1)"],[[2.5,1],"Color=0.2*[1,0,0,1]"]);
【例】2つの放物線で囲まれた部分を赤で塗る。
Plotdata("1","x^2-1","x=[-3,3]");
Plotdata("2","x^2/2","x=[-3,3]");
Shade(["gr2","Invert(gr1)"],[[-1.5,1],"Color=[1,0,0]","alpha->0.4"]);
ここで，alpha->0.4 は画面上の色濃度指定。
y
x
O
【例】描画領域（NE,SWの矩形領域）からはみ出した部分は表示しないようにする。
51

### Page 52

Plotdata("1","x^2","x");
Partcrv("1",[-1,1],[3,9],"gr1");
Listplot("1",[[3,9],[-1,1]]);
Joincrvs("1",["sg1","part1"]);
Shade(["join1"],["Color=[0,0,0.2,0]","Trim=y"]);
SW,NE を動かしてみると，白枠内だけが色塗りされる。
【例】同心円をリング状に塗る。
下図右のように，同心円をリング状に塗るが，円2つだけでは閉曲線はできない。そこで，左図のように，円
の描き始めを線分で結んで閉曲線を作る。このとき，向きを考えて，Joincrvsで結ぶように，”Enc=n”をつ
ける。線分は非表示にしたいので，"nodisp"オプションをつけておく。なお，点Aを適当な位置に作図して
おく。
r1=2;
r2=1.5;
Circledata("1",[A,A+[r1,0]]);
Circledata("2",[A,A+[r2,0]]);
Listplot("1",[A+[r1,0],A+[r2,0]],["nodisp"]);
Shade(["cr1","sg1","Invert(cr2)","Invert(sg1)"],["Enc=n","Color=green"]);
cr1
cr2
A
sg1
その他，Joincrvs() の例も参照のこと
関数 Reflectdata(name , プロットデータ , 対称点または対称軸,options)
機能 プロットデータの鏡映を作成
説明 プロットデータを指定された点または軸に関して対称移動する。
対称点は座標または，点の識別名。ただし，対称点を座標で示すときは要素がひとつのリストにする。
対称軸はリスト[ 点1, 点2 ]で指定。
【例】中心A , 半径ABの円を描き，そのプロットデータを用いて鏡映を描く。
点Cに関して対称な円を実線
点(-1,2)に関して対称な円を太い実線
直線DEに関して対称な円を破線
Circledata([A,B]);
Reflectdata("1","crAB",[C]);
Reflectdata("2","crAB",[[-1,2]],["dr,2"]);
Reflectdata("3","crAB",[D,E],["da"]);
52

### Page 53

y
(-1,2) C D
B
A
x
O
E
関数 Rotatedata(name , プロットデータ ，角度 , [中心 , options])
機能 プロットデータの位置を回転する
説明 図形を，中心で示された点の周りに回転する。角度は弧度法で与える
中心とoptionsはまとめてリストで与える。
【例】中心A , 半径ABの円を描き，次のように回転して線種を変えて描く。
π π π
点Cを中心に ，点(1,5)を中心に ， 点Dを中心に −
2 3 3
Circledata([A,B]);
Rotatedata("1","crAB",pi/2,[C]);
Rotatedata("2","crAB",pi/3,[[1,5],"dr,2"]);
Rotatedata("3","crAB",-pi/3,[D,"da"]);
y
D (1,5)
B C
A
x
O
⇒関数一覧
関数 Scaledata(name , プロットデータ，x方向比率 , y方向比率 , [中心 , options])
機能 図形の位置を拡大・縮小する
説明 図形の位置をプロットデータを用いて指定された比率で拡大・縮小する
比率は [x方向比率 , y方向比率] のリストで与えてもよい。
中心とoptionsはまとめてリストで与える。optionsは線種
【例】点A(2,1)，B(1,1)，C(-1,-1)，D(3,-1) を作図しておく。
Aを中心とする半径ABの円のプロットデータを作り，
原点中心にx軸方向に3，y軸方向に2拡大する。
53

### Page 54

Ｃを中心にx軸方向に3，y軸方向に2拡大し，実線で太く描く。
−→
原点中心にベクトルODだけ拡大し，破線で描く。
Circledata([A,B]);
Scaledata("1","crAB",3,2,[[0,0]]);
Scaledata("2","crAB",3,2,[C,"dr,2"]);
Scaledata("3","crAB",[D.x,D.y],[[0,0],"da"]);
y
B A
x
O
C D
関数 Translatedata(name , プロットデータ , 移動ベクトル , options)
機能 プロットデータを平行移動する
説明 プロットデータを移動ベクトルで示された分だけ平行移動する。
【例】点A,B,C,Dを作図ツールでとっておく。
Circledata([A,B]); でできる円（crAB）をx軸方向に2，y軸方向に3だけ平行移動して実線で描く。
−→
ベクトルOCだけ平行移動し，実線で太く描く。
−→
ベクトルODだけ平行移動し，破線で描く。
Circledata([A,B]);
Translatedata("1","crAB",[2,3]);
Translatedata("2","crAB",C,["dr,2"]);
Translatedata("3","crAB",D,["da"]);
y
D (2,3)
B A
x
O
C
関数 Intersectcrvs(プロットデータ1, プロットデータ2)
機能 2曲線の交点リストを取得する。
説明 オプションとして，共有点があるかどうかを判断するための限界値があるが，通常は使わない。
【例】円と曲線の交点をP,Qとする。 y
Plotdata("1", "sin(x)", "x", ["Num=100"]); Q
x
54 O
P

### Page 55

Circledata([A, B]);
tmp=Intersectcrvs("gr1","crAB");
P.xy=tmp_1;
Q.xy=tmp_2;
この関数は，交点のデータのリストを返すので，tmp＝[ [ -0.37, -0.36 ], [ 2.13, 0.85 ] ] のように値が返って
くる。交点の順序は PD1, PD2 の順序と曲線の向きによって決まる。曲線の向きは，y =f(x)のグラフでは
x座標が増加する向きで，パラメーター表示曲線ではパラメータの増加する向き。また，PD1 上から探し始め
て PD2 との交点を拾っていく。
交点がひとつの場合も tmp ＝ [ [ 2.45, 0.63 ] ] と 2 重のリストに入っているので，点として取出すには
P.xy=tmp_1; とする。
注）交点の算出は，数式処理によるのではなく，プロットデータからの数値探索のアルゴリズムによっている。
関数 Intersectcrvspp(プロットデータ1, プロットデータ2)
機能 2曲線の交点のパラメータリストを取得する。
説明 2曲線の交点の座標とパラメータのリストを返す。
Intersectcrvs() との違いは，パラメータがあるかどうかである。
【例】放物線と直線の交点のパラメータを求める。
2点A(-1,1),B(2.4) を作図しておく。
Plotdata("1","x^2","x");
Lineplot([A,B]);
p1=Intersectcrvs("gr1","lnAB");
p2=Intersectcrvspp("gr1","lnAB");
println("p1="+p1);
println("p2="+p2);
とすると，コンソールには
p1=[[-1,1],[2,4]]
p2=[[[-1,1],17.68,1],[[2,4],42.66,1]]
と表示される。
関数 Intersectcurves(プロットデータ1, プロットデータ2)
関数 Intersectcurvespp(プロットデータ1, プロットデータ2)
機能 2曲線の交点リストを取得する。接点があるとき，時間はかかるがより精密な値を返す。
関数 Nearestpt(PD1，PD2)
機能 2曲線に対し，最も近い点とそのパラメータ，距離のリストを返す
説明 戻り値は，それぞれの曲線上の点の座標とプロットデータ中の位置，その距離からなるリスト。
y
【例】2つの放物線上の点の最短距離とその位置を求める。
点A,Bを作図ツールでとっておく。
A
Plotdata("1", "x^2+2", "x=[-2,2]");
1.78
Plotdata("2", "-(x-2)^2+1","x=[0,4]");
plist=Nearestpt("gr1","gr2");
A.xy=plist_1; B
x
B.xy=plist_3; O
55

### Page 56

Listplot([A,B],["do"]);
Pointdata("1",[A,B],["Size=2"]);
Letter([A,"n2w","A",B,"s2e","B",(A+B)/2,"e",text(plist_5)]);
ここで plistに代入されたリストは次のようになっている。
[[0.4,2.16],31,[1.58,0.82],20.73,1.78]
なお，距離 1.78 は小数点以下第3位を四捨五入して表示されている。
関数 Nearestptcrv(座標, プロットデータ)
機能 点に最も近いプロットデータの点を求める
説明 第１引数の座標に最も近い曲線プロットデータ上の点の座標を返す。
【例】点(3,0)に最も近い y =x2 上の点を求める。
y
点Aは(3,0)に，点Bは適当な位置に作図しておき，次のスクリプトを実行すると点Bが求める点となる。
Plotdata("1", "x^2", "x");
B.xy=Nearestptcrv(A.xy,"gr1");
Listplot([A,B],["do"]);
Ptsize(2);
Pointdata("1",[A,B]); B
Letter([A,"ne","A",B,"nw","B"]);
A
x
O
注）第１引数は座標なので，A ではなく A.xy としなければならない。
⇒関数一覧
関数 Numptcrv (プロットデータ)
機能 プロットデータの個数を返す
説明 Cindyscript で length(PD)とするのと同じ
【例】 Implicit() と Paramplot() でそれぞれ楕円を描いたときのプロットデータの順序を比較する。ただし，
TeXには書き出さない。
Slider("A-C-B",[0,-2],[6,-2]);
Implicitplot("1","x^2+4*y^2=4","x=[-2,2]","y=[-2,2]",["do"]);
Paramplot("1","[2*cos(t)+5,sin(t)]","t=[0,2*pi]",["do","Num=140"]);
println([Numptcrv(imp1),Numptcrv(gp1)]);
n=floor(C.x*2);
repeat(n,s,start->0,
t=s*10+1;
draw(imp1_t,color->hue(s/10));
draw(gp1_t,color->hue(s/10));
);
4行目で，２つのプロットデータの個数が同じであることを確かめている。
56

### Page 57

スライダを動かすと，10個おきのプロットデータに対応する点が描かれる。
関数 Paramoncrv(点の座標, 曲線の名前)
機能 曲線上の点のパラメータ値を返す。
説明 曲線は折れ線として描かれ，曲線上の各点はこの折れ線の節点を基準としたパラメータ値を持つ。パラメータ
値は整数部分が節点の番号，小数部分が節間の位置を表す。
【例】図のような点PからQに至る円周上の5等分点を節点とする折れ線cr1において，n番目の線分上の点
はn≤t≤n+1の範囲のパラメータ値を持つ。
たとえば，図の点Aは2番目の線分上にあり，この値は
println(Paramoncrv(A.xy,"cr1"));
によってコンソールに表示される。（たとえば2.45）。
点Aの位置を動かすとパラメータ値は変わる。
y
A
x
Q O P
⇒関数一覧
関数 Pointoncrv(点のパラメータ値, PD)
機能 曲線上のパラメータ値を持つ点の座標を返す。
説明 曲線（折れ線）上の節点を基準としたパラメータ値により点の位置が定まる。
【例】図のような点PからQに至る半円周上の5等分点を節点とする折れ線cr1において，パラメータ値4.5
を持つ点Aは4番目の線分の中点である。したがって
Circledata("0",[[0,0],[2,0]],["do"]);
Circledata("1",[[0,0],[2,0]],["Num=5","Rng=[0,pi]"]);
tmp=Pointoncurve(4.5,"cr1");
Pointdata("1",tmp,["Size=3"]);
Letter([tmp,"nw","A",[2,0],"se","P",[-2,0],"sw","Q"]);
によって，点Aを中点に置くことができる。
y
A
x
Q O P
57

### Page 58

関数 Ptcrv(n,プロットデータ)
機能 曲線プロットデータのn 番目の節点を返す
説明 Cindyscript の PD n と同じ
【例】楕円上の点で分割する。あからじめ必要な点を作図しておく。
y
Circledata([O,P],["do","Num=100","notex"]);
Scaledata("1","crOP",4/3,1); B
F.xy=[-sqrt(7),0];
A=Ptcrv(9,sc1); A
B=Ptcrv(16,sc1);
Listplot("1",[A,F,B],["da"]);
Partcrv("1",A,B,"sc1",["dr,3"]); x
F O
Shade(["part1","sg1"],0.1);
Arrowhead(B,"sc1",[1.5]);
Letter([A,"ne","A",B,"ne","B",F,"s2","F"]);
関数 Ptstart(プロットデータ) , Ptend(プロットデータ)
機能 プロットデータの最初の点，最後の点を取得する。
説明 プロットデータの最初の点，最後の点の座標を返す。
【例】定義域を限定したグラフの両端の点を取得し線分ABを引く。
Deffun("f(x)",["regional(y)","y=x^2","y"]);
Plotdata("1","f(x)","x",["do"]);
Plotdata("2","f(x)","x=[-1,2]");
Lineplot("1",[Ptstart(gr2),Ptend(gr2)],["do"]);
Listplot("1",[Ptstart(gr2),Ptend(gr2)]);
Letter([A,"w2","A",B,"e2","B"]);
y
B
A
x
O
関数 ReadOutData(ファイル名）
機能 外部データをプロットデータとして読み込む
説明 CやRなどで作成したKeTCindy形式のデータファイルを読み込む。
引数を省略した場合は，Fheadで定義したファイル名のテキストファイルから読み込む。
ファイル名にはコンマで区切ってパスを与えることができる。たとえば，
ReadOutData("/datafolder","file.txt");
KeTCindy形式のデータとは
変数名//
start//（リストの始まり）
[ , , ], …. // （個々のデータ２か３次元）
58

### Page 59

…
end// （リストの終わり）
start// （次のリストの始まり）
…
end//
変数名//
start//
…
end//
の形式のテキストファイル。
関数 Readcsv(path,filename,option)
機能 csvファイルを読む。
説明 csvファイルを読みこむ。戻り値は読み込んだデータのリスト。
第１引数の path は，ファイルを作業フォルダ（ 初期設定は fig ）に置いた場合は省略することができる。そ
うでない場合は，フルパスで指定する。たとえば，”/Users/Hoge/Desktop”
option は，”Flat=” で，”Flat=y” の場合は，読み込んだデータをリスト化したときに平滑化（１次元のリス
ト）にする。 初期設定は ”Flat=n”
【例】次のようなCSVファイル sample.csvを読み込むとする。
12,14,15,18,13
9,13,17,21
つまり，２行分のデータである。
data=Readcsv("sample.csv");
とすると，
data=[[12,14,15,18,13],[9,13,17,21]]
となる。
したがって，１行目のデータだけ取り出したい場合は
dt1=data_1;
とする。
⇒関数一覧
関数 Readlines(path,filename,option)
機能 テキストファイルを1行ずつ読む。
説明 テキストファイルを1行ずつ読みこむ。戻り値は読み込んだ文字列のリスト。
第１引数の path は，ファイルを作業フォルダ（ 初期設定は fig ）に置いた場合は省略することができる。そ
うでない場合は，フルパスで指定する。たとえば，”/Users/Hoge/Desktop”
関数 WriteOutData(ファイル名,PDリスト）
機能 外部データに書き出す
説明 プロットデータをKeTCindy形式のデータファイルに書き出す。出力先の 初期設定は作業フォルダ。
【例】 放物線と円のプロットデータを書き出す。
Plotdata("1", "x^2","x");
59

### Page 60

Circledata("1",[[0,0],[1,0]]);
WriteOutData("figdata.txt",["gr1",gr1,"cr1",cr1]);
書き出されたファイルの中身は次のようになっている。
gr1//
start//
[[-2.68843,7.22765],[-2.51807,6.34067],・・,[-2.00698,4.02798]]//
[[-1.83662,3.37318],[-1.66626,2.77642],・・,[-1.15518,1.33443]]//
以下，同様にプロットデータが続く
[[5.82965,33.98479]]//
end//
cr1//
start//
[[1,0],[0.99211,0.12533],[0.96858,0.24869],・・,[0.80902,0.58779]]//
以下，同様にプロットデータが続く
[[0.87631,-0.48175],[0.92978,-0.36812],・・,[1,0]]//
end////
関数 Extractdata(データ名,属性）
機能 ReadOutData() で読み込んだデータに属性をつける。
説明 ReadOutData() で読み込んだデータには，線種などの属性がついていないので，そのままでは表示されない。
そこで，この関数により属性をつけて表示する。
ReadOutData("figdata.txt");
Extractdata("gr1",["da"]);
⇒関数一覧
1.4 計算
関数 Derivative(関数式 , 変数 , 値)
機能 関数の微分係数を求める
説明 関数式で与えられた関数の，「変数＝値」における微分係数を求める。
値は，点の座標を用いることができる。点Aのx座標であれば， A.x とする。
【例】3次曲線上の点Aで接線を引く。点A,Bは作図ツールで適当にとっておく。
Deffun("f(x)",["regional(y)","y=x^3-4*x","y"]);
coef=Derivative("f(x)","x",A.x);
A.y=f(A.x);
B.y=coef*(B.x-A.x)+A.y;
Plotdata("1","f(x)","x",["Num=200"]);
Lineplot([A,B]);
Letter([A,"ne","A"]);
y
A
x
O
なお，曲線のプロットデータを用いて，微分係数を求めることもできる。
60

### Page 61

書式は，Derivative(PD ,値) で，次のように使う。（上の例と同じ図ができる）
Deffun("f(x)",["regional(y)","y=x^3-4*x","y"]);
Plotdata("1","f(x)","x",["Num=200"]);
coef=Derivative("gr1","x="+A.x);
A.y=f(A.x);
B.y=coef*(B.x-A.x)+A.y;
Lineplot([A,B]);
Letter([A,"ne","A"]);
また，曲線の接線については，Tangentplotも参照されたい。
⇒関数一覧
関数 integrate(関数式 , 変数=範囲 , options)
関数 integrate(PD , 範囲 , options)
機能 関数式またはプロットデータで与えられた関数（データ）の数値積分の値を求める。
説明 optionsは次の通り。
”Rule=s”：シンプソン法による。 初期設定は大島ベジェ公式。
”Num=数値”：分割数の指定。初期値は 100
【例】f(x)=x3−2x2+2 について，0から3までの定積分の値を求める。
f(x):=x^3-2*x^2+2;
val=Integrate("f(x)","x=[0,3]");
println(val);//8.25が表示される
【例】上の例と同じ関数をプロットデータで指定する。
plotdata("1","x^3-2*x^2+2","x");
println(Integrate("gr1",[0,3]));
数値積分ではなく，数式処理として定積分の値を求める場合は，Maxima を利用する。CalcbyM を参照。
関数 Inversefun(関数 , 範囲 , 値)
機能 関数の逆関数値を求める
説明 関数は文字列で，関数式もしくは定義された関数名とする。
指定された範囲の中で逆関数値を求める。存在しない場合は一方の端点を戻り値とし，コンソールに「not
found」と表示される。
数式処理ではなく数値探索のアルゴリズムを使っているので，単調関数でない場合は範囲をできるだけ狭くと
るとよい。値が複数ある場合は，小さいほうが返される。
【例】x=Inversefun("sin(x)","x=[0,pi/2]",0.5);
実行すると x=0.5236 となる。
⇒関数一覧
1.5 値の取得と入出力
計算値やプロットデータの値を取得したり，R用とのデータのやりとりをする。
61

### Page 62

関数 Asin(実数）,Acos(実数)
機能 逆三角関数の値を求める。
説明 CindyScriptの組み込み関数に，arcsin(x),arccos(x) があるが，xの絶対値が１より大きい場合は虚数を返す。
このことがＲではエラーになるので，計算誤差により１よりわずかに大きくなる場合のために用意した関数。
関数 Sqr(実数）
機能 平方根を求める。
説明 CindyScriptの組み込み関数に，sqrt(x) があるが，xが負の場合は虚数を返す。これに対し，xが負の場合は
０を返すようにした関数。計算誤差により１よりわずかに大きくなる場合のために用意した。
関数 BBdata(ファイル名,option）
機能 画像ファイルのサイズを求める
説明 TeX 文書において，inputgraphics コマンドで画像を貼り込むときの BB サイズを求める。TeX 処理系の
extractbb を用いて画像ファイルからBBデータを作り，テキストファイルとして作業ディレクトリに書き出
す。これを読んで，コンソールに ingludegarphics のコマンドを書き出す。これをそのままコピーすればよい。
なお，bbの値は整数値ではなく，高精細の値を小数点以下2桁に四捨五入して示される。画像ファイルは，
PDFに限らず，PNG，JPGなどでもよい。
optionは，幅または高さの指定。
”w=40mm” でwidth=40mm が，”h=40mm”で height=40mm が付加される。
【例】
⇒関数一覧
関数 Cindyname()
機能 作図中のファイル名を取得する。
説明 たとえば，現在作図しているファイル名が 「polygon.cdy」のとき，”polygon” を返す。
関数 Crossprod(リスト，リスト)
機能 2つのベクトルの外積を求める。
説明 Cindyscriptの組み込み関数 cross(リスト，リスト)と同じ。
【例】Crossprod([1,0,0],[1,1,1]);
結果は[0,-1,1]
関数 Dotprod(リスト，リスト)
機能 2つのベクトルの内積を求める。
説明 Cindyscriptでは，積の演算で内積が求められる。
62

### Page 63

【例】Dotprod([1,2,3],[1,-1,1]);
結果は2
[1,2,3]*[1,-1,1] でも同じ結果を得る。
関数 Findarea(プロットデータ)
機能 プロットデータで囲まれる部分の面積を求める。
説明 閉曲線をなすプロットデータで囲まれる部分の面積を求める。大島のベジェ公式を用いている。
【例】楕円の面積を求めて表示する。
Paramplot("1","[3*cos(t),2*sin(t)]","t=[0,2*pi]");
area=Findarea("gp1");
println(Sprintf(area,6));
コンソールに面積 18.849536 が表示される。
関数 Findlength(プロットデータ)
機能 プロットデータの曲線の長さを求める。
説明 プロットデータが描く曲線の長さを求める。大島のベジェ公式を用いている。
【例】円周の長さを求めて表示する。
Circledata("1",[[0,0],[2,0]]);
len=Findlength("cr1");
println(Sprintf(len,6));
コンソールに 12.558097 が表示される。
⇒関数一覧
63

### Page 64

1.6 作表
関数 Tabledata(横データ，縦データ, 除外線 , options)
機能 表の枠を作成し，表のデータlist を返す
説明 Cinderellaの描画面上に左下を原点とする表を作成する。
除外線がない場合は空リストを指定する。（必須）
optionsのうち，Tabledataに特有なものは
ラベルのスキップ幅，”Setwindow=n”，”Geo=n”，”Move=[0,0]”
である。
”Setwindow=n” をつけると，NE,SWによる出力領域指定が有効になり，NE,SWをドラッグして出力領域を
変更できる。（初期状態は，表の右上と左下）つけない場合は，表の部分だけが出力される。
縦横データは，次のように，間隔の幅で与える。ただし，幅はCinderellaの描画面の0.1を単位とする。
Yoko=[20,20,20,20];
Tate=[10,10,10,10,10];
Tabledata(Yoko,Tate,[]);
”Geo=y”とすると，作成された表には，行，列の制御点がつく。画面上では，横罫線の番号 r0,r1,・・・縦罫
線の番号 c0,c1,・・・と見ることもできる。また，縦幅，横幅が数字で示される。ただし，これらはTEXには
出力されない。また，作表はCinderellaの描画面上では座標平面上に置かれるが，TEXへの出力は座標平面
上には置かないことが多いので，座標軸は非表示としている。
描画面 TeX
”Geo=y”の場合は，表のサイズ・行幅・列幅は，作成後にそれぞれの制御点をドラッグすることにより任意に
変えることができる。
除外線は，除外するセルの罫線を，rとc で位置指定する。
横罫線の場合，横罫線の番号，範囲（から，まで）
縦罫線の場合，縦罫線の番号，範囲（から，まで）
とする。
ラベルのスキップ値は，いくつおきにラベルをつけるかの設定である。0とするとラベルが表示されない。た
だし，ラベルはCinderellaの画面上だけの問題。
”Move=点の座標”とすると，指定された点が左下になるように平行移動される。
【例】4つの罫線を非表示にする
Rmv=["r1c0c1","c3r0r1","c3r3r5","r4c2c4"];
Yoko=[20,20,20,20];
Tate=[10,10,10,10,10];
Tabledata(Yoko,Tate,Rmv);
64

### Page 65

で，次の表ができる。
＜補足＞
”Geo=y”の場合，制御点r0,r1,・・・,c0,c1,・・・がなければ新しく作り，すでに存在する場合はそのままと
する。したがって，一度表を作成したのち，行数・列数を修正して作り直す場合は，一度既存の点を消去する
必要がある。そのためには，「すべての点を選択する」ツールをクリックして点を消去するのがよい。クリック
すると，消去後すぐに新規作成される。(誤って「すべての要素を選択する」を選ばないこと)
他の点が描画されている場合は，表の部分だけドラッグで選択するか，表示メニューの「式による表示」で一
覧表を出して，制御点を選択して消去する。
”Geo=n”（デフォルト）の場合，幾何点を生成しない。幾何点を作成しないメリットは，スクリプトだけで全
体の縦横幅を変更できること。デメリットはインタラクティブな微調整ができないこと。
【例】１つおきにスキップして，r1,r3,c1,c2 を非表示とする。
Yoko=[20,20,20,20];
Tate=[10,10,10,10,10];
Tabledatalight(Yoko,Tate,[],[2]);
関数 Changetablestyle(罫線リスト, 変更オプション)
機能 Table の罫線の描画オプションを変更
説明 罫線の部分的に指定して描画オプションを変更できる。
【例】
Tabledatalight([10,20,10,20],[10,10,10],[]);
Changetablestyle(["r1c0c4"],["da"]);
Changetablestyle(["r2c0c2","c1r0r3"],["nodisp"]);
複数の表を描くこともできる。
⇒関数一覧
65

### Page 66

関数 Findcell(列番号, 行番号)
機能 セルの情報list（中心，横幅／2，縦幅／2）を返す
説明 列番号，行番号は左上のセルを１列１行として数える。
【例】Tabledata(Tate,Yoko,[]);
println(Findcell(2,1));
とすると，2列１行のセルの中心の座標と横幅の半分，縦幅の半分の値がリストとしてコンソールに表示さ
れる。
関数 Putcell (列番号, 行番号, 位置, 文字データ)
機能 セルに文字列を入れる
説明 複数のセルにまたぐ位置指定の場合，列番号，行番号は，セル左上と右下の制御点の名称で指定する。
位置はc, r, l, t, b （中央center , 右right , 左left , 上top , 下bottom ）
位置の例を以下に示す。
yoko=[20,20,20,20,20];
tate=[20,20];
Tabledata(yoko,tate,["c1r1r2","c4r1r2"]);
Putcell(1,1,"c","A");
Putcell(2,1,"r","B");
Putcell(3,1,"l","C");
Putcell(4,1,"t","D");
Putcell(5,1,"b","E");
Putcell("c0r1","c2r2","c","F");
Putcell("c2r1","c3r2","lb","G");
Putcell("c3r1","c5r2","rt","H");
c0 c1 c2 c3 c4 c5
r0
D
A BC
E
r1
H
F
G
r2
※数式の場合は，Putcellexpr を用いる。
⇒関数一覧
関数 Putcol (列番号, 文字位置，文字列リスト)
機能 １列に順に文字を書き入れる
説明 列番号で指定した列に，第１行から順に文字列リストの文字を書き入れる
数の場合はダブルクォートでくくらなくてもよい。
セルを飛ばす場合は，ヌル文字列 ”” を書く。
関数 Putcolexpr (列番号, 文字位置，文字列リスト)
機能 １列に順に文字を書き入れる
説明 文字列にTEX書式を使うことができる
関数 Putrow (行番号, 文字位置，文字列リスト)
66

### Page 67

機能 １行に順に文字を書き入れる
説明 行番号で指定した行に，第１列から順に文字列リストの文字を書き入れる。
関数 Putrowexpr (行番号, 文字位置，文字列リスト)
機能 １行に順に文字を書き入れる
説明 文字列にTEX書式を使うことができる
文字を入れる例を示す。
Tate=[20,20,20,20,20];
Yoko=[15,15,15];
Tabledata(Tate,Yoko,["c1r1r2","r1c2c3","r2c2c3"]);
Putcol(3,"c",["A","B","C"]);
Putcolexpr(4,"l",["x^2","y=\sqrt{x^3}"]);
Putrow(1,"c",[1,"二"]);
Putrowexpr(3,"c",["","\frac{\pi}{2}","","","\sum{x^2}"]);
c0 c1 c2 c3 c4 c5
r0
1 二 A x2
r1
√
B y = x3
r2
∑
π C x2
2
r3
※ r0,c0,・・は画面に表示される番号。
グラフや文を入れた表の作成例
Putcolexpr(),Putrowexpr() では，数式だけでなく，一般のTEXの文を入れることができる。また，グラフの
位置を適当に合わせて描画することにより，表のセルの中にグラフを入れることができる。
【例】2次関数のグラフと2次方程式の判別式の関係
セルの中にグラフを描く例。実際には，セルの位置にグラフを描く。
x軸を描くための点A〜Fは作図ツールでとっておく。
スクリプトを実行して表ができたら，制御点をドラッグしてサイズを調整し，点A〜Ｆもドラッグして軸と放
物線の共有状況を示すようにする。
Tate=[40,40,40];
Yoko=[20,20,20];
Tabledata(Tate,Yoko,[],["dr,2"]);
Changetablestyle(["r1c0c3"],["dr"]);
Changetablestyle(["r2c0c3"],["da"]);
Plotdata("1","(x-2)^2+0.5","x=[0.5,3.5]");
Plotdata("2","(x-6)^2+1","x=[4.5,7.5]");
Plotdata("3","(x-10)^2+1.5","x=[8.5,11.5]");
Listplot([A,B]);
Listplot([C,D]);
Listplot([E,F]);
Putrowexpr(1,"c",["D>0","D=0","D<0"]);
Putrow(2,"c",["2点で交わる","接する","共有点なし"]);
67

### Page 68

判別式とx軸の交点
D>0 D=0 D<0
2点で交わる 接する 共有点なし
【例】増減表とグラフ
関数の増減表とグラフを１つの表の中に入れた例。
Tate=[6,6,10,6,10,6,40];
Yoko=[30,6,6,6];
Rmv=["c1r0r1","c2r0r1","c3r0r1","c4r0r1","c5r0r1", "r1c6c7",
"r2c6c7","r3c6c7"];
Tabledata(Tate,Yoko,Rmv,["dr"])
Tlistplot("23d",["c1r2","c2r3"]);
Tlistplot("23u",["c1r3","c2r2"]);
Putrowexpr(2,"c",["x",0,"\cdots","\tfrac{1}{4}","\cdots",4]);
Putrowexpr(3,"c",["y`","","-",0,"+"]);
Putrowexpr(4,"c",["y",0,"\searrow","-\tfrac{1}{4}","\nearrow",2]);
Putcell(1,1,"l2t2","{\small\begin{minipage}{44mm}$y=x-\sqrt{x}$\\$y`=
\dfrac{2\sqrt{x}-1}{2\sqrt{x}}=0$|より\vspace{1mm}\\\hspace*{2zw}$x=
\dfrac{1}{4}$\vspace{1mm}\\増減表は次のようになる\end{minipage}}" );
Plotdata("1","x-sqrt(x)","x=[0,3]",["do","notex"]);
Listplot("2",[[0,0],[3,0]],["do","notex"]);
Listplot("3",[[0,-0.5],[0,3]],["do","notex"]);
Translatedata("1","gr1",[4.9,1],["dr"]);
Translatedata("2","sg2",[4.9,1],["dr"]);
Translatedata("3","sg3",[4.9,1],["dr"]);
Letter(Ptend(tr2),"e1","\small{$x$}");
Letter(Ptend(tr3),"n1","\small{$y$}");
Letter(Ptstart(tr2),"w1","\small O");
Expr(Ptend(tr1),"nw-2","y=x-\sqrt{x}");
√
y=x− √ x
y′ = 2 x √ −1 =0より y
2 x
1
x=
4
√
増減表は次のようになる． y =x− x
x 0 ··· 1 ··· 4
4
y′ − 0 + O x
y 0 ↘ −1 ↗ 2
4
【例】凹凸を含めた増減表
Tate=apply(1..8,20);
Yoko=[apply(1..4,10);
Tabledata(Tate,Yoko,[]);
Putrowexpr(1,c,["x","\cdots","-1","\cdots","0","\cdots","1","\cdots"]);
Putrowexpr(2,c,["y`","+","+","+","0","-","-","-"]);
Putrowexpr(3,c,["y``","+","0","-","-","-","0","+"]);
Putrowexpr(4,c,["y","\nelarrow","\frac{1}{\sqrt{e}}","\nerarrow",
"1","\serarrow","\frac{1}{\sqrt{e}}","\selarrow"]);
68

### Page 69

x ··· −1 ··· 0 ··· 1 ···
y′ + + + 0 − − −
y′′ + 0 − − − 0 +
y √1 1 √1
e e
ここで，凹凸を示す矢印は，ketpic.sty で定義されているものである。
nelarrow,nerarrow,selarrow,serarrow,NELarrow,NERarrow,SELarrow,SERrarrow がある。先頭のne,seで
北東・南東（右上・右下）次の r,l は回転の向き（r：right：反時計回り，l：left：時計回り）の矢印(arrow)と
覚えるとよい。直線系の矢印は NEarrow,SEarrrow。 少しずつ違うので試されたい。
なお，これらの矢印はCindyTeXにはないので，Cinderellaの描画面には表示されない。
関数 Tgrid(セルラベル)
機能 表のセルの座標を返す
説明 指定されたセルの左上の座標を返す。実際には，セルラベルは罫線を示しているので，指定した罫線の交点
（格子点）ということもできる。
関数 Tlistplot(セルラベル1,セルラベル2)
機能 指定された2つの格子点を線分で結ぶ
説明 セルに斜線を引くのに用いる。
【例】Tlistplot(["c0r1","c1r2"]);
⇒関数一覧
1.7 ファイル操作
以下で，小文字から始まるコマンドはKeTCindyplugin.jarで定義されているものである。
関数 isexists(dir,file)
機能 dirにfileが存在するか
関数 makedir(path,dirname)
機能 pathにdirnameのdirを作成する。
関数 Filelist([mainpath,]dirname)
機能 (mainpathにある)dirnameのファイル一覧をリストとして返す。
関数 Readlines([path,]filename)
機能 (pathにある)filernameの各行を読み込みリストとして返す。
説明 pathのデフォルトはDirwork。
関数 gethome()
機能 ユーザホームを返す。
69

### Page 70

関数 ismacos()
機能 Mac OSか。
関数 ismacos()
機能 Windows OSか。
関数 islinux()
機能 Linux OSか。
1.8 Tikzコマンドの利用
TikzはKETCindyにはない豊富なコマンドを持っている。これらを利用するには，TexcomでTEXのコマンド列
に追加すればよい。
【例】
Usegraphics("tikz");
Setwindow([-1,5],[-1,3]);
Htickmark([1,"1",2,"2"]);
Vtickmark([1,"1",2,"2"]);
Circledata("1",[[4,2],1]);
Texcom("\shadedraw (1,1) rectangle +(2,2);");
y
2
1
x
O 1 2
関数 Tikzptseq(点リスト）
機能 KETCindyの点リストをTikzの点列に変換して，文字列として返す。
【例】A.xy=[-4,-3], B.xy=[4,3]のとき
Tikzptseq([A,B,[4,-3]]);
⇒ (-4.00000,-3.00000)--(4.00000,3.00000)--(4.00000,-3.00000)
関数 Tikzline(点リスト, [オプション]）
機能 Tikzのlineコマンドを用いて線分をかく。
説明 "cycle"は閉多角形, "Join=round/bevel/miter"(コーナーの形状)
【例】A.xy=[-4,-3], B.xy=[4,3], C.xy=[4,-3]のとき
Listplot("1",[A,B,C,A],["dr,6"]);
Changestyle(["sg1"],["notex"]);
Tikzline([A,B,C,"cycle"],["Width=6","Join=round"]);
70

### Page 71

1.9 その他
関数 Assign(文字列，文字，文字）
機能 文字列の中のある文字を他の文字で置き換える
説明 第１引数の文字列中の第2引数の文字を，第3引数の文字で置き換える。
第3引数が数値の場合，文字列に変換される。
第2引数と，第3引数をリストにして，複数の置き換えをすることができる。
【例】a*x を1.3*x とした文字列を返す。次のいずれも同じ結果になる。
Assign("x^2+a*x","a","1.3");
Assign("x^2+a*x","a",1.3);
【例】直線 y =bx−b2 の係数bを変化させて描き，包絡線をうかびあがらせる。
repeat(50,t,
cb=t/5-5;
Plotdata(text(t),Assign("b*x-b^2","b",cb),"x");
);
y
x
O
【例】文字で表された x と y の係数をまとめて数値で置き換える。
Assign("a*x^2+b*x",["a",1,"b",2]);
⇒関数一覧
関数 Colorcode(種別1,種別2, カラーコード)
機能 種別1から種別2へカラーコードを変換する。戻り値は変換されたコード。
説明 種別は，”rgb”,”cmyk”,”hsv”のいずれか。
【例】変換例をいくつか示す。
RGBの[1,0,0]をCMYKに変換したコードをコンソールに表示する。
71

### Page 72

col=Colorcode("rgb","cmyk",[1,0,0]);
println(col);
CMYKの[0,1,1,0]をRGBに変換したコードをコンソールに表示する。
col=Colorcode("cmyk","rgb",[0,1,1,0]);
println(col);
RGBの[1,0,0]をHSVに変換したコードをコンソールに表示する。
col=Colorcode("rgb","hsv",[1,0,0]);
println(col);
関数 Dqq(文字列)
機能 文字列の前後に"をつける。
str="abc";
str2=Dqq(str);
println([str,str2]);
関数 Factorial(n)
機能 正の整数nの階乗を計算する。
関数 Binomial(n,r)
機能 2項係数 C を計算する。
n r
【例】Binomial(60,30) ⇒ 118264581564861424
関数 Gcdl(numberlist)
機能 numberlistの最大公約数を計算する。
【例】Binomial(60,30) ⇒ 118264581564861424
関数 Norm(ベクトル), Norm(ベクトル1, ベクトル2)
機能 ベクトル（2つのベクトルの場合は差の大きさ）の大きさを計算する。
関数 Figpdf(option）
機能 出力枠サイズのPDFを作る。
説明 KETCindyでは，通常，出力された fig.tex ファイルを閲覧するPDFをA4サイズで作成する。これに対し，
Figpdf()を実行すると，出力サイズのPDFを作成する。閲覧用だけではなくワープロなどにに貼り込むとき
にそのまま使用できる。ただし，そのための親子プロセスを生成して実行するため，次の手続き(1)(2)が必要
となる。
(1) Setparent(filename)で，出力するPDF用のファイル名を設定する。
(2) 出力は，「Parent」のボタンを押す。
たとえば，fig.cdy で作図しているとき，
Setparent("pic");
72

### Page 73

とすると，fig.tex を表示した pic.pdf が作成される。pic.pdf が目的のPDF。
このファイル名は 作図しているCinderellaのファイル名，または Setfiles() で指定したファイル名とは異なる
ものにする。
optionは，マージン（余白）と平行移動量。指定しない場合は 初期設定値。
余白は，左右上下の順に4つの数をコンマで区切る。
平行移動量は，右方向，下方向をリストで与える。
余白指定と平行移動指定は同時に行うことができる。
【例】余白の設定
Figpdf([5,5,10,10]); 左右に5mm，上下10mmの余白
Figpdf([[5,10]]); 右に5mm，下に10mm平行移動して表示
Figpdf([5,8,10,10,[5,-5]]); 左5mm，右8mm，上下10mmの余白，
右に5mm，上に5mm平行移動して表示
なお，座標軸を表示する場合，右側は最低3mmの余白を設定しないと軸の文字が入らない。
⇒関数一覧
関数 Help(文字列）
機能 関数の使用例を取得する
説明 文字列で始まる関数の使用例をコンソールに表示する。
println(Help("L"));
のようにすると，コンソールに，次のように「L」で始まる関数の使用例が表示される。
Letter([C,"c","Graph of $f(x)$"]);
Letter([C,"c","xy"],["size->30"]);
文字を書き込む
Letterrot(C,B-A,"AB");
Letterrot(C,B-A,"t0n5","AB");
Letterrot(C,B-A,0,5,"AB");
傾いた文字を書き込む
・・・・
関数 Helpkey(文字列）
機能 関数の使用例をキーワードで検索する
説明 文字列に与えたキーワードで関数の使用例を検索し，コンソールに表示する。
【例】Helpkey("直線");とすると，コンソールに次のように表示される。
IntersectsgpL("",[p1,p2],[p3,p4,p5],"draw");
IntersectsgpL("R","P-Q","A-B-C");
IntersectsgpL("R","P-Q","A-B-C","put");
空間の直線と平面の交点
Lineplot("1",[[2,1],[3,3]]);
・・・・
関数 Indexall(str1,str2);
機能 文字列 str1 から str2 を検索しその位置をすべて返す
説明 Cindyscriptの indexof() の拡張版。indexof() が最初に見つかった位置を返すのに対し，Indexall()は存在す
73

### Page 74

る位置をすべてリストにして返す。
【例】str=”abcabcabc” から ”b”を検索する。
indexof(str,"b") では，2 が返る。
Indexall(str,"b") では，[2,5,8]が返る。
関数 Bracket(str [,bracketpair]);
機能 文字列 strから bracketpair を検索しその位置と階層レベルのリストを返す。
説明 bracketpairのデフォルトは”()”。
【例】Bracket(”(abc(de)fg)”)では，[[1,1],[5,2],[8,-2],[11,-1]]が返る。
関数 Getlevel(str [,poslistまたはsep,key]);
機能 文字列 strから sepの位置と階層レベルのリストを返す。
説明 sep, keyのデフォルトはコンマと()。sepを与えたとき，poslistはsepのindexlistになる。
【例】Getlevel(”(a,(b,c),d)”では，[[3,1],[6,2],[9,1]]が返る。
関数 Isptselected(点名）または Ptselected(点名)
機能 点が選択されていれば true,そうでなければ false を返す。
説明 点名はリストで与える。引数はなしにすることも可能で，その場合はすべての点が対象。
KeTCindyの関数の中には処理に時間がかかるものがある。その場合，点をドラッグするなど，画面上で操作
をするとその都度再計算されるために，動きが非常に遅くなる。そこで，ドラッグする点をこの関数で指定す
れば，ドラッグしている間は処理されないようにすることができる。
【例】点Aを原点近くにとっておき，次のスクリプトを実行する。
Deffun("f(x)",["regional(y)","y=x^3-2*x","y"]);
Plotdata("1","f(x)","x",["Num=100"]);
Putoncurve("A","gr1");
coef=Derivative("f(x)","x",A.x);
Defvar(["coef",coef]);
Deffun("g(x)",["regional(y)","y=coef*(x-A.x)+A.y","y"]);
Plotdata("2","g(x)","x",["Num=1"]);
if(!Ptselected(A),
Enclosing("1",["gr2","Invert(gr1)"],[A,"nodisp"]);
Hatchdata("1",["i"],[["en1"]]);
);
点Aをドラッグ中（選択状態） 点A以外をクリックして選択状態を解除
74

### Page 75

関数 Reparse(文字列か文字列のリスト)
機能 評価(parse)してから実部をとる(re)。
説明 CindyJSでは，実数の演算でも虚数の項が出ることがあり，その対応である。
【例】str="(0-1)^2"; Reparse(str);
注）CindyJSでformat(parse(str),0)を実行すると1-i*0になる。
関数 Slider(名称，位置1,位置2)
機能 スライダを作成する
説明 名称は ”A-C-B” の形で，端点をA,B，スライダ点をCとしたスライダを作る。
端点A,Bの位置を，位置1，位置2で指定する。単に”C”としたときは端点をとらない。スライダにより取得
したい値は，点Cの座標（たとえば C.x）を利用する。
点A,B,Cはあらかじめ作図しておく必要はない。既にある場合はその点を使う。
【例】2つのスライダを用意し，y =asin(x−b) のa,b を変化させる。
Slider("A-C-B",[-5,-2],[5,-2]); // C is movable.
Slider("D-F-E",[-6,-2],[-6,2]); // F is movable.
Plotdata("1",Assign("y=a*sin(x-b)",["a",F.y,"b",C.x]),"x");
関数 Sprintf(実数,長さ)
機能 小数点以下の長さを固定した文字列に変換
説明 実数を，小数点n位までの数とした文字列に変換する
【例】円周率
Sprintf(pi,2) は 3.14 を返す
Sprintf(pi,7) は 3.1415927 を返す
注）pi は Cindyscriptの予約変数で，円周率を表す。
関数 Textformat(数，桁数)
機能 小数点以下の桁数を指定して数を文字列化する。
説明 第１引数は数のリストでもよい。数のリストの場合は，戻り値は，対応する数値を指定係数にした後，リスト
を文字列化する。Cindyscriptの組み込み関数にも，format()という同様の関数があるが，format() は文字列
のリストを返す。
【例】円周率を小数点以下5位までで文字列化する。
Textformat(pi,5); format(pi,5);
戻り値は，いずれも "3.14159"
【例】第１引数がリストのときの，format() との戻り値の違い。
dt=[1/6,0.5];
75

### Page 76

Textformat(dt,4); // 戻り値は ”[ 0.1667 , 0.5 ]”
format(dt,4); // 戻り値は [ ”0.1667” , ”0.5” ]
関数 Texcom(TEXコード）
機能 TEXのコードを書き出す
説明 任意のTEXのコードを書き出す
Tikz参照
関数 Windispg()またはWindisp(データのリスト）
機能 定義されているプロットデータをCinderella画面に黒線で描く
説明 Windispg()は，スクリプトの最後に置くことで，出力される部分だけが黒で描かれるので，出力図を確認する
ことができる。ただし，Letter()関数で表示した点の名称などがCinderellaで作図したラベルと重なって表示
されて見にくくなることもある。この関数を実行しなくても出力には影響しない。
Windisp(データのリスト）は，Rから KETCindy用に出力されたファイルを ReadOutData()関数で読み込
んだときに，必要なプロットデータ列だけを表示するのに用いる。
ReadOutData(”filename.txt”) でデータを読み込むと，そのデータに含まれるプロットデータ列が，コンソー
ルに
Outdata of filename.txt : [Gfn,Gdfn,Gh]
のように表示される。
このうち，GfnとGhだけを表示するのであれば
Windispg([Gfn,Gh]);
とする。引数なしで
Windispg();
とすればすべてのプロットデータ列が表示される。
なお，いずれの場合も，作図したプロットデータも同時に表示される。
作図した図を全てではなく選択して表示する場合は，それらのプロットデータ名をリストにして引数とする。
たとえば，sg1, gr1, crABが定義されているとき，
Windispg(["sg1","gr1"]);
とすれば，sg1,gr1のみが表示される。
関数 Viewtex()
機能 TEXのソースファイルを書き出す。引数なし。
説明 グローバル変数Fheadで定義したファイル名に ”main” を付加したTEXのソースファイルとバッチファイル
（Macの場合はシェルファイル）を作成する。
関数 Workprocess(）
機能 作図の経過を取得する
説明 作図ツールを用いた作図の経過を取得する。
println(Workproccess());
とすると，コンソールに作図手順が表示される。
関数 Op(n,list or str)
機能 リストまたは文字列から要素を抜き出す
説明 第2引数のリストまたは文字列のn番目の要素（文字）を返す。
76

### Page 77

Cindyscriptの アンダーバーの演算子 (list n , str n) と同様。
関数 Strsplit(文字列 , 文字)
機能 文字列を分解する。
説明 第１引数の文字列を第2引数の文字の位置で分解したリストを返す。
【例】文字aで区切って分解する。
str="abcadeaf";
strL=Strsplit(str,"a"); //[” ”,”bc”,”de”,”f”] を返す。
同様の関数に，Cindyscriptの tokenize(文字列,文字列)がある。tokenize() の第２引数は文字列や，文字のリ
ストでもよい。
⇒関数一覧
関数 Fracform(数 , 分母のリストまたは最大値 [, 許容誤差の桁数(5)])
機能 分母リストの1つを分母とする近似分数と誤差を返す。
説明 戻り値は，簡易TeX-like書式の文字列，誤差，分子，分母。
【例】Fracform(0.33,1..100); => [fr(33,100),''err=0',1,3]
【例】Fracform(pi,200)); => [fr(355,113),err=0.0000002668,355,113]
【例】Fracform(0.33,1..100); => [fr(33,100),''err=0',1,3]
⇒関数一覧
関数 Tonormalform(簡易TeX-like文字列)
機能 *を省略した文字列に*を補った文字列を返す。
【例】Tonormalform("fr(1,3)xsin(x)")); => \verbfr(1,3)*x*sin(x)—
⇒関数一覧
関数 Addasterisk(文字列)
機能 数式文字列に*を追加する。
【例】Addasterisk("fr(1,2)x^2+3sin(x)"); =¿ "fr(1,2)*x^2+3*sin(x)"
⇒関数一覧
関数 Sla2fra(文字列)
機能 文字列の中の / を簡易TeX-like書式の分数に直す。
【例】Slat2fra("pi/3"); =¿ ”frapi,3”
⇒関数一覧
77

### Page 78

関数 Totexform(簡易TeX-like書式)
機能 TeX書式の文字列を返す。
【例】Totexform("fr(1,3)"); => frac{1}{3}
⇒関数一覧
関数 Tocindyform(簡易TeX-like書式)
機能 Cindy書式の文字列を返す。
⇒関数一覧
78

### Page 79

2 他の数式処理ソフトなどとの連携
2.1 Rとの連携
Rは主に統計解析のためのソフトウェアで，binorm（二項分布），pois（ポアソン），unif（一様分布），chisq（カイ
2乗），f（F分布），t（t分布）など，多くの確率分布をサポートしている。
KETCindyでは，kc.bat/command/sh によってコマンドをRに渡し，結果をテキストファイルで受け取る。この
とき，Rとのやりとりで，次のようなファイルが作業ディレクトリに作成される。
拡張子 r ：r用のファイル
拡張子 dat，拡張子 txt：データファイル
このデータのやり取りに関する次のオプションがある。
オプションなしまたは，”” のとき
i) データファイルがなければ，新しく作る
ii) データファイルが既にあればそれを読み込む
”m”のとき，強制的にデータファイルを作り直す。
”r” のとき，すでにあるデータファイルを読み込む。
注）\は\\と書く。
2.1.1 Rの関数の利用
関数 Boxplot(名前,データ,垂直位置,箱の高さ,option)
機能 箱ひげ図を描く
説明 データは，リストで渡す場合とファイル名を渡してファイルから読み込む場合がある。データファイルは csv
形式とする。
【例】乱数で作成した5未満の実数のデータを箱ひげ図にする。
dt1=apply(1..100,5*random());
Boxplot("1",dt1,1,1/2);
y
x
O
【例】外部ファイルとして用意したデータを読み込んで箱ひげ図にする。
Boxplot("2","datafile.csv",3,1/2);
複数列から成るcsvファイルを読み込むには，Readcsvを使う。csvファイルは，作業フォルダ（ 初期設定は
fig ）に入れておく。戻り値は読み込んだファイル。
データの値を画面に入るように調節するには，dt1/20 のようにしてリサイズする。
また，Framedata()，Rulerscale() を併用することで目盛を入れることができる。Framedata() のために，表
示領域の対角点A,BをCinderellaの作図ツールで作図しておく。
data=Readcsv("datafile.csv");
79

### Page 80

dt1=apply(data,#_1);
dt2=apply(data,#_2);
Boxplot("1",dt1/20,1,1/2);
Boxplot("2",dt2/20,3,1/2);
Framedata("1",[A,B],["corner"]);
Rulerscale(A,["r",0,6,1],["f",1,"\mbox{dt1}",3,"\mbox{dt2}"]);
dt2
dt1
0 1 2 3 4 5 6
注）一度実行した後，データを書き直すと，図が更新されないので，”m” オプションをつけて Box-
plot(”1”,dt1/20,1,1/2,[”m”]); とすると，図が更新される。データを書き出すときは，もう一度 ”m” オ
プションをはずして実行してから Figure ボタンを押す。これは，データの作成タイミングの関係。
⇒関数一覧
関数 Rfun(name,コマンド, 引数, option)
機能 Rの1つのコマンドを実行して結果を返す
説明 バッチファイル kc.bat / シェルファイル kc.sh を利用してRとデータをやり取りし，計算結果を取得する。
結果は，変数 R+name に入り，コンソールにも表示される。
【例】Rを用いて標準正規分布から10個の乱数を発生し，戻り値から平均値と標準偏差を求めてコンソールに
表示する。
Rfun("1","rnorm",[10]);
nx=length(R1);
mx=sum(R1)/nx;
sx=sqrt(R1*R1/nx-mx^2);
println("平均："+format(mx,4)+"標準偏差："+format(sx,4));
関数 CalcbyR(変数名,コマンド列，option)
機能 Rのコマンドを実行して結果を返す
説明 バッチファイル kc.bat / シェルファイル kc.sh を利用してRとデータをやり取りし，計算結果を取得する。
コマンド列は，”戻り値=コマンド”，[引数] の2つをセットとして並べる。
最後の行の結果が戻り値として第１引数の変数名に代入される。”戻り値1::戻り値2・・”,[]の形（戻り値1，
戻り値2・・は各コマンドの戻り値）でコマンドを書くと，戻り値1,・・のリストとなる。戻り値が一つの場
合は実数。”=値”,[] の形の場合，「値」がそのまま戻り値となる。
【例】Rを用いてN(50,52)から10個の乱数を発生し，平均と不偏分散もRで計算してその結果をコンソール
に表示する。
cmdL=[
"tmp1=rnorm",[10,50,5],
"tmp2=mean",["tmp1"],
80

### Page 81

"tmp3=var",["tmp1"],
"tmp1::tmp2::tmp3",[]
];
CalcbyR("rd",cmdL);
dt=rd_1;
mx=rd_2;
vx=rd_3;
println("データ："+dt);
println("平均："+format(mx,4)+"不偏分散："+format(vx,4));
CalcbyR()によって，データと平均，不偏分散からなるリストが作成されるので，mxに平均，vxに不偏分散
を代入している。rd_(-1) は，リスト rd の末尾の要素。
【例】Ｒでポアソン分布から200個の乱数をとり，標本平均の分布の様子＝分散が小さくなって，正規分布に近
づいている様子＝をヒストグラムで見る。分散はＲで求めた不偏分散に (n-1)/n をかけて再計算してコンソー
ルに表示する。
cmdL=[
"tmp1=rpois",[200,5],
"tmp2=mean",["tmp1"],
"tmp3=var",["tmp1"],
"=c(tmp2,tmp3,tmp1)",[]
];
CalcbyR("rd",cmdL);
dt=rd_(3..length(rd));
n=length(dt);
mx=rd_1;
vx=rd_2*(n-1)/n;
sx=sqrt(vx);
println(dt);
println(["m="+format(mx,4),"v="+format(vx,4)]);
Setscaling(1/5);
Histplot("1",dt,["Breaks=seq(0,14,1)","dr,0.5"]);
y
x
O
【例】ポアソン分布で乱数を2000個発生させ，10個ずつの平均をＲで計算し，ヒストグラムを作る。
cmdL=[
"tmp1=rpois",[2000,5],
"tmp2=c()",[],
"for(k in 1:200){",[],
"tmp=tmp1[(10*(k-1)+1):(10*k)]",[],
"tmp2=c(tmp2,mean(tmp))",[],
"}",[],
"=tmp2",[]
];
CalcbyR("rd2",cmdL);
81

### Page 82

Setscaling(1/10);
Histplot("2",rd2);
⇒関数一覧
関数 Histplot(name,data,option)
機能 Rを利用してヒストグラムを描く
説明 dataはリストにして作成するか，外部ファイルからReadcsv()で読み込む。戻り値は，階級境界値と，対応す
る度数のリスト。
階級境界値（ブレークポイント）は，自動的に設定される（スタージェスの公式による）が，オプションで，
"breaks=[0,10,20,30,40,50,60,70,80,90,100]"
などと指定することもできる。
この他のオプションは
”Den=yes/no”：密度の指定（初期値は no）
”Rel=yes/no”：相対度数にする/しない（初期値は no）
【例】csvファイル（datafile.csv）を読み込み，ヒストグラムを作る。Framedata() と Rulerscale()を併用し
て，目盛付きの枠の中に表示する。表示枠の対角点A,BはCinderellaの作図ツールで作図しておく。
Addax(0);
Setscaling(5);
Setunitlen("0.6mm");
data=Readcsv("datafile.csv");
Histplot("1",data,[""]);
Framedata("1",[A,B],["corner"]);
Rulerscale(A,["r",0,100,10],["r",0,15,5]);
15
10
5
0
0 10 20 30 40 50 60 70 80 90 100
2行目と3行目は，データに合わせて縦方向を5倍にし，TeXの単位長を0.6mmにしている。
Den,Rel オプションをyes にしたときは，Setscaling(100)くらいにするのがよい。
csvファイルが複数のデータからなる場合は，
dt1=data_1; として，リストの第１要素を取得する。第2要素のヒストグラムであればdata_2 とする。
⇒関数一覧
関数 PlotdataR(name,式,変数)
機能 Rの関数のグラフを描く
説明 Cindyscriptの組み込み関数にはない関数のグラフをRを利用して描く。
【例】平均5, 標準偏差2の正規分布の密度関数と分布関数のグラフを描く。
82

### Page 83

PlotdataR(“1”, “dnorm(x,5,2)”, ”x=[0,10]”);
PlotdataR(“2”, ”pnorm(x,5,2)”, ”x=[0,10]”);
y
x
O
【例】標準正規分布のグラフ上の点とx軸を結んだ線分を描く。
点A,BはCinderellaの作図ツールで作図しておき，点Aをグラフ上のおよその位置に置いてから実行する。
PlotdataR("1","dnorm(x)","x=[-5,5]");
Putoncurve("A","grR1",[-3,3]);
Putpoint("B",[A.x,0]);
Listplot("1",[A,B]);
2行目の最後の引数の[-3,3]は，その範囲を動かすことを意味する。
Aはグラフ上を動かすことができて，Bはそれに伴って動く。ただし，少し動かす度に バッチ/シェル ファイ
ルを実行するので，煩雑な場合は，Plotdata() の行をコメント化してから点Aを動かしたあと再実行すると
よい。
【例】上と同様で，x軸上の点を自由点Aとし，曲線上にBを置く。
PlotdataR("1","dnorm(x)","x=[-5,5]");
PlotdataR("1","dnorm(x)","x=[-5,5]");
A.xy=[A.x,0];
Lineplot("1",[A,A+[0,1]],["nodisp"]);
Putintersect("B","grR1","ln1");
Listplot("1",[A,B]);
【例】前の例のグラフで，ABの左側にShadeをかけ，Shadeの部分の面積を求める。Pの値を表示する位置
に，Cinderellaの作図ツールで点Cをとっておく。
PlotdataR("1","dnorm(x)","x=[-5,5]",["Num=100"]);
Putpoint("A",[0,0],[A.x,0]);
Lineplot("1",[A,A+[0,1]],["nodisp"]);
Putintersect("B","grR1","ln1");
Listplot("1",[A,B]);
Listplot("2",[[-5,0],[5,0]],"nodisp");
Enclosing("1",["Invert(grR1)","sg2","sg1"],[B,"notex"]);
Shade(["en1"],["Color=[0.2,0,0,0]"]);
tmp=0.5+Integrate("grR1",[0,A.x]);
Expr([A,"s",text(A.x),C,"e","P="+text(tmp)]);
y
P =0.65
x
O 0.37
⇒関数一覧
83

### Page 84

関数 PlotdiscR(name,式,変数)
機能 Rを利用して離散型のグラフを描く
説明 dbinom （二項分布），dpois（ポアソン分布），dgeom（幾何分布）など離散型確率分布のグラフを描く。
【例】二項分布のグラフと正規分布のグラフを比較する。
Setscaling(20);
PlotdiscR("1","dbinom(k,10,0.4)","k=[0,10]");
PlotdataR("1","dnorm(x,10*0.4,sqrt(10*0.4*0.6))","x=[0,10]",["do"]);
y
x
O
【例】ポアソン分布および幾何分布のグラフ。
PlotdiscR("2","dpois(k,4)","k=[0,10]");
PlotdiscR("3","dgeom(k,0.3)","k=[0,10]");
⇒関数一覧
関数 Scatterplot(name,filename/datalist,option1,option2)
機能 2次元データを読み込み，散布図を描く
説明 外部ファイル filename（csv形式）を読み，散布図を描く。
外部ファイルの２次元データとは，次の形のcsvファイル。（行末はLFまたはCR）
2.3, 4.5 (LF)
3.2, 7 (LF)
2.0, 6.8 (LF)
datalistの場合は，次の形。
data=[[2.3,4.5],[3.2,7],[2.0,6.8], ・・・ ];
第１オプションは，回帰直線を描くかどうかと点のスタイル。
”Reg=no” : 回帰直線を描くかどうか（yes/no) 初期値は yes
第２オプションは，相関係数と回帰直線の式を表示する位置と，回帰直線のスタイル。
位置は，幾何点の名称でもよい。
【例】data.csv を読んで散布図を描き，回帰直線を引く。
Scatterplot("1","data.csv");
だけで描ける。オプションをつけた例は次。
点Aを相関係数と回帰直線の式を表示する点としてCinderellaの作図ツールで取る。
84

### Page 85

点を青で大きさ2とし，回帰直線を緑で表示する。
Scatterplot("1","data.csv",["Size=4","Color=blue"],[A,"Color=green"]);
Listplot("1",[[0,7],[0,0],[7,0]]);
Rulerscale([0,0],["r",0,7,1],["r",1,7,1]);
7
r =0.535, y =1.009x−0.545
6
5
4
3
2
1
0 1 2 3 4 5 6 7
⇒関数一覧
2.1.2 TEXのコマンド書き出し（メタコマンド）
Wfile=’ファイル名’ 書き出しファイル名を設定
cat(”,file=Wfile,append=FALSE)
書き出しファイルを初期化
Texcom(”コマンド”) TEXコマンドのコードを書き出す
例) Texcom(”\\begin{minipage}{3cm}”)
※ ”newline” のとき，空白行を挿入
Openphr(ユーザーコマンド名)，Closephr()
\defのコマンド定義を始める
例) Openphr(”\\p”)
Texcom(”\\begin{array}{cc}”)
Texcom(”5 & 3\\\\”)
Texcom(”8 & 7”)
Texcom(”\end{array}$”)
Closephr()
Openpar(ユーザーコマンド名，幅 {, 位置 }), Closepar()
minipage環境を含む\def コマンド定義を始める
※ 位置のデフォルトは ”c”
例) Openpar(”\\s”,”5cm”)
Texcom(”\\input{rei}”)
Closepar()
Letter(c([2,3),”se”,”\\s”)
85

### Page 86

Texletter( 点(list形式), 方向, 文字列 ，・・・)
点の位置の「方向」に文字列をかく（複数可）
例) Texletter(list(4,”#1”),”n”,”文字”)
※ 位置は”n”, s”, ”e”, ”w”, ”ne”, ”nw”, ”se”, ”sw”, ”c”
※ 点の位置はリスト形式で，TEXの形式で渡される。
Texnewctr(番号または番号のベクトル)
KETpicで使うカウンタ(ketpicctra,...)を定義
Texctr(番号またはカウンタ名)
番号のカウンタ名またはカウンタ名を返す
Texthectr(番号) \the+カウンタ名の文字列を返す
Texvalctr(番号) \value{カウンタ名}の文字列を返す
Texsetctr(番号，文字列) カウンタに値をセットするTEXコマンド列を出力
例) Texsetctr(2, ”1*2/3”);
例) Texsetctr(2, ”(-#1)+2”);
Texletter(位置（list），方向，文字列)
位置listで表される点に文字列をかくTEXコマンド列を出力
例) Texletter(list(10,paste(”-”,Texvctr(2),sep=””)),”ne”,”\content”);
例) Texletter(list(0, ”#1”), ”c”, ”A”);
Texnewcmd(コマンド名，引数の個数，オプション値)
\newcommand を始めるTEXコマンドを出力
Texrenewcmd(コマンド名，引数の個数，オプション値)
\renewcommand を始めるTEXコマンドを出力
Texend() TEXのコマンド定義を終わるTEXコマンドを出力
Texfor(カウンタ番号，初期値，終了値)
TEXのループ構造を始める．
※ 初期値，終了値は文字列で与える．
例) Texfor(1,”1”,”#1”);
Texendfor(カウンタ番号) TEXのループ構造を終える．
例) Texendfor(1);
Texforinit() TEXのループ構造を初期化
Texif(数値条件 { ,1 }) TEXのif構造を始める．（ifnumまたは ifdim）
※ 条件は文字列で与える．
※ 1を追加したときは ifdim
例) Texif(”Texctr(1)<#2”);
Texelse() TEXのelseブロック．
Texendif() TEXのif構造を終える．
2.2 KETCindyでのメタコマンドの利用例
(1) 次のコマンドを実行すると，マクロファイル hdash.tex ができる。
cmdL=[
"Wfile='hdash.tex'",[],
"cat('',file=Wfile,append=FALSE)",[],
"Texnewcmd",["'\\hdash'",2],
"Texcom",["'{\\unitlength=1mm'"],
"Texcom",["'\\begin{picture}(#1,#2)(0,0)'"],
"Texsetctr",[1,"'#1/2'"],
"Texfor",[2,1,"Texthectr(1)"],
86

### Page 87

"Texsetctr",[3,"'2*Texctr(2)-2'"],
"tmp1=Texthectr(3)",[],
"tmp=paste('\\put(',tmp1,',#2){\\line(1,0){1}}',sep='')",[],
"Texcom(tmp)",[],
"Texendfor",[2],
"Texcom",["'\\end{picture}}'"],
"Texend()",[]
];
CalcbyR("ans",cmdL,["Out=n"]);
注）上の例ではpict2eのコマンドを使っている．
(2) 親ファイル（例えばdashtest.tex）を作っておく。
\documentclass{ujarticle}
\usepackage{ketpic,ketlayer}
\usepackage{pict2e} % pict2eの読み込み
\input{hdash.tex}
\begin{document}
\hdash{20}{14}
\end{document}
(3) CindyScriptに
Setfiles(”dashtest”);
を追加して，Parentボタンを押す．
87

### Page 88

2.3 Maximaとの連携
Maximaは数式処理ソフトで，KETCindyにおいては微積分の計算など，Cindyscriptでは不十分な点を補うこと
ができる。
KETCindyでは，kc.bat/shによってコマンドをMaximaに渡し，結果をテキストファイルで受け取る。このとき，
Maximaとのやりとりで，次のようなファイルが作業ディレクトリに作成される。
拡張子 max ：Maximaに渡すコマンドを記述したファイル
拡張子 txt：Maximaが出力したデータファイル
このデータのやり取りに関する次のオプションがある。
オプションなしまたは，”” のとき
i) データファイルがなければ，新しく作る
ii) データファイルが既にあればそれを読み込む
”m”のとき，強制的にデータファイルを作り直す。
”r” のとき，すでにあるデータファイルを読み込む。
このとき，ファイルの読み書きで不具合があると，数秒の後「==> file.txt not generated (5 s ) 」のようなエラー
メッセージがコンソールに表示される。このような場合は作業ディレクトリの設定などを確認していただきたい。こ
の待ち時間については，Waitオプションで設定することもできる。
関数 CalcbyM(name，コマンド，option)
機能 Maximaのスクリプトを実行する
説明 第2引数はMaximaで実行するコマンドを記述したスクリプト。
コマンドと引数リストの繰り返しからなるスクリプトをリストとして作り，一度に実行する。
戻り値はない（未定義値）。実行結果は，コマンドリストの最後に記述した変数（引数は空リスト）の値が，
nameで指定された変数に代入される。複数の結果を戻すときは，:: で区切って記述するとリストにしてname
に代入される。
【例】sinx とその導関数を表示する。
cmdL=[
"f:sin(x)", [],
"df:diff",["sin(x)","x"],
"f::df",[]
];
CalcbyM("fdf",cmdL);
println(fdf);
実行すると，結果の f とdf のリストが変数 fdf に代入され，コンソールに，[sin(x),cos(x)] と表示される。
【例】2次方程式 x2−x−4=0の解を求める。
cmdL=[
"ans:solve",["x^2-x-4","x"],
"ans",[]
];
CalcbyM("ans",cmdL);
println("ans="+ans);
コンソールには
ans=[x = -(sqrt(17)-1)/2,x = (sqrt(17)+1)/2]
が表示される。
88

### Page 89

応用例１：曲線の接線を引く
ex+e−x
f(x)= の，x=aにおける接線の方程式を作る。
2
fx="(exp(x)+exp(-x))/2";
cmdL=[
"df:diff",[fx,"x"],
"c:ev",["df","x=a"],
"b:ev",[fx,"x=a"],
"eq:c*(x-a)+b",[],
"eq",[]
];
CalcbyM("tn1",cmdL);
println(tn1);
コンソールには
(%e^a-%e^-a)*(x-a))/2+(%e^a+%e^-a)/2
が表示される。
この，CalcbyMの戻り値 tn1 を用いて，曲線上の１点Aにおける接線のグラフを描く。以下のスクリプトを
追加する。なお，点AをCinderellaの作図ツールで適当なところにとっておく。
tn1=Assign(tn1,["%e^a","exp(a)","%e^-a","exp(-a)"]);
Plotdata("1",fx,"x");
Putoncurve("A","gr1");
tmp=Assign(tn1,["a",A.x]);
plotdata("2",tmp,"x",["Num=2"]);
１行目ではMaximaで作成した式を，Cindyscriptでプロットできる式にしている。
y
A
x
O
なお，接線の方程式を求めるだけであれば，Mxfun()を使うこともできる。Mxfun()の解説を参照のこと。
応用例2：パラメトリックの場合の接線
媒介変数の値を決めるために，点AをCinderellaの描画面のx軸上にとっておき，そのx座標を媒介変数t
の値とする。スライダを作ってもよい。
fn="3*cos(t)^2*[cos(t),sin(t)]"; y
cmdL=[
"f:",[fn],
"df:diff",["f","t"],
x
O
89

### Page 90

"df:trigsimp",["df"],
"tn:f+s*df",[],
"tn",[]
];
CalcbyM("tn2",cmdL);
Paramplot("1",fn,"t=[0,2*pi]",["Num=100"]);
gn=Assign(tn2,["t",A.x]);
Paramplot("2",gn,"s=[-3,3]");
cmdLで定義しているMaximaのコマンド（trigsimp など）については，Maximaの解説書などを参照され
たい。
【例】定積分の値を求める。
∫
2
(−x3+3x+2)dx の値を求める。結果は val で受け取り，Mxtex() に渡して，TeX書式にして表示する。
−1
cmdL=[
"val:integrate",["-x^3+3*x+2,x,-1,2"],
"val",[]
];
CalcbyM("val",cmdL);
Mxtex("1",val);
Expr([[2,2],"e","S="+tx1]);
関数 Mxbatch(ファイル名)
機能 Maximaのライブラリを使うバッチファイルを作成
説明 ketcindy/ketlib/maximaL にあるライブラリを用いるコマンドでバッチファイルを作成する。
ketcindy/ketlib/maximaL には，fourier sec.max , matoperation.max , poincare.mac の3つのファイルが
あり，関数を定義したライブラリが入っている。それぞれ次のような内容である。各ファイルをテキストエ
ディタで開いて参照されたい。
fourier sec.max ：フーリエ級数の計算を行う。
matoperation.max ： 行列の計算を行う。
poincare ： ハミルトニアンシステムに関する計算を行う。
【例】cmd=Mxbatch("fourier_sec")
を実行すると，cmdに，たとえば
[batch,["/Applications/ketcindy/ketlib/maximaL/fourier_sec.max"]]
が代入される。（Mac/Windows および KeTCindyの設定によって異なる）
そこで，次のように利用する。
Setax(["a"]);
Slider("A-C-B",[-5.5,-1.5],[4.5,-1.5]);
defL=["1",[-3,-2],1,"0",[-2,-1],1,"-x",[-1,1],1,"0",[1,2],1,"-1",[2,3],1];
Drwxy();
tmp=Periodfun(defL,1,["dr,2","Color=red"]);
fun=tmp_1;
per=tmp_2;
Htickmark([1,"n","1",2,"n","2",3,"nw","3"]);
Htickmark([-1,"-1",-2,"-2",-3,"-3"]);
cmdL=Concat(Mxbatch("fourier_sec"),[
"Ffun(x):="+fun,[],
"c:fourier_sec_coeff",["Ffun(x)","x"],
"c[1]::c[2]::c[3]",[]
]);
90

### Page 91

CalcbyM("ans",cmdL,[]);
nterm=round(4*(C.x-A.x));
Fourierseries("1",ans,per,nterm,["Num=400"]);
Mxtex("2",ans_3);
Expr([[-5,-2],"e","s_n="+tx2,[4,-2],"e","n="+text(nterm)]);
y
1 2 3
x
−3 −2 −1 O
s
=−2(πncos(2π
3
n)+3sin(π
3
n)−πncos(π
3
n)−πn(−1)n)
n=15
n π2n2
関数 Mxfun(name，式，リスト，option)
機能 Maximaの関数を実行する
説明 第2引数の「式」はMaximaの関数名。第3引数のリストは関数に渡す引数のリスト。
戻り値は，第１引数の式に１つでも文字があると文字列となる。すべて数字（+,-, . を含む）の場合は16桁以
下であれば数，それ以上の場合は文字列となる。また，戻り値は，変数 mx+name にも代入される。
オプションに ”Disp=no” をつけると，結果をコンソールに表示しない。
【例】10!を求める。
Mxfun("1","10!",[]);
を実行すると，コンソールにmx1 is 3628800 と表示される。この値は変数 mx1 に代入されているので，
Letter([[0,1],"e",mx1]);
とすればCinderellaの描画面上に表示される。mx1ではなく，戻り値を変数に代入して使うこともできる。
fact10=Mxfun("1","10!",[]);
Letter([[0,1],"e",fact10]);
【例】文字列の連結
文字列を引数とする場合，例えば，Maximaの文字列を連結するコマンドconcatでは，
concat("a","b")
とするが，中にダブルクォートが入っているため，全体を文字列にすることができない。
このような場合は，第2引数を使って
Mxfun("1","concat",["a","b"])
とすればよい。
＜参考＞ CindyScript の unicode(code) 関数を用いてダブルクォートを表し，次のようにすることもできる。
dq=unicode("22");
comm="concat("+dq+"a"+dq+","+dq+"b"+dq+")";
Mxfun("1",comm,[]);
【例】f(x)=sinx を微分する
Mxfun("1", "diff",["sin(x)","x"])
とすると
diff(sin(x),x)
91

### Page 92

というコマンドをMaximaに渡して，戻り値をCindyの変数mx1に代入する。
Mxfun("1", "diff(sin(x),x)",[]])
と，第１引数にまとめても同じ結果になる。ただし，この場合，第2引数は空リストとする。
＜参考＞Cindyscriptの微分との違い
Cindyscriptでも微分はできる。たとえば，
f(x):=sin(x);
g(x):=d(f(#),x);
plot(g(#));
とすると，cos(x)のグラフが描かれる。
しかし，Cindyscriptの微分が，微分の定義による数値計算であるのに対し，Maximaでは数式処理として微
分ができる。
その意味の違いは，次のスクリプトで確かめられる。
f(x):=sin(x);
g(x):=d(f(#),x);
println(g(x));
では，コンソールに表示されるのは未定義値（ ） である。
一方，
Mxfun("1", "diff",["sin(x)","x"]);
println(mx1);
では，コンソールに cos(x) と表示される。
mx1は文字列であるので，Plotdata("1",mx1,"x") でグラフが描ける。
また，Cindyscriptの微分では，3階か4階までの導関数が計算上の限度であるのに対し，Maximaなら何階
でも微分ができるので，テイラー展開などで有利である。
【例】sinx の テイラー展開による近似のグラフを表示する。
Mxfun("1","taylor",["sin(x)","x",0,7],[""]);
Plotdata("1","sin(x)","x",["da"]);
Plotdata("2",mx1,"x");
y
x
O
なお，Mxtex() を用いれば，Mxfun()の結果の mx1をTeX書式にして表示できる。
Expr([[1,2],"e",Mxtex("1",mx1)]);
を追加すれば[1,2]の位置に式が表示される。
【例】接線の方程式を作る
92

### Page 93

ex+e−x
f(x)= の，x=aにおける接線の方程式を作る。
2
関数式を文字列にしておき，Assign() を用いて変数xをaに変えれば，f(a)の式を作ることができる。導関
数についても同様にする。
fx="(exp(x)+exp(-x))/2";
gx=Mxfun("1","diff",[fx,"x"]);
fa=Assign(fx,["x","a"]);
ga=Assign(gx,["x","a"]);
tf=ga+"*(x-a)+("+fa+")";
println(tf);
コンソールには
(%e^a-%e^-a)/2*(x-a)+((exp(a)+exp(-a))/2)
が表示される。
同様の例を CalcbyM() で例示しているので参照されたい。
関数 Mxtex(name,式)
機能 式をTeX書式にする
説明 第2引数の式は，直接書いた式もしくはMxfunの戻り値。これをTeXの書式にする。
戻り値は，変数 txname にも代入される。
【例】部分分数への分解
x3
部分分数 の分解をMaximaで行い，その結果をTeX書式にして画面に表示する。画面に表示
(x+1)(x+2)
された結果はそのままKETCindyで出力できる。
Mxfun("1","partfrac",["x^3/((x+1)*(x+2))","x"]);
Mxtex("1",mx1);
Expr([0,1],"e",tx1);
ここで，mx1，tx1はそれぞれMxfun(”1”,・・) , Mxtex”1”,・・) の結果（戻り値）である。mx1，tx1 はコ
ンソールにも表示され，tx1は次のようになっている。
\frac{8}{x+2}-\frac{1}{x+1}+x-3
Cindyscript は TeX 書式をサポートしているのでこれで描画面に分数式が表示されるが，Tex の文書では，
\frac{}{} ではなく，\dfrac{}{}を使うことが多い。そこで，Assign()を用いて，”frac” を ”dfrac” に変え
れば，そのままTex文書で使える。ただし，Cindyscriptは \dfrac{}{} をサポートしていないので，画面上
では分数表記にならない。そのあたりの事情を次のスクリプトで示す。
fx="x^3/((x+1)*(x+2))";
pfx=Mxfun("1","partfrac",[fx,"x"]);
form=Mxtex("1",fx)+"="+Mxtex("2",pfx);
dform=Assign(form,["frac","dfrac"]);
Letter([0,5],"e","部分分数への分解$"+form+"$");
Letter([0,3],"e","部分分数への分解$"+dform+"$");
Cinderellaの描画面では次のように表示される。
93

### Page 94

出力したTeX挿入図では次のようになる。
Decomposition into partial fractions
x3 8 1
= − +x−3
(x+1) (x+2) x+2 x+1
なお，文字列を置換するのに，Assign(form,["frac","dfrac"]) ではなく，
Cindyscriptの文字列の関数 replace を用いて，
dform=replace(form,"frac","dfrac");
としてもよい。
【例】2次関数のグラフを表示し，x軸との交点のx座標を表示する。
y
fx="x^2-x-3";
cmdL=[
"ans:solve",[fx,"x"],
"ans",[]
x
]; √ O √
1− 13 13+1
CalcbyM("ans",cmdL); 2 2
p1=indexof(ans,"[");
p2=indexof(ans,",");
p3=indexof(ans,"]");
s1=substring(ans,p1,p2-1);
s2=substring(ans,p2,p3-1);
s1=replace(s1,"x =","");
s2=replace(s2,"x =","");
Mxtex("1",s1);
Mxtex("2",s2);
Plotdata("1",fx,"x");
Expr([-2,-0.5],"e",tx1);
Expr([2,-0.5],"e",tx2);
ここで，CalcbyM("ans",cmdL); で得られるansは，次のような文字列である。
"[x = -(sqrt(13)-1)/2,x = (sqrt(13)+1)/2] "
そこで，ここから2つの式だけを抽出する作業を行ったのち，Mxtex() でTeXの式を得ている。
さらに応用として，点AをCinderellaの作図ツールで作図し，
if(A.y<0,
fx="(x-"+text(A.x)+")^2"+guess(A.y),
fx="(x-"+text(A.x)+")^2+"+guess(A.y);
);
とすると，点Aを頂点とする放物線と軸との交点の座標が描かれる。Maximaとのデータのやり取りをするた
めのタイムラグがあるが，インタラクティブに放物線の位置を変えることができる。
＜参考＞
2次関数のような簡単な関数であれば，Cindyscriptの roots() 関数を用いて2次方程式が解けるので，次のス
94

### Page 95

クリプトでほぼ同じ動作をするものを作ることができる。「ほぼ」というのは点Aの位置によっては，guess()
で解釈しきれないことがあるためである。Maximaを使えば数式処理で解を求めるので，Aがどこにあっても
きれいに表示できる。
fx="x^2-2*A.x*x+A.x^2+A.y";
cf=[A.x^2+A.y,-2*A.x,1];
sol=roots(cf);
s1=guess(sol_2);
s2=guess(sol_1);
Mxtex("1",s1);
Mxtex("2",s2);
Plotdata("1",fx,"x");
Expr([-2,-0.5],"e",tx1);
Expr([2,-0.5],"e",tx2);
⇒関数一覧
95

### Page 96

2.4 Wolfram Engine との連携
2019年5月，Wolfram ResearchはMathematicaのコアであるWolfram Engineを開発者や個人ユースのために
無償開放した。
インストール・ライセンスは https://www.wolfram.com/engine/
ただし，Wolfram IDを取得する必要がある。
関数 CalcbyW(name，コマンド，option)
機能 Wolfram 言語(Wl)のスクリプトを実行する
説明 第2引数はWolfram Engineで実行するコマンド。
コマンドと引数リストの繰り返しからなるリスト（例えばcmdL）を作って，一度に実行する。結果は，コマ
ンドリストの最後に記述した変数（引数は空リスト）の値がwl+name で指定された変数に代入される。複数
の結果を戻すときは，:: で区切って記述するとリストにして代入される。
関数 Wlfun(name，式，リスト，option)
機能 Wlの1つの関数を実行する
説明 第2引数の「式」はWlの関数名。第3引数のリストは関数に渡す引数のリスト。
オプションに ”Disp=no” をつけると，結果をコンソールに表示しない。
関数 Wltex(name,式)
機能 式をTeX書式にする
説明 第2引数の式は，直接書いたWlの式もしくはWlfunの戻り値。これをTeXの書式にする。
戻り値は，変数 wl+name にも代入される。オプションに ”Disp=no” をつけると，結果をコンソールに表示
しない。
⇒関数一覧
2.5 Risa/Asirとの連携
関数 CalcbyA(name，コマンド，option)
機能 Risa/Asirのスクリプトを実行する
説明 第2引数はRisa/Asirで実行するコマンド。
コマンドと引数リストの繰り返しからなるリスト（例えばcmdL）を作って，一度に実行する。
戻り値はない。（未定義値）結果は，コマンドリストの最後に記述した変数（引数は空リスト）の値がname で
指定された変数に代入される。複数の結果を戻すときは，:: で区切って記述するとリストにして代入される。
関数 Asirfun(name，式，リスト，option)
機能 Risa/Asirの関数を実行する
説明 第2引数の「式」はRisa/Asirの関数名。第3引数のリストは関数に渡す引数のリスト。
戻り値は，第１引数の式に１つでも文字があると文字列となる。すべて数字（+,-, . を含む）の場合は16桁以
下であれば数，それ以上の場合は文字列となる。また，戻り値は，変数 asname にも代入される。
オプションに ”Disp=no” をつけると，結果をコンソールに表示しない。
⇒関数一覧
96

### Page 97

2.6 FriCAS(Axiom) との連携
関数 CalcbyF(name，コマンド，option)
機能 FriCASのスクリプトを実行する
説明 第2引数はFriCASで実行するコマンド。
コマンドと引数リストの繰り返しからなるリスト（例えばcmdL）を作って，一度に実行する。
戻り値はない。（未定義値）結果は，コマンドリストの最後に記述した変数（引数は空リスト）の値がname で
指定された変数に代入される。複数の結果を戻すときは，:: で区切って記述するとリストにして代入される。
関数 Frfun(name，式，リスト，option)
機能 FriCASの関数を実行する
説明 第2引数の「式」はFriCASの関数名。第3引数のリストは関数に渡す引数のリスト。
戻り値は，第１引数の式に１つでも文字があると文字列となる。すべて数字（+,-, . を含む）の場合は16桁以
下であれば数，それ以上の場合は文字列となる。また，戻り値は，変数 friname にも代入される。
オプションに ”Disp=no” をつけると，結果をコンソールに表示しない。
⇒関数一覧
2.7 MeshLabとの連携
MeshLabは，3Dデータ（objデータなど）を読み込んでレイトレーシングで表示・編集するソフトウェアであ
る。レイトレーシングで3Dグラフィクスを描くには，Cinderellaと親和性の高い Cindy3D を利用するのがよいが，
MeshLabを使うメリットは3Dプリンタ用のSTLファイルを出力できることである。また，KETCindyで描いた
3Dの図がレイトレーシングでどのようになるのかを見ることも比較的簡単にできる。
MeshLabとの連携は，KETCindyから Obj 形式のデータを書き出すことで行う。Mkobj**() 関数でデータを作
り，Mkviewobj() 関数でMeshLabを呼び出して表示を行う。
なお，Mkviewobj() 関数でMeshLabを呼び出して表示を行う場合，これをDrawスロットに書くと頻繁に呼び出
しが行われるため非効率となる。そこで，if(1==0,・・・) で・・・の部分にMeshLabの呼び出し関係のスクリプト
を書いて，実際に呼び出すときに if(1==1,・・・)とする方法と，呼び出し関係のスクリプトを関数化してボタンに
割り当てる方法がある。ketcindyパッケージに含まれる sample にボタンをつけたものがある。
なお，3Dであるので，Initialization スロットに
Ketinit(); Ketinit3d(); を記述しておく。
関数 Mkobjcmd(name，式，option)
機能 厚みを持たない曲面のobjファイルのためのコマンドを作成する
説明 オプションは [分割数1，分割数2，表側の方向の指定]
表側の方向は，変数に対して，右手系の方向が”+”
作成されるデータは”oc”+name のファイル名の obj データである。この名称は，Mkviewobj() で用いる。
（以下，Mkobj**()関数では同様）
【例】：サドル面
fd=[ "z=x^2-y^2", "x=[-1,1]","y=[-1,1]"," "];
Sf3data("1",fd);
Windispg();
Mkobjcmd("1",fd,[40,40,"-"]);
Meshlab():=(
Mkviewobj("saddle",oc1, ["m","v"]);
97

### Page 98

);
このうち，Sf3data("1",fd); はCinderellaの画面に表示するためであって，なくてもよい。
次図で，左が option + の場合，右が - の場合である。
⇒関数一覧
関数 Mkobjcrvcmd(name，PD，option)
機能 空間曲線（直線）のobjファイルのためのコマンドを作成
説明 オプションは [太さ，断面の形状（正多角形）の辺の数，断面の正面]
曲線は紐のようなもので表す。その断面は正多角形で， 初期設定は正 6 角形である。断面の正面
は”xy”,”yz”,”zx”のいずれかで指定する。太くなった時に形状の差が現れる。
例太さ0.03で螺旋を描く
Spacecurve("1","[(6*pi-t)/(6*pi)*cos(t),(6*pi-t)/(6*pi)*sin(t),0.1*t]",
"t=[0,6*pi]",["Num=200"]);
Windispg();
Mkobjcrvcmd("1","sc3d1",[0.03]);
Meshlab():=(
Mkviewobj("spiral",oc1,["m","v"]);
);
Mkobjcrvcmd("1","sc3d1",[0.1,8,"yz"]); としたのが下図右。
⇒関数一覧
関数 Mkobjnrm(name，式)
機能 法線ベクトルのデータを作成
説明 式は曲面を表す式。これに対し，法線ベクトルを表す式を求める。
関数 Mkobjplatecmd(name，面データ，options)
98

### Page 99

機能 面を描く
説明 面データを渡して面を描く。
options は，面の厚みの指定。厚みは中心線に対し，両側につけることができる。
たとえば，[0.05] はプラス側に 0.05 の厚み，[0.05,-0.04] はマイナス側にも0.04の厚みをつける。
【例】三角形のプレートを描く
Xyzax3data("","x=[-5,5]","y=[-5,5]","z=[-5,5]");
p1=[2,0,0];
p2=[0,2,0];
p3=[0,0,2];
plane=[[p1,p2,p3],[[1,2,3]]];
Mkobjplatecmd("1",plane,[0.05]);
Mkobjcrvcmd("2","ax3d");
Mkviewobj("plane",Concatcmd([oc1,oc2]),["m","v"]);
関数 Mkobjpolycmd(name，PD，options)
機能 多面体を描く
説明 VertexEdgeFace() の戻り値を PDとして渡して多面体を描く。
関数 Mkobjsymbcmd(PD, 実数，実数，ベクトル, ベクトル)
機能 文字等のobjデータのためのコマンドを作成
説明 引数のPDを描く。第2引数は大きさ，第3引数は回転角，第4引数は正面方向のベクトル，第5引数はPD
の中心の位置。
PDは，平面の描画コマンドによるプロットデータが使える。また，PD に半角アルファベットを文字として
与えることができる。この場合，文字は n,p,q,r,t,x,y,z で，該当するフォントが data フォルダの fontF フォ
ルダに用意されている。この中にないフォントは使えない。
関数 Mkobjthickcmd(name，式)
機能 厚みを持つ曲面のobjファイルのためのコマンドを作成
説明 オプションは [分割数1，分割数2，厚み，表側の方向の指定，条件] 表側の方向は，変数に対して，右手系の方
向が”+”。厚みを持つため，nsew のそれぞれについて，”+n+s-e-w” のように指定する。
条件として，"Assume(R>0)" をつけると，Rが0以下になるための不具合を回避できる。
また，”ratsimp” をつけると有理関数について，”trigsimp”をつけると三角関数について，処理を速くするこ
とができる。
なお，この関数はMaximaを使うので，Maximaをインストールしていることが前提。
【例】回転放物線
0
fd=[
10
"z=(x^2+y^2)",
"x=R*cos(T)","y=R*sin(T)",
"R=[0,2]","T=[0,2*pi]","e"
20
0 10 20 30 40 50 60 70 80 90 100 110 120 130 140 150
99

### Page 100

];
Mkobjthickcmd("1",fd,[40,40,0.2,"+n+s-e-w+","assume(R>0)"]);
Mkviewobj("pala",oc1,["m","v","Wait=5"]);
関数 Mkviewobj(name，PD, options)
機能 objファイルを作成。optionにより MeshLab を立ち上げて表示する。
説明 第2引数に複数のプロットデータを与えるときは，Concatcmd() により１つにまとめる。オプションは
”m”または”make” データを作る（指定しない場合もデータがなければ作る）
”v”または”view” MeshLabを立ち上げて表示する
”W=n” 作成するための待ち時間。ｎ秒。これを過ぎると終了する
”Unit=mm” Setunitlen()と連動して3Ｄプリンタの数値の単位をmmで指定する
3Dプリンターがインチで認識する場合は ”Unit=in” とする。
⇒関数一覧
2.8 表計算ソフトとの連携
表計算ソフトでは，複数のセルを選択してコピー（Windowsでは Crtl+ C ，Macでは Command+C）すると，
セルの内容はtab区切りのテキストデータとしてクリップボードにコピーされる。これをCindyscriptエディタに
ペーストすることで表計算ソフトのデータをKETCindyで利用できる。逆に，Cindyscriptのコンソールへの出力を
表計算ソフトのシートにコピーすることもできる。
また，表計算ソフトから書き出したCSVファイルについても同様にしてCSV形式のデータを扱うことができる。
関数 Tab2list(str，option)
機能 str の内容をリストに変換する
説明 tabやコンマ区切りになっている文字列 str をリストに変換する。
optionは，次の通り。
Blank=a：NULLのセルをaに置き換える。
Sep=b：セパレータ（区切り文字）を b とする。 初期設定は tabコード
次のような手順で表計算ソフトやCSVファイルからデータをKETCindyに移すことができる。
(1) Cindyscriptエディタで，適当な文字変数を用意する。
たとえば，data=””;
100

### Page 101

(2) 表計算ソフトで，適当な範囲を指定しクリップボードにコピーする。
Windowsなら Ctrl+C，Macなら Command+C
(3) data=””; のダブルクォートの間にペーストする。
最後の行は右図のように，” の前で改行されていてもよい。
(4) この文字変数 data に対し，Tab2list(data) を実行すると，行列を表すリストが返される。
これを適当な変数に代入し，作表コマンドで表にするなど，目的に応じて利用する。
数値だけなら行列として計算もできる。
空文字のセル(NULL)が含まれる場合， 初期設定ではそのまま空文字になるが，アンケート処理などで無回
答を０にしたいような場合は
dlist=Tab2list(data,["Blank=0"];
とする。
CSVファイルからCSV形式（コンマ区切り）のデータをコピーした場合は
dlist=Tab2list(data,["Sep=,"];
とする。
なお，文字列をセパレータで区切ってリスト化するCindyscriptの関数に tokenize()がある。上の例で，
dlist=tokenize(data,[unicode("000a"),unicode("0009")]);
とすると，改行コード(000a)とtabコード(0009)で切り分けてリスト化する。このとき，リストの各要素は
つぎのようになる。
文字列→文字列
数値形式の文字→実数【例】 14 → 整数1412.3 → 実数12.3
101

### Page 102

計算式の形→文字列【例】 437-0023 →437-0023 (文字列)
これに対し，Tab2list()では，計算式の形の文字列は数値と見なして計算結果を取得する。
【例】 437-0023 →414 (数値)
したがって，郵便番号や日付(28/12/5)のようなものは計算されてしまうので，tokenize() を用いるのがよい。
なお，tokenize()の場合，空行は空リストになるので，最後の行でダブルクォートの前で改行されていると空
リストが入る。
関数 Dispmat(list)
機能 リストを行列の形でtab区切りにしてコンソールに表示する。
説明 行列を表すリスト （たとえば dlist) を引数としてDispmat(dlist) を実行すると，コンソールに行列型で内容
が表示される。
実際にはTAB区切りの文字列。（println としなくても直接コンソールに表示される）
これを表計算ソフトのシートにコピーする。
関数 Writecsv(namelist, data, filename, option)
機能 data の内容をCSVファイルに出力する
説明 ベクトルまたは行列となっている data を、filenameのファイル名としてCSVファイルに書き出す。
optionは，次の通り。（省略できる）
Col=nn：自然数nnで指定した列数のCSVファイルとして書き出す。
namelistは，CSVファイルの1行目に追加される項目名。省略すると”C1,C2,...”という項目名が付く。
なお，列数の指定を省略するとdataが行列の場合は、その列数をdataがベクトルの場合はnamelistの項目
数を利用する。
⇒関数一覧
102

### Page 103

3 アニメーション PDF
3.1 概要
アニメーションのできるPDFを作る。
Cinderellaの作図機能とCindyscriptを用いてアニメーションができるが，PDFにすることでCinderellaがなく
てもPDFビュアーがあればアニメーションを実行できるので，プレゼンテーションや教材の受け渡しなどに便利で
ある。
次の画面は，samplesフォルダにある「s06animation」の「s0601cycloid」のものである。これをひな形として使
うのがよい。すでにあるスライダなどが邪魔であれば，消去ボタンで消去するか，template2allbuttons.cdy をひな
形として用いる。
画面上方のボタンには，次のようなスクリプトが割り当てられている。
Figure ： Viewtex(); 現在の画面のPDFデータを作る
Parent ：複数のスクリプト Figpdf() を使うときに使用する。
ParaF ： Parafolder(); アニメーションのフレームデータを作る
Anime ： Mkanimation(); アニメーションPDFを作る
Flip ： Mkflipanime(); パラパラ動画PDFを作る
アニメーションPDFを作るには，フレームを定義する関数を記述し，「ParaF」ボタンでフレームデータを作り，
「Anime」または「Flip」ボタンでPDFを作成する。
Anime ボタンを押すと，\usepackage[dvipdfmx]{animate} でパッケージを読み込み，animateinline 環境のア
ニメーションを作る。
Flip ボタンを押すと，animateinline 環境ではなく，フレームに分割したPDFが生成される。
なお，アニメーションPDFでアニメーションを行うにはAdobe Acrobat Reader など，アニメーションに対応し
たPDFリーダーが必要である。WindowsのSumatraPDF，Macの プレビューではアニメーションができない。
3.2 関数
関数 Setpara(fname,funcstr,range,options1,options2)
機能 アニメーションの設定をする
説明 fname は出力するファイル名，funcstrは定義した動画関数名，rangeは範囲
「Anime」ボタンを押すと，animate+fname.pdf が作られる。再生はコントローラか，画面クリックで行う。
「Flip」ボタンを押すと，flipanime+filename.pdf が作られる。再生（コマ送り）は，Acrobat Reader のペー
103

### Page 104

ジ送りボタンで行う。
options1 はアニメーションのデータを作るための設定。
m/r データの作成 / 既存データがある場合の読み込み（ 初期設定は r ）
Div=n フレーム数。初期値は25。
options2 はアニメーションについての設定で，次の通り。
Frate=n １秒間のフレーム数。初期値は20。
Title=str タイトル。指定しない場合は fname と同じ。
Scale=n 図の大きさの拡大率
opA=[option] animateinline 環境のためのオプション
初期設定は[loop,controls,buttonsize=3mm]。
loop：繰り返し再生する。
controls：コントローラを表示する
buttonsize：コントローラのサイズ
palindrome：反転して繰り返し再生する
step：コマ送りモードにする。コントローラもコマ送り仕様。
"OpA=[controls,buttonsize=5mm]" のように記述する。
+をつけると初期設定のものに追加することができる。
たとえば "OpA=+step" で
"OpA=[loop,controls,buttonsize=3mm,step]" となる。
"OpA=[]" とすると，オプションなしとなり，
画面をクリックすると繰り返しなしで再生される。
記述例
Setpara("cycloid","mf(t)","t=[0,60]",["Div=60"],
["Frate=30","Title="サイクロイド","Scale=1.5","OpA=[controls]"]);
関数 Parafolder(funcstr,fname,range,options)
機能 アニメーションのフレームデータを作成する
説明 funcstrは動画関数名，fname は出力するフォルダ名，rangeは範囲
作業フォルダ(fig)内に，フレームデータを格納した fname フォルダを作る。ひな形（s0601cycloid）にある
ParaF ボタンに割り当てられており，通常はそのまま使えばよい。
関数 Mkanimation(path,folder)
機能 アニメーションのPDFを作る
説明 作業フォルダ(fig)内に，フレームデータを格納した fname フォルダを作り，ここからアニメーションのPDF
を作る。Setpara() で設定したファイル名を fname とすると，生成する TeX ファイルは，animatefname.tex
（PDF作成のTeXファイル）と animfname.tex （動画データ）で，PDFの名称は，animatefname.pdf と
なる。
ひな形（s0601cycloid）にある Anime ボタンに割り当てられており，通常はあらためて設定せずそのまま使え
ばよい。
関数 Mkflipanime(path,folder)
機能 パラパラ動画のPDFを作る
104

### Page 105

説明 作業フォルダ(fig)内に，フレームデータを格納したfnameフォルダを作り，ここからパラパラ動画のPDFを
作る。Setpara() で設定したファイル名を fname とすると，生成する TeX ファイルは，flipanimefname.tex
（PDF作成のTeXファイル）で，PDFの名称は，flipanimefname.pdf となる。
ひな形にある Flip ボタンに割り当てられており，通常はあらためて設定せずそのまま使えばよい。
⇒関数一覧
3.3 制作例
【例】定円上を動く点Pと，定点Aを結ぶ線分の中点をQとして動きを見る。
アニメーション（フレーム）を定義する関数は，時刻を t として， t における図を定義すると考える。時刻は単な
る媒介変数であるので，t でなく s などでもよい。関数名は，たとえば mf(movie frame) とする。
Setax(["","","sw","","sw"]);
Slider("A-C-B",[0,YMIN-1],[2*pi,YMIN-1]);
Circledata("1",[[0,0],[0,2]]);
mf(t):=(
pt=2*[cos(t),sin(t)];
mp=(pt+[4,0])/2;
Listplot("1",[[4,0],pt]);
Pointdata("1",[mp,pt],["Size=2"]);
if(t==0,
ptlist=[mp];
,
ptlist=append(ptlist,mp);
);
Letter([[4,0],"s","A",pt,"en","P",mp,"ne","Q"]);
Pointdata("2",ptlist,["Size=2","Color=red"]);
);
mf(C.x);
Setpara("middle","mf(t)","t=[0,4*pi]");
この例の場合，mf(C.x) を実行するとスライダを動かすことでインタラクティブに軌跡を表示できる。アニメー
ションを作る上では mf(C.x) やスライダはなくてもよい。
Cinderellaの画面は次のようになる。
アニメーションを作成するときは //mf(C.x) とコメントアウトしてから 「ParaF」「Anime」 ボタンをクリック
する。次の図は，でき上がった animatemiddle.pdf の始めの画面である。
105

### Page 106

また，次のようにオプションを指定すると，5秒間のアニメーションとなる。
Setpara("middle","mf(t)","t=[0,4*pi]",["Div=30"],["Frate=6"]);
["Div=150"],["Frate=30"]とすると，やはり5秒間のアニメーションとなるが，1秒間のフレーム数が多いた
め，なめらかな動きとなる。これは標準的なビデオのフレームレートである。ただし，ファイルサイズは約5倍と
なる。
⇒関数一覧
106

### Page 107

4 KeT スライド
4.1 概要と制作手順
KETCindyで作成した図とテキストを統合してプレゼンテーション用のスライドPDFを作成する。必要なファイ
ルは，スライドの内容を記述したテキストファイル（ここではコンテンツファイルと呼ぶ）と，タイトルや図を作成
し，コンテンツファイルと統合する KETCindyのファイルである。この2つのファイルは，拡張子が txt と cdy で，
ファイル名は同一とする。たとえば，コンテンツファイルを makeslide.txt ， KETCindyファイルを makeslide.cdy
としたときの，制作イメージを次の図に示す。
makeslide.txt
Title
Text1
fig1
Text2
fig1.tex ...
fig2.tex
makeslide.cdy Slide.pdf
movie.tex
makeslide.cdy
ひな形として，サンプルとして提供されている samples フォルダの中の s0701basic.cdy をコピーし，適当にリ
ネームして使うのがよいだろう。必要なボタンと，最低限のスクリプトが記述されている。
以下では，KETCindyのファイルを makeslide.cdy , コンテンツファイルを makeslide.txt として説明を進める。
制作手順は次の通り。
(1) makeslide.cdy に Settitle コマンドでタイトルを書き，「Titile」ボタンで書き出す。
タイトルスライドが作業フォルダに，makeslide.txtがmakeslide.cdyと同じフォルダに作成される。makeslide.txt
がすでにある場合には上書きはされず，タイトルスライドだけが上書きされる。
(2) makeslide.txt に，スライドの各ベージごとの内容を記述する。
(3) 必要な図やアニメーションのコードを書き，ボタンをクリックしてファイルを作る。
Figure : 図を挿入するとき
ParaF : アニメーションやパラパラスライドを挿入するとき
107

### Page 108

(4) Slide ボタンでスライドPDFを作成する。
PDFと，関連する中間ファイルは，作業フォルダではなく，makeslide.cdyのあるフォルダに作成される。また，
スライドPDFはアニメーションと同様，Windows，MacではAdobe Reader で開く必要がある。Linux(Ubuntu)
では Evince でプレゼンテーションができる。
4.2 コンテンツファイル
コンテンツファイルは次のような構成にする。
title::slide0 タイトルスライド。title はコマンド。
main::三角比と三角関数 セクション1のタイトル。main はコマンド。
直角三角形と三角比 1ページ目の表示内容。
・・・・
new::角の概念の拡張 新しいページとタイトル。new はコマンド。
enumerate::[(1)] 2ページ目の表示内容。enumerate はコマンド。
・・・・
new::負の角 新しいページとタイトル。
・・・・
main::三角関数のグラフ セクション2のタイトル。
f(x)=sinx 以下同様
new::振幅と周期
・・・・
注）urlの指定で // を用いるときは，|||| とすれば // に変換される。
・ページの内容は，コマンドでレイアウトなどを指定し，表示する文をテキストで書く。
コマンド
コマンドにおいて，各ブロックの引数の区切りは :: とし，各行の終わりには必ず//をつける。
【タイトルと壁紙】
タイトルスライドをつけるときは，
title::slide0
を１行目に置く。タイトルスライドは makeslide.cdy で作る。slide0は 初期設定のタイトルスライドのファイル
名。このファイル名を変更(たとえば”start”)したときは，makeslide.cdyで，Settile()のオプションに”Title=start”
をつけて，ファイル名が一致するようにしておく。
タイトルスライドをつけないときはスライド名をつけないでおく。
title::
注）title コマンドは必須で，これを１行目に書かないとスライドは作成されない。
壁紙（背景）を表示するときは，タイトルコマンドに続けて壁紙ファイル名を書く。
title::slide0::wallpaper
wallpaper は壁紙のファイル名。壁紙ファイルはTeXのファイルで，作業フォルダ（fig）に入れておく。
壁紙ファイルの一例
{\color[cmyk]{0.6,0.2,0.8,0}\huge\rm\normalsize
\newpage
\begin{layer}{120}{0}
108

### Page 109

\lineseg{0}{2}{125}{0}
\lineseg{0}{88}{125}{0}
\putnotese{0}{90}{\ketcindy}
\end{layer}
}
【セクションタイトル】
main::セクションタイトル名
セクションを分けないときはなくてもよい。
【新しいページ】
new(::行下げ)::タイトル((::位置)::読み込みファイル)
例）new::[10]::はじめに::{50}{20}::figure
読み込みファイルの表示サイズを変更するときは
new::[10]::はじめに::{50}{20}::figure,0.8
のようにする。
読み込みファイルがなければ，figure は省略。
【箇条書き】
番号つき箇条書きは
enumerate
で，enumerate環境の始まりを示す。
番号にかっこをつけるなど，番号の形式を変えるには，
enumerate::[(1)]
のように，::で区切って形式を示す。 初期設定は，かっこなしの番号。
記号つき箇条書きは
itemize
で itemize環境の始まりを示す。記号は中黒。
enumerate，itemizeのいずれも
item::文
で itemを記述する。
環境の終わりは，
end
で示す。
【項目の順表示】
1枚のスライド内で，項目を段階的に表示するときは，new の次の行に
%repeat=m(,para)
を書く。mは段階数で，たとえば，そのスライドの内容を3段階で表示したい場合は
%repeat=3
とする。実際には３枚のスライドが作られる。
para をつけると，右下にコントローラが表示され，前後に進めやすくなる。
%repeat=3,para
段階的に表示したい行の先頭に，表示する順番を，2番目以降から
%[2,-]::text
%[3,-]::text
109

### Page 110

のように書く。
番号指定を [-, 3] とすると，3番目まで表示する。
[1..3,5 ] とすると，1番目から３番目までと5番目に表示する。（4番目をスキップ）
【薄文字】
順表示したい項目の全体像を見せておいて，そのうちの現在までの項目を示すような場合に用いる。番号指定の前
に thin をつけ，
%thin[2,-]::text
%thin[3,-]::text
のように書くと，現段階の項目よりあとは薄文字で表示される。
薄文字の濃さは，
\setthin{alpha}
で指定できる。alphaは0から1までの数で， 初期設定は0.1。
\setthin{0} のとき，指定段階以降の項目は非表示になる。
初期設定の薄文字の濃さは，makeslide.cdy の Setslidebodyの第３引数で設定できる。たとえば，
Setslidebody(["","",0.2]);
とする。
item とともに用いるときは，%thin[n,-] を先に書く。
【例】項目の順表示
図は，３番目のJavaまで進んだところである。右下にコントローラがある。
new::プログラミング言語
%repeat=6,para
\slidepage
itemize
item::Python
%thin[2,-]::item::Ruby
%thin[3,-]::item::Java
%thin[4,-]::item::JavaScript
%thin[5,-]::item::CindyScript
%thin[6,-]::item::C
end
【図ファイルの順表示】
作業フォルダ（fig）の中にあるサブフォルダ（例えばsubfig）の図ファイルすべてを順に表示する。
パラパラ動画のときに用いる。パラパラ動画では，ParaFボタンをクリックすると，作業フォルダ(fig)の中に，動
画のフレームファイルが入ったフォルダが作られる。そのフォルダのファイルをアルファベット順に表示する。もち
ろん，パラパラ動画以外のファイルの順表示に使ってもよい。
new の次に
%repeat=
%para=subfig:{0}:s{60}{10}:input(:倍率)
を書く。TeXのソースには，
layer{120}{0}, \putnotes{60}{10 初期設定put...}
の形で書き入れられる。
また，２行に分けずに
%repeat=,para=... と続けて書いてもよい。
110

### Page 111

【レイヤー】
ketlayerの\begin{layer}・・\end{layer} として書き出す。本来の記述より簡素になっている。
layer::{範囲}{0}
で layer環境の始まりを示す。layer環境の終わりは
end
レイヤーの中に作業フォルダ（fig）にある図を表示するには
putnote::方向と位置::読み込みファイル
とする。
例） figure.texを(30,10)の位置の南東（原点は左上）に表示する。
putnote::se{30}{10}::figure
例） figの中のfigure.texを0.8倍にして表示する。
putnote::se{30}{10}::figure,0.8
例）includegraphics で figure.pdf を表示する。
putnote::se{30}{10}::include[width=5cm]::figure.pdf
注）KeTpicStyle.pdfを参照。文字などは本来の書式を用いて次のように入れる。
\putnotee{30}{10}{文字}
【テキストと動画】
コマンド以外のテキストはそのまま TEX に書き出される。行末には をつける。
テキストを途中で改行するには，TEX の 強制改行マーク \\をつける。
動画の場合は，動画の設定をして（アニメーションの節を参照）ファイルを作る。
パラパラ動画の場合は，ParaFボタンをクリックすると，figフォルダ内に動画のフレームファイルが入ったフォ
ルダ（たとえば sincurve）が作られる。これを，
%repeat=
%para=sincurve:{0}:s{60}{10}:input(:倍率)
で表示する。
アニメーションの場合は，スライドのために，makeslide.cdyのスクリプトに，Addpackage(["[dvipdfmx]{animate}"]);
を追加しておく。
Animeボタンをクリックすると，パラパラアニメと同様に動画のフレームファイルが入ったフォルダが作られ，動
画用のTEX ファイルができる。Setpara() で設定したファイル名が ”sincurve” のとき，動画用のTEX ファイルは
”animsincurve.tex” となるので，%repeat ではなく \input{fig/animsincurve} で表示する。
【コメント行】
コマンドや文をコメントアウトするときは，%% とする。
【空白行】
空白行を入れたいときは，... とする。
【タブ】
\Ltab{長さ}{文１}文２
とすると，文１が行頭から，文２が長さ分の字下げをした位置から表示される。長さは 20mm のように指定。
【ページ番号】
page番号を表示するときは次のようにする。
mainの場合は \slidepage[m]
111

### Page 112

それ以外の場合は %repeatの後に \slidepage
注）総ページ数を取得するため，TeXを２度コンパイルすることが必要である。そのため，Slideボタンを２度ク
リックすると総ページ数が表示される。
mp3/mp4ファイルの追加
makeslide.txtのタイトルコマンドの後に，以下を追加する。
title::slide0(::wallpaper)
::\usepackage{ketmedia}
::\usepackage[dvipdfmx]{media9}
mp3ファイルを追加するときは，\inputsoundまたは\inputsoundclickを用いる。
\inputsountclik[90]{フォルダ/}{ファイル}
\inputsoundは「自動再生」，\inputsoundclickは「クリック再生」である。最初の引数は，ボタンの水平位置
（単位mm）でデフォルトは90である．またフォルダには/をつける。
mp4ファイルを追加するときは，\inputmovieを用いる。
\inputsountclik[90]{1}{0.4}{フォルダ/}{ファイル}
2番目と3番目の引数は，幅と高さの\linewidthからの倍率である。
【余白などの編集】
スライドの上側余白として，初期状態で \vspace*{18mm} が設定される。次のページにはみ出してしまうような
場合は，出力された tex ファイルで調整すればよい。
その他，適宜編集して，kc.command(bat/sh) を実行すれば，細かい部分を修正した PDF を作成することがで
きる。
4.3 関数
makeslide.cdy で使う，KETCindyの関数。
関数 Setslidebody(bodycolor,bodystyle,density)
機能 全体の文字スタイルと薄文字の濃さ(0-1)の設定
説明 引数の意味は次の通り。
bodycolor 文字色 :初期設定は ”blue”
bodystyle フォントタイプ :初期設定は "\Large\bf\boldmath"
density 薄文字の濃さ :初期設定は 0.1
引数がない場合や（ Setslidebody()）この関数を書かない場合は初期値が使われる。
ある引数だけを指定したい場合は，それより前は空にする。
【例】Setslidebody(,"\large")
関数 Setslidehyper(”dvipdfmx”,options)
機能 順表示でページ送りのコントローラを設定する。
説明 順表示しないときもこの関数の記述は必須と考えてよい。
パッケージ hyperref.styを読み込み，かつ，options の値を与える。
Setslidehyper(); は無効。初期設定で使う場合は Setslidehyper(""); とする。
第１引数は hyperref.sty の第１パラメータ。初期設定は ”dvipdfmx”
options は [”cl=bool,lc=col,fc=col”,”Pos=[x,y]”,”Size=n”]
112

### Page 113

cl colorlinks : リンクに色をつけるかどうか。true / false で指定。 初期設定は true
lc linkcolor : コントローラの色。色名で指定。 初期設定は blue
fc filecolor リンクの色。色名で指定。 初期設定は blue
以上３つは，セットで指定。一部初期値を使う場合はlc=, のように右辺を空にする。
Pos コントローラの位置。 初期設定は [125,73] （左上が原点）
Size コントローラの大きさ。 初期設定は1
関数 Setslidemain([letterc,boxc,boxd,framec,xpos,size])
機能 メインスライド（セクション区切り）の設定
説明 引数の一部を 初期設定値とする場合は [,,,,3] や [,”red”] などとする。
letterc 文字の色。 初期設定は CMYKで [0.98,0.13,0,0.43]
boxc ボックスの色。 初期設定は [0,0.32,0.52,0]
frame フレームの色。 初期設定は [0,0.32,0.52,0]
xpos タイトルの水平位置。 初期設定は 62
size タイトルの倍率。 初期設定は 2
関数 Setslidepage([letterc,boxc,boxd,framec,shadowc,xpos,size])
機能 ページの設定をする。
説明 引数の一部を 初期設定値とする場合は [,,,,3] や [,”red”]などとする。
letterc 文字の色。 初期設定は CMYKで [0.98,0.13,0,0.43]
boxc ボックスの色。 初期設定は [0,0.32,0.52,0]
frame フレームの色。 初期設定は [0,0.32,0.52,0]
shadowc影の色。 初期設定は [0,0,0,0.5]
xpos タイトルの水平位置。 初期設定は 6
size タイトルの倍率。 初期設定は 1.3
関数 Setslidemargin([leftmarginchange,topmarginchange])
機能 スライドの左上マージンをデフォルトから変更する場合の値。
説明 Setslidemargin([+5,-10]);（横方向に+5mm，縦方向に−10mm変更）
関数 Settitle(タイトルリスト,options)
機能 タイトルスライドを作る
説明 タイトルリストはコンマ区切りで位置と文を文字列で与える。例を参照。「Title」ボタンをクリックすると，
コンテンツファイルがない場合は新たに作る。すでにある場合は上書きせずタイトルスライドのみを作る。
Settitleのオプションは次をリストで与える。
”Title=” タイトルスライドのファイル名。 初期設定は ”slide0”。
”Layery=” タイトルの縦位置。 初期設定は0。0でないときは方眼を表示。
”Color=” 文字の色。 初期設定は blue。
【例】タイトルの設定
Settitle([
"s{60}{20}{メインタイトル}",
113

### Page 114

"s{60}{50}{名前}",
"s{60}{60}{所属}",
"s{60}{70}{情報}"
] ,
["Title=SlideA","Color=[1,1,0,0]"]);
出力する TEX ファイルに，\begin{layer} の設定をする。 s は，東西南北のs。
例のように，タイトルリストは改行すると見やすい。
⇒関数一覧
114

### Page 115

5 K TCindy3D
E
5.1 概要
KETCindy3Dの画面は次のように構成される。
Cinderellaの描画面に，白の矩形で囲んだ領域が2つできる。NE,SWを対角とする左側の領域を主画面，右側の
領域を副画面という。
主画面は平面の場合と同様，TeXに出力される範囲を示し，NE,SWの2点をドラッグすることにより変更できる。
主画面の下方のスライダで視点が移動でき，主画面上では軸が回転する。副画面は，xy平面上に視点を置いたものと
考えればよい。
主画面上にCinderellaの作図ツールで点や線分を作図すると，副画面に対応する点が作図される。主画面上の点を
ドラッグするとx,y座標を変更でき，副画面上の点をドラッグするとz座標を変更できる。
KeTCindy3Dでは，線や面についての陰線処理を行う。陰線処理はＣ言語との連携により処理を速めている。C
言語を使う環境整備が必要であるが，現在はこれを標準としている。C言語が使えない場合はRで計算する関数を用
いることになるが，その場合はかなり時間がかかる。（場合にもよるが2分程度）
115

### Page 116

5.2 設定
関数 Ketinit3d()
機能 KeTCindy3Dの使用宣言
説明 Cinderellaの画面を3Ｄモードにする。
Cinderellaの描画面に，視点移動のための2つのスライダを作る。スライダは初期位置が左端になる。スライ
ダTHで角THETAを，スライダFIで角PHIを内部変数として定義する。
引数に0を入れて Ketinit3d(0) とすると，副画面を表示しない。
＜重要＞
この関数は Initialization スロットに置く。Ketinit() も，平面の場合と異なり Initialization スロットに置く。
KeTCindy3Dにおける変数の初期化などを行う，Start3d()はDrawスロットに書く。
関数 Setangle(TH,FI)
機能 回転角の指定
説明 スライダで設定できる回転角（視点の位置）TH と FI を度数法で指定する。たとえば，Setangle(70,40) と
すると，TH,FIがその位置になる。スライダは固定されるので，再度スライダを有効にしたい場合は，コメン
ト化して再実行する。
初期状態だけを決めたい場合は
if(!Ptselected(),Setangle(70,40));
または
if(!Isangle(),Setangle(70,40));
とすると，スライダは有効となり，スライダのいずれかの点を選択した状態であれば Figure ボタンも有効で
ある。画面上のなにもないところをクリックして，点の選択状態を解除するともとに戻る。
回転角の取得については，回転角の取得を参照のこと。
関数 Start3d(option)
機能 3Ｄの画面設定と空間点の認識
説明 副画面を作り，幾何点を3Ｄの点として認識する。この関数は必須で，Drawスロットの先頭に書く。
Cinderellaの作図ツールで，点・線分を作図すると，内部関数の Ptseg3data() によってそれらを空間の点と
して認識し，副画面上に対応する点をとる。ただし，始めはz座標を０とする。点の名前がAであれば，副画
面上の点はAzとなる。点をポイントして選択すると副画面の上に座標が表示される。
作図した点の名称をインスペクタで変更した場合，新しい名称に対応する点を副画面上に作成するが，以前の
点は消えないので要注意。たとえば，点Aを作図した後，主画面上の点Aをインスペクタで点Dに変えた場
合，副画面上に新たにDzができるが，以前のAzも残る。残ったAzは，選択しておいて作図ツールの消去ボ
タン で消すことができる。
optionに，除外点のリストを与えると，その点は空間点としない。（スライダで視点を移動しても位置は変わ
らない）
関数 Startsurf(options)
機能 曲面描画の初期化と定数の設定
説明 options で定数を設定する。定数としては，分割数，Cのサイズ，誤差の限界を設定する。
optionsがないときは，以下の 初期設定を用いる。
[50,50],[1500,500,200],[0.01,0.1]
設定後に初期値にリセットするときは，文字列 ”reset” を引数に与える。
これにより，陰線処理をともなう面の描画の手順は，次のようになる。
116

### Page 117

(1)Startsurf(); で面描画の宣言をする。
(2) 描画関数でプロットデータを作る。
(3) ExeccmdC(); で，C言語を用いてまとめて描画する。
⇒関数一覧
関数 Xyzax3data(name，ｘの範囲，yの範囲，zの範囲,options)
機能 座標軸を描く
説明 描画面に座標軸を描き，プロットデータ ax3dを作成する。nameは空文字列でよい。option は次の2つ。
矢じり：”a[size],angle”：sizeは数字で矢じりの大きさ（デフォルトは1）。angleは開き角（デフォルトは18◦）
原点O：”Onesw”：neswは微小位置。数字も付けられる。neswをつけない場合の初期値はsw。
【例】 初期設定の座標軸
Xyzax3data("","x=[-5,5]","y=[-5,5]","z=[-5,5]");
矢じりをつける
Xyzax3data("","x=[-5,5]","y=[-5,5]","z=[-5,5]",["a"]);
矢じりを大きくする
Xyzax3data("","x=[-5,5]","y=[-5,5]","z=[-5,5]",["a2"]);
原点のOを表示する。
Xyzax3data("","x=[-5,5]","y=[-5,5]","z=[-5,5]",["O"]);
原点のOの位置を調整して右上に表示する。やじりもつける。
Xyzax3data("","x=[-5,5]","y=[-5,5]","z=[-5,5]",["a","Oe2n2"]);
【注意】Putaxes3d() で点を取ると原点に点Oが作成される。この点名Oと表示が重複するのが煩わしい場合
は，作図後にこのoptionをつけてから出力するとよい。
5.3 描画
5.3.1 点・線
関数 Pointdata3d(名前,点リスト,options)
機能 点の3Dデータと2Dデータを作成し，画面とTEXに出力する。
説明 optionsはPointdata()と同様。
【例】
Pointdata3d("1",[[1,1,1],[0,1,0]],["Size=2","Color=red"]);
関数 Putpoint3d(リスト,option)
機能 空間に幾何点を作図する
説明 点の名称と座標を与えて点を作図する。複数の点を一度に作図できる。
optionは，”fix”( 初期設定) または ”free”。リスト [”free”] にしてもよい。
”fix” では，固定点（ドラッグで移動できない点）とする。同じ名称の点がすでに存在する場合は，指定した位
置に移動して固定点とする。
”free” では，自由点（ドラッグで移動できる）とする。同じ名称の点がすでに存在する場合はなにもしない。
【例】いくつか記述例を示す。
Putpoint3d(["A",[2,1,3]]);
117

### Page 118

Putpoint3d(["A",[1,1,1],"C",[1,0,1]],"fix");
Putpoint3d(["A",[2,1,3]],"free");
なお，この関数は幾何点を作るものであり，TeXには出力されない。TeXに点を出力するには，Pointdata()
を併用する。
空間における点の座標は，点名に”3d”を付加した名前の変数に代入される。たとえば，点Aの座標はA3dで
ある。これにより，点の座標を取得できる。
関数 Putaxes3d([x,y,z])
機能 軸上に幾何点を作る。
説明 引数のリスト [x,y,z] に対し，点X(x,0,0) ,Y(0,y,0) , Z(0,0,z) および 原点Oを主画面上にとり，副画面上に
対応する点Xz，Yz，Zz，Oz を作る。すでに同じ名称の点がある場合は，指定された位置に移動する。
引数は，実数にすることもでき，Putaxes3d(a) は，Putaxes3d([a,a,a]) と同じになる。
【例】
Putaxes3d(5);原点と，x(5,0,0),y(0,5,0),z(0,0,5) を作る。
Putaxes3d([1,2,3]);原点と，x(1,0,0),y(0,2,0),z(0,0,3) を作る。
関数 Putoncurve3d(点名，PD)
機能 空間曲線上に点をとる
説明 プロットデータPDの曲線上に，点名の点をとる。
とった点は固定点ではなく，曲線上にインシデントとなる。したがって，ドラッグして曲線上を動かすことが
できる。例は Partcrv3d() を参照のこと。
関数 Putonseg3d(点名，点1，点2)
機能 線分上に点を作る
説明 点１と点2の中点に，指定された名前の点を取る。点１と点2が線分として結ばれていなくてもよい。とった
点は線分にインシデントとなる（線分が描かれていなくても）。点１と点2はリストにすることもできる。指
定した点がすでに存在する場合は動かさない。
点1，点2は幾何点の名称または座標で指定する。
【例】A(1,-1,0)とB(0,2,2) の中点に点Cをとる。つぎのいずれでもよい。
Putonseg3d("C",A,B);
Putonseg3d("C",[A,B]);
Putonseg3d("C",[[1,-1,0],[0,2,2]]);
関数 Spaceline(name,list)
機能 折れ線を描く
説明 点の名称または座標のリストを与えて折れ線を描く。平面での Listplot() にあたる。
options は線種（dr,da,do）
【例】いくつか示す。
・Spaceline(”1”,[[2,5,1],[4,2,3]]); 指定された2点を結んだ線分を描く。
・Spaceline(”2”,[A,B,C,A]);作図されている2点A,B,Cを結んだ三角形を描く。
・節点を表示する場合は，Pointdata3d() で描画する。
118

### Page 119

pt=[[2,0,0],[2,0,2],[2,2,2],[0,2,2],[0,4,2],[0,4,4]];
Spaceline("1",pt);
Pointdata3d("1",pt,["Size=3"]);
点の名前が必要であれば
pname=apply(1..6,"P"+text(#));
のようにして，名前リストを作ることができる。
z
O
x
y
関数 Spacecurve(name,式,定義域,options)
機能 空間曲線を描く
説明 媒介変数で表された曲線を描く。optionは解像度 Num
【例】螺旋を描く
Spacecurve("1","[2*cos(t),2*sin(t),0.2*t]","t=[0,4*pi]",["Num=100"]);
z
O
x
y
関数 Bezier3d(name,リスト1,リスト2)
機能 空間ベジェ曲線を描く
説明 引数はリスト1が端点リスト，リスト2が制御点リスト
１組の端点につき，2つの制御点を使う。
【例】いくつかの点をベジェ曲線で結ぶ
端点A,Bに対し，制御点をD,Eとする。
Bezier3d("1",["A","B"],["D","E"]);
端点A,Bに対し，制御点をD,Eとし，端点BCに対し制御点をE,Fとする。
Bezier3d("1",["A","B","C"],["D","E","E","F"]);
端点A,Bに対し，制御点をD,Eとし，端点BCに対し制御点をF,Gとする。（図）
Bezier3d("1",["A","B","C"],["D","E","F","G"]);
119

### Page 120

z
C
F
D
G
O
B
A
x
y
E
⇒関数一覧
関数 Mkbezierptcrv3d(点リスト)
機能 制御点を自動的にとる空間ベジェ曲線
説明 リストで与えた点に対し，制御点を自動的に生成してベジェ曲線を描く。
制御点は，2つの点に対して，その点を端点とする線分上に2つ作られる。これを適宜移動して任意の曲線に
することができる。空間ベジェ曲線 Bezier3d() を参照のこと。
【例】Mkbezierptcrv3d(["A","B","C","D"]);
線分AB上に2点a1p,a2p，線分BC上に2点a2p,a2q，線分CD上に2点a3p,a3qができる。
関数 Skeletonparadata(name,PDリスト,PDリスト,option)
機能 陰線処理（スケルトン処理）をおこなう
説明 描画されている線と軸について陰線処理をおこなう。
第2引数の線（プロットデータ）が，第3引数の線（プロットデータ）によって隠される部分を消去する。第
2，第3引数を省略した場合は，すべての線について，互いの陰線処理をおこなう。optionで消去する部分の
長さを指定できる。
他のオプション
"No=点リスト" 点リストの点が選ばれているときは実行しない
"File=y/m/n (n)" データファイルを作るか
"Check=点リスト" 点リストの点が変更されていたら，ファイルを作り直す
【例】螺旋と線分，座標軸の陰線処理
次のように螺旋と線分，座標軸を描いておく。
Xyzax3data("","x=[-5,5]","y=[-5,4]","z=[-5,3]");
Putpoint3d(["A",[0,-2,-2]]);
Putpoint3d(["B",[-1,1,3]]);
Spaceline([A,B]);
Spacecurve("1","[2*cos(t),2*sin(t),0.2*t]","t=[0,4*pi]",["Num=100"]);
座標軸のプロットデータは ax3d，線分は AB3d，螺旋は sc3d1 である。これに対し，
Skeletonparadata("1");
描画されている線と軸について陰線処理をおこなう。（図左）
Skeletonparadata("1",[2]);
重なった部分の空きを2にする。（図中央）
Skeletonparadata("1",["AB3d","ax3d"],["sc3d1"]);
螺旋によって隠れる部分だけ消去する。（図右）
120

### Page 121

z z z
x x x
y y y
このほか，次も可能。
Skeletonparadata("1",["AB3d","ax3d"],["sc3d1"],[2]);
Skeletonparadata("1",["AB3d"],["ax3d","sc3d1"]);
⇒関数一覧
5.3.2 多面体
多面体の描画について，四面体の場合を例にして説明する。
四面体は4つの面からなっている。 A
頂点をA,B,C,Dとすると，4つの面は
△ABC，△ABD，△ACD，△BCD
である。
頂点のリスト[A,B,C,D] に対し，Aから順に番号を D
B
つけると，各面の頂点の順番は
[1,2,3],[1,2,4],[1,3,4],[2,3,4]
C
と表現できる。
頂点のリストと，この面リストを組にして [[A,B,C,D],[[1,2,3],[1,2,4],[1,3,4],[2,3,4]]] としたものを「面データ」
という。この面データを使って，多面体を描画するのが VertexEdgeFace() である。
多面体の陰線処理は２通りある。ひとつは，多面体を線画と考えて，隠れる部分だけを処理する方法で，Skeleton-
paradata() を用いる。Concatobj() の例を参照のこと。
もうひとつは，面と考えて，面に隠れる部分を点線で描いたり，非表示にしたりする方法で，Phparadata() を用
いる。 Phparadata()の例を参照のこと。
関数 Concatobj(リスト,option)
機能 いくつかのobjデータを結合する
説明 多面体の各面の頂点リストから面データ（頂点リストと面リスト）を作る。
たとえば，Concatobj([[A,B,C],[A,B,D],[A,C,D],[B,C,D]]);とすると，面データ[[A,B,C,D],[[1,2,3],[1,2,4],[1,3,4],[2,3,4]]]
が返される。
【例】4点A,B,C,Dを幾何点として作り，これを頂点とする四面体を描く。
Putpoint3d("A",2*[0,0,sqrt(3)]);
Putpoint3d("B",2*[1,-1/sqrt(3),0]);
Putpoint3d("C",2*[0,sqrt(3)-1/sqrt(3),0]);
Putpoint3d("D",2*[-1,-1/sqrt(3),0]);
phd=Concatobj([[A,B,C],[A,B,D],[A,C,D],[B,C,D]]);
VertexEdgeFace("1",phd);
Skeletonparadata("1");
Letter3d([A3d,"ne","A",B3d,"sw","B",C3d,"se","C",D3d,"e","D"]);
121

### Page 122

A
D
B
C
＜参考１＞
幾何点を作らないで四面体を描くのであれば，
a=2*[-1,-1/sqrt(3),0];
b=2*[1,-1/sqrt(3),0];
c=2*[0,sqrt(3)-1/sqrt(3),0];
d=2*[0,0,sqrt(3)];
phd=Concatobj([[a,b,c],[a,b,d],[a,c,d],[b,c,d]]);
としてもよい。
＜参考２＞四面体のような凸型多角形の場合は，CindyScriptの convexhull3d() 関数を用いて次のようにす
ることができる。面リストではなく頂点リストを与えるだけなので手間を省くことができる。
a=2*[0,0,sqrt(3)];
b=2*[1,-1/sqrt(3),0];
c=2*[0,sqrt(3)-1/sqrt(3),0];
d=2*[-1,-1/sqrt(3),0];
phd=convexhull3d([a,b,c,d]);
⇒関数一覧
関数 VertexEdgeFace(name,面データ,options)
機能 面データを用いて多面体を描く
説明 面データは，たとえば四面体ABCDの場合は，[[A,B,C,D],[[1,2,3],[1,2,4],[1,3,4],[2,3,4]]] である。
4点A,B,C,Dをとっておき，このリストを引数に与えると，四面体が描かれる。
生成されるプロットデータは，
phv3d：頂点のリスト
phe3d：辺のリスト
phf3d：面リスト
なお，それぞれ末尾にnameが付加される。
【例】4点A,B,C,Dを取り，正四面体ABCDを描く
Putpoint3d("A",2*[-1,-1/sqrt(3),0]);
Putpoint3d("B",2*[1,-1/sqrt(3),0]);
Putpoint3d("C",2*[0,sqrt(3)-1/sqrt(3),0]);
Putpoint3d("D",2*[0,0,sqrt(3)]);
phd=[[A,B,C,D],[[1,2,3],[1,2,4],[1,3,4],[2,3,4]]];
VertexEdgeFace("1",phd);
122

### Page 123

面リストは，Congatobj() を使って作ることができる。陰線処理して描く場合も含め，Concatobj() の例を参
照のこと。
関数 Phparadata(name,name2,options)
機能 多面体を陰線処理して描く
説明 多面体のプロットデータをVertexEdgeFace() で作る。このプロットデータに対し，隠れている面（辺）を陰
線処理して表示する。第1引数は通常のname，第2引数のname2は，VertexEdgeFace() で与えたnameと
同じものとする。
optionsは，全体の線種（”dr,2”など）と，陰線の線種を”Hidden=線種” で指定できる。 初期設定では陰線は
表示しない。
【例】四面体を描く。
Putpoint3d("A",2*[-1,-1/sqrt(3),0]);
Putpoint3d("B",2*[1,-1/sqrt(3),0]);
Putpoint3d("C",2*[0,sqrt(3)-1/sqrt(3),0]);
Putpoint3d("D",2*[0,0,sqrt(3)]);
phd=Concatobj([[A,B,C],[A,B,D],[A,C,D],[B,C,D]]);
VertexEdgeFace("1",phd);
Phparadata("1","1",["Hidden=do"]);
なお，VertexEdgeFace() で四面体が描かれるが，Phparadata() により非表示になる。Figureボタンで描き
出せば正しく出力されるので，Phparadata() を実行する前に画面上に表示して確認してからPhparadata()
を実行するとよい。
【例】切頂二十面体を描く。
小林・鈴木・三谷による多面体データpolyhedrons_objを用いて，s06の切頂二十面体（サッカーボール型）
を描く。 polyhedrons_obj は KeTCindyシステムの data ディレクトリにあるので，Setdirectory() でカレ
ントディレクトリを作業ディレクトリと切替ながら出力する。
Setdirectory( Dirhead+"/data/polyhedrons_obj");
phd=Readobj("s06.obj",["size=3"]);
Setdirectory(Dirwork);
VertexEdgeFace("s06",phd);
Phparadata("1","s06");
VertexEdgeFace() の name は通常の ”1” でもよい。その場合は，Phparadata("1","1"); とするが，わか
りにくいので上のようにした。
実行すると，Cinderellaの描画面は次のように頂点だけが描かれる。
123

### Page 124

全体の線種と，陰線の線種を
Phparadata("1","s06",["dr,2","Hidden=do"]);
で指定したのが下図右である。
【注意】
polyhedrons obj のデータを使って，続けて異なる多面体を描きたい場合は注意が必要である。Readobj()だ
けを変更して別のデータを読めばよさそうであるが，前のデータが残っていてうまくいかない。VertexEdge-
Face() のname を（したがって，Phparadata()の第2引数も）書き換えるか，作業フォルダ(fig) の中身を
削除してから実行する。たとえば，上のコードで切頂二十面体を描いた後，正八面体（r02）を描こうとするな
らば，
Setdirectory( Dirhead+"/data/polyhedrons_obj");
phd=Readobj("r02.obj",["size=3"]);
Setdirectory(Dirwork);
VertexEdgeFace("2",phd);
Phparadata("1","2");
のようにする。
⇒関数一覧
関数 Nohiddenbyfaces(name,PD1,PD2,option1,option2)
機能 面に対し曲線を陰線処理する
説明 PD2で与えられた面に対し，曲線PD1の面に隠れている部分を陰線処理する。
引数PD1を省略するとすべての曲線が対象となる。陰線処理された線は初期設定では点線で表される。この
線種はoption2で変更できる。たとえば，[”da”] とすると破線になる。[”nodsip”] とすると，陰線は表示され
ない。option1は曲線全体のoptionであるので，option2 だけを指定する場合は，option1 として空リスト[ ]
が必要である。option2では，”Eps=” で，陰線処理時の許容限界を設定できる。陰線処理がうまくいかない
ときは，この値を Eps=10^(-4) のように変えてみるとよい。初期設定は Eps=10^(-2)。
【例】座標平面上に正四面体を描き，各軸と正四面体の辺を陰線処理する。（下図左）
Xyzax3data("","x=[-5,5]","y=[-5,5]","z=[-5,4]");
Putpoint3d("A",2*[-1,-1/sqrt(3),0]);
Putpoint3d("B",2*[1,-1/sqrt(3),0]);
Putpoint3d("C",2*[0,sqrt(3)-1/sqrt(3),0]);
Putpoint3d("D",2*[0,0,2*sqrt(6)/3]);
phd=Concatobj([[A,B,C],[A,B,D],[A,C,D],[B,C,D]]);
VertexEdgeFace("1",phd);
Nohiddenbyfaces("1","phf3d1");
VertexEdgeFace("1",phd); によって，辺，頂点，面のプロットデータが作られる。phf3d1 は，面のプロッ
トデータである。
ここで，Nohiddenbyfaces("1","phe3d1","phf3d1",["dr,2"],["da"]); とすると，座標軸は陰線処理
されず，正四面体の辺（phe3d1）だけが陰線処理されて破線で描かれる。四面体は太く描かれる。（下図右）
124

### Page 125

z z
x y x y
同様に，
Nohiddenbyfaces("1","ax3d","phf3d1",[],["da"]);
とすれば，座標軸だけが陰線処理されて破線で描かれる。
5.3.3 曲面
曲面の描画には，ワイヤーフレームモデルとサーフェスモデルがある。ワイヤーフレームモデルは，曲面を編目で
表すものであり，サーフェスモデルは編目のない面として，その輪郭線を描くものである。
ワイヤーフレームモデル サーフェスモデル
KeTCindyでは，それぞれ次の関数を用いて描画する。
陰線処理をしないワイヤーフレームモデル Sf3data(name,form,options)
サーフェスモデル Sfbdparadata(name,form,options)
サーフェスモデルにワイヤーを描く Wireparadata(name,PD,form,n1,n2,options)
ワイヤーフレームモデルで陰線処理をするためには，面のデータが必要なので，Sfbdparadata() で描画した後，
Wireparadata()で描画する。
また，サーフェスモデルの描画では，陰線処理に時間がかかるため，Ｃ言語の使用を前提としている。したがって，
Ｃ言語を用いて描画を行う ExeccmdC() を併用する。
引数の form は，方程式 と，変数の定義域を文字列のリストにしたものである。方程式のパターンは次の3通りが
ある。
(1) z =f(x,y)
【例】式：z =x2−y2
定義域：x=(−2,2),y =(−2,2)
(2) z =f(x,y),x=g(r,t),y =h(r,t)
【例】式：z =4−(x2+y2),x=rcost,y =rsint
定義域：r =(0,2),t=(0,2π)
(3) x=f(u,v),y =g(u,v),z =h(u,v),
【例】式：x=2sinucosv,y =2sinusinv,z =2cosu
定義域：u=(0,π),v =(0,2π)
ここで，(2)と(3)は媒介変数型で，x,y,z それぞれの式と，媒介変数２つの定義域からなっている。そのままでは
125

### Page 126

区別がつかないので，引数として与えるときは，(3) の型には，識別文字として ”p” を先頭に付加する。
また，定義域については，開区間でとる場合と閉区間でとる場合がある。その区別を境界指定として”ewsn”で表す
（ともに閉区間）。”ewsn” の意味は次のように考える。
変数が u,v のとき，u,v 平面において，a ≤ u ≤ b,c ≤ v ≤ d の矩形を考え，境界値を東西南北(ewsn)で示す。
それぞれの文字が書かれたときは境界値を含む。
v
n
d
w e
c
s
u
a b
この境界指定を最後に付加するが，省略することもでき，省略した場合は初期値の ”ewsn” （閉区間）とする。と
もに開区間とする場合は，”” とする。ただし，陰線処理をしない Sf3data() では，境界にも線を引くので，この指定
は無効となる。
具体的な例を示そう。
次は，円錐の form である。（formは form data を短縮した fd がよく使われる）
fd=["p","x=r*cos(t)","y=r*sin(t)","z=2*(2-r)","r=[1,2]","t=[0,2*pi]","ew"]
”ew” は 1≤r ≤2 であることを示す。したがって，円錐台の上面と底面が表示される。
これを ”e” とすると 1<r ≤2 となり，上面が表示されない。
また，これを ”w” とすると 1≤r <2 となり，底面が表示されない。
さらに，”ewn” あるいは ”ews” としたり，指定を略して初期値の ”ewsn” とすると，t=(0,2π) の左右いずれか
の値が含まれることになり，不要な境界線が現れる。
”ew” ”e” ”w” ”ewn”
球面を描く場合はこの点で留意することがある。球面をサーフェスモデルで描くと単に円にしか見えないので，多
くの場合はサーフェスモデルで描いた球面に Wireparadata() で陰線処理したワイヤーを入れることになるだろう。
その場合，Wireparadata() では境界線には線を引かないので，境界指定を ”s” として，境界線を引く必要がある。
境界指定を ”” とすると，経線が1本足りなくなるので注意されたい。具体例は，Wireparadata() に例示してある。
関数 Sf3data(name,リスト,options)
機能 陰線処理なしの曲面をワイヤーフレームモデルで描く
説明 optionsは，メッシュの密度と解像度（各変数に対応する分割数）。
メッシュ密度は，縦横で ”Wire=[a,b]” で指定。初期値はa,bとも20。
解像度は，”Num=[a,b]” で指定。初期値はa,bとも25。
126

### Page 127

【例】 z =f(x,y) 型
z
z =x2−y2を定義域x=[−2,2],y =[−2,2] で描画する。
fd=["z=x^2-y^2","x=[-2,2]","y=[-2,2]"];
Sf3data("1",fd);
メッシュの数を縦横とも10，解像度をx,yとも10にすると
x
メッシュ密度，解像度とも下げるので粗い描画となる。 y
Sf3data("1",fd,["Num=[10,10]","Wire=[10,10]"]);
【例】z =f(x,y),x=g(r,t),y =h(r,t)型
次図左
fd=["z=4-(x^2+y^2)","x=r*cos(t)","y=r*sin(t)","r=[0,2]","t=[0,2*pi]"];
Sf3data("1",fd);
次図右
fd=["z=sin(sqrt(abs(x^2+y^2)))","x=r*cos(t)","y=r*sin(t)",
"r=[0,3]","t=[0,2*pi]"];
Sf3data("1",fd);
z z
x x
y y
(3) x=f(u,v),y =g(u,v),z =h(u,v), 型
この場合，(2)と区別するために，”p” を先頭につけておく。
【例】球面
fd=["p","x=2*sin(u)*cos(v)","y=2*sin(u)*sin(v)","z=2*cos(u)",
"u=[0,pi]","v=[0,2*pi]",""]; Sf3data("1",fd);
z
x
y
⇒関数一覧
関数 Sfbdparadata(name,式,options)
機能 サーフェスモデルの輪郭線を描く
127

### Page 128

説明 この関数はデータを作るだけなので，表示するには ExeccmdC() を併用する。
optionsは，”Wait=n”,”r”,”m”,および線種。Wait の初期値は30。
”r”,”m”に関しては，
オプションなしまたは，”” のとき
i) データファイルがなければ，新しく作る
ii) データファイルが既にあればそれを読み込む
”m”のとき，強制的にデータファイルを作り直す。
”r” のとき，すでにあるデータファイルを読み込む。
この処理は時間がかかるため，この関数を実行した状態で画面上のスライダやその他の点を動かそうとすると
反応が悪くなる。そこで，Isangle() または Isptselected() を用いて，スライダの点を選択しているときはワイ
ヤフレームモデルを描画するようにするとよい。
なお，C言語の環境がない場合は，ExeccmdC()が使えないので，SfbdparadataR(name,式,optons1,optons2)
を使う。options2 には陰線の表示方法について ”nodisp” または線種 を指定する。 初期設定は”nodisp” 。
options2のみ指定するときは，options1に [””] （空文字）を書いておく。
作図例は 次の ExeccmdC を参照のこと。
関数 ExeccmdC(name,options1,options2)
機能 曲面を表示する。戻り値は，対象にしたプロットデータのリスト。
説明 データが作成された曲面を表示する。
options1 には”r”,”m”, ”Wait=n” と輪郭線の線種が指定できる。
options2 には 軸の陰線について ”nodisp” または線種が指定できる。 初期設定は ”do”。
options2だけを指定したい場合は，options1 を空リスト [ ] にする。
【例】サドル面
陰線を消去して表示
fd=["z=x^2-y^2","x=[-2,2]","y=[-2,2]"];
if(Isangle(),
Sf3data("1",fd);
,
Startsurf();
Sfbdparadata("1",fd);
ExeccmdC("1",[],["nodisp"]);
);
全体を実線で太めにして，陰線は初期設定の
点線で表示。
ExeccmdC() を変更する。
ExeccmdC("1",["dr,2"]);
【例】放物面： 式を変更する。
fd=["z=4-(x^2+y^2)","x=R*cos(T)","y=R*sin(T)","R=[0,2]","T=[0,2*pi]","e"];
陰線を消去（下図左）：ExeccmdC("1",[],["nodisp"]);
陰線を破線で表示（下図右）：ExeccmdC("1",[],["da"]);
128

### Page 129

【例】曲面を２つ表示するときは，Sfbdparadata()のnameは”1”と”2”にするが，まとめてExeccmdC("1")
で表示できる。
fd=[
"p",
"x=r*cos(t)","y=r*sin(t)","z=2*(2-r)",
"r=[1,2]","t=[0,2*pi]","ew"
];
fd2=[
"p",
"x=r*cos(t)-3","y=r*sin(t)+3","z=2*(2-r)",
"r=[0,2]","t=[0,2*pi]","ew"
];
if(!ptselected(),
Startsurf();
Sfbdparadata("1",fd);
Sfbdparadata("2",fd2);
ExeccmdC("1");
);
z
x
y
【例】トーラスを描く：軸は非表示にしておく。
fd=["p","x=(2+cos(u))*cos(v)",
"y=(2+cos(u))*sin(v)","z=sin(u)",
"u=[0,2*pi]","v=[0,2*pi]","s"];
if(Ptselected(),
Sf3data("1",fd);
,
Startsurf();
Sfbdparadata("1",fd);
Wireparadata("1","sfbd3d1",fd,12,12,[],["nodisp"]);
ExeccmdC("1",[],["nodisp"]);
);
⇒関数一覧
関数 Wireparadata(name,PD,式,整数,整数,optons)
機能 Sfbdparadataで作成した曲面について，陰線処理したワイヤーを描く
129

### Page 130

説明 PDは，第3引数の式を用いてSfbdparadata()で描いたサーフェスモデルのプロットデータ名。第4，第5引
数は分割線の数。
options には ”r”,”m”,”Wait=n” が指定できる。
Sfbdparadata() とペアで使い，そのあとに ExeccmdC で描画する。
C 言語の環境がない場合は，ExeccmdC() が使えないので，WireparadataR(name,PD, 式, 整数, 整数,op-
tons1,optons2) を使う。options2には陰線の表示方法について ”nodisp” または線種 を指定する。 初期設定
は”nodisp” 。options2のみ指定するときは，options1に [””] （空文字）を書いておく。
【例】
z
サドル面
fd=["z=x^2-y^2","x=[-2,2]","y=[-2,2]"];
if(Isangle(),
Sf3data("1",fd);
,
Startsurf();
y
Sfbdparadata("1",fd);
x
Wireparadata("1","sfbd3d1",fd,4,5);
ExeccmdC("1");
);
z
回転放物面：次を変更
fd=["z=4-(x^2+y^2)","x=r*cos(t)",
"y=r*sin(t)","r=[0,2]","t=[0,2*pi]","e"];
Wireparadata("1","sfbd3d1",fd,5,7);
y
球面 x
fd=["p","x=sin(u)*cos(v)","y=sin(u)*sin(v)","z=cos(u)",
"u=[0,pi]","v=[0,2*pi]","s"];
if(Ptselected(), z
Sf3data("1",fd);
,
Startsurf();
Sfbdparadata("1",fd);
Wireparadata("1","sfbd3d1",fd,12,12);
ExeccmdC("1");
);
x
y
関数 Crvsfparadata(name,PD1,PD2,式)
機能 曲面による曲線の陰線処理を行う。
説明 曲線PD1と曲面PD2について，PD1はPD2による陰線処理を行う。
Crvsfparadata() のあとに ExeccmdC() でまとめて描画する。
C言語が使えない場合は，CrvsfparadataR(name,PD1,PD2,式,options1,options2) を使う。options1 は分割
数と誤差限界， options2 は陰線の線種。
【例】回転放物面と座標軸，線分を陰線処理したデータを作って表示する。線分の端点A,Bはあらかじめ作図
しておく。
ExeccmdC()の 初期設定では陰線は点線で表示される。（下図左）
Xyzax3data("","x=[-5,5]","y=[-5,5]","z=[-5,5]");
Putpoint3d(["A",[0,-3,0],"B",[0,3,3]]);
Spaceline([A,B]);
fd=["z=4-(x^2+y^2)","x=R*cos(T)","y=R*sin(T)","R=[0,2]","T=[0,2*pi]","e"];
130

### Page 131

Startsurf();
Sfbdparadata("1",fd);
Crvsfparadata("1","AB3d","sfbd3d1",fd);
Crvsfparadata("2","ax3d","sfbd3d1",fd);
ExeccmdC("1");
ExeccmdC()の options2を [”nodisp”] にすると，陰線は非表示になる。（下図右）
ExeccmdC("1",[],["nodisp"]);
z z
x y x y
戻り値を使うと，Changestyle3d() を使って陰線のスタイル（線種，色）を変えることができる。戻り値の内
容は，コンソールに「readoutdata from template3D1.txt : 」として表示されるので，これをテキストエディ
タで開き，操作対象を決めればよい。たとえば，上の左図で，線分ABの陰線はリストの４番目の crvsfh3d1
なので，
ret=ExeccmdC("1");
Changestyle3d(ret_4,["da","Color=red"]);
とすると，赤の破線にすることができる。
【例】球面で座標軸を陰線処理し，球面の陰線は非表示で表す。
z
fd=["p","x=2*sin(u)*cos(v)",
"y=2*sin(u)*sin(v)",
"z=2*cos(u)",
"u=[0,pi]","v=[0,2*pi]",""];
if(Isangle(),
Sf3data("1",fd);
,
Startsurf();
x
Sfbdparadata("1",fd);
Wireparadata("1","sfbd3d1",fd,12,12,[],["nodisp]); y
Crvsfparadata("1","ax3d","sfbd3d1",fd);
ExeccmdC("1");
);
⇒関数一覧
5.4 プロットデータの操作
関数 Datalist2d()
機能 画面上のプロットデータのリストを取得する
説明 画面に描かれているすべてのプロットデータのリストを返す。
空間図形は，Cinderellaの画面上に射影し表示する。そのため，KeTCindy3Dは，空間におけるプロットデー
タと，画面上に表示するプロットデータの2つを作っている。Datalist2d()では，画面上に表示するプロット
データのリストを返す。
131

### Page 132

【例】
Xyzax3data("","x=[-5,5]","y=[-5,5]","z=[-5,5]");
Putpoint3d(["A",[0,-3,0],"B",[0,3,3]]);
Spaceline("1",[A,B]);
println("PD="+Datalist2d());
とすると，コンソールにPD=[ax2d,AB2d] と表示される。ax2dは座標軸のプロットデータ ax3d に，AB2d
は線分ABのプロットデータ AB3d に対応している。
関数 Datalist3d()
機能 空間のプロットデータのリストを取得する
説明 空間に描かれているすべてのプロットデータのリストを返す
【例】
Xyzax3data("","x=[-5,5]","y=[-5,5]","z=[-5,5]");
Putpoint3d(["A",[0,-3,0],"B",[0,3,3]]);
Spaceline("1",[A,B]);
println("PD="+Datalist3d());
とすると，コンソールにPD=[ax3d,AB3d] と表示される。
関数 Changestyle3d(リスト,リスト)
機能 3Dプロットデータの属性を変更
説明 第１引数のプロットデータの属性を，第2引数に変更する。
たとえば，補助線など，画面には描いてもTeXに書き出さない線を描画するときは，optionに[”notex”] を
つけるが，これをあとから付加したい場合に利用する。プロットデータはリストにできるので，複数のプロッ
トデータの属性をまとめて変更することができて便利である。
【例】4つの点で四面体の辺を描き，まとめて notex にする。点A,B,C,Dはとってあるものとする。
Spaceline("1",[A,B]);
Spaceline("2",[A,C]);
Spaceline("3",[B,C]);
Spaceline("4",[A,D]);
Spaceline("5",[B,D]);
Spaceline("6",[C,D]);
edges=apply(1..6,"sl3d"+text(#));
Changestyle3d(edges,["notex"]);
関数 Intersectcrvsf(name,PD，式)
機能 曲線と曲面の交点の座標を求める
説明 PDは曲線のプロットデータ。式は曲面の式。
曲面は，Sfbdparadata()でデータを作成し，ExeccmdC()で表示しておく。交点の座標は，”intercrvsf”+name
に代入される。コマンドの実行順序は次の例のようにする。
【例】回転放物面と線分の交点の座標を表示する。
Putpoint3d(["A",[0,-3,0],"B",[0,3,2]]);
Spaceline("1",[A,B]);
fd=[
"z=4-(x^2+y^2)","x=R*cos(T)","y=R*sin(T)",
"R=[0,2]","T=[0,2*pi]","e"
];
132

### Page 133

Startsurf();
Sfbdparadata("1",fd);
Intersectcrvsf("1","sl3d1",fd);
ExeccmdC("1",[""]);
println("Intersect="+intercrvsf1);
Pointdata3d("1",intercrvsf1);
実行すると，コンソールに
Intersect=[[0,1.57,1.52],[0,-1.91,0.36]]
のように表示され，画面には交点が表示される。
⇒関数一覧
関数 IntersectsgpL(点名，線分，面，描画方法)
機能 空間の線分（直線）と平面の交点を求める。
説明 引数の線分は線分の端点を ”A-B” の形もしくは空間座標のリストで与える。
引数の面は，面内の3点を ”C-D-E” の形もしくは空間座標のリストで与える。
戻り値は，[pt,flag1,flag2,val1,val2]
pt：直線と平面の交点の座標。直線と平面が平行で交点が存在しない場合は空リスト[]
flag1 ： 交点が線分内にあれば true ，なければ false
flag2 ： 交点が面内にあれば true，なければ false
val1,val2 ： 線分についてのパラメータ値，平面についてのパラメータ値
描画方法は，”put” または ”i” , ”e” 。
put ： 幾何点を作る
i ： 線分内にあれば点を描く
e :平面で交われば点を描く
【例】交点の有無と戻り値
次のスクリプトでp2 を変えたときの戻り値の flag1, flag2
p1=[1,-1,0];
p2=[0,0,1/2];
p3=[0,1,0];
p4=[-1,0,0];
p5=[0,0,1];
Spaceline("1",[p1,p2]);
Spaceline("2",[p3,p4,p5,p3]);
ret=IntersectsgpL("P",[p1,p2],[p3,p4,p5],"put");
println("flag1="+ret_2+": flag2="+ret_3);
p2=[0,0,1/2]; p2=[-1,1,1];
flag1=false : flag2=trueflag1=true : flag2=true
z z
x y x y
133

### Page 134

p2=[1,2,1]; p2=[1,0,1/2];
flag1=true : flag2=false flag1=false : flag2=false
z z
x y x y
【例】立方体を平面で切った図を描く。
いろいろな手順が考えられるが，ここでは次の手順で描く。
(1) 立方体の頂点をとる。１辺の長さをHnとし，軸上の点をPutaxes3d()でとる。
(2) 切断面を決める点E,F,Gを辺上の自由点としてPutonseg3d()でとる。
(3) E,F,Gを通る平面と，辺AC,DYとの交点をとり，M,Nとする。
(4) 全体を多面体として面データを作って描画する。
Hn=3;
Putaxes3d(Hn);
Putpoint3d("A",[Hn,Hn,0]);
Putpoint3d("B",[Hn,0,Hn]);
Putpoint3d("C",[Hn,Hn,Hn]);
Putpoint3d("D",[0,Hn,Hn]);
Putonseg3d("E",X,B);
Putonseg3d("F",Z,B);
Putonseg3d("G",Z,D);
IntersectsgpL("M","A-C","E-F-G","put");
IntersectsgpL("N","D-Y","E-F-G","put");
phd=Concatobj([[O,X,A,Y],[X,A,M,E],[A,Y,N,M],[Y,N,G,Z,O],
[O,Z,F,E,X],[Z,F,G],[E,M,N,G,F]]);
VertexEdgeFace("1",phd);
Nohiddenbyfaces("1","phf3d1");
スクリプトを実行後，点E,F,Gをドラッグして適当な位置の断面にする。
できた図は下図左。これに，次のスクリプトを追加すれば，断面上方の立方体の各辺も点線で描かれる。（下
図右）
Spaceline("1",[E,B,F],["do"]);
Spaceline("2",[B,C,M],["do"]);
Spaceline("3",[C,D,N],["do"]);
Spaceline("4",[D,G],["do"]);
134

### Page 135

⇒関数一覧
関数 Sfcutparadatacdy(name,面,曲面,options)
機能 平面と曲面の交線を求める。
説明 面の方程式はx,y,zの方程式，曲面は媒介変数表示で与える。
【例】円錐を平面y+2z =3で切った断面を表示する。
fd=[
"p",
"x=r*cos(t)","y=r*sin(t)","z=2*(2-r)",
"r=[0,2]","t=[0,2*pi]","e"
];
Startsurf();
Sfbdparadata("1",fd);
Sfcutparadatacdy("1","y+2*z=3",fd);
ExeccmdC("1");
関数 Partcrv3d(name，始点，終点，PD)
機能 部分曲線のプロットデータを作成する
説明 曲線PDにおいて，始点から終点までのプロットデータを作成する。
始点と終点は，プロットデータの番号もしくは曲線上にとった点の識別名で示す。
【例】螺旋を描き一部分を太くする。Putoncurve3d() で螺旋上に点C,Dができるので，ドラッグして適当な
位置に移動する。
Xyzax3data("","x=[-5,5]","y=[-5,5]","z=[-5,4]");
Spacecurve("1","[2*cos(t),2*sin(t),0.2*t]","t=[0,4*pi]",["Num=100"]);
Putoncurve3d("C","sc3d1");
Putoncurve3d("D","sc3d1");
Partcrv3d("1",C,D,"sc3d1",["dr,3"]);
Letter([C,"n2","C",D,"n2","D"]);
ここで，"sc3d1" は，螺旋，"part3d1" は，部分曲線のプロットデータである。
135

### Page 136

z
D
C
y
x
【例】稲妻状の螺旋を点線で描き，その一部を実線にする。位置はプロットデータの番号で示す。小数にすると
曲線を分割している線分の途中の位置になる。
Spacecurve("1","[2*cos(t),2*sin(t),0.2*t]","t=[0,4*pi]",["Num=10","do"]);
Partcrv3d("1",3.3,8.5,"sc3d1");
z
y
x
⇒関数一覧
関数 Reflectdata3d(name , PDlist , list , options)
機能 PDの鏡映を作る
説明 第3引数のタイプにより，点に関する鏡映，直線に関する鏡映，面に関する鏡映を作る。戻り値は鏡映したプ
ロットデータのリスト。
【例】点A,B,C,D,Eを空間にとり，三角形ABCの鏡映を作る。
Putpoint3d(["A",[0,-2,0],"B",[2,-2,0],"C",[1,-2,2],"D",[1,0,1],"E",[1,0,0]]);
Spaceline("1",[A,B,C,A]);
で点をとり，三角形を描いておく。
点Dに関する鏡映
Reflectdata3d("1",["sl3d1"],[D3d],["Color=blue","dr,2"]);
z
C
D
A
B y
x
直線DEに関する鏡映
Reflectdata3d("1",["sl3d1"],[D3d,E3d],["Color=blue","dr,2"]);
136

### Page 137

z
C
D
A
B E y
x
平面BDEに関する鏡映
Reflectdata3d("1",["sl3d1"],[D3d,E3d,B3d],["Color=blue","dr,2"]);
z
C
D
A
B E y
x
関数 Reflectpoint3d(座標,リスト)
機能 点の鏡映点を求める
説明 第2引数のタイプにより，点に関する鏡映，直線に関する鏡映，面に関する鏡映のそれぞれの点の座標を返す。
【例】点A,B,C,Dを空間にとり，点Aの鏡映点の座標を求める。
点Bに関する鏡映点Reflectpoint3d(A3d,[B3d]);
直線BCに関する鏡映点 Reflectpoint3d(A3d,[B3d,C3d]);
平面BCDに関する鏡映点 Reflectpoint3d(A3d,[B3d,C3d,D3d]);
⇒関数一覧
関数 Rotatedata3d(name,PDリスト,vec,角度,options)
機能 プロットデータを回転
説明 プロットデータを，原点を始点とするベクトルvec 周りに回転する。複数のプロットデータをまとめて回転す
ることができる。戻り値は回転したプロットデータのリスト。
options として，中心点（vecの始点），線種を指定することができる。
【例】コード例と結果を示す。
Xyzax3data("","x=[-5,4]","y=[-5,5]","z=[-5,4]",["a","O"]);
Putpoint3d(["A",[0,-2,0],"B",[2,-2,0],"C",[1,-2,2],"D",[1,-2,3]]);
Spaceline("1",[A,B,C,A]);
Spaceline([C,D]);
Rotatedata3d("1",["sl3d1","CD3d"],[0,0,1],pi/2,["dr,2"]);
Letter([A,"s","A",B,"w","B",C,"ne","C",D,"ne","D"]);
これを
Rotatedata3d("1",["sl3d1","CD3d"],[0,0,1],pi/2,[[1,0,0],"dr,2"]);
とした場合が右図である。
137

### Page 138

z z
D D
C C
B A B A
O O
x x
y y
関数 Rotatepoint3d(座標, vec , 角度, [点] )
機能 点の位置を回転する
説明 点をvecの周りに回転する。角度は弧度法で与える。
第4引数に点を与えた場合，vecの始点が第4引数の位置になる。デフォルトは原点
点Aを，(0,−1,0)に置いたときの記述例と戻り値
Putpoint3d("A",[0,-1,0]);
Rotatepoint3d(A3d,[0,0,1],pi/2); //戻り値は [1,0,0]
Rotatepoint3d(A3d,[0,0,1],pi/2,[1,1,0]); //戻り値は [3,0,0]
関数 Scaledata3d(name , PDリスト , vec , [中心,options])
機能 PDを拡大/縮小する。
説明 点は空間座標，vec は３次元ベクトルで倍率を表す。
中心とoptionsはリストで与える。
【例】三角形と円を拡大/縮小する。
Putpoint3d(["A",[0,-2,0],"B",[2,-2,0],"C",[1,-2,2]]);
Spaceline("1",[A,B,C,A]);
Spacecurve("1","[cos(t)+1,sin(t)+1,1]","t=[0,2*pi]",["Num=100"]);
Scaledata3d("1",["sl3d1","sc3d1"],[2,2,2],[[0,0,0],"dr,2"]);
z
y
x
関数 Scalepoint3d(点,vec,中心)
機能 点の位置を拡大/縮小する。
説明 点は空間座標，vec は３次元ベクトルで与える。
【例】コード例と結果を示す。
Putpoint3d(["A",[2,-1,2]]);
pt=Scalepoint3d(A3d,[3,2,4],[1,1,1]);
Putpoint3d(["B",pt]);
\vspace{\baselineskip}
138

### Page 139

点Bの位置は(4,-3,5)になる。
関数 Translatedata3d(name,PD,平行移動量)
機能 空間プロットデータを平行移動
説明 PDで表される図形を，平行移動する。戻り値は平行移動したプロットデータのリスト。
【例】曲線 sc3d1 をy軸方向に2だけ平行移動する。
Translatedata3d("1",["sc3d1"],[0,2,0]);
結果として，もとの曲線と平行移動した曲線の2つが描かれる。
【例】多面体の平行移動
VertexEdgeFace() で描いた多角形はこの関数では平行移動できないので，面データを直接操作して平行移動
を行う。
たとえば，小林・鈴木・三谷による多面体データpolyhedrons objを用いて正八面体を描く場合，次のように
する。y軸方向に2だけ平行移動する場合である。
Setdirectory( Dirhead+"/data/polyhedrons_obj");
phd=Readobj("r02.obj",["size=2"]);
Setdirectory(Dirwork);
dn=length(phd_1);
repeat(dn,s,phd_1_s=phd_1_s+[0,2,0]);
VertexEdgeFace("1",phd);
z
x
y
関数 Translatepoint3d(座標，平行移動量)
機能 空間点を平行移動
説明 点を平行移動する。
【例】点A(1,0,0) を(-1,1,1)だけ平行移動した点をBとする。点Aの空間座標は A3d で表される。
Putpoint3d(["A",[1,0,0]]);
pt=Translatepoint3d(A3d,[-1,1,1]);
Putpoint3d(["B",pt]);
⇒関数一覧
139

### Page 140

5.5 その他
関数 Perpplane(点名,点,ベクトル，option)
機能 点を通り線分に垂直な平面上に基準点を2つとる
説明 引数の点名は，作成する2点で ”A-B” の形
第2引数は通る点の名称または座標
第3引数は法線ベクトル
optionは ”put”で，2つの幾何点を作図する。optionがない場合は幾何点は作らず，無名の点のみを表示す
る。put以外の文字列を書いたときは無効な命令とし，何も作成されない。
記述例を示すと
Perpplane("A-B","P",[1,1,1],"put");
点Pを通り，法線ベクトル(1,1,1)に垂直な平面上に点A,Bをとる。
Perpplane("A-B","P",P3d-O3d);
点Pを通り，線分OPに垂直な平面上に点A,Bをとる。これらにおいて，PAとPBは垂直で，PA=PB=1
となる。
【例】ベクトル p⃗=(1,1,1) に垂直で点(1,1,1)を通る平面ABCDを描く。
点A,B,C,Dは作図ツールで適当に取っておく。正確な位置はスクリプトで決める。
Xyzax3data("","x=[-5,5]","y=[-5,5]","z=[-5,4]");
z
Putpoint3d(["O",[0,0,0]]);
Putpoint3d(["P",[1,1,1]]);
D
Perpplane("E-F","P",P3d-O3d,"put");
A
vec1=2*(E3d-P3d);
vec2=2*(F3d-P3d);
Putpoint3d(["A",P3d+vec1+vec2]); P
Putpoint3d(["B",P3d+vec1-vec2]);
x
Putpoint3d(["C",P3d-vec1-vec2]);
Putpoint3d(["D",P3d-vec1+vec2]); C
Spaceline("1",[A,B,C,D,A]); B y
Arrowdata([O,P],["dr,2"]);
Letter([P,"w","P",A,"ne","A",B,"e","B",C,"ws","C",D,"nw","D",]);
Skeletonparadata("1");
関数 Perppt(点名，点，点リスト,option)
機能 平面に下ろした垂線の足を求める
説明 第2引数の点から，第3引数の点リストで決まる平面に下した垂線の足を，第１引数の名前の点とする。
オプションは次の通り。 初期設定は ”draw”
draw：点を打つ。幾何点は作らない
put ：幾何点を作る
none：計算だけ行い，点は作図しない。
【例】原点から点ABCを通る平面に下した垂線の足Hの座標を求める。
Perppt("H","O","A-B-C","none"); 表示はされない。
Perppt("H","O","A-B-C"); Ｈの位置に緑色の点が表示される。
Perppt("H","O","A-B-C","put"); 幾何点Hが作図される。
いずれの場合も，Hの座標は変数H3d に代入される
作図例
140

### Page 141

Xyzax3data("","x=[-5,5]","y=[-5,5]","z=[-5,4]");
Putpoint3d("O",[0,0,0]);
Putpoint3d("A",[3,0,0]);
Putpoint3d("B",[0,3,0]);
Putpoint3d("C",[0,0,3]);
Perppt("H","O","A-B-C","put");
Spaceline("1",[A,B,C,A]);
Spaceline("2",[O,H]);
Letter([A,"nw","A",B,"ne","B",C,"ne","C",O,"nw","O",H,"ne","H"]);
z
C
H
O
B
A y
x
⇒関数一覧
関数 Projcoordpara(座標)
機能 投影座標を求める
説明 空間座標を平面に投影した座標を求める。
戻り値の第１，第2要素はCinderellaの描画面のx,y座標。第3要素はxy平面に垂直なzの座標で．投影面
からの（符号付）距離を表す。
【例】Projcoordpara([3,1,2]);
戻り値は[-0.65,1.7,3.27] のようになる。（視点によって値は異なる）
関数 Readobj(ファイル名)
機能 objファイルを読み込む。
説明 小林・鈴木・三谷による整面凸多面体のデータは
http://mitani.cs.tsukuba.ac.jp/polyhedron/
からダウンロードできる。polyhedrons_objを，例えば，ユーザホームのketcindy作業フォルダに入れて
おく。
Setdirectory(gethome()+"/ketcindy/polyhedrons_obj");
polydt=Readobj("r02.obj");
Setdirectory(Dirwork);
これで，r02.obj データが，変数 polydt に代入される。
オプションは ”size=n”で，n倍したデータにする。負の数にすると上下が反転される。
データはKeTCindyのdataフォルダの中にある。したがって，次のようなスクリプトを書く。読み込むのは
一度だけなので， Draw スロットではなくInitialization スロットに置けばよいが，コードの可読性を高める
には Draw スロットでもよい。
この多面体データは，頂点リストと面リストからなっているが，頂点リストは座標のリストなので，読み込ん
で表示するときには，点の名称を v1,v2,・・・ とする。
読み込んだあとの使い方を含めて例を示す。
【例】polydtを用いて正八面体を描く
141

### Page 142

VertexEdgeFace("1",polydt);
Nohiddenbyfaces("1","phf3d1");
主なデータは次の通り。
番号 名称 番号 名称 番号 名称
r01 正四面体 s02 二十・十二面体 s08 斜立方八面体
r02 正八面体 s03 切頭四面体 s09 斜十二・二十面体
r03 正六面体 s04 切頭八面体 s10 切頭立方八面体
r04 正十二面体 s05 切頭立方体 s11 頭切二十・十二面体
r05 正二十面体 s06 切頭二十面体 s12L/R 変形立方体
s01 立方八面体 s07 切頭十二面体 s13L/R 変形十二面体
この他にn01〜n92まで整面凸多面体がある。
関数 Xyzcoord(P.x,P.y,Pz.y)
機能 主副画面で決まる点の座標
説明 Cinderellaの描画面上の点が表す空間座標を求める
点Ｐについて，主画面の点Ｐに対応するのが副画面のPzである。点Pの2次元座標はP.x,P.yで，Pzのy座
標はPz.yで表される。これを引数として与えると，点Ｐの空間座標が返される。
【例】点Aをドラッグして動かしたとき，Aの座標を求める。
println(Xyzcoord(A.x,A.y,Az.y));
により，コンソールに座標が表示される。
関数 Isangle()
機能 角度スライダ（視点スライダ）の選択判断
説明 角度スライダを選択しているときは true ，そうでないときは false を返す。
曲面の描画・陰線処理には時間がかかるため，角度スライダを動かすと反応が悪くなる。そこで，角度スライ
ダを選択しているときは曲面の描画をしないようにすることで反応がよくなる。
【例】放物面の描画
次のようにすると，スライダの点を選んでいる間はワイヤフレームモデルが描かれ，画面上の他の部分をク
リックして選択状態が解除されると陰線処理された放物面が描かれる。
fd=[
"z=4-(x^2+y^2)",
"x=R*cos(T)","y=R*sin(T)",
"R=[0,2]","T=[0,2*pi]","e"
];
if(Isangle(),
Sf3data("1",fd);
,
Startsurf();
Sfbdparadata("1",fd);
Crvsfparadata("1","ax3d","sfbd3d1",fd);
ExeccmdC("1");
);
142

### Page 143

関数 Dist3d(a1,a2)
機能 空間の2点間の距離を返す
説明 引数a1,a2 は作図点の名称，空間点の名称のいずれでもよい。
次の3通りの記法は同じ結果を返す。混在も可
Dist3d("A","B");
Dist3d(A,B);
Dist3d(A3d,B3d);
関数 Embed(name,PDリスト,式,変数リスト)
機能 2Ｄ図形の空間内平面へ埋め込む
説明 第2引数は2Ｄの図形のプロットデータのリスト，式と変数は平面を記述する式と変数。平面は原点voと2
−→ −→ −→ −→
つの基本ベクトル vx，vy を用いて，vo+x·vx+y·vy の形で表すことができる。変数（基本ベクトルの係
数）はx,y でなく，s,t でもよい。式，変数リストともに文字列にする。また，基本ベクトルは直交していな
くてもよいし，長さが異なってもよいが，縦横同じスケールの直交座標系にするのがわかりやすいだろう。
【例】正三角形と外接円を空間内の平面に埋め込む
Xyzax3data("","x=[-5,4]","y=[-10,4]","z=[-5,5]",["a","O"]);
Spaceline("1",[[3,0,0],[3,6,0],[3,6,6],[3,0,6],[3,0,0]]);
Defvar("vo=[3,3,3]");
Defvar("vx=[0,1,0]");
Defvar("vy=[0,0,1]");
Putpoint3d(["A",[3,3,3]],["fix"]);
Circledata("1",[[0,0],[2,0]],["nodisp"]);
Listplot("1",[[0,2],[-sqrt(3),-1],[sqrt(3),-1],[0,2]],["nodisp"]);
Embed("1",["cr1","sg1"],"vo+x*vx+y*vy","[x,y]");
Pointdata("1",[A],["Size=3"]);
z
x O
y
ここで，Embed()で引き渡す vo,vx,vy については，Rでの変数定義が必要なので（KETCindyでは行わない）
Defvar() によって定義をしている。
原点，基本ベクトルを，点を作図して次のようにすることもできる。この場合は Defvar() は不要。
Putpoint3d(["A",[3,3,3],"B",[0,1,0],"C",[0,0,1]]);
Embed("1",["cr1","sg1"],"A3d+x*B3d+y*C3d","[x,y]");
143

### Page 144

この場合，点B,Cの座標がそのまま基本ベクトルとなっているが，原点Aに対して描画平面上にはB,Cがな
いので図がわかりにくい。図をわかりやすくするならば次のようにする。
Putpoint3d(["A",[3,3,3],"B",[3,4,3],"C",[3,3,4]]);
Embed("1",["cr1","sg1"],"A3d+x*(B3d-A3d)+y*(C3d-A3d)","[x,y]");
また，平面を記述するのに，平面の原点と法線ベクトルを用いて Perpplane() を用いると，基本ベクトルが生
成されるので、これを利用することができる。次のスクリプトでは，Skeletonparadata() を用いて陰線処理も
している。
Xyzax3data("","x=[-5,5]","y=[-8,5]","z=[-5,5]");
Putpoint3d(["O",[0,0,0],"P",[1,1,2]]);
Perpplane("E-F","P",P3d-O3d,"put");
vec1=3*(E3d-P3d);
vec2=3*(F3d-P3d);
Putpoint3d(["A",P3d+vec1+vec2]);
Putpoint3d(["B",P3d+vec1-vec2]);
Putpoint3d(["C",P3d-vec1-vec2]);
Putpoint3d(["D",P3d-vec1+vec2]);
Spaceline("1",[A,B,C,D,A]);
Circledata("1",[[0,0],[2,0]],["nodisp"]);
Listplot("1",[[0,2],[-sqrt(3),-1],[sqrt(3),-1],[0,2]],["nodisp"]);
Embed("1",["cr1","sg1"],"P3d+x*(E3d-P3d)+y*(F3d-P3d)","[x,y]");
Pointdata("1",[P],["Size=3"]);
Skeletonparadata("1");
z
x
y
⇒関数一覧
関数 Parapt(座標)
機能 点の投影面での座標
説明 引数の空間座標に対応するCinderellaの描画面の座標を返す。
144

### Page 145

【例】Parapt([2,1,5]); により，点(2,1,5) が表示されている描画面の座標，たとえば [-0.52,3.27]が返さ
れる。
関数 Invparapt(座標，PD)
機能 描画面上の座標に対応する曲線上の点の座標を返す
説明 Cinderellaの描画面上の座標を与えて，それに対応する曲線上の3次元座標を返す。
空間内の曲線を作図すると，曲線の空間内のプロットデータとともに，描画面上に描くためのプロットデータ
も作られる。これを利用すると，描画面上の位置から曲線上の座標を求めることができる。
【例】螺旋と線分を描いたとき，描画面上での交点（空間内の交点ではない）に対応する螺旋上の点の座標を求
め部分曲線を描く。
Spaceline("1",[[-1,-1,-1],[1,2,3]]);
Spacecurve("1","[2*cos(t),2*sin(t),0.2*t]","t=[0,4*pi]",["do"]);
tmp=Intersectcrvs("sl2d1","sc2d1");
p1=Invparapt(tmp_1,"sc3d1");
p2=Invparapt(tmp_2,"sc3d1");
Partcrv3d("1",p1,p2,"sc3d1");
z
x
y
ここで，sl2d1,sc2d1 は線分と螺旋の描画面上での（平面の）プロットデータである。Intersectcrvs() で平面
上の交点の座標（複数あるのでリストが返る）を求め，Invparapt() で対応する螺旋上の点の座標を求めて部
分曲線を描いている。実際に交わる点での部分曲線ではないことに注意。
関数 Projpara(空間曲線)
機能 空間曲線を投影した平面曲線を返す。
関数 Expr3d([位置, 方向, 文字列],option)
機能 文字列を表示する
説明 Expr() と同じ書式。「位置（座標）」だけ，空間座標にする。
関数 Letter3d([位置, 方向, 文字列],option)
機能 文字列を表示する
説明 Letter() と同じ書式。「位置（座標）」だけ，空間座標にする。
【例】三角錐ABCDを描いて，BCの中点に点Mを取ってA,Dと結ぶ。
A
Putpoint3d("A",2*[0,0,2*sqrt(6)/3]);
Putpoint3d("B",2*[1,-1/sqrt(3),0]);
Putpoint3d("C",2*[0,sqrt(3)-1/sqrt(3),0]);
Putpoint3d("D",2*[-1,-1/sqrt(3),0]);
Putpoint3d("M",(B3d+C3d)/2); D
B
phd=Concatobj([[A,B,C],[A,B,D],[A,C,D],[B,C,D]]);
M
VertexEdgeFace("1",phd); C
145

### Page 146

Spaceline("1",[A,M,D]);
Nohiddenbyfaces("1","phf3d1");
Letter3d([A3d,"ne","A",B3d,"w","B",C3d,"se","C",D3d,"e","D"]);
Letter3d(M3d,"sw","M",["Color=blue"]);
⇒関数一覧
関数 Getangle()
機能 回転角の取得
説明 スライダで設定できる回転角（視点の位置）TH と FI を取得する。これは，スライダの左側に表示されてい
る値である。戻り値は，リスト [TH,FI] で，角は度数法で表される。なお，内部変数は，THETAとPHIで，
弧度法で表されている。
回転角の設定については，回転角の設定を参照のこと。
⇒関数一覧
146

### Page 147

6 KeTJS
6.1 CindyJSとKeTJS
CindyJS は，Cinderellaの作品をHTMLにしてWeb上で動かせるようにしたものである。Cinderellaのファイ
ルメニューには，「HTMLに書き出す」があり，これにより，HTML ファイルができる。できたHTMLファイルを
そのままダブルクリックすると，JavaScript で記述されたプログラムが走る。
現在のところはCinderellaと完全互換ではなく，Web上ではMouseスロットなどが使えなかったり，線種が指
定できなかったりする。それでも，自作のボタンは有効なので，これでWeb上のアプリケーションを作ることがで
きる。
KeTJSでは，CindyScriptにはないKeTCindyの関数（コマンド）を使って，作図アプリケーションを作ること
ができる。CindyJSの拡張版ともいえる。
ただし，CindyJSがCinderellaと完全互換でないように，KeTJSもKeTCindyと完全互換ではない。たとえば，
Maximaの呼び出しなどはできない。それでも，KeTCindyのシステムが入っていない環境でもWebブラウザで教
材が使えることのメリットは大きいだろう。なお，HTMLなので，TeXのファイルへの書き出し機能はない。
KeTJSでHTMLを作成するには，いったんCinderellaのファイルメニューから「HTMLに書き出す」を選んで
HTMLを作成した後，「KeTJS(on,off)」ボタンをクリックする。「HTMLに書き出す」で書き出されたHTMLは，
実行のための環境設定しか書かれていない。これに，作図プログラムを追加するのが「KeTJSon」「KeTJSoff」ボタ
ンである。この２つのボタンの違いについては，次節「動作環境」を参照のこと。
また，ひな形として，template4ketcindyjs.cdy または samplesフォルダの s06, s16 に入っているものを使うとよ
い。「KeTJSon」「KeTJSoff」ボタンが設定してある。
6.2 KeTJSの動作環境
Cinderella のファイルメニューから「HTML に書き出す」を選ぶと，CSS とランタイムへのリンク，および
JavaScriptのコードが書かれたHTMLファイルが書き出される。CSSとランタイムへのリンクは
<link rel="stylesheet" href="https://cindyjs.org/dist/v0.8/CindyJS.css">
<script type="text/javascript" src="https://cindyjs.org/dist/v0.8/Cindy.js">
</script>
となっている。つまり，Web上からランタイム Cindy.js をオンラインでダウンロードしてJavaScriptを動かすこ
とになる。そのため，ファイルをブラウザで開いたときに少し時間がかかる。また，インターネットに接続できない
と実行できない。
このCSSとランタイムは，自分のコンピュータに置くことができ，KeTCindyでは，KeTCindyのライブラリと
ともに，ketcindyjsというフォルダ内に入っている。
また，JavaScriptのコードの方は，これだけではKeTCindyのコマンドでの作図はできない。
そこで，KeTJSon ボタンをクリックすると，リンク先はそのままで，JavaScriptのコードを追加して，ファイル
名に json を追加したHTMLファイルを作る。
また，KeTJSoff ボタン（オフラインで使う）をクリックすると，ランタイムをダウンロードして，Cinderellaの
ファイルと同じフォルダに ketcindyjs フォルダを作る。リンク先は次のように ketcindyjs に変え，JavaScript の
コードを追加して，ファイル名に jsoffL を追加したHTMLファイルを作る。
<link rel="stylesheet" href="ketcindyjs/CindyJS.css">
<script type="text/javascript" src="ketcindyjs/Cindy.js"></script>
ファイル名について
Cinderellaのファイルメニューから「HTMLに書き出す」ときのファイル名は，初期設定では作図中のファイル名
147

### Page 148

と同じ。このファイル名は書き出すときに指定できる。
「KeTJSon」ボタンで書き出すときのファイル名は，Setfiles() でファイル名が指定されていなければ，作図中
のファイル名と同じ。これが「CindyJS に書き出す」で書き出したときのファイル名で同じでないと，KeTJS の
HTMLは作成されない。したがって，次のいずれかでファイル名を決める。
(1) ファイル名は作図中のCinderellaのファイル名と同じにする。
このときは，Setfiles() を使わない。
(2) 作図中のCinderellaのファイル名と別の名前にする。
このときは，Setfiles("filename") を使い，CindyJSに書き出すときに
"filename" で書き出す。
6.3 KeTJSの設定
関数 Setketcindyjs(options)
機能 KeTJSの設定
説明 オプションを設定しない場合（ Setketcindyjs() ）は，デフォルト値が使われる。
オプションは次の通り。
Scale 実数 拡大・縮小 デフォルト値は 1
Grid 実数 グリッドサイズ デフォルト値は 1（mm）
Nolabel 点のリスト ラベルを表示しない点を指定する。”No”だけでも可。
”Nolabel=all”とすると，すべての点のラベルが表示されない。
Label 点のリスト ラベルを表示する点を指定する。他は表示されない。
”Label”か”Nolabel”のいずれかを用いる。
Color 背景色 背景色の指定。 デフォルト値は offwhite
Figure y 書き出す範囲をNE,SWの範囲にする。
Axes false CindyJSが表示している座標軸を非表示にする。
【例】次のように記述する。
Setketcindyjs(["Scale=1.5","Label=[A]","Color=lightgray"])
注１）Cinderella の画面に背景の方眼が描かれているとき，「CindyJS に書き出
す」で，この方眼も表示される。方眼を消したい場合は，画面下の「グリッ
ドを描く」ツールで非表示にしておく。
注２）HTMLなので，画面に説明文などを表示したい場合は，HTMLファイルを
開き，下の方の <body> と </body> の間，<div id="CSCanvas"></div>
の前後に書けば表示される。改行などは，HTMLのタグを用いる。
関数 Ketcindyjsmain(prependlist,appendlist)
機能 KeTJSファイルのhtmlを読み込み，前後にスクリプトを追加した親htmlを作成する。
説明 親ファイル名は，cdyファイル名+main+(on,off) となる。
タグは，冒頭に<pf5/fbr>などと指定する。
_;は&emsp; と変換される。
【例】Ketcindyjsmain(["<pf10red/fp>_;_;Title"],[]);
=> <p><font size="10" color="red">&emsp;&emsp;Title</font></p>
コメント化 no ketjs
機能 KeTJSへの書き出しの有無を指定
148

### Page 149

説明 コマンドの末尾に // に続いて書くと，その行はKeTJSに出力しない。ブロック単位で非出力にするには，
ブロックを //no ketjs on，//no ketjs off ではさむ。
【例】次のスクリプトは，いずれも画面上では四角形ABCDと対角線AD,BCを描いている。
Listplot("1",[A,B,C,D,A]);
Listplot("2",[A,C]);
Listplot("3",[B,D]);// no ketjs
この場合，HTMLでは対角線BDは描かれない。
Listplot("1",[A,B,C,D,A]);
// no ketjs on
Listplot("2",[A,C]);
Listplot("3",[B,D]);
// no ketjs off
この場合，対角線は2本とも描かれない。
KeTJSだけで有効 only ketjs
機能 KeTJSだけに書き込む
説明 コマンドの先頭に // をつけて，行の最後に続けて書くと，その行はKeTJSだけで有効となる。ブロック単
位で有効化するには，ブロックを only ketjs on，only ketjs off ではさむ。
【例】KeTJSだけで入力窓を作る。
str="x^2";
//str=Textedit(50); only ketjs
Plotdata("1",str,"x");
注）TexteditはKeTJSで入力窓からの入力を得るコマンド
⇒関数一覧
6.4 KeTJSのコマンド
関数 Ptpos(幾何点)
機能 幾何点の現在（直前）座標を返す。
説明 幾何点を制御可能範囲外に移動した場合に保持されるもとの座標
【例】Ptpos(A)
関数 Ketcindyjsdata(変数名と値のリスト)
機能 KeTJSファイルのscript ”csinit”の最後にデータを書き込む
説明 Maximaの返り値などKeTJSでは得られないデータを使えるようにする。
【例】Mxfun("1","integrate",["x*sin(x)","x"]);// no ketjs
Ketcindyjsdata(["mx1",mx1]);
Plotdata("1",mx1,"x");
関数 Animationparam(初期値，速度，範囲)
機能 アニメーションボタンのパラメータ値を取得する。
例 ss=Animationparam(0,1,[-60,60]);
説明
• ”Play” パラメータ値が初期値にセットされ，変化が始まる。
• ”Stop” パラメータ値が初期値にセットされ，変化が終わる。
• 速度 パラメータ値の変化速度（秒速）
149

### Page 150

• 範囲 パラメータ値が端点に達したら停止する。
関数 Seteditable(識別番号,[初期文字列，”Size=文字サイズ”，”Width=幅”])
機能 "Editable Text"を設定する。
説明 Editable Textの作り方
(1) 「モード/特別/文字列入力」を選び，適当な初期値を入れる。
(2) 「要素を動かす」に戻り，shift-clickすると動かすことができる。
(3) インスペクトで識別番号を確認（修正）する。
【例】Setedittext(0,[”y=”,”Size=18”,”Width=100”]);
Text0の表示文字"y="，文字サイズ18pt，幅100pt
関数 Textedit(識別番号[,デフォルト値])
機能 KeTJSで入力窓に入れた文字列（＝があるときは，その右側）を返す。
文字列が空ならデフォルト値を返す。
【例】
str=Textedit(0,"x^2");
Plotdata("1",str,"x");
関数 Subsedit(識別番号,文字列)
機能 文字列を識別番号の入力窓に入れる。
【例】
Subsedit(0,"x^2");
関数 Movetojs(識別番号または要素名,座標,フォントサイズ);
機能 KeTJSでテキストボタンの位置とフォントサイズを指定
例 Movetojs(0,[2,-4],15);
関数 Setplaybuttons(座標,フォントサイズ [,スペース増加量]);
機能 KeTJSでPlayなどのボタンの位置とフォントサイズを指定
例 Setplaybuttons([-3,-4.5],15,[1]);
注）Play,Pause,Rev,Stopの識別番号が71,72,73,74であることを確認しておく。
注）スペース増加量の単位はmm，リストで個々に指定することもできる。
⇒関数一覧
6.5 入力窓の利用
• 入力窓(Editable Text)の作成
(1) モード > 特別 > 文字列入力（終わったら「要素を動かす」ボタンに戻しておく）
(2) Shiftキーを押しながら選択，編集 > インスペクタを開いて，識別番号を取得する。
(3) コマンドSeteditableで窓の形状を設定する。
Seteditable(0,["=","Size=18","Width=200"]);
(4) 位置を動かすには，Shiftキーを押しながら選択する．
• 入力窓からの文字列の取得
str=Textedit(0,空のときまたは=の右辺が空のときに返す文字列);
• 入力窓に文字列を代入
Subsedit(0,文字列);
150

### Page 151

7 付録
7.1 用語解説
Cinderellaで使っている用語に次のものがある。
インシデント 点が曲線（直線）上に乗っている状態を表す。
曲線上に点をとるとインシデントになり，ドラッグしたとき曲線上だけを動く。
インシデントの状態を変えるには，「点の取り付け/取り外し」ツールを使う。
幾何要素 Cinderellaの作図ツールで作図した点や直線などの要素
インスペクタ 幾何要素の大きさや色などの属性を管理するウィンドウ。
幾何点 幾何要素としての点。マウスドラッグで動かすことができる。
CindyscriptやKeTCindyのスクリプトで取った点は幾何要素にならないことがある。
自由点 マウスドラッグで任意に動かすことのできる点。
固定点 マウスドラッグで移動することのできない点
2曲線の交点などではない単独の点の場合，インスペクタで点を固定できる。
スナップ マウスポイントが格子点の近くに来ると格子点上にぴったり移動する。
Cinderellaの画面の下方ツールのうち，磁石アイコンによりこのモードになる。
7.2 Cinderellaの作図ツール
動かすモードにする ：幾何要素を選択して動かす。これが標準状態
点を加える ：クリックして点を作る
直線を加える ：2点間をドラッグする
線分を加える ：2点間をドラッグする
中点を加える ：2点間をドラッグする
交点を加える ：2曲線を順にクリック
平行線を加える ：直線上から通る点へドラッグ
垂線を加える ：直線上から通る点へドラッグ
角の二等分線を加える ：2直線を順にクリック
円を加える ：中心から半径分ドラッグ
半径つき円を加える ：中心から半径分ドラッグ
焦点と通る点で決まる楕円 ：焦点と通る点を順にクリック
焦点と通る点で決まる双曲線 ：焦点と通る点を順にクリック
焦点と準線で決まる放物線 ：焦点と準線を順にクリック
多角形を加える ：多角形の頂点を順にクリック
角に印をつける ：2直線を順にクリック
角度を測る ：2直線を順にクリック
選択した要素を消去する ：選択しておいてツールをクリック
点をまとめて選択する ：点がすべて選択される
線分をまとめて選択する ：線分がすべて選択される
151

### Page 152

画面ツール（下のツールバー）
原点を移動する ：画面上の任意の位置でドラッグする
矩形領域を画面サイズに拡大 ：ドラッグしてできる矩形で領域を選択する
画面を矩形領域サイズに縮小 ：ドラッグしてで切る矩形で領域を選択する
格子点にスナップする ：軸と方眼を表示しスナップモードにする
グリッドを粗く / 細かくする
7.3 他のテキストエディタの使用
例えば，cdyファイル名をtemplate.cdyとする．
(1) template.txtを作成して，template.cdyと同じ場所におく．
(2) template.cdyのFiguresスロットを以下を記述して実行する．
Ketinit();
setdirectory(Dircdy);
import(Cdyname()+''.txt'');
setdirectory(Dirwork);
Windispg();
(3) template.txtにスクリプトを書いて保存する．
例）Putpoint("A",[0,0],A.xy);
Plotdata("1'',''x^2'',''x'');
注）template.txtを変更した場合も，cdy画面をクリックすればよい．
⇒関数一覧
152

### Page 153

7.4 色名とカラーコード一覧
name CMYK Color name CMYK Color
greenyellow [0.15,0,0.69,0] royalpurple [0.75,0.9,0,0]
yellow [0,0,1,0] blueviolet [0.86,0.91,0,0.04]
goldenrod [0,0.1,0.84,0] periwinkle [0.57,0.55,0,0]
dandelion [0,0.29,0.84,0] cadetblue [0.62,0.57,0.23,0]
apricot [0,0.32,0.52,0] cornflowerblue [0.65,0.13,0,0]
peach [0,0.5,0.7,0] midnightblue [0.98,0.13,0,0.43]
melon [0,0.46,0.5,0] navyblue [0.94,0.54,0,0]
yelloworange [0,0.42,1,0] royalblue [1,0.5,0,0]
orange [0,0.61,0.87,0] blue [1,1,0,0]
burntorange [0,0.51,1,0] cerulean [0.94,0.11,0,0]
bittersweet [0,0.75,1,0.24] cyan [1,0,0,0]
redorange [0,0.77,0.87,0] processblue [0.96,0,0,0]
mahogany [0,0.85,0.87,0.35] skyblue [0.62,0,0.12,0]
maroon [0,0.87,0.68,0.32] turquoise [0.85,0,0.2,0]
brickred [0,0.89,0.94,0.28] tealblue [0.86,0,0.34,0.02]
red [0,1,1,0] aquamarine [0.82,0,0.3,0]
orangered [0,1,0.5,0] bluegreen [0.85,0,0.33,0]
rubinered [0,1,0.13,0] emerald [1,0,0.5,0]
wildstrawberry [0,0.96,0.39,0] janglegreen [0.99,0,0.52,0]
salmon [0,0.53,0.38,0] seagreen [0.69,0,0.5,0]
carnationpink [0,0.63,0,0] green [1,0,1,0]
magenta [0,1,0,0] forestgreen [0.91,0,0.88,0.12]
violetred [0,0.81,0,0] pinegreen [0.92,0,0.59,0.25]
rhodamine [0,0.82,0,0] limegreen [0.5,0,1,0]
mulberry [0.34,0.9,0,0.02] yellowgreen [0.44,0,0.74,0]
redviolet [0.07,0.9,0,0.34] springgreen [0.26,0,0.76,0]
fuchsia [0.47,0.91,0,0.08] olivegreen [0.64,0,0.95,0.4]
lavender [0,0.48,0,0] rawsienna [0,0.72,1,0.45]
thistle [0.12,0.59,0,0] sepia [0,0.83,1,0.7]
orchid [0.32,0.64,0,0] brown [0,0.81,1,0.6]
darkorchid [0.4,0.8,0.2,0] tan [0.14,0.42,0.56,0]
purple [0.45,0.86,0,0] gray [0,0,0,0.5]
plum [0.5,1,0,0] black [0,0,0,1]
violet [0.79,0.88,0,0] white [0,0,0,0]
注）lightgray [0,0,0,0.15], offwhite [0,0,0,0.3], cindycolor [0.66,0,69,0.71]を追加
153

### Page 154

7.5 点の作図についての比較表
関数 戻り値を使う 描画する 幾何点を作る TeXに出力
Pointdata - ⃝ - ⃝
Putpoint - - ⃝ -
Putintersect - - ⃝ -
PutonCurve - - ⃝ -
PutonLine - - ⃝ -
PutonSeg - - ⃝ -
Reflectpoint ⃝ - - -
Rotatepoint ⃝ - - -
Scalepoint ⃝ - - -
Translatepoint ⃝ - - -
Pointdata3d - ⃝ - ⃝
Putpoint3d - - ⃝ -
Intersectcrvsf △ - ⃝ -
IntersectsgpL - ⃝ ⃝ -
Invparapt ⃝ - - -
Parapt ⃝ - - -
Perpplane - ⃝ ⃝ -
Perppt - ⃝ ⃝ -
Pointdata3d - ⃝ - ⃝
PutonCurve3d - - ⃝ -
PutonSeg3d - - ⃝ -
Reflectpoint3d ⃝ - - -
Rotatepoint3d ⃝ - - -
Scalepoint3d ⃝ - - -
Translatepoint3d ⃝ - - -
注) Intersectcrvsf は戻り値ではなく，プロットデータを使う。
154

### Page 155

8 関数一覧
【目次】に戻る
【設定・定義】
Addasterisk(文字列) 数式文字列に*を追加する
Addax(0/1) 座標軸を描くかどうかを定める
Addgraph(name ,プロットデータ) ユーザー定義のプロットデータを描画する
Addpackage(package) プレビュー用のパッケージを追加
Anglemark(点list, options) 角の印を入れる
Animationparam(初期値，速度，範囲) アニメーションボタンのパラメータ値を取得
Arrowdata(name,options) 2点間を結ぶ矢線を描く
Arrowhead(点,方向,options) 点に矢じりだけを描く
Acos(real) 逆余弦三角関数の値を返す
Asin(real) 逆正弦三角関数の値を返す
Atan(real) 逆正接三角関数の値を返す
Asirfun(name,式,list,option) Risa/Asirの関数を実行する
Assign(文字列) 文字列中のある文字を値で置き換える
BBdata(ファイル名) 画像のサイズ(bounding box)を求める
Bezier3d(name, list, list) 空間ベジェ曲線を描く
Beziersmooth(name , list,options ) なめらかなベジェ曲線を描く。その１
Beziersym(name , list,options ) なめらかなベジェ曲線を描く。その2
Bezier(name, list,list,options ) 単独のベジェ曲線を描く
Binomial(n,r) 2項係数を計算する。
Bowdata(点list,options) 弓形を描く
Boxplot(名前,データ,位置,高さ,option) 箱ひげ図を描く
Bracket(str) strから bracketpair を検索し位置と階層レベルのリストを返す
Bspline(name，list，options ) 2次 Bスプライン曲線を描く
CalcbyA(name,list,option) Risa/Asirのスクリプトを実行する
CalcbyF(name,list,option) FriCASのスクリプトを実行する
CalcbyM(name,list,option) Maximaのスクリプトを実行する
CalcbyW(name,list,option) Wolfram 言語のスクリプトを実行する
CalcbyR(変数名,コマンド列, option) Rのコマンド列を実行して結果を返す
Changestyle3d(list, list) 空間プロットデータの属性を変更
Changestyle(PD list, options) 描画オプションを変更する
Changetablestyle(罫線list, options) Table の罫線の描画オプションを変更する。
Changework(パス) 作業ディレクトリを変更する
Cindyname() 作図しているファイル名を取得する。
Circledata(name,点list,options) 円または正多角形を描く
Colorcode(文字1，文字2,color) カラーコードの変換
Colorname2cmyk(文字1，文字2,color) カラー名のcmykを返す
Com0th(コマンド) RのOpenfileの前に置くコマンドを定義する
Com1st(コマンド) RのOpenfileの前に置くコマンドを定義する
Com2ndpre(コマンド) RのOpenfileのあとに置くコマンドを定義する
Com2nd(コマンド) RのOpenfileのあとに置くコマンドを定義する
155

### Page 156

Concatobj(list,option) いくつかのobjデータを結合
Crossprod(list,list) ベクトルの外積を計算する
CRspline(name，list，options ) 単独のCatmull-Rom スプライン曲線を描く
Crv2onsfparadata(name,PD,PD2,式,opt,opt曲)面上の曲線(媒介変数)の陰線処理
Crv3onsfparadata(name,PD,PD2,式,opt,opt曲)面上の曲線の陰線処理
Crvsfparadata(name,PD,PD2,式,opt,opt) 曲線の曲面による陰線処理
Datalist2d() 画面に描かれているすべてのプロットデータ
Datalist3d() 画面に描かれているすべての空間プロットデータ
Deffun(関数名 , 定義list ) Rと共有する関数を定義する
Definecolor(色名 , 定義list ) ユーザー定義色の設定
Defvar(文字列) Rと共有する変数を定義する
Deqplot(name,式,変数名,初期値,options]) 微分方程式の解曲線を描く
Derivative(関数式,変数,値) 関数の微分係数を求める
Dispmat(list) listの内容を行列型にコンソールに表示する
Dist3d(点名,点名) 空間の2点の距離
Dotfilldata(name , 方向, PD , options) 領域に点を敷き詰める
Dotprod(list,list) ベクトルの内積を計算する
Dqq(文字列) 文字列の前後に"をつける。
Drawfigures(name ,figlist,optionlist) 複数のデータのスタイルをリストで与えて描画する
Drawpoint3d(座標) 空間点を描く
Segmark(name,list,options) 線分に印をつける
Drwxy() Addax(0のとき座標軸を先に描く
Ellipseplot(name,list,str,options) 楕円を描く
Embed(name,PD,式) 埋め込みデータ作成
Enclosing(name , [位置，方向，数式]) 複数の曲線から閉曲線を描く
ExeccmdC(name,options1,options2) C言語で命令実行
Expr3d([座標,位置,文字列],options) 空間の数式文字列を表示する
Exprrot(位置，向き，文字列) 傾いたTEX数式を書く
Expr([座標,位置,文字列],options) TEX数式を書く
Extractdata(データ名,属性) ReadOutDataで読み込んだデータに属性をつける。
Factorial(n) nの階乗を計算する。
Figpdf(option) 出力枠サイズのPDFを作る
Filelist(mainpath,dirname) (mainpathにある)dirnameのファイル一覧をリストとして返す
Findarea(PD) プロットデータで囲まれる部分の面積を求める
Findcell(列番号, 行番号) セルの情報listを返す
Findlength(PD) プロットデータで描く曲線の長さを求める
Fontsize(記号) フォントサイズを設定する
Fourierseries(name,係数,周期,項数) フーリエ級数を描く
Fracform(数,分母リスト) 簡易TeX-like書式の文字列を返す
Framedata(name , list) 矩形を描く(空のときは描画領域)
Frfun(name,式,list,option) FriCASの関数を実行する
Gcd(numberlist) 最大公約数を計算する。
Getangle() 回転角の取得
gethome() ユーザホームを返す
Getlevel(str) strから sepの位置と階層レベルのリストを返す
156

### Page 157

Hatchdata(name , 方向, PD , options) 領域に斜線を引く
Helpkey(str) キーワードで関数を検索する
Help(str) コマンドヘルプを表示する
Histplot(name,data) ヒストグラムを描く
Htickmark([横座標 , 方向 , 文字]) 横軸に目盛りを描く
Hyperbolaplot(name,list,str,options) 双曲線を描く
Implicitplot(name,str,,str,str,options) 陰関数のグラフを描く
Indexall(str1,str2) 文字列 str1 から str2 を検索しその位置をすべて返す
Addglist() ketlib スロットで定義された描画データを追加する
Initglist() ketlib スロットで描画データを作るときの初期化
Setglist() ketlib スロットの描画データを登録する
Integrate(関数式,変数,範囲,options) 関数の定積分値を求める
Intersectcrvs(PD1,PD2) プロットデータの交点のパラメータlistを返す
Intersectcrvsf(name,PD,式) 曲線と曲面の交点を求める
Intersectcrvs(PD1,PD2) プロットデータの交点の座標listを返す
Intersectcurves(PD1,PD2) より精密な交点のlistを返す
Intersectcurvespp(PD1,PD2) より精密な交点のパラメータlistを返す
IntersectsgpL(点名,線分,面,描画方法) 空間の直線と平面の交点
Inversefun(関数式,範囲,値) 逆関数値を求める
Invert(PD) プロットデータの点を逆順にする（reverseと同じ）
Invparapt(座標,PD) 描画面座標に対応する曲線上の座標
Isangle() 角度スライダが選択されているか
isexists(dir,file) dirにfileが存在するか
islinux() Linux OSか
ismacos() Mac OSか
Isptselected(点名) 点が選択されていればtrueを返す
Ptselected(点名) 点が選択されていればtrueを返す
iswindows() Windows OSか
Joincrvs(name, PDlist, options) 2つのプロットデータをつなげたデータを作る
Ketcindyjsdata(変数名と値のリスト) script ”csinit”にデータを書き込む
Ketcindyjsmain(prependlist,appendlist) ketcindyjsのhtmlの前後にスクリプトを追加したhtmlを作成
Ketinit3d() KeTCindy3Dの使用宣言
Ketinit(options) KETCindyを初期化する
Letter3d([座標,位置,文字列],options) 空間文字列を表示する
Letterrot(座標,方向,移動量,文字列) 文字列を回転して表示する
Letter([座標,位置,文字列],options) 文字列を表示する
Lineplot(name,2点のlist,options) 2点を結ぶ直線を描く
Listplot(name,点のlist,options) 点を線分で結ぶ
makedir(path,dirname) pathにdirnameのdirを作成する
Mkbeziercrv(name,list,options) 作図した点を使ってベジェ曲線を描く
Mkbezierptcrv3d(点list) 制御点を自動的にとる空間ベジェ曲線
Mkbezierptcrv(list，options ) 制御点を自動配置してベジェ曲線を描く
Mkcircles() 幾何円のすべてのPD を作成する
Mkobjcmd(name,式,option) 厚みを持たない曲面のコマンドを作成
Mkobjcrvcmd(name,PD,option) 空間曲線のコマンドを作成
157

### Page 158

Mkobjnrm(name,式) 法線ベクトルのデータを作成
Mkobjplatecmd(name,面データ,options) 面を描く
Mkobjpolycmd(name,PD,options) 多面体を描く
Mkobjsymbcmd(PD, 実数,実数,vec,vec) 文字等のコマンドを作成
Mkobjthickcmd(name,式) 厚みを持つ曲面のコマンドを作成
Mksegments() 幾何線分のすべてのPD を作成する
Mkviewobj(name,PD, options) obj ファイルを作成
Movetojs(要素名,座標,フォントサイズ) Textボタンの位置とフォントサイズを設定
Mxbatch(list) Maximaの外部スクリプト用コマンドを作る
Mxfun(name,式,list,option) Maximaの関数を実行する
Mxtex(num,式) 式をTeX書式にする
Wltex(name,式) 式をTeX書式にする
Nearestptcrv(点,PD) 点に一番近い曲線上の点を取得する
Nearestpt(PD,PD) 2曲線間の最も近い点を取得する
Nohiddenbyfaces(name,PD,PD,opt1,opt2) 多面体と空間曲線を陰線処理
Norm(ベクトル) ベクトルの大きさを計算する。
Numptcrv(PD) 曲線PD の節点データの個数を取得する
Op(n,list) listまたは文字列から要素を抜き出す
Ospline(list，list，options ) 大島のスプライン曲線を描く
Ovaldata(name, 点list,options) 角を丸くした矩形を描く
Parabolaplot(name,list,str,options) 放物線を描く
Paramark(点list,options) 角の印を入れる
Paramoncurve(PD,n,PtL) PD上にある点P のデータを取得する
Paramplot(name,式,変数と定義域,options) 媒介変数で表された曲線を描く
Parapt(座標) 空間点の投影面での座標
Partcrv3d(name,始点,終点,PD) 空間曲線PDの部分曲線を作る
Partcrv(name,点1,点2,PD) 部分曲線を描く
Periodfun(定義式,周期,options) 周期関数のグラフを描く
Perpplane(点名, 点, ベクトル,option) 点を通り垂直な平面上の基準点
Perppt(点名,点,点list,option) 平面に下ろした垂線の足
Phparadata(name,name2,options) 多面体を陰線処理して描く
PlotdataR(name,式,変数) Rの関数のグラフを描く
Plotdata(name,式,変数と定義域,options) 関数のグラフを描く
PlotdiscR(name,式,変数) 離散型のグラフを描く
Pointdata3d(名前,点list,options) 空間点のデータを作成する
Pointdata(name,点list,options) 点データを作る
Pointoncurve(数,PD) パラメータ値をもつプロットデータ上の点
Polarplot(name,式,変数と定義域,options) 極座標表示の曲線を描く
Polygonplot(name,点list,整数,options) 正多角形を描く
Projpara(空間曲線) 空間曲線を投影した平面曲線を求める
Ptcrv(n,PD) 曲線PD のn 番目の節点を取得する
Ptpos(幾何点) 幾何点の現在（直前）座標
Ptsize(数) 表示する点の大きさを設定する
Ptend(PD) プロットデータの終点を取得する
Ptstart(PD) プロットデータの始点を取得する
158

### Page 159

Putaxes3d([x,y,z]) 空間の軸上に幾何点をとる
Putcell(列番号, 行番号, 位置, 文字) セルに文字列を入れる
Putcellexpr(列番号, 行番号, 位置, 文字) セルに数式を入れる
Putcolexpr(列番号, 位置，文字列list) １列に順にTEX書式の文字を書き入れる
Putcol(列番号, 位置，文字列list) １列に順に文字を書き入れる
Putintersect(点名,PD1,PD2) 2曲線の交点を作る
Putoncurve3d(点名,PD) 空間曲線上に点をとる
Putoncurve(name,PD,初期値) 曲線上に点を作る
Putonline(点名,座標1,座標2) 直線上に点を作る
Putonseg3d(点名,点1,点2) 空間線分上に点をとる
Putonseg(点名,座標1,座標2) 線分上に点を作る
Putpoint3d(list,option) 空間点をとる
Putpoint(点名,座標1,座標2) 点を作る
Putrowexpr(行番号, 位置，文字列list) １行に順にTEX書式の文字を書き入れる
Putrow(行番号, 位置，文字列list) １行に順に文字を書き入れる
Readcsv(name,filename,option) csvファイルを読む
Readlines(name,filename,option) テキストファイルを1行ずつ読む
Readlines(path,filename) (pathにある)filernameの各行を読み込みリストとして返す
Readobj(ファイル名) objファイルを読み込む
Readoutdata(ファイル名) 外部データをPDとして読み込む
Reflectdata3d(点,PDlist,list,options) 空間PDを鏡映
Reflectdata(name,PD,点list,options) プロットデータの鏡映を作成
Reflectpoint3d(点,list) 空間点を鏡映
Reflectpoint(点,対称点/対称軸) 点の鏡映を作成
Reparse(文字列（リスト） 評価して実数化する
Rfun(変数名,コマンド,引数, option) Rの1つコマンドを実行して結果を返す
Rotatedata3d(name,PD,vec,角度,点) 空間プロットデータを回転
Rotatedata(name,PD,角度,中心,options) プロットデータを回転する
Rotatepoint3d(点 , vec , 角度 , 点) 空間点を回転
Rotatepoint(点,角度,中心) 点の位置を回転する
Rulerscale(点,list,list) 目盛を打つ
Scaledata3d(点, vec, 中心) プロットデータを拡大/縮小
Scaledata(name,PD,x,y,中心,options) 点を拡大・縮小する
Scalepoint3d(点, vec, 中心) 空間点の位置を拡大/縮小
Scalepoint(点,比率ベクトル,中心) 点の位置を拡大・縮小する
Scatterplot(name,filename,option) 2次元データを読み込み，散布図を描く
Segmark(name,list,options) 線分に印をつける
Setangle(theta,phi) 回転角の設定
Setarrow(size,angle,pos,cut,style 矢線の形状を設定する
Setax(list) 座標軸の書式を設定する
Setcolor(color,options) Windispgでの描画色を設定する
Seteditable(識別番号, 文字サイズ, 幅) "Editable Text"を設定する。
Setfiles(filename) 出力するファイル名を設定する
Setketcindyjs(options) KeTJSの設定
Setmarklen(数) 軸の目盛の長さを設定する
159

### Page 160

Setorigin(座標) 表示する座標軸の原点の位置を設定する
Setpara(str) パラパラ動画のタイトル指定
Setparent(filename) Parentで出力するファイル名を設定する
Setpen(数) 線の太さを設定する
Setplaybuttons(座標,サイズ [, スペース]) Playなどのボタンの位置とフォントサイズを設定
Setpt(数) 表示する点の大きさを設定する
Setscaling(数) 縦方向の倍率を設定する
Settitle(タイトルlist,options) スライドのタイトル設定
Setunitlen(数) 単位長を設定する
Setwindow() 描画領域を設定する
Sf3data(name, list,options) 陰線処理なしの空間曲面を描く
Sfbdparadata(name, 式,options) 曲面を陰線処理して描く
Sfcutparadatacdy(name,面,曲面,options) 平面と曲面の交線を求める。
Shade(PDlist , 数) 閉曲線の内部にシェードをかける
Skeletonparadata(name,PD,PD,options) スケルトン処理のデータ作成
Sla2fra(文字列) 文字列の中の / を簡易TeX-like書式の分数に直す
Slider() スライダを作る
Spacecurve(name, 式, 定義域,options) 空間曲線のデータ作成
Spaceline(name,list) 空間の折線データ作成
Sprintf(実数,長さ) 小数点以下の長さを固定した文字列に変換
Sqr(real) 平方根を返す
Start3d() 3Dの開始
Startsurf() 曲面描画の初期化
Strsplit(文字列,文字) 文字列を分解する。
Textedit(識別番号,文字列) 文字列を識別番号の入力窓に入れる
Tab2list(str，option) str の内容をlistに変換する
Tabledatalight(”” , 縦横 ,除外 , options) 幾何点を持たない表の枠を作成する
Tabledata(”” , 縦横 ,除外 , options) 表の枠を作成する
Tangentplot(name,PD, 位置) 曲線の接線を引く
Texcom(コード) TEXのコードを書き出す
Textedit(識別番号) KeTJSで入力窓に入れた文字列を取得
Textformat(数,桁数) 小数点以下の桁数を指定して数値を文字列化する
Tgrid(セルラベル) セル（格子点）の座標を返す
Tlistplot(セルラベル1,セルラベル2) セルに斜線を引く
Tocindyform(TeX-like書式 Cindy書式の文字列を返す
Tonoralform(TeX-like書式) TeX書式の文字列に*を補う
Totexform(TeX-like書式) TeX書式の文字列を返す
Translatedata3d(name,PD, 平行移動量) 空間プロットデータを平行移動
Translatedata(name,PD,ベクトル,options) プロットデータを平行移動する
Translatepoint3d(座標,平行移動量) 空間点を平行移動
Translatepoint(点,ベクトル) 点を平行移動する
Unscaling(プロットデータ) scalingされたデータを論理値化する
Usegraphics() グラフィクスパッケージを"pict2e" に変更する
VertexEdgeFace(面データ,option) 頂点と面から辺を求め，辺を描く
Viewtex() TEXのソースファイルを書き出す。引数なし
160

### Page 161

Vtickmark([横座標 , 方向 , 文字]) 縦軸に目盛りを描く
Windispg() 定義されたプロットデータを描画面に描く
Wireparadata(name,PD,式,int,int,opt,opt) 曲面のワイヤフレームを陰線処理
Wlfun(name,式,list,option) Wolfram 言語の1つの関数を実行する
Workprocess() 作図の経過を取得する
Writecsv(namelist,data,option) dataの内容をcsvファイルに書き出す
WriteOutData() PDデータを書き出す
Xyzax3data(name,文字,文字,文字,options)空間座標軸の表示
Xyzcoord(P.x,P.y,Pz.y) 主副画面で決まる空間点の座標
161

## CindyJSReference2024.pdf

### Page 1

CindyScript / CindyJS Reference
CinderellaJapan
2024 年3月26 日
目次
1 CindyScript の全般的仕様 6
1.1 関数型プログラミング言語 . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
1.2 コードの書式 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6
2 制御命令 7
2.1 繰り返し . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7
2.1.1 while . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7
2.1.2 repeat . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7
2.1.3 forall . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 8
2.2 条件分岐 if . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 9
2.3 トリガー trigger . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10
2.4 強制的評価 eval . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10
3 変数 10
3.1 大域的変数と局所変数 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 11
3.2 変数の作成と削除 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 12
3.3 局所変数の宣言 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13
3.4 オブジェクトのキー変数 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13
4 算術関数 15
4.1 四則演算と累乗 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 15
4.2 剰余 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16
4.3 角度演算子 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16
4.4 絶対値 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16
4.5 距離演算子 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17
4.6 標準的な算術関数 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17
1

### Page 2

4.7 四捨五入 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18
4.8 床関数と天井関数 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18
4.9 複素数 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18
4.10 乱数 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18
4.11 ブール関数 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19
4.11.1 比較 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19
4.11.2 ブール代数 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19
4.12 演算子一覧 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 20
5 型の判定 21
6 文字列関数 22
6.1 文字列の結合 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22
6.2 文字列への変換 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22
6.3 文字列の長さ . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 22
6.4 文字列の抜き出し . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 23
6.5 文字列の検索 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 23
6.6 文字列の分解 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 23
6.7 文字列の置換 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 24
6.8 文字列の解析 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 24
6.9 文字列の比較と並べ替え . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 25
7 リスト 25
7.1 リストの作成とアクセス . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 25
7.2 リストの操作 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27
7.3 リストの要素の走査 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 28
7.4 要素の組み合わせ . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 29
7.5 要素の整列 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 30
7.6 要素の総和・積 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 31
7.7 最大と最小 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32
8 ベクトルと行列 32
8.1 ベクトルと行列の定義 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32
8.2 和と積 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 33
8.3 ベクトルと行列の演算 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 33
8.4 線形代数の演算 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 34
8.5 3 次元の凸多面体を作る . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 35
2

### Page 3

9 幾何学要素へのアクセス 36
9.1 要素にその名前でアクセスする . . . . . . . . . . . . . . . . . . . . . . . . . 36
9.2 幾何学要素のリスト . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 37
9.3 幾何学要素のパラメータ . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 37
9.4 インスペクタの要素 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 42
9.5 要素の作成と消去 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 43
9.6 幾何要素の操作 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 44
10 図形の描画 46
10.1 修飾子 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 46
10.2 色や大きさの設定 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 47
10.3 色の関数 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 48
10.4 描画関数 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 49
11 関数プロット 51
11.1 実数関数のグラフを描く . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 51
11.2 動的な色と透明度 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 54
11.3 カラープロット . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 55
11.4 ベクトル場 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 57
11.5 グリッド . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 60
11.6 オシログラフ . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 62
11.7 文字と表 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 64
12 TeX 記法 Cinderella TeX 67
13 画像の操作とレンダリング 72
13.1 メディアブラウザ . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 72
13.2 画像の表示と変換 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 72
13.3 カスタム画像を作る . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 81
13.4 キャンバスに描く . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 81
14 シェイプ 85
14.1 シェイプの初歩 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 85
14.2 シェイプの結合 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 85
14.3 シェイプの使い方 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 85
15 座標系と基底 88
15.1 座標変換 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 88
15.2 射影基底との関係 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 90
3

### Page 4

15.3 基底スタック . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 92
15.4 レイヤー . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 93
15.5 スクリーン境界の決定 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 95
16 幾何学的演算 96
16.1 リストと座標 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 96
16.2 基本的な幾何学関数 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 96
16.3 有用な線形代数関数 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 97
16.4 変換とオブジェクトの型 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 98
16.5 幾何学変換と基底 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 99
17 計算 100
17.1 微分と接線 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 100
17.2 高度な計算 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 101
18 音声出力 Syntherella 102
18.1 概要 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 102
18.2 単音 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 102
18.3 旋律 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 103
18.4 音色 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 107
18.5 サウンド関数 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 109
19 ファイル管理 111
19.1 データの読み込み . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 111
19.2 データの書き出し . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 111
19.3 HTML との連携 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 112
19.4 ネットワーク . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 113
19.5 コンソールへの出力 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 114
20 時間とアニメーション 114
20.1 時間 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 114
20.2 アニメーションのコントロール . . . . . . . . . . . . . . . . . . . . . . . . . 115
21 ユーザー入力 115
21.1 マウスとキーボード . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 115
21.2 加速度センサにおける AMS データ . . . . . . . . . . . . . . . . . . . . . . . 116
22 CindyLab との連携 116
22.1 シミュレーション環境 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 116
4

### Page 5

23 Cindy3D 118
23.1 設定 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 118
23.2 描画関数 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 119
23.3 光の当て方と表現 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 126
24 CindyJS 132
24.1 CindyJS のHTML基本構造 . . . . . . . . . . . . . . . . . . . . . . . . . . 132
24.1.1 CindyJS ランタイムのロード . . . . . . . . . . . . . . . . . . . . . . . . 133
24.1.2 スクリプトの記述 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 133
24.1.3 CindyJS の初期化 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 134
24.2 CindyJS のHTML文書の実例 . . . . . . . . . . . . . . . . . . . . . . . . . 135
25 索引 138
5

### Page 6

1 CindyScript の全般的仕様
1.1 関数型プログラミング言語
CindyScript のすべての計算は関数によって行われる。いろいろな計算は、基本的な関数
によってなされる。通常の計算のように a+b のようにして計算をすることもでき， 「+」は
演算子と呼ばれるが，CindyScript では、これを挿入演算子と呼んでいる。同じ計算 が、関
数 add(a,b) によってもできる。そこで、このマニュアルでは、「演算子」 と「関数」をほ
ぼ同義なものとして使っている。したがって、add(a,b) のような関数も「演算子」 と呼ぶ
ことがある。
さらに、 if 文のような一見手続き風の命令文が、関数として認識される。例えば、
if(x<y,print("Mine"),print("Yours"))
という文は、3 つの引数を持つ if 関数の例である。第 1 の引数 x の条件を評価し，その結
果により 第 2 または第 3 の結果 print("Mine") または print("Yours") を実行し，戻り
値とする。これは次の命令文と同じである。print(if(x<y,"Mine","Yours"))
1.2 コードの書式
CindyScript では，命令文の区切りにセミコロン ; を書く。これは必須である。単なる改
行は命令文の続きと見なされる。したがって，関数を使うときの括弧をそのままブロックを
表すものとして，その内部で改行することもできる。ブロック内のインデントは特に必要は
ないが，可読性のためにはつけるとよい。
命令文の最後にはセミコロンをつけなくてもよい。
【例】
repeat(9,i, j=i*i; draw([i,j])) は，次のようにブロックとして書くことができる。
repeat(9,i,
j=i*i;
draw([i,j]);
)
6

### Page 7

2 制御命令
2.1 繰り返し
2.1.1 while
while(<bool>,<expr>)
while 関数は <bool>が真である間，<expr> を評価する。
【例】：０から４までの和を求める。
x=0;
sum=0;
while(x<4,
x=x+1;
sum=sum+x;
);
println(sum);
参考：while は関数なので戻り値がある。戻り値は最後の評価結果である。上の例では sum
の値が戻る。
2.1.2 repeat
repeat(<int>,<expr>)
<expr>を <int> 回繰り返し，最後の評価結果が戻る。 <expr> が評価されている間，実
行変数 # は繰り返しの回数を数える。
【修飾子】次の修飾子を任意に組み合わせることができる。
start ループの開始の値を設定する。
stop ループの終了の値を設定する。
step ステップの値を設定する。
【例 】 スクリプト 結果
repeat(6, println(#+" ")) 1 2 3 4 5 6
repeat(6, start->4, println(#+" ")) 4 5 6 7 8 9
7

### Page 8

repeat(6, stop->2, println(#+" ")) -3 -2 -1 0 1 2
repeat(6, step->3, println(#+" ")) 1 4 7 10 13 16
repeat(6, stop->12,step->4, println(#+" ")) -8 -4 0 4 8 12
repeat(6, start->3,step->2, println(#+" ")) 3 5 7 9 11 13
repeat(6, start->3,stop->4, println(#+" ")) 3 3.2 3.4 3.6 3.8 4
repeat(6, start->0,stop->-3, println(#+" ")) 0 -0.6 -1.2 -1.8 -2.4 -3
repeat(6, start->3,stop->4,step->0.4, println(#+" ")) 3 3.4 3.8
repeat(<int>,<var>,<expr>)
この関数は，実行変数が¡var¿に割り当てられるという１点を除いては，repeat(<int>,<expr>)
と同じ。これは，異なる実行変数を使って，ループを入れ子にすることを考慮している。
【例】 10×10の点列を描く
repeat(10,i,
repeat(10,j,
draw((i,j));
);
)
2.1.3 forall
リストを使って繰り返しをする。
forall(<list>,<expr>)
この関数の第１引数はリスト。 <expr> がリストのそれぞれの要素に対して評価される。
実行変数# はリストのそれぞれの要素になる。
【例】リストの全要素を改行してコンソールに表示する。
a=["this","is","a","list"];
forall(a,println(#))
forall(<list>,<var>,<expr>)
実行変数が <var> であること以外は forall(<list>,<expr>)と同じ。
8

### Page 9

2.2 条件分岐 if
if(<bool>,<expr>)
<bool> が真であれば、<expr> が評価(実行)され，その値が返される。
【例】
if(x<0,println("xは負です"))
このコードでは、x が負の値であれば、”x は負です”が印字 (表示) され、その文字列がそ
のまま戻り値として返される。負の値でなければ、何も印字されず、 ___が返される。
if(<bool>,<expr1>,<expr2>)
条件 <bool> が真であれば <expr1> が評価され、そうでなければ <expr2>が評価され、
その値が返される。したがって、この if 文は、if then else に相当する。 この条件分岐
の典型的な使用法は2つある。まず、条件によって場合分けをするときに使う。
【例】
if(x<0,
println("x は負です")
,
if (x>0,
println("x は正です")
,
println("x は零です")
)
)
このコードでは、 x の値が正か、負か、ゼロかを表示する。
第2の使い方は、 <bool> の条件により値を返したいときで if 関数の戻り値を利用する。
これは関数の定義としてよく使う。
【例】
f(x):=if(x>0,x,-x)
このコードは、xの絶対値を返す関数 f(x) を定義する。
9

### Page 10

【例】
A.color=if(A.x>0,(1,0,0),(0,0,1))
このコードでは、点 A の色を、そのx座標の正負により赤か青に設定する。
2.3 トリガー trigger
t trigger(<bool>,<expr>)
trigger は動的意味あいを持つ条件判断である。 <bool> が false から true に変わった
ときに評価される。たとえば、何かの要素をドラッグしているとき、<bool> が false から
true に変化したことを察知して <expr> を評価 (実行) する。 この演算子の目的は、要素
をドラッグしているときに何らかのイベントが起きたかどうかを判断することである。 次の
コードはそのような例である。
【例】
trigger(A.x<0,println("A はxが負の半平面に入りました"));
trigger(A.x>0,println("A はxが正の半平面に入りました"))
このコードでは、点 A が y軸を横切るとメッセージを出す。
2.4 強制的評価 eval
eval(<expr>,<modif1>,<modif2>,…
この関数は，<expr>の内容を強制的に評価する。<expr>内の変数は modifier のリストに
ある変数で置き換えられる。置き換える変数は局所変数。実行後はもとの値に書き戻される。
【例】次のコードは，評価値を 7 とする。
eval(x+y,x->2,y->5)
3 変数
CindyScript の基本的な型は次の通り。
• 数値 : 数値の型は、整数、浮動小数点数、複素数
• リスト : 任意の値のリスト。ベクトルや行列はリストで表される
• 文字列 : 文字列
• 幾何要素 : 幾何学的要素
10

### Page 11

• ブール値 : true または false のブール値
しかしながら，CindyScript は値の型を明示しない。変数は特定の型を持たず，どんな型
のどんな値でも変数 に代入することができる。 例えば、関数f(x,y) を定義する次のコード
f(x,y):=x+y;
は、整数、複素数、ベクトル、行列のいずれでも使えるが，関数が意味不明なことをする
と、「意味がない」ことを表す ___印を返す。したがって、上の例で、f([1,2],[3,4]) なら
ばベクトルの和として [4,6]を返すが、 f(4,[3,4]) では意味がなく、 ___を返す。
3.1 大域的変数と局所変数
変数に代入した値がどこまで有効かを表すのに，「大域的（global）」と「局所的（local）」
という概念がある。どこで使われていても変数の値が変化しないのが「大域的」，関数の内部
や繰り返しループなどの内部だけで有効な場合を「局所的」という。CindyScript の変数は，
基本的には大域的である。したがって，関数定義などで使用した変数がすでに使われていて
なんらかの値が代入されていることがありうる。
【例】
f(x):=(
x+y;
);
x=1;
y=1;
println(f(5));
この例では，x は引数なので，f(5) を実行すると x=5 が代入される。 y の値は関数内部で
は代入されていないが，呼び出す前に y=1 としているので，この値が使われる。結果は
6
1
となる。
繰り返しの repeat で使う変数は局所的である。
【例】
x=5;
repeat(2,x,
println(x);
);
11

### Page 12

println(x);
結果は
1
2
5
となる。
3.2 変数の作成と削除
変数の作成: createvar(<varname>)
変数の削除: removevar(<varname>)
これらの関数は，局所変数の生成について手動で管理するのを助ける。
createvar(x) は新しい変数 xを作り，前の値はスタックに入れられる。
removevar(x) は局所変数を削除して，スタックの値を書き戻す。
通常，変数は明示的に作っておく必要はない。それらは，最初に使われるときに自動的に
作られる。 createvar と removevar は，コードの特定の部分に，ある名前で変数を予約し
たいときだけ使われる。
【例】
x=10;
println("x is now "+x);
createvar(x);
x=5;
println("x is now "+x);
removevar(x);
println("x is now "+x);
このコードの実行結果は次の通り。
x is now 10
x is now 5
x is now 10
clear()
12

### Page 13

引数なしで，すべての変数をクリアする。特定の変数をクリアする場合は clear(<var>)
と引数に渡す。
3.3 局所変数の宣言
regional(name1,name2,...)
関数内で局所変数を使う。
この関数は，ユーザーが定義する関数の最初に使う。引数にある複数の変数を局所変数と
して定義する。local 関数と似ているが，関数内での処理が終わると自動的に消滅する。し
たがって，releaseなどで消去する手続きは不要でlocal関数より便利に使える。
【例】
f(x):=(
regional(y);
y=2;
x+y;
);
x=1;
y=1;
println(f(5));
この例では，y の値は関数内部で 2 が代入されているが，この y は局所変数として扱われる
ので，呼び出す前の y の値は変わらず 1 のままである。
結果は
7
1
となる。
関数を呼び出すことで，その前の y の値が変わってしまうのを防ぐことができる。
3.4 オブジェクトのキー変数
<key>=<something> で宣言した <object>のキー変数のリストを得る。
【例】オブジェクトのキー変数を割り当てる。
A:"age"=34;
13

### Page 14

A:"haircolor"="brown";
割当をした結果はつぎのような構文で利用できる。
println(A:"age");
println(A:"haircolor");
keys 関数は，オブジェクトに割り当てられた変数のリストを取得する。したがって，次の
コードではリスト ["age","haircolor"] が表示される。
println(keys(A));
14

### Page 15

4 算術関数
4.1 四則演算と累乗
四則演算は，数学の基本的な演算子 +, -, *, /, ^ がそのまま使える。これらは，「挿入
演算子」と呼ばれ，数とリストに適用できるが，演算の意味は，適用されるものによって異な
る。たとえば， 5+7 の結果は 12 であり， [2,3,4]+[3,-1,5] の結果は [5,2,9] となる。
これらの演算子のほかに，関数でも演算ができる。
演算 演算子 関数
和 + add(<expr1>,<expr2>)
差 - sub(<expr1>,<expr2>)
積 * mult(<expr1>,<expr2>)
商 / div(<expr1>,<expr2>)
累乗 ^ pow(<expr1>,<expr2>)
商については，÷でも演算ができる。（÷ は日本語入力で入力する。Unicode）
数 (整数，実数，複素数) のべき乗では，指数は整数に限らず，実数，複素数でも可能。正
式には exp(b*ln(a)) が計算される。(ln(a)は複素変数の対数関数)
ln() は周期 2*pi で定義されるので， a^b は一般には多価関数。 b が整数でない場合に
は a^b は最初の主要な値を返す。
【例】 式 結果
2.3 + 5.9 8.2 実数の和
add(5,6) 11 整数の和
(2+3*i) + (5+9*i) 7+i*12 複素数の和
(2+3*i) - (5+9*i) -3 - i*6 複素数の差
sub([3,5)],[1,2]) [2,3] リストの差
[2,3,6] - [3,2,4] [-1,1,2] リスト（ベクトル）の差
[2,3,[1,2]] + [3,4,[1,3]] [5,7,[2,4]] リストの和
[2,3,4] + [3,4,[1,2]] [5,7,___] （第３要素が未定義値となる）
7 * 8 56 整数の積
(1+i) * (2+i) 1+3*i 複素数の積
2 * [5,3,2] [10,2,4] ベクトルの実数倍
[5,3,2] * 2 [10,2,4] ベクトルの実数倍
[2,2,3] * [3,4,6] 32 ベクトルの内積
[[1,2],[3,4]] * [1,2] [5,11] 行列と列ベクトルの積
15

### Page 16

[1,2] * [[1,2],[3,4]] [7,10] 行ベクトルと行列の積
[[1,2],[3,4]] * [[1,2],[3,4]] [[7,10],[15,22]] 行列の積
[6,8,4]/2 [3,4,2] ベクトルの実数倍と同じ
mult(2,[3,4]) [6,8] ベクトルの実数倍
mult([4,5],[3,4]) 32 ベクトルの内積
8/2 4 整数の商
8÷2 4 整数の商
div(8,2) 4 整数の商
(2-i) / (1+i) 0.5 - i*1.5 複素数の商
6^2 36 整数の整数乗
pow(6,2) 36 整数の整数乗
2^(1/2) 1.4142・・ 整数の分数乗
2^i 0.7692 + i*0.639 整数のi乗
4.2 剰余
mod(<expr1>,<expr2>) 関数は，<expr1>を <expr2>で割った余りを求める。
4.3 角度演算子
<数>° は，数に pi/180 をかける。度数法 (60 分法) による角度を弧度法に変換する。
「°」は日本語入力モードで入力する。
【例】sin(30°) の結果は 0.5
4.4 絶対値
| <obj> | 演算子，および関数 abs(obj)は，objの絶対値を求める。objは実数，複素
数，ベクトルのいずれか。
| <obj> | 演算子を ||3+|x−2|| のように入れ子にして使うことはできない。入れ子に
したい場合は abs() 関数を用いる。
abs() は，実数，複素数，ベクトルなどのノルムを計算する。
【例】 abs([1,3,1,2,1]) の結果は 4
16

### Page 17

4.5 距離演算子
|<ob1,obj2>| 演算子，および dist(obj1,obj2) 関数は，２つのオブジェクトの距離
を計算する。オブジェクトは，実数，複素数，ベクトルのいずれかで，２つとも同じ種類の
ものとする。
【例】 |[1,1],[4,5]| の結果は 5
|<ob1,obj2j>| 演算子を入れ子にして使うことはできない。入れ子にしたい場合は
dist() 関数を用いる。
4.6 標準的な算術関数
平方根 sqrt(<expr>)
指数関数 exp(<expr>)
自然対数: log(<expr>)
三角関数 sin(<expr>)
三角関数 cos(<expr>)
三角関数 tan(<expr>)
sine の逆関数 arcsin(<expr>)
cosine の逆関数 arccos(<expr>)
tangent の逆関数 arctan(<expr>)
ベクトルのなす角 arctan2(<実数1,実数2>)
ベクトルのなす角 arctan2(<vector>)
三角関数は複素関数なので引数に複素数を与えることができる。
arc は原則として多価だが，関数は −π からπ の間の解をひとつ返す。
平方根は演算子として √ も使える。√ は日本語入力モードで入力する。
【例】sin(2+3*i) の結果は 9.1545 - i*4.1689
arctan2(1,1) と arctan2([1,1]) の結果はいずれも 45°
Cinderellaで作図した点をAとしたとき，arctan2(A) はOAがx軸の正の方向となす角
を返す。(O は原点)
√2 の結果は 1.412・・・
17

### Page 18

4.7 四捨五入
round(<expr>) は，小数点以下を四捨五入する。小数点以下のある桁を指定して四捨五
入する関数は用意されていないので，たとえば，小数点以下第４位を四捨五入する場合には，
1000倍して四捨五入したのち10000で割る。
リストにも適用できる。複素数に対しては，実部と虚部のそれぞれに対して適用される。
【例】
round(pi*1000)/1000 結果は 3.142
round([3.2,7.8,3.1+i*6.9]) 結果は [3,8,3+i*7]
4.8 床関数と天井関数
床関数：その数以下の最大の整数: floor(<expr>)
天井関数：その数以上の最小の整数: ceil(<expr>)
複素数に対しては，実部と虚部のそれぞれに対して適用される。
4.9 複素数
複素数の実部: re(<expr>)
複素数の虚部: im(<expr>)
共役複素数: conjugate(<expr>)
4.10 乱数
random() 0 より大きく 1 未満の一様乱数
random(<数>) 0 より大きく <数> 未満の実数の一様乱数
randomint(<数>) 0 以上 <数> 未満の整数の一様乱数
randomnormal() (0,1) 正規乱数
randombool() ブール値の乱数 true または false
seedrandom(<数>) 乱数発生器の初期化
random 関数は，負の数や複素数を引数にすることもできる。例えば，random(-5) は -5
から 0までの乱数を発生する。 randomint(6+i*10) は実部が0から6まで，虚部が0から
10までの複素数をランダムに発生する。
疑似乱数は，常に予測不可能な新しい乱数列を発生する。なんらかの理由で，スクリプト
を実行するたびに，同じ乱数列を発生させたい場合は，seedrandom() 関数を使う。引数に
18

### Page 19

与えた整数に対し，同じ乱数列が発生する。異なる引数 (seed) を与えれば別の乱数列が発生
する。
4.11 ブール関数
条件付き分岐では真偽の判定が必要になるが，これに関する演算がブール演算である。演
算子もしくは関数により，true またはfalse が返される。
4.11.1 比較
<expr1> == <expr2> ２つの式の評価結果が等しい。
<expr1> != <expr2> ２つの式の評価結果が等しくない。
以下は，ともに 実数であれば，通常の大小関係。
ともに 文字列であれば，辞書順に比較。 比較できない値の場合は が返される。
<expr1> > <expr2> expr1 が，expr2 より大きい。
<expr1> < <expr2> expr1 が，expr2 より小さい。
<expr1> >= <expr2> expr1 が，expr2 より大きいか等しい。
<expr1> <= <expr2> expr1 が，expr2 より小さいか等しい。
ファジー(あいまい)な比較：~=, ~!=, ~<, ~>, ~>=, ~<= (チルダと比較記号)
CindyScript は，比較を ファジー (あいまい) におこなう演算子を持っている。この演算
子では，条件がεの限界内かどうかを調べる。したがって，a~=0 は，値 a が + ε から -ε
の範囲にあるかどうかを調べる。 小さな値 ε は 0.0000000001 に設定される。この演算子
は，数値計算における誤差を吸収するのに役に立つ。たとえば，x==y が論理的に等しいにも
かかわらず，if(x==y,・・)が正しく動作しない場合，if(x~=y,・・)とすることにより誤
差を吸収して動作するようになる。
4.11.2 ブール代数
演算子 関数
論理積 <bool1> & <bool2> and(<bool1>,<bool2>)
論理和 <bool1> % <bool2> or(<bool1>,<bool2>)
否定 !<bool> not(<bool>)
排他的論理和 ー xor(<bool1>,<bool2>)
引数がブール表現でない場合は___を返す。
19

### Page 20

4.12 演算子一覧
括弧内は優先順位。
: 自身の定義にアクセスする
. あらかじめ定義されたデータフィールドにアクセスする
° 度数法を弧度法に変換する
_ リスト内の要素にアクセスする
^ べき乗
* 乗法 (ベクトル，行列も含む)
/ 除法(ベクトル，行列をスカラーで割る場合も含む)
+ 加法 (ベクトル，行列も含む)
- 減法 (ベクトル，行列も含む)
! 論理否定
== 相等
> より大きい
< より小さい
>= 以上
<= 以下
!= 等しくない
~= ほぼ等しい
~< ほぼ小さい
~> ほぼ大きい
~>= ほぼ以上である
~<= ほぼ以下である
=:= equals after evaluation
& 論理積
% 論理和
!= 等しくない
~!= ほぼ等しくない
.. aからbまでの範囲の数のリスト
++ リストの連結
-- リストの差
~~ ２つのリストの共通要素
:> リストの後方に要素を追加する
<: リストの前方に要素を追加する
= 変数への代入
20

### Page 21

:= 関数の定義
:=_ 定義の消去
-> 修飾子の宣言
, リストと関数の区切り
; 命令文の区切り
5 型の判定
次の情報関数は，式が特定の種類に属するかどうかを調べる。戻り値はbool 値。
isinteger(<expr>) 整数かどうかを調べる。
isreal(<expr>) 実数かどうかを調べる。 なお，整数は実数。
iscomplex(<expr>) 複素数かどうかを調べる。 なお，実数は複素数。
iseven(<expr>) 偶数かどうかを調べる。
isodd(<expr>) 奇数かどうかを調べる。
islist(<expr>) リストかどうかを調べる。
ismatrix(<expr>) 行列かどうかを調べる。
isnumbervector(<expr>) すべて数(実数または複素数)からなるベクトルかどうかを調べる。
isnumbermatrix(<expr>) 成分がすべて数(実数または複素数)の行列かどうかを調べる。
isstring(<expr>) 文字列かどうかを調べる。
isgeometric(<expr>) 幾何学要素かどうかを調べる。
isselected(<expr>) 選択された幾何学要素かどうかを調べる。
ispoint(<expr>) 幾何の点かどうかを調べる。
isline(<expr>) 幾何の直線かどうかを調べる。
iscircle(<expr>) 幾何の円かどうかを調べる。
isconic(<expr>) が幾何の円錐曲線かどうかを調べる。
ismass(<expr>) CindyLab の質点かどうかを調べる。
issun(<expr>) CindyLab の恒星かどうかを調べる。
isspring(<expr>) CindyLab のバネかどうかを調べる。
isundefined(<expr>) 未定義要素( ___)を返すかどうかを調べる。
21

### Page 22

6 文字列関数
6.1 文字列の結合
<文字列> + <expr>
＋演算子は，ひとつの文字列に expr をつけ加える。expr が文字列でない場合も文字列に変
換する。文字列とexprは逆順でもよい。
【例】 式 結果
"Cindy"+"Script" ”CindyScript”
"４たす３は "+(4+3) ”４たす３は 7”
""+(4+3) ”7”
6.2 文字列への変換
text(<expr>)
exprを評価し，結果を文字列に変換する。
format(<数>,<整数>)
第１引数の数の小数点以下を，第２引数で指定された桁まで，文字列として整形する。最高
15 桁まで可能。引数がリストの場合は，各要素に対して整形がなされる。format() は，出
力としての整形を行なうだけで，整形された値は文字列として扱われるので計算はできない。
【例】
式 結果
text(12*3) ”36”
text([1,2]*[2,-1]) ”0”
format(sqrt(2),4) ”1.4142”
format(pi,14) ”3.14159265358979”
format([sin(30°),cos(30°)],3) [”0.5”,”0.866”]
6.3 文字列の長さ
length(<文字列>)
文字列の長さを返す。
22

### Page 23

6.4 文字列の抜き出し
substring(<文字列>,<整数1>,<整数2>)
<文字列> の <整数1> 文字目の次から <整数2> 文字目までの文字列を抜き出す。
【例】 substring("abcdefg",3,6) は "def"を返す。
6.5 文字列の検索
indexof(<文字列1>,<文字列2>)
文字列 <文字列 2> が <文字列 1> の中にあるかどうかを検索し，最初に見つかった位置を
返す。なければ 0 を返す。
indexof(<文字列1>,<文字列2>,<整数>)
文字列,<文字列2>が <文字列1> の <整数> 文字目以降にあるかどうかを検索し，最初に見
つかった位置を返す。なければ 0 を返す。
【例】 式 結果
indexof("CindyScript","i") 2
indexof("CindyScript","y") 5
indexof("CindyScript","z") 0
indexof("CindyScript","i",1) 2
indexof("CindyScript","i",3) 9
indexof("CindyScript","i",10) 0
6.6 文字列の分解
tokenize(<文字列>,<expr>)
この関数は，引数<文字列> の部分文字列のリストを作成する。2 番目の引数 <expr> は，
文字列か，文字列のリストでなければならない。もし <expr>が文字列であれば， <文字列>
からこの文字列を検索する。この文字列は <文字列> を分解するときの標識となる。
もし <expr> が文字列のリストであれば，このリストを再帰的に使って <文字列> の部分
文字列のリストを生成する。
【例】 式 結果
tokenize("one:two--three:four",":") ["one", "two--three", "four"]
23

### Page 24

tokenize("one:two--three:four","-") ["one:two", "", "three:four"]
tokenize("one:two--three:four","--") ["one:two", "three:four"]
tokenize("one:two--three:four",["-",":"]) [["one", "two"], [], ["three", "four"]]
tokenize("one:two--three:four",["--",":"]) [["one", "two"], ["three", "four"]]
6.7 文字列の置換
replace(<文字列1>,<文字列2>,<文字列3>)
<文字列 1> の中の <文字列 2> をすべて <文字列 3> で置き換える。L-System の構築に便
利。replace(<文字列>,<list>)
<list> は <文字列> に対して，置き換えをする文字列の組合せからなるリスト。リストの
置き換え規則は１つでもよく，変数に代入して使うこともできる。
【例 】 式 結果
replace("one:two--three:four","o","XXX") "XXXne:twXXX--three:fXXXur"
replace("F","F","F+F") "F+F"
replace("F+F","F","F+F") "F+F+F+F"
replace("XYX",[["X","one"],["Y","two"]]) "onetwoone"
s="ABC"; replace(s,[["A","X"]]) "XBC"
s="ABC"; t= [["A","X"], ["B","Y"]];replace(s,t) "XYC"
6.8 文字列の解析
parse(<文字列>)
文字列の内容を解析して，その結果を評価する。この関数は，テキストフィールドから入
力された文字列を処理するのに特に有効。
guess(<数>)
浮動小数点で表された数を，高い精度でその浮動小数点数を生み出す数式に変えようと
する。
【例 】 式 結果
parse("3+7") 10
text="sin(x)+cos(x)";f(x):=parse(text); f(x)=sin(x)+cos(x) と同じ
parse(Text0.text); Text0 に入力された文字を解析
24

### Page 25

guess(8.125) "65/8"
guess(0.774596669241483) "sqrt(3/5)"
6.9 文字列の比較と並べ替え
数と同様，文字列も順序付けができる。したがって，演算子 >, <, >=, <=, ==, !=を
使って比較ができる。これらの演算子についてはブール関数を参照のこと。
文字の順序としては，辞書順を使う。たとえば，次のようになる。
"a"<"abd"<"abe"<"b"<"blue"<"blunt"<"xxx"
リストの並べ替え: sort(<list>), sort(<list>,<expr>), sort(<list>,<var>,<expr>)
文字列を含むリストを並べ替える。 文字列の順序は常に辞書順。文字列の長さで並べ替え
るように，ユーザーが順序を定義することもできる。
【例 】 式 結果
sort(["one","two","three","four"]) ["four","one","three","two"]
sort(["one","two","three","four"],length(#)) ["one","two","four","three"]
指標関数: <文字列>_<整数>
リストの項目にアクセスする挿入演算子 は，文字列内の指定した位置にある文字にアク
セスするのにも使える。この演算子で，文字を返したり，文字をセットしたりすることがで
きる。
【例 】 式 結果
"CindyScript"_5 ”y”
"CindyScript"_12
a="CindyScript";a_5="erella"; ”CinderellaScript”
7 リスト
7.1 リストの作成とアクセス
整数列の作成：<整数1>..<整数2>
<整数1> から <整数2>までの連続する整数のリストを作る。<整数1> が<整数2>より大
きい場合は空のリストを返す。
【例 】 式 結果
25

### Page 26

4..9 [4,5,6,7,8,9]
-2..2 [-2,-1,0,1,2]
リストの要素へのアクセス
演算子では <list>_<整数>
関数では take(<list>,<整数>)
第２引数のインデックスは 1 から始まる整数。インデックスが 0 か，リストの要素数より
大きいときは，___が返され，「Index out of range」という Warning メッセージが出る。
インデックスは計算式で与えることもできる。また，入れ子にしたリストの要素にもアク
セスできる。インデックスを負の整数にすると，リストの末尾から逆順にアクセスする。
整数のリストを使って，まとめてアクセスすることもできる。結果はリストで返される。
【例 】 式 結果
[2 ,5 ,7 ,3]_3 7
take([2 ,5 ,7 ,3],2) 5
[2 ,5 ,7 ,3]_5 ___
[[2,[4,5]],1]_1 [2,[4,5]]
[[2,[4,5]],1]_(7-5) 1
[[2,[4,5]],1]_1_2 [4,5]
[[2,[4,5]],1]_1_2_2 5
[[2,[4,5]],1]_1_2_2_2 ___
[2 ,5 ,7 ,3]_(-1) 7
take([2 ,5 ,7 ,3],(-3) 5
[[2,6] ,5 ,7 ,3]_(-4)_(-1) 6
[2 ,5 ,7 ,3]_[2,3] [5,7]
[2 ,5 ,7 ,3]_[-1,1,1] [3,2,2]
リストが変数に代入されると，個々の要素は 演算子によってアクセスしたのち，それを
設定することができる。たとえば，次のスクリプトの結果， a は [[2,["B",5]],"A"] に
なる。
a=[[2,[4,5]],1];
a_2="A";
a_1_2_1="B";
リストの長さ: length(<list>)
【例 】 式 結果
26

### Page 27

length([2 ,5 ,7 ,3]) 4
length([2 ,[5, 4, 5] ,7 ,3]_2) 3
length(1..1000) 1000
内容のテスト: contains(<list>,<expr>)
<list> の中に<expr>があるかどうかで，true または false を返す。
Unicode の数学記号 ∈ ，∉ を使うこともできる。
println(4 ∈ [1,3,4,5]) の結果はtrue
println(4 ∉ [1,3,4,5]) の結果はfalse
7.2 リストの操作
リストの連結
演算子では <リスト1>++<リスト2> または <リスト1> ∪ <リスト2>
∪ はUnicode の数学記号。
関数では concat(<リスト1>,<リスト2>)
【例 】 式 結果
concat(["a", "b"], ["c", "d"]) ["a", "b", "c", "d"]
["a", "b"] ++ ["c", "d"] ["a", "b", "c", "d"]
["a", "b"] ∪ ["c", "d"] ["a", "b", "c", "d"]
リストからの要素の削除
演算子では <リスト1> -- <リスト2>
関数では remove(<リスト1>,<リスト2>)
【例 】 式 結果
remove([1,3,4,5,1,5,6], [1,3,7]) [4,5,5,7]
[1,3,4,5,1,5,6]--[1,3,7] [4,5,5,7]
リストの共通部分
演算子では <リスト1>~~<リスト2> または <リスト1> ∩ <リスト2>
∩ はUnicode の数学記号。
関数では common(<リスト1>,<リスト2>)
【例 】 式 結果
common([1,3,4,5,1,5,6], [1,3,7]) [1,3]
27

### Page 28

[1,3,4,5,1,5,6]~~[1,3,7] [1,3]
[1,3,4,5,1,5,6] ∩ [1,3,7] [1,3]
要素の後方追加
演算子では <list> :> <expr>
関数では append(<list>,<expr>)
要素の前方付加
演算子では <expr> <: <list>
関数では prepend(<expr>,<list>)
【例 】 式 結果
["a", "b", "c"]:>"d" ["a", "b", "c","d"]
append(["a", "b", "c"], "d") ["a", "b", "c","d"]
"d"<:["a", "b", "c"] ["d", "a", "b", "c"]
prepend("d",["a", "b", "c"]) ["d", "a", "b", "c"]
7.3 リストの要素の走査
全要素走査
forall(<list>,<expr>) 実行変数は #
forall(<list>,<var>,<expr>) 実行変数を ver にする
第１引数の <list> を走査し，それぞれの要素を <expr> で評価する。
【例】
a=["this","is","a","list"]; のとき，forall(a,println(#)) とすれば，repeat()
で繰り返しをしなくてもリストのすべての要素がコンソールに表示される。
式の適用
apply(<list>,<expr>) 実行変数は #
apply(<list>,<var>,<expr>) 実行変数を ver にする
操作 <expr> をリストのすべての要素に適用し，その結果からなるリストを作成する。
【例 】 式 結果
apply([1, 2, 3, 4, 5],#*2) [2, 4, 6, 8, 10]
28

### Page 29

apply([1, 2, 3, 4, 5],t,t+5) [6, 7, 8, 9, 10]
apply(1..5, [#,#*2]) [[1, 2], [2, 4], [3, 6], [4, 8], [5, 10]]
リストの要素の選択
select(<list>,<boolexpr>) 実行変数は #
select(<list>,<ver><boolexpr>) 実行変数を ver にする
この関数は，条件 <boolexpr>を満たすすべての要素を選び出す。この条件は <bool> 値
をとる。
【例 】 式 結果
select(1..10, isodd(#)) [1, 3, 5, 7, 9]
select(0..10, #+# == #^2) [0,2]
【例】 次のスクリプトはxの約数のリストを得る関数divisorsを定義し，100以下の素数
のリストを表示する。
divisors(x):=select(1..x,mod(x,#)==0);
primes(n):=select(1..n,length(divisors(#))==2);
println(primes(100))
7.4 要素の組み合わせ
ペアを作る: pairs(<list>)
リストに含まれるすべての要素から２つずつを組み合わせたペアの部分リストを要素とす
るリストを作る。
チェーンを作る: consecutive(<list>)
引数 <list> の連続する２つずつの要素のペアからなるリストを作る。
輪を作る: cycle(<list>)
チェーンに加え，最後の要素と最初の要素もつなげる。
３つの組合せを作る: triples(<list>)
リストに含まれるすべての要素から 3 つずつを組み合わせた部分リストを要素とするリス
トを作る。
２つのリストの直積を作る: directproduct(<リスト1>,<リスト2>)
29

### Page 30

<リスト 1> の要素を第１成分に， <リスト 2> の要素を第２成分とした，すべてのペアか
らなるリストを作る。
【例】 式 結果
pairs([1, 2, 3, 4]) [[1, 2], [1, 3], [1, 4], [2, 3], [2, 4], [3, 4]]
consecutive([1, 2, 3, 4, 5]) [[1, 2], [2, 3], [3, 4], [4, 5]]
cycle([1, 2, 3, 4, 5]) [[1, 2], [2, 3], [3, 4], [4, 5], [5, 1]]
triples([1, 2, 3, 4]) [[1, 2, 3], [1, 2, 4], [1, 3, 4], [2, 3,4 ]]
directproduct([1,2,3],["A","B"]) [[1,"A"],[1,"B"],[2,"A"],[2,"B"],[3,"A"],[3,"B"]]
入れ子リストの平坦化: flatten(<list>)
リストが入れ子になっているときに，第２の入れ子を解除して平坦化したリストを返す。
修飾子を使うと，再帰的な操作が可能。また，平坦化のレベルを制御できる。
修飾子 levels は，”all” ですべてを平坦化する。 整数を与えるとその回数だけ再帰的に
平坦化する。 flatten(...,levels->1) は修飾子を付けない場合と同じ。
【例 】次のリストを用意する。
list=[[1,2],[3,[4,5],[6,[7,8]]],6];
このリストに対して平坦化を行なった結果は次の通り。
式 結果
flatten(list) [1,2,3,[4,5],[6,[7,8]],6]
flatten(list,levels->0) [[1,2],[3,[4,5],[6,[7,8]]],6]
flatten(list,levels->1) [1,2,3,[4,5],[6,[7,8]],6]
flatten(list,levels->2) [1,2,3,4,5,6,[7,8],6]
flatten(list,levels->3) [1,2,3,4,5,6,7,8,6]
flatten(list,levels->"all") [1,2,3,4,5,6,7,8,6]
7.5 要素の整列
逆順にする: reverse(<list>)
<list> の要素を逆順にする。
並べ替え: sort(<list>)
次の順序で要素を並べる。
ブール値 ¡数 ¡ 文字列 ¡ リスト
30

### Page 31

並べ替え: sort(<list>, <expr>) ：実行変数は #
並べ替え: sort(<list>, <ver>,<expr>) ：実行変数を ver に指定する
リストの各要素を <expr> の内容によって評価し，その結果に従って並べ替える。
リストの要素を単一化した集合(set) を作る: set(<list>)
リストのすべての要素を分類し，同一のものを取り除いて並べ替える。すなわち，リスト
をオブジェクトの集合とみなして唯一の表現にする。
【例 】 式 結果
reverse([1, 2, 3, 4]) [4, 3, 2, 1]
sort([4.5, 1.3, 6.7, 0.2]) [0.2, 1.3, 4.5, 6.7]
sort(["one","two","three","four","five"]) ["five","four","one","three","two"]
sort([-4.5, 1.3, -6.7, 0.2], abs(#)) [0.2, 1.3, -4.5, -6.7]
sort(["one","two","three","four"],length(#)) ["one","two","four","three"]
set([3, 5, 2, 4, 3, 5, 7]) [2, 3, 4, 5, 7]
set([3, 5, 2]++[4, 5, 2]) [2, 3, 4, 5]
7.6 要素の総和・積
総和関数
sum(<list>) 要素の総和を求める。
sum(<list>,<expr>) 各要素に <expr> を実行した結果の総和を求める。
実行変数は#
sum(<list>,<var>,<expr>) sum(<list>,<expr>)で実行変数を<var>とする。
積関数
product(<list>) 要素をすべて掛け合わせる。要素は数であることが前提。
product(<list>,<expr>) 各要素に <expr> を実行した結果をすべて掛け合わせる。
実行変数は#
product(<list>,<var>,<expr>) product(<list>,<expr>)で実行変数を<var>とする。
【例 】 式 結果
sum(1..10) 55
sum([4,6,2,6]) 18
sum([[3, 5], [2, 5], [5, 6]]) [10, 16]
sum(["h","e","ll","o"] ”hello”
sum(1..100,#^2) 338350
31

### Page 32

product(1..5) 120
応用例
average(x) := sum(x)/length(x) で平均を計算する関数が定義できる。xはリスト。
fac(x) := product(1..x) で階乗を計算する関数が定義できる。xは自然数。
7.7 最大と最小
最大値関数
max(<list>) 要素の最大値を求める。
max(<list>,<expr>) <expr> をリストのすべての要素に実行した結果の最大値
実行変数は#
max(<list>,<var>,<expr>) max(<list>,<expr>)で実行変数<var>にする。
最小値関数
min(<list>) 要素の最小値を求める。
min(<list>,<expr>) <expr> をリストのすべての要素に実行した結果の最小値
実行変数は#
min(<list>,<var>,<expr>) min(<list>,<expr>)で実行変数を<var>にする。
8 ベクトルと行列
ベクトルや行列はリストで表現される。幾何学要素の座標もリストで表現される。した
がって，これらの間での計算は，リストとしての計算で行われる。
8.1 ベクトルと行列の定義
数のリストは”数ベクトル” と呼ばれる。あるリストが数ベクトルかどうかは
isnumbervector 関数によって確かめられる。
リストの要素がまたリストであり，しかもそれらがすべて同じ長さであれば，そのよう
なリストは 行列と呼ばれる。あるリストが行列であるかどうかは， ismatrix 関数によって
確かめられる。さらに，行列の個々の要素がすべて数であれば，この行列は数行列と呼ばれ
る。ある行列が数行列かどうかは isnumbermatrix関数によって確かめられる。行列の要素
は同じ長さのベクトルとも考えられ，このようなベクトルは行列の行ベクトルである。した
がって，行列が n 個の，長さ mの行ベクトルからなるならば， n × m 行列である。
32

### Page 33

8.2 和と積
リストが同じ形を持つときは，加法と減法ができる。これは，リストが同じ長さでいくつ
かの要素がやはり同じようなリストであれば，和・差に対応する要素は同じ形になるという
ことである。
リストのかけ算は，数学的に意味があれば許される。次の表は，かけ算が許される場合に
ついてまとめたものである。
要素１ 要素２ 結果 意味
数 数 数 通常のかけ算
数 長さ r のベクトル 長さ r のベクトル ベクトルの実数倍
長さ r のベクトル 数 長さ r のベクトル ベクトルの実数倍
長さ r のベクトル 長さ r のベクトル 数 ベクトルの内積
n × r 行列 長さ r のベクトル 長さ n のベクトル 行列×列ベクトル
長さ n のベクトル n × r 行列 長さ r のベクトル 行ベクトル × 行列
n × r 行列 r× m 行列 n × m 行列 行列の積
8.3 ベクトルと行列の演算
行列の次数 matrixrowcolum(<matrix>)
行と列の数を，2つの数の要素からなるリストとして返す。
転置行列 transpose(<matrix>)
転置行列を返す。
行列の行抽出 row(<matrix>,<整数>)
<整数> 番目の行をベクトルとして返す。
行列の列抽出 column(<matrix>,<整数>)
<整数> 番目の列をベクトルとして返す。
小行列 submatrix(<matrix>,<整数1>,<整数2>)
第<整数1> 列と 第<整数2> 行を削除した小行列を返す。
ベクトルから行列への変換 rowmatrix(<vector>)
ベクトルを１行とする行列を返す。
ベクトルから行列への変換 columnmatrix(<vector>)
ベクトルを１列とする行列を返す。
零ベクトルの生成 zerovector(<整数>)
長さが <整数> の零ベクトルを作る。
零行列の生成 zeromatrix(<整数1>,<整数2>)
33

### Page 34

<整数1> 行 <整数2> 列の零行列を作る。
【例 】 式 結果
matrixrowcolumn([[1,2],[3,2],[1,3],[5,4]]) [4,2]
transpose([[1,2],[3,2],[1,3],[5,4]]) [[1,3,1,5],[2,2,3,4]]
transpose([[1],[3],[1],[5]]) [[1,3,1,5]]
transpose([[1,3,1,5]]) [[1],[3],[1],[5]]
row([[1,2],[3,2],[1,3],[5,4]],2) [3,2]
column([[1,2],[3,2],[1,3],[5,4]],2) [2,2,3,4]
submatrix([[1,2,4],[3,2,3],[1,3,6],[5,4,7]],2,3) [[1,4],[3,3],[5,7]]
rowmatrix([1,2,3,4]) [[1,2,3,4]]
columnmatrix([1,2,3,4]) [[1],[2],[3],[4]]
8.4 線形代数の演算
正方行列の行列式 det(<matrix>)
ベクトルの大きさ |vec|
２つのベクトルの距離 |<ベクトル1>,<ベクトル2>|
ベクトルの距離 dist(<ベクトル1>,<ベクトル2>)
エルミート内積 hermiteanproduct(<ベクトル1>,<ベクトル2>)
正方行列の逆行列 inverse(<matrix>)
余因子行列 adj(<matrix>)
固有値 eigenvalues(<matrix>)
固有ベクトル eigenvectors(<matrix>)
１次方程式の解 linearsolve(<matrix>,<vector>)
または linearsolve(<matrix>,<matrix>)
エルミート内積は内積 <ベクトル 1>*<ベクトル 2>と似ているが，２番目のベクトルは掛
けられる前に，共役複素数にされる。特に， hermiteanproduct(a,a) は常に非負。
次のコードは，内積とエルミート内積の違いを示す。
a=[2+3*i,1-i];
println(hermiteanproduct(a,a));
println(a*a);
結果は次の通り。
34

### Page 35

15
-5 + i*10
inverse(<matrix>)は，逆行列を持たない場合は，未定義のオブジェクトを返す。
eigenvalues(<matrix>) の結果は値のリストとして返される。n 次の正方行列からは n
個の固有値を返す。実数の行列であっても，固有値は複素数の範囲で求めるのが普通。
【例】
m1=[[1,1,0],[0,1,0],[0,0,.5]];
println(eigenvalues(m1));
m2=[[1,1,0],[-1,1,0],[0,0,.5]];
println(eigenvalues(m2));
結果は次の通り
[1,1,0.5]
[1 + i*1,1 - i*1,0.5]
eigenvectors(<matrix>)は，正方行列の固有ベクトルの基底を計算する。結果としてベ
クトルのリストを返す。 このリストの順序は， eigenvalues 関数における固有ベクトルの
順序と同じ。もし，行列が対角化可能でない場合は，この結果は意味がない。
linearsolve(A,b) は，方程式 Ax=b の解 x を計算する。 行列 A は正方行列で逆行列を
持たなければならない。 b は n 次のベクトルか， n 行の行列。 A が逆行列を持たないか，
次数が合わない場合は未定義値を返す。
【例】
m=[[1,1,0],[0,1,0],[0,1,1]];
x=linearsolve(m,[2,3,4]);
println(x);
println(m*x);
結果は次の通り。
[-1,3,1]
[2,3,4]
8.5 3 次元の凸多面体を作る
convexhull3d(<ベクトルのリスト>)
この関数は，３次元ベクトルのリストを与えると凸多面体を作る。戻り値は２つのリスト
35

### Page 36

からなるペア。第１の要素は凸多面体の頂点リスト，第２の要素は面リスト。それぞれの面
は第１要素の頂点によって与えられる。
【例】 次の点のリストは，立方体の頂点と中心を示すリストである。
[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1]
,[-1,1,-1],[-1,-1,1],[-1,-1,-1],[0,0,0]]
このリストに convexhull3d 関数を適用すると，次の出力を得る。
[ [[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1],[-1,1,-1],[-1,-1,1],[-1,-1,-1]],
[[6,5,1,2],[3,1,5,7],[3,4,2,1],[8,7,5,6],[8,6,2,4],[8,4,3,7]] ]
9 幾何学要素へのアクセス
9.1 要素にその名前でアクセスする
すべての幾何学要素には個々の名前 (識別子) がある。CindyScript において，幾何学要素
はあらかじめ定義された変数として扱われる。それぞれのパラメータは . (ドット) 演算子に
よって読み書きできる。例えば，次のコードでは，点 Aの大きさを20に設定する。
A.size=20
もし，点や線（の名前）が算術関数に含まれるときは，自動的にその位置を表すベクトル
に変換される。 点は 2 次元座標で表される [x,y] ベクトルに変換される。直線は，同様に
同次座標で表される[x,y,z] ベクトルに変換される。しかし，座標を設定する場合は，ドッ
ト演算子を用いて明示的に設定されなければならない。幾何学要素が算術関数で使われない
のであれば，依然として幾何学的要素として扱われます。この概念が微妙なので，少し例を
挙げてはっきりさせておこう。
A と B , C がCinderella の点であると仮定する。次のコードは A を線分 BC の中点に設
定する。
A.xy=(B+C)/2
この2点B,Cは算術関数に含まれるので，[x,y] ベクトルとして処理される。しかし，点
A の位置は .xy パラメータによって明示的に設定されなければならない。
次のコードでは３つの点の色をすべて緑色にする。
pts=[A,B,C];
36

### Page 37

forall(pts, p, p.color=[0,1,0]);
このコードでは，点の名前はリスト pts へのハンドルとしてそのまま扱われる。 forall
関数で走査されたハンドルは一度変数 p に代入され，そこから色のパラメータにアクセスさ
れる。
9.2 幾何学要素のリスト
Cinderella で作図した幾何学要素をリストアップするような場合，次のような要素のリス
トを返す関数が使える。
allmasses allsprings
すべての点のリスト allpoints()
すべての直線のリスト alllines()
すべての線分のリスト allsegments()
すべての円のリスト allcircles()
すべての円錐曲線のリスト allconics()
すべての質点のリスト allmasses()
すべてのバネのリスト allsprings()
他の要素に付随する要素のリスト allsegments(<幾何要素>)
【例】 次のスクリプトは，y 軸 の左右で点の色を変える。
pts=allpoints();
forall(pts,p,
if(p.x<0, p.color=[1,1,0], p.color=[0,1,0]);
);
9.3 幾何学要素のパラメータ
ドット演算子によってアクセスできるパラメータ。以下の表において，パラメータの型は
次の通り。
real：実数
int：整数
bool：true または false
string：文字列
2-vector： 2次元ベクトル
37

### Page 38

3-vector： 3次元ベクトル
3x3-matrix： 3行3列行列
すべての幾何学要素についてのパラメータ
名前 読み出し 書き込み 型 目的
color 可 可 3-vector オブジェクトの色 (赤, 緑, 青)
colorhsb 可 可 3-vector オブジェクトの色 (色相, 彩度, 輝度)
isshowing 可 可 bool オブジェクトの表示/非表示
visible 可 可 bool オブジェクトの表示/非表示
alpha 可 可 real オブジェクトの透明度
labelled 可 可 bool ラベルの表示/非表示
name 可 不可 string オブジェクトの名称
caption 可 可 string オブジェクトのラベル
trace 可 可 bool 軌跡(足跡)の表示/非表示
tracelength 可 可 int 足跡の長さ
selected 可 可 bool オブジェクトが選択されているかどうか
パラメータの書き込みは，時には自由要素に限られることがある。該当する項で ”free” の
語を使ってそれを表す。
それぞれの幾何学要素は個別の識別名を持つ。識別名は.name パラメータによってアクセ
スできる。たとえば， A.name は文字列 ”A” を返す。その名前は，画面上に表示される ラ
ベル (caption) とは異なる場合がある。ラベルが設定されていなければ A.caption は空の
文字列。また，ラベルはインスペクタで変更することができる。
isshowing と visible の違いは，isshowing ではオブジェクトに依存するすべての要素に引
き継がれるのに対し，visible では従属するオブジェクトからは引き継がれない点。
直線のパラメータ
名前 読み出し 書き込み 型 目的
homog 可 free 3-vector 直線の同次座標
angle 可 free real 直線の角度
slope 可 free real 直線の傾き
size 可 可 int 直線の幅 (0 から 10))
点のパラメータ
38

### Page 39

名前 読み出し 書き込み 型 目的
x 可 free real 点のx座標
y 可 free real 点のy座標
xy 可 free 2-vector 点のxy 座標
coord 可 free 2-vector 点のxy 座標
homog 可 free 3-vector 点の同次座標
angle 可 free real 円周上の点の角度(円周上の点にのみ適用)
size 可 可 int 点の大きさ (0 から 40)
imagerot 可 可 real 点が画像で置き換えられている場合，回転角度
円と円錐曲線(２次曲線)
名前 読み出し 書き込み 型 目的
center 可 free real 円の中心
radius 可 free real 円の半径
matrix 可 不可 real 円または二次曲線を記述する行列
size 可 可 int 線の幅 (0 から 10)
テキストのパラメータ
名前 読み出し 書き込み 型 目的
text 可 可 string 文字列の内容
pressed 可 可 boolean 文字列の状態。ボタンならばtrue
xy 可 可 2-vector 文字列の位置
アニメーションのパラメータ
名前 読み出し 書き込み 型 目的
run 可 可 bool アニメーションの実行/非実行
speed 可 可 real アニメーションの相対的な速さ
変換のパラメータ
名前 読み出し 書き込み 型 目的
matrix 可 不可 3x3 matrix 変換の同次行列
inverse 可 不可 3x3 matrix 逆変換の同次行列
39

### Page 40

CindyLab オブジェクトのパラメータ
すべての CindyLab 要素のパラメータ
名前 読み出し 書き込み 型 目的
simulate 可 可 bool オブジェクトがシミュレーションに加わるかどうか
質点のパラメータ
名前 読み出し 書き込み 型 目的
mass 可 可 real オブジェクトの質量
charge 可 可 int オブジェクトの電荷
friction 可 可 real オブジェクトの摩擦
radius 可 可 real 質点を球とみなすときの半径
posx 可 可 real 質点のx座標
posy 可 可 real 質点のy座標
pos 可 可 2-vector 質点の位置ベクトル
vx 可 可 real 速度のx成分
vy 可 可 real 速度のy成分
v 可 可 2-vector 速度ベクトル
fx 可 不可 real 粒子にかかる力のx成分
fy 可 不可 real 粒子にかかる力のy成分
f 可 不可 2-vector 粒子にかかる力のベクトル
kinetic 可 不可 real 粒子の運動エネルギー
ke 可 不可 real 粒子の運動エネルギー
質点間に力を定義したい場合がある。そのときは Integeration Tick スロットにコードを
書く。質点の位置が内部的に通常の幾何学要素と異なるタイムスケールで動くときは pos,
posx および posy によってその位置にアクセスする必要がある。
バネとクーロン力のパラメータ
40

### Page 41

名前 読み出し 書き込み 型 目的
l 可 不可 real バネの現在長
lrest 可 不可 real バネの自然長
ldiff 可 不可 real 現在の長さと自然長との差
strength 可 可 real バネ定数
f 可 不可 real バネにかかる力
amplitude 可 可 real 振幅
speed 可 可 real 運動の速さ
phase 可 可 real 運動の段階（位相）(0.0 〜 1.0)
potential 可 不可 real バネのポテンシャルエネルギー
pe 可 不可 real バネのポテンシャルエネルギー
速度のパラメータ
名前 読み出し 書き込み 型 目的
factor 可 可 real 図で表されている速度と実際の速度との掛け率
重力のパラメータ
名前 読み出し 書き込み 型 目的
strength 可 可 real 重力場の強さ
potential 可 不可 real 重力場におけるすべての質点のポテンシャルエネルギー
pe 可 不可 real 重力場におけるすべての質点のポテンシャルエネルギー
恒星のパラメータ
名前 読み出し 書き込み 型 目的
mass 可 可 real 恒星の質量
potential 可 不可 real 恒星の場におけるすべての質点のポテンシャルエネルギー
pe 可 不可 real 恒星の場におけるすべての質点のポテンシャルエネルギー
電磁場のパラメータ
名前 読み出し 書き込み 型 目的
strength 可 可 real 電磁場の強さ
friction 可 可 real 磁力のかかるフィールドでの摩擦
41

### Page 42

床と反射壁のパラメータ
名前 読み出し 書き込み 型 目的
xdamp 可 可 real x方向の吸収率
ydamp 可 可 real y方向の吸収率
環境のパラメータ
環境は内蔵関数の simulation() によって次の項目がアクセスできる。
名前 読み出し 書き込み 型 目的
gravity 可 可 real 全体にかかる重力
friction 可 可 real 全体にかかる摩擦力
kinetic 可 不可 real 全体的な運動エネルギー
ke 可 不可 real 全体的な運動エネルギー
otential 可 不可 real 全体的なポテンシャルエネルギー
pe 可 不可 real 全体的なポテンシャルエネルギー
9.4 インスペクタの要素
inspect 属性のリスト: inspect(<幾何要素>)
【例】 点Aが描かれているとき，inspect(A) とすれば，次のようなリストが返される。
[name,definition,color,visibility,drawtrace,tracelength,traceskip,tracedim,render,isvisible,
text.fontfamily,pinning,incidences,labeled,textsize,textbold,textitalics,ptsize,pointborder,
printname,point.image,point.image.rotation,freept.pos]
属性の読み出し: inspect(<幾何要素>,<文字列1>)
【例】 inspect(A,"text.fontfamily") とすれば
SansSerif
が返される。
属性の設定: inspect(<幾何要素>,<文字列1>,<文字列2>)
変更可能な属性の値を設定する。
【例】 Aのフォント Serif に設定する。
inspect(A,"text.fontfamily","Serif")
ユーザー属性の設定: attribute(<幾何要素>,<文字列1>,<文字列2>)
<幾何要素> の属性を <文字列1> と <文字列2>で設定する。
42

### Page 43

ユーザー属性の取得: attribute(<幾何要素>,<文字列>)
<文字列> で定義される幾何要素 <幾何要素> のユーザー属性を取得する。
この２つのユーザー属性に関する関数はVisage で主に使用する。
9.5 要素の作成と消去
createpoint 自由点を作る: createpoint(<文字列>,<位置>)
この関数は <文字列> を識別名とする点を <位置> に作る。すでに同じ名前の点がある場
合には新しく作らず，単に指定した位置に移動する。
create 幾何要素を作る: create(<リスト1>,<文字列>,<リスト2>)
この関数は，任意の幾何要素を作る。アルゴリズムがいくつか微妙な点を引き起こすので，
特別な用途に限られる。
第１引数の <リスト 1>は生成する要素の名前のリスト。第２引数の <文字列> は幾何学的
なアルゴリズムの内部的な名前。第３引数の <リスト2> は，定義のために必要なパラメータ
のリスト。
【例】
create(["A"],"FreePoint",[[1,1,1]]);
create(["B"],"FreePoint",[[4,3,1]]);
create(["a"],"Join",[A,B]);
create(["X"],"CircleMP",[A,B]);
create(["Y"],"CircleMP",[B,A]);
create(["P","Q"],"IntersectionCircleCircle",[X,Y]);
create(["b"],"Join",[P,Q]);
create(["M"],"Meet",[a,b]);
この一連のコードで，次の図のように幾何要素を作る。６番目の命令で円の交点を作ると
き，２つの点の名前のリストがなければならない。
43

### Page 44

removeelement 幾何要素の消去: removeelement(<幾何要素>)
幾何要素を，それに関連するものも含めて消去する。
inputs 幾何要素を構成する要素: inputs(<幾何要素>)
幾何要素 を定義するために必要な要素のリストを返す。
algorithm 幾何要素の作図手順: algorithm(<幾何要素>)
この関数は<幾何要素>の作図手順を文字列で返す。
【例】次のスクリプトはすべての要素に対してその作図手順を示す。
els=allelements();
data=apply(els,([[#.name],algorithm(#),inputs(#)]));
たとえば，垂直二等分線の作図手順が次のように出力される。
[[["A"],"FreePoint",[[4,4,-4]]],
[["B"],"FreePoint",[[4,-3,1]]],
[["a"],"Join",[A,B]],
[["C"],"Mid",[A,B]],
[["b"],"Orthogonal",[a,C]]
]
9.6 幾何要素の操作
自由要素を動かす: moveto(<幾何要素>,<位置>)
この関数では<幾何要素>に幾何の自由要素を，<位置>にこれを動かしたい位置を記述する。
この関数によって自由要素の動きをシミュレートする。
<幾何要素>が自由点であれば，<位置>は2つの数のリスト [x,y]（ユークリッド座標）か
44

### Page 45

３つの数のリスト [x,y,z] （同次座標）。
<幾何要素>が自由直線であれば，<位置>は３つの数のリスト[a,b,c] でなければならず，
直線 ax+by +c = 0 に設定される。
【例】 次のコードは，幾何の要素をどのように動かせるかをまとめたものである。要素の
データに直接アクセスして動かすものも含む。
// A は自由点
moveto(A,[1,4]); //点Aをユークリッド座標(1,4)に置く
A.xy=[1,4]; //点Aをユークリッド座標(1,4)に置く
A.x=5; // A のx座標を 5 にする。y座標は変化しない
A.y=3; //A のy座標を 3 にする。x座標は変化しない
moveto(A,[2,3,2]); // A を同次座標 [2,3,2] に置く
A.homog=[2,3,2]; // A を同次座標 [2,3,2] に置く
// a は自由曲線
moveto(a,[2,3,4]); // a を同次座標 [2,3,4]に置く
a.moveto=[2,3,4]; // a を同次座標 [2,3,4]に置く
// b は傾きつき直線
a.slope=1; // 傾きを 1 にする
// C は半径が自由な円
C.radius=1; // 半径を 1 にする
動いた要素: mover()
この関数は，マウスによって今動かされた要素が何であるか(そのハンドル) を返す。
マウスのあるところの要素: elementsatmouse()
この関数は，現在マウスカーソルの近くにある要素のリストを返す。
【例】 次のスクリプトを Mouse Move スロットに置いて実行すると，マウスカーソルの近く
にある要素が消える。マウスカーソルが遠ざかればまた現れる。
apply(allelements(),#.alpha=1);
apply(elementsatmouse(),#.alpha=0);
repaint();
オブジェクトへのインシデント:incidences(<幾何要素>)
45

### Page 46

この関数は，幾何要素 とインシデントなすべての要素のリストを返す。
軌跡上の点: locusdata(<軌跡>)
この関数は，<軌跡> によって与えられる軌跡上の点の xy 座標のリストを返す。
その名前の要素を取り出す: element(<文字列>)
この関数は， <文字列> の名前の幾何要素を返す。
【例】element 関数は，要素名が無効であるか，あるいはすでに使われているような場合
に使われる。たとえば，i という名前の直線の色にアクセスしようとすると，i は虚数単位の
名前として予約されているので， i.color=[1,1,1] と書くことはできない。このような場
合，次のように書く。
element("i").color=[1,1,1]
再描画をする: repaint()
この関数は描画している図を強制的に再描画する。これは，スクリプトが図の更新を必要
とするときに実行される。この関数は draw あるいは move スロットにおいてはいけない。
再描画その２: repaint(<real>)
repaint 命令を，パラメータで与えられたミリ秒だけ遅らせて実行する。
10 図形の描画
10.1 修飾子
描画関数では，色や大きさなどをオプションとして与えることができる。これを「修飾子」
と呼んでいる。次のような修飾子があり，関数によって使えるものは異なる。修飾子はコン
マで区切って，draw([1,1],size->8,color->[1,1,0] ) のように指定する。
46

### Page 47

修飾子 型 効果
pointsize <real> 点の大きさを設定する。
linesize <real> 線の幅を設定する
size <real> 点の大きさと線の幅を設定する
pointcolor [R,G,B] RGB 値による点の色を設定する
linecolor [R,G,B] RGB 値による線の色を設定する
color [R,G,B] RGB 値による点と線の色を設定する
alpha <real> 透明度を設定する
noborder <bool> true なら点の境界線の表示をしない
border <bool> true なら点の境界線の表示をする
dashtype <real> 破線パターンを０から４で指定する
dashing <real> 破線を描く。与えた数により細かさが変わる
dashpattern <list> 個別の破線パターンを指定する
10.2 色や大きさの設定
色の設定
色は，赤/緑/青 (R/G/B) の 3 つの実数のリストで指定する。それぞれの値は 0 から 1 ま
でで，0が最も暗く1が最も明るくなる。ある実数が色のコードと解釈される場合，0以下の
数は0に，1以上の数は1に置き換えられる。
初期状態の色は，
pointcolor(<colorvec>),
linecolor(<colorvec>),
textcolor(<colorvec>)
の3つの関数で設定できる。さらに， color(<colorvec>) 関数はすべてのオブジェクト
の色を同時に設定する。
個々に色を指定するときは，修飾子 color->[R,G,B] を用いる。
【例】
pointcolor([0,1,1]); これ以降，点の色を水色（シアン）にする。
draw([2,2],color->[1,1,0]); 座標 [2,2]に黄色で点を打つ。
drawtext([2,2],"注意",color->[1,0,0]座);標 [2,2]に赤で「注意」と表示する。
透明度の設定
透明度は 0 から 1 までの実数で指定する。ここで，0 は完全に透明で，1 は完全に不透
47

### Page 48

明になる。 この範囲外の値は 0 か 1 のどちらかに設定される。初期状態の透明度は，関数
alpha(<数>) によりすべての要素に設定される。個々に設定する場合は，拡張子 alpha->
数 を用いる。
【例】
alpha(0.5); これ以降，透明度を0.5にする。
draw([2,2],alpha->0.8); 座標 [2,2]に透明度0.8で点を打つ。
大きさの設定
初期状態の大きさは pointsize(<数>), linesize(<数>), textsize(<数>) の３つ
の関数で設定できる。大きさは，実数で指定する。点と線の大きさは 1 から 20 までの整数
で，ピクセルのサイズ。
個々に大きさを指定するときは，修飾子 size->数 を用いる。
【例】
textsize(24); これ以降，文字の大きさを24にする。
draw([2,2],size->8); 座標[2,2]に大きさ８の点を打つ。
drawtext([2,2],"文字",size->36); 座標[2,2]に大きさ36で文字を表示する。
10.3 色の関数
次の関数は，指定した輝度の色コード（[R,G,B]）を返す。たとえば，red(0.8) は
[0.8,0,0]
赤色： red(<数>)
緑色： green(<数>)
青色： blue(<数>)
灰色： gray(<数>)
虹色 ：hue(<数>)
hue は，すべての色のうちの一つを表す色コードを作る。 <数> は 0 から 1 までの数で色
相環の範囲を表す。1 より大きな値の場合には，色相環を何周かして色を決める。次のコー
ドと実行結果はその例。
n=360;
ind=(1..n)/n;
linesize(2);
forall(ind,
color(hue(#));
draw((0,0),(sin(#*2*pi),cos(#*2*pi)));
);
48

### Page 49

10.4 描画関数
点を描く: draw(<expr>)
draw([x,y]) は点 [x,y] に点を打つ。draw([x,y,z]) は同次座標が [x,y,z] である点
を打つ。
[x,y,z] が点の同次座標であるとき，対応する点は， xy-座標が [x/z,y/z] の点。 z=0
の点は ”無限遠点” 。この無限遠点は，Cinderella の通常のユークリッド表示では見えない
が，球面表示や局所的に射影基底が設定されている場合は表示される。
線分・直線を描く: draw(<expr>,<expr>)
引数に２点を与えると，線分を描く。この２点はリストにしてもよく，座標はユークリッ
ド座標でも，同次座標でもよい。
作図した幾何点の識別子を点の座標として用いることもできる。
直線を描くには同次座標を用いる。3 つの実数 [a,b,c] で表される直線は，方程式
a∗x+b∗y +c = 0 で表されるものと考えることができる。 ユークリッド座標 [x,y] の
点は，この方程式を満たすときに限りこの直線上にある。同次座標 [x,y,z] の点は，方程式
a∗x+b∗y +c∗z = 0 を満たすときに限りこの直線上にある。
3つの実数 [a,b,c]が点を表すのか直線を表すのかをCindyScript が知るために，直線が
引かれた場合には内部フラグが立つようになっている。たとえば， join(A,B) 命令は，2点
A と B を通る直線を計算して，直線であるという内部フラグを立てる。その結果，直線が引
かれる。関数 line() を使うことによって，直線のフラグを強制的に立てることもできる。
【例】２点 A(1,1) と B(4,5) を作図してあるとする。次の描画命令はいずれも２点 [1,1] と
[4,5]を結ぶ線分を描く。
draw([1,1],[4,5]);
draw([[1,1],[4,5]]);
draw(A,B);
draw([A,B]);
【例】次の２つの描画命令はいずれも直線を描く。
draw(line([1,1,0.5]));
draw(join([1,2],[2,-1]));
【例】線分（直線）では，修飾子によって幾つかの線種が扱える。次はその例。
draw([0,0],[0,6],dashtype->0);
draw([1,0],[1,6],dashtype->1);
49

### Page 50

draw([2,0],[2,6],dashtype->2);
draw([3,0],[3,6],dashtype->3);
draw([4,0],[4,6],dashtype->4);
draw([6,0],[6,6],dashing->4);
draw([7,0],[7,6],dashing->6);
draw([8,0],[8,6],dashing->8);
draw([9,0],[9,6],dashing->10);
draw([11,0],[11,6],dashpattern->[0,4,2,4]);
draw([12,0],[12,6],dashpattern->[0,2,2,2,4,2]);
draw([13,0],[13,6],dashpattern->[0,4,2,4]);
draw([14,0],[14,6],dashpattern->[4,2,1,2]);
リストのオブジェクトを描画する: drawall(<list>)
draw() 関数で描画する点・線分をリストにして描画することができる。これにより，
repeat()で繰り返しを行うことなく，まとめて描画できる。
【例】次のコードは，正 17 角形の辺と対角線をすべて描く。２行目で単位円上に点を打つ関
数を定義する。 ３行目は，変数 steps を単位円を 17 等分する角度のリストとする。これら
に対応する点が，変数 pts に４行目でリストとして代入され，５行目で，変数 segs を pts の
すべてのペアのリストとする。最後の２つの行で２つのリストにある点と線分を描く。
n=17;
f(x):=[sin(x),cos(x)];
steps=2*pi*(1..n)/n;
pts=apply(steps,f(#));
segs=pairs(pts);
drawall(segs,alpha->0.9);
drawall(pts,size->4);
点をつなげる: connect(<list>)
この関数は，点のリストを受け取って，それらを順に結んだ線分を描く。
多角形を描く: drawpoly(<list>)
この関数は，点のリストを受け取り，点を順に結んだ多角形を描く。点のリストは閉じて
いる必要はなく，自動的に閉じて描く。たとえば，draw([A,B,C]) とすると，A,B,C,A を
この順に結んで多角形とする。使える修飾子は color と alpha。size は使えないので，線
の太さを指定したい場合は，閉じたリストにして connect()を用いる。
50

### Page 51

中を塗った多角形を描く: fillpoly(<list>)
この関数は，点のリストを受け取って中が塗られた多角形を描く。使える修飾子は color
と alpha。
円を描く: drawcircle(<点>,<半径>)
<点> を中心とする半径 <半径> の円を描く。点の座標はユークリッド座標か同次座標で与
える。
円盤を描く: fillcircle(<点>,<半径>)
<点> を中心とする，半径 <半径> の，内部を塗りつぶした円を描く。点の座標はユーク
リッド座標か同次座標で与える。使える修飾子は color と alpha。
11 関数プロット
CindyScript には，数学的な関数をプロットするいくつかの関数がある。簡単な関数のプ
ロットの他に，極値，零点，変曲点に関する情報も表示できる。
11.1 実数関数のグラフを描く
関数のプロット: plot(<expr>)
plot 関数は，関数をプロットするのに使う。 <expr> に関数式を与える。この式は実行変
数 # を含まなくてはならず，実数の入力値 # に対して，ひとつの実数か2次元ベクトルを計
算します。一つの実数の場合には， plot 関数は単純な関数のグラフを描く。ベクトルの場
合には，媒介変数形のグラフを描く。座標系は，幾何の表示画面の座標系に依存する。 # の
代わりに他の実行変数を使うことができる。自由変数が一つだけあればそれを実行変数と見
なす。複数の自由変数がある場合は， x, y, t, z の順に探して実行変数とみなす。
関数を定義しておいてそのグラフを描くこともできる。
plot(sin(#));
plot(sin(x)); plot(sin(#))と同じ結果になる
f(x):=2*sin(x); plot(f(#)); f(x)で定義したグラフを描く
plot([2*cos(t),3*sin(t)]); 媒介変数表示で楕円を描く
媒介変数表示の場合，変数の値の初期値は0から100。この範囲は，修飾子 start , stop に
よって指定できる。
plot() 系の関数では次の修飾子が使える。曲線の外観に関するもの，定義域や解像度に関
するもの，特別な点のマーク，線種がある。
51

### Page 52

修飾子 型 効果
外観の表現
color [R,G,B] 色を設定
size <real> 線の幅を設定
alpha <real> 不透明度を設定
connect <real> 関数値の飛んでいるところをつなぐ
繰り返しの制御
start <real> 描き始めの値を設定
stop <real> 描き終わりの値を設定
steps <real> プロットする点の間隔 (媒介変数のみ)
pxlres <real> 曲線をプロットする解像度 (real 関数のみ)
特別な点
extrema <bool> すべての極値をマークする
extrema [R,G,B] すべての極値を指定した色でマークする
minima <bool> すべての極小値をマークする
minima [R,G,B] すべての極小値を指定した色でマークする
maxima <bool> すべての極大値をマークする
maxima [R,G,B] すべての極大値を指定した色でマークする
zeros <bool> すべての零点をマークする
zeros [R,G,B] すべての零点を指定した色でマークする
inflections <bool> すべての変曲点をマークする
inflections [R,G,B] すべての変曲点を指定した色でマークする
破線
dashing <real> 破線パターンの幅 (初期値 5)
dashtype <int> 特定の破線タイプ ( 値は0から4まで)
dashpattern <list> 個々の破線パターンを指定する
定義域
定義域の左端と右端を決める，start , stop は幾何点で制御することもできる。
点A,Bをx軸上に置き，次のスクリプトでグラフを表示すれば，点をドラッグしてインタ
ラクティブに定義域を変えることができる。
plot(f(#),start->A.x,stop->B.x)
52

### Page 53

プロットの解像度
グラフのプロットは，定義域を分割して点の座標を計算して線分でつないでいる。媒介変
数表示の場合は，この間隔を steps で変更できる。分割数が大きくなると解像度が高くなる。
また，pxlres 修飾子はこの解像度の指定だが，plot() 関数は解像度を自動的に調整し，特
異点の近くでは解像度を高めるようになっている。次の例は plot(sin(1/#)*#) の結果を
示すが，原点付近での解像度が高くなっている。
pxlres 修飾子は，colorplot() 関数で有用になる。
不連続点を結ぶ
通常は，関数値が飛んでいるところが発見されても，初期状態ではその点は結ばれない。
ノコギリ波のようにそれらの点を結ぶときには connect->true という修飾子を使う。次の
例は，plot(x-floor(x),connect->true) で，f(x) = x−|x| のグラフの不連続点を結
んだもの。
特異点の表示
修飾子を用いて，零点，極大値，極小値，変曲点を表示することができる。たとえば，
extrema->true とすると，すべての極値を点で表示する。点の色を指定する場合は
extrema->[R,G,B] とする。
線種
線分の線種と同様に，関数プロットでも dashtype などの修飾子で線種を指定できる。
関数のプロット その２: plot(<expr>,<var>)
53

### Page 54

実行変数を指定してプロットする。実行変数として有効な変数を２つ以上含む式のとき，
どの変数についての関数かを指定できる。
11.2 動的な色と透明度
関数プロットの色と透明度は，関数値によって変化させることができる。次の図は
plot(sin(x),color->hue(x/(2*pi)),size->3)
の実行例。ここで，周期的な虹色を作るために hue を使っている。
積分イメージのプロット: fillplot(<expr>)
積分の説明などで関数のグラフと x 軸の間をハイライトさせたいときに用いる。plot()
関数と同様な引数（実行変数など）を使う。最も簡単な使い方では，x軸をはさんだ部分をハ
イライトする。この関数ではグラフそのものは描かない。グラフも描きたい場合は plot() 関
数と併用するか修飾子graphを用いる。
【例】
f(x):=1/(x^2+1)*sin(4*x);
fillplot(f(x));
plot(f(x)); または fillplot(f(x),graph->true);
注意： fillplot(...) における特異点の処理は， plot() 関数ほど精密ではない。その
ため， plot() での修飾子とは使い分ける必要がある。
この関数では通常のcolor,alphaのほかに，次の修飾子が使える。
修飾子 型 効果
pluscolor [R,G,B] 関数値が正のときの色
minuscolor [R,G,B] 関数値が負のときの色
start <real> 定義域の左端
stop <real> 定義域の右端
graph <bool> 関数のグラフも描く
graph [R,G,B] 特定の色で関数のグラフを描く
size <reall> 関数のグラフの太さ
54

### Page 55

【例】fillplot(sin(x),graph->true,pluscolor->(0.5,1,0.5),minuscolor->(1,0.5,0.5));
積分イメージのプロット: fillplot(<expr>,<expr>)
この関数は fillplot(...) と同様だが，2 つの関数のグラフではさまれた部分をハイラ
イトする。
【例】sinx とcosxのグラフで挟まれた部分を交互に色を変えて塗る。
fillplot(sin(x),cos(x),graph->true,pluscolor->(0.5,1,0.5),minuscolor->(1,0.5,0.5))
11.3 カラープロット
カラープロットは平面上の各点に，関数によって色を割り当てることができる。
場の色表現: colorplot(<expr>,<vector>,<vector>)
この関数は，関数によって長方形の各々の点に，カラーコードを割り当てる。ここでも
<expr> の関数の中で実行変数 # が使われるが，この変数は平面上の点である。 <expr> の
値は，実数か (その場合は灰色)，３つの実数のベクトル (RGB)。２番目と３番目の引数は，
描画領域の左下と右上の位置を決定する。
【例】 次のコードと２点Ａ, Ｂは右の図を描く。１行目で２点間の距離の正弦を計算する関
数を定義する。(値は区間[0,1] に入るように縮小・シフトしている)
colorplot 関数の第１の引数は，実行変数 # から計算される色のベクトル。赤はＡからの
同心円状の波，緑は0，青はＢからの同心円状の波。最後に，ＣとＤは描画領域の長方形の２
つの頂点。
f(A,B):=((1+sin(2*dist(A,B)))/2);
colorplot((f(A,#),0,f(B,#)),C,D);
55

### Page 56

実行変数
通常は # を colorplot の実行変数として使う。しかし，別の変数を用いることもできる。
どんな変数が実行変数として使えるかは，次の順序で考える。
・<expr> の中で１つだけの自由変数が使われている場合，その変数が実行変数として解釈さ
れる。２次元ベクトルの場合もある。
・<expr> が # を含む場合， # が実行変数とされる。
・<expr> が x と yを自由変数として含む場合， ベクトル (x,y) として扱われる。
・１つの自由変数が明確に割り当てられない場合， ベクトル (x,y) が用いられる。
・上記のいずれでもない場合，点 p と複素数 z が実行変数としてチェックされる。
修飾子
colorplot 関数では3つの修飾子が扱える。 pxlres は，色をプロットする四角形のピク
セルの大きさを決定する整数。上の図は pxlres->2 の場合で，これが初期値。 pxlres を２
か１にすると精密な図ができる。 しかしながら，四角形の中のピクセルごとに，colorplot
が計算されるので，pxlres が１次関数的に減らされても計算は２次関数的に増加する。した
がって，効率を上げるためにこの修飾子を調整するとよい。
解像度を動的に変えることもできる。そのために，解像度を段階的に変える startres が
ある。たとえば， startres->16 と pxlres->1 を使うとインタラクティブな動きをする。
十分な時間があれば最もよい解像度になるように再計算をする。
さらに colorplot 関数では，透明度をコントロールする alpha 修飾子が使える。 この修
飾子は，実行変数をパラメータに用いることもできる。
【例】
f(A,B):=((1+sin(2*dist(A,B)))/2);
colorplot((f(A,#),0,f(B,#)),C,D, pxlres->4, alpha->-abs(#)+5);
56

### Page 57

CindyJS での colorplot
CindeyJS での colorplot では，矩形領域を示す点を略すと画面全体が対象となる。ま
た，pxlres は 1 である。Cinderella では矩形領域を示す点を略すことはできない。
11.4 ベクトル場
ベクトル場の描画: drawfield(<expr>)
drawfield 関数は，式 <expr> で与えられるベクトル場を描画するのに用いる。この式は
実行変数 # を含んだ２次元ベクトルである必要がある。その結果も２次元ベクトル。式を
drawfield 関数に適用すると，対応するベクトル場を描く。ベクトル場は動的である。たと
えば，画面上でマウスをドラッグすると絵が動く。したがって，drawfield 関数を Draw ス
ロットでなく "timer tick" スロットに入れるのが有効である。すると，アニメーションコ
ントローラが表示され，アニメーションを走らせると，ベクトル場が自動的に動く。実行変
数の考え方は colorplot() と同様。特に，自由変数 x と y を２次元ベクトル (x,y) とし
て使うことができる。
【例】
関数 f(x,y)=(y,sin(x)) によって定義されるベクトル場を考える。CindyScript での定
義のしかたと drawfield 関数の使い方は次の通り。
f(v):=[v.y,sin(v.x)];
drawfield(f(#));
drawfield((y,sin(x))) でも同じ図が得られる。
図を描くのに，針のような図形が画面上に描かれる。これらの針はベクトル場によって配
置される。アニメーションの間，針はベクトル場によって動く。計算時間はかかるが，針の
かわりに小さな蛇のような図形でベクトル場の印象を高めることもできる。これは，stream
修飾子で指定する。
f(v):=[v.y,sin(v.x)];
drawfield(f(#),stream->true);
57

### Page 58

修飾子
drawfield 関数は，ベクトル場の生成プロセスを制御する多くの修飾子を備えている。それ
らの理解を助けるために，どのように図が描かれるかをもう少し詳しく説明する。
図は，ベクトル場の影響を受けているいくつかのテストオブジェクトの動きを示すことで
生成される。初期状態では，テストオブジェクトは針状。それらはまず格子状に置かれる。
これは通常いくつかの副産物を発生し，格子点の周りにある半径でランダムにゆがめられる。
アニメーションの間，針は力の場の方向に動く。針の長さは場の強さを表す。
修飾子 型 効果
resolution <int> ピクセル単位での最初の格子の大きさ。
jitter <int> テストオブジェクトのゆがみ
needlesize <real> 針の最大長
factor <reak> 場の強さの拡大要素
stream <bool> 針状か流体か
move <real> オブジェクトを動かす速さ
color [R,G,B] 流体もしくは針の始めの方の色
color2 [R,G,B] 針のあとの方の色
次の図は最初の格子の様子。 move->0 と jitter->0 を指定した。垂直または水平方向か
ら不自然な配置になっている。
次の図は， resolution->5 と stream->true で描写したもの。
複素ベクトル場の描画: drawfieldcomplex(<expr>)
58

### Page 59

この関数は drawfield とよく似ている。しかし，これは入力値を１次元の複素数とする関
数である。 実部と虚部はベクトル場の x 成分と y 成分とみなされる。それ以外は，drawfield
と同様。
【例】 次は，描かれた4点によって零値が決まる複素多項式を使った例。
f(x):=(x-complex(A))*(x-complex(B))*(x-complex(C))*(x-complex(D));
drawfieldcomplex(f(#),stream->true,resolution->5,color->(0,0,0))
力の場の表示: drawforces()
この関数も drawfield とよく似ているが，今度は CindyLab における物理シミュレー
ションに関連している。引数は必要でなく，画面のいろいろな地点にある潜在的な試験電荷
による力を示す。試験電荷は，質量 1，電荷 1，半径 1。しかし，他のいかなる粒子もこれと
相互作用は起こさない。ときどき，力の場を説明するのに， factor 修飾子を使うことが必
要になる。次の図は4つの荷電粒子間の相互作用を示す。
点による力の場の描画: drawforces(<mass>)
固定された質量を持つ粒子に関して力の場を描く他の関数がある。粒子自身は力の計算に
入らない。こうして，特定の粒子に作用する力を表現することができる。
59

### Page 60

11.5 グリッド
グリッドは平面から平面への写像を視覚化するのに用いることができる。グリッドで写像
による変形が示される。
正方グリッドのマッピング: mapgrid(<expr>)
この関数は，正方グリッドをとって ¡expr¿ による関数で変形する。初期状態ではもとのグ
リッドはその平面における単位正方形とみなされる。この正方形の境界は修飾子によって変
更できる。また complex->true 修飾子によって，複素写像を視覚化できる。
修飾子
修飾子 型 効果
color [R,G,B] 色
alpha <real> 透明度
size <real> グリッド線のサイズを指定する。
xrange [<real>,<real>] もとの正方形のxの範囲
yrange [<real>,<real>] もとの正方形のyの範囲
resolution <int> 両方向のグリッド線の数
resolutionx <int> x-方向のグリッド線の数
resolutiony <int> y-方向のグリッド線の数
step <int> 両方向のステップ数
stepx <int> x-方向のステップ数
stepy <int> y-方向のステップ数
complex <bool> 複素関数を使う
【例】次のコードは mapgrid 関数の使い方の例。修飾子 xrange と yrange による効果も示
す。 x 座標と y 座標をそれぞれ２乗する２次元の関数による効果を示す。
f(v):=(v_1^2,v_2^2);
linesize(1.5);
mapgrid(f(v),color->[0,0,0]);
mapgrid(f(v),xrange->[1,2],color->[0.6,0,0]);
mapgrid(f(v),yrange->[1,2],color->[0.6,0,0]);
60

### Page 61

mapgrid(f(v),xrange->[1,2],yrange->[1,2],color->[0,0.6,0]);
次の例は，グリッドの線がまっすぐであったり平行であったりしない例。
f(v):=(v_1*sin(v_2),v_2*sin(v_1));
linesize(1.5);
mapgrid(f(v),xrange->[1,2],yrange->[1,2]);
次の例は，複素関数による mapgrid の使い方の例。
mapgrid(z^2,complex->true);
resolution 修飾子によって生成される格子の密度を指定できる。
61

### Page 62

mapgrid(z^2,complex->true,resolution->4);
初期状態では mapgrid 関数では直接格子点をつなぐ。これは数学的に正しくない図を作
るかもしれない。 step 修飾子で格子点の間に段階を追加する。
mapgrid(z^2,complex->true,resolution->4,step->5);
以上の３つのコードの結果は左から順に次の図。
11.6 オシログラフ
物理的大きさのグラフを描く: drawcurves(<vector>,<list>)
物理シミュレーションにおいて，大きさが時間とともにどのように変化するかをグラフで
示したい場合がよくある。このために， drawcurves 関数が作られた。ここで，<vector>
は表示領域の左下の角の位置を表す２次元ベクトルで， <list> は観察する値のリスト。ア
ニメーションが始まると値が更新され，対応する曲線が描かれる。
【例】次の図は drawcurves 関数の簡単な使い方を示している。 CindyLab で振り子を作っ
ている。Dは自由質点。重力を加えて振り子が動く。次のコードは，動く点Dの x 座標と x
方向の速度を曲線で表す。
drawcurves([0,0],[D.x,D.vx])
62

### Page 63

修飾子
修飾子 型 効果
width <real> プロット範囲の幅(ピクセル)
height <real> それぞれの曲線の高さ(ピクセル)
border <bool> 表の枠を表示する
back <bool> 背景を表示する
back [R,G,B] 背景を指定した色で塗りつぶす
backalpha <real> 背景の不透明度
colors [<色1>,<色2>,<色3>,...] 曲線ごとに色を指定する
texts [<文字列1>,<文字列2>,<文字列3>,...] 曲線ごとに表題を付ける
showrange <bool> 曲線の最大と最小を表示する
range <文字列> 欄外参照
range [<文字列1>,<文字列2>,<文字列3>,...] それぞれの曲線の peek/auto
range の文字列は
"peek"：絶対値が最大のときの大きさ
"auto" ：現在表示されている部分の大きさ
次のスクリプトは，修飾子の使い方を示す。連結振動子のエネルギー状態を表す。
linecolor((1,1,1));
textcolor((0,0.8,0));
drawcurves((-7,-3),
[A.x,B.x,A.ke,B.ke,a.pe+b.pe+c.pe],
height->50,
color->(1,1,1),
back->(0,0,0),
backalpha->1,
range->"peek",width->400,
colors->[
[1,0.5,0.5],
[0.5,1,0.5],
[1,0.5,0.5],
[0.5,1,0.5],
[0.5,0.5,1]],
63

### Page 64

texts->[
"PosA = "+ A.x,
"PosB = "+B.x,
"EnergyA = "+A.ke,
"EnergyB = "+B.ke,
"PotentialEnergy = "+(a.pe+b.pe+c.pe)
]
);
対応する図は次の通り。
11.7 文字と表
文字の表示: drawtext(<vector>,<expr>)
drawtext(<vector>,<文字列>) 関数は <文字列> で与えられる文字列を <vector>の指
定する位置に表示する。この位置ベクトルは， ユークリッド xy座標か，同次座標で与える。
文字列中に改行コードがあると，文字通りそこで改行される。改行コードは不可視だが，ス
クリプト中で単に Enter キーで改行するときに入る。これにより，複数行からなる文章を書
くことができる。
【例】drawtext([0,0],"Hello World") で，文字列 ”Hello World” を[0, 0] の位置から
書き始める。
修飾子
64

### Page 65

修飾子 型 効果
size <real> 文字の大きさの設定
color [R,G,B] 文字の色を設定
alpha <real> 文字の透明度を設定
xoffset <real> 文字と基準点の x 方向のピクセル単位の隔たりを設定
yoffset <real> 文字と基準点の y 方向のピクセル単位の隔たりを設定
offset [<real>,<real>] 文字と基準点の xy ピクセル単位の隔たりを設定
align <文字列> left,right,mid で文字の配置を設定
bold <bool> 太字
italics <bool> 斜体
family <文字列> フォントの指定
利用できるフォント: fontfamilies()
この関数では，そのコンピュータで利用できるすべてのフォントのリストを作成する。次
のコードはそれらのフォントの名前をその字体で表示する。
families=fontfamilies();
t=0;
while(t<length(families),t=t+1;
drawtext((mod(t,5)*7,round(t/5)),families\_t,family->families\_t);
);
Unicode: unicode(<文字列>)
Cinderella では Unicode が扱える。Unicode で文字を表示するには unicode(<文字列>)
関数を使う。引数は，16進数のUnicode列。戻り値はそれに対応する文字。修飾子によって
16進数ではない形式の引数にもできる。
修飾子 base -> <整数> を用いると，Unicode のコード表現を変更できる。
【例】unicode("0041") と unicode(65,base->10) はどちらも文字 ”A”を返す。
文字列の表示可/不可: candisplay(<文字列>)
この関数は，与えられた文字列が，現在選択されているフォントで表示できるかどうを調
べる。戻り値はブール値。
表を描く: drawtable(<位置>,<list>)
65

### Page 66

リストで表を作る。表の外観のために，修飾子も使える。
【例】次のコードで表ができる。
x=1..10;
table=apply(x,(#,#^2,#^3,#^4));
drawtable([0,0],table);
修飾子
修飾子 型 効果
width <int> セル幅をピクセル単位で指定する
height <int> セルの高さをピクセル単位で指定する
flip 行と列を入れ替える
border <bool> 背景と線を描くかどうかの指定
size <実数> 文字の大きさを設定
color [R,G,B] 文字の色を設定
alpha <real> 文字の透明度を設定
offset [<real>,<real>] 文字と基準点の xy ピクセル単位の隔たりを設定
align <文字列> セル内での横位置をcenter,right,left の文字で指定
back <bool> 表の背景を描くかどうかを指定
back [R,G,B] 表の背景を指定したRGBの色で描くかどうかを指定
backalpha <real> 表の背景の透明度
【例】次のコードは drawtable 関数を用いた例。２番目の表は見出し。
x=1..9;
tab=apply(x,(#,#^2,#^3,#^4));
tab1=("x","x^2","x^3","x^4");
linecolor([0,0,.8]);
drawtable([0,0],tab,
width->50,
back->[1,0,0],
backalpha->0.1,
align->"right",
size->12
66

### Page 67

);
linecolor([0,0,0]);
drawtable([0,7.1],tab1,flip->true,
width->50,
height->33,
back->[0,0,1],
backalpha->0.4,
align->"mid",
size->16,
color->[1,1,1]
);
12 TeX 記法 Cinderella TeX
現在の Cinderella ではおよそ 95% の Tex 記法が使える。ここでは，いくつかの例と，標
準的な TeX との違いについて記述する。TeX 記法の詳細については TeX の解説書などを参
照されたい。また，例については実行画面を示さないものもあるが，適宜実行してみてもら
いたい。
TeX 記法は CindyScript の drawtext() で表示する文章と，幾何学要素のラベル，「文字
列を追加する」ボタンによる文字列に使える。特別メニューの文字列入力による文章には使
えない。
TeX 記法の宣言
通常の文章（文字列）の中で，ドル記号ではさんだ部分が TeX 記法によるものと解釈さ
れる。
【例】drawtext([0,2],"$f(x)=x^3-3x^2-3x+1$");
サブスクリプトとスーパースクリプト
サブスクリプト (上付き文字) とスーパースクリプト（添え字）は，それぞれ と ^ 記号
を用いる。複雑なサブ・スーパースクリプトを用いたい場合は，波括弧でくくるが，通常の
TeX スクリプトと異なり，数だけからなるものであれば，括弧はいらない。（つけてもよい）
【例】
drawtext([0,0], "$A_1$");
drawtext([2,0], "$A_123$");
67

### Page 68

drawtext([4,0], "$A_1^12$");
drawtext([6,0], "$A_{1_2}^{\frac{1}{2}}$");
drawtext([8,0], "$A_{1_2}^{\sqrt{x^2+y^2}}$");
和，積分などの記号
TeX ではバックスラッシュ\ を用いて制御コードを書く。 \sum と \int では，自動的に
和の記号や積分記号，上付き文字と下付き文字などを使って式を表現する。
和，積分記号の結果は添字のつき方が通常のTeXとCinderella TeX では異なる。
drawtext([0,0], "$\sum_{i=1}^n (i^2+1)$");
drawtext([3,0], "$\sqrt{x^2+y^2}$");
drawtext([6,0], "$\int_a^b f(x)dx$");
を実行すると，通常のTeXでは
∑ √ ∫
n (i2 +1) x2 +y2 b f(x)dx
i=1 a
となるが，Cinderella TeX では次のようになる。
積分記号で，上端下端の位置を調整したい場合は，\int のあとにスペースをいれ， と^ を
２重にするとそれらしくなる。
drawtext((6,0), "$\int _{_a}^{^b} f(x)dx$");
括弧
Cinderella TeX では4種類の括弧を式の中で使う。
丸い括弧 : (....)
角括弧 : [....]
波括弧 : \{...\}
縦線 : |...|
異なる大きさの括弧を使う場合は， \big, \Big, \bigg, \Bigg に続いて括弧を書
68

### Page 69

く。 \left と \right を使うと，ちょうどよい大きさの括弧でくくることができる。
\left と \right はちゃんと入れ子状になっている必要がある。
【例】
drawtext([0,0],"$\Bigg( \bigg( \Big( \big( (\ldots) \big) \Big) \bigg) \Bigg)$");
drawtext([5,0],"$\Bigg[ \bigg[ \Big[ \big[ [\ldots] \big] \Big] \bigg] \Bigg]$");
drawtext([10,0],"$\Bigg\{\bigg\{\Big\{\big\{\{\ldots\}\big\}\Big\}\bigg\}\Bigg\}$");
drawtext([15,0],"$\Bigg| \bigg| \Big| \big| |\ldots| \big| \Big| \bigg| \Bigg|$");
drawtext([20,0],"$\left[\sum_{i=1}^n \left({\sqrt sin(i)\right)\right]^2$");
分数
分数のような特殊な形の式は， Cinderella TeX は次の式をサポートしている。
\frac,\over,\choose,\binom
\cfrac,\dfrac はサポートしていない。
【例】
drawtext([0,0],"${1+n^2\over 1-n^2}$");
drawtext([3,0],"${2\choose 3}$");
drawtext([6,0],"$\frac{a+b}{x^2}$");
drawtext([9,0],"$\binom{a+b}{x^2}$");
空白
空白と改行は，よく式を区切るためだけに使われ，式のレイアウトのためにはあまり使わ
れない。\， \; \quad \qquad \! を使えば，空白の大きさを変えられる。現在のフォ
ントの ”m” の大きさが空白の単位になる。
\qquad： 2.0 単位の空白
\quad： 1.0 単位の空白
\;： 5/18 単位の空白
\,： 3/18 単位の空白
\!： -5/18 単位の空白（マイナスなので前の文字と重なる）
【例】 drawtext([0,0],"$A\!A A \,A\;A\quad A \qquad A$")
69

### Page 70

上線と下線
Cinderella TeX は式の上または下に矢印などの線を引くいくつかの方法をサポートして
いる。
\overline, \underline, \overleftarrow, \overrightarrow, \vec, \hat, \tilde
これらの記号のあとに，線を引きたい部分を波括弧でくくる。
【例】
drawtext([0,0],"$\overline{A}\;\cap\;\overline{B}\;=\;\overline{A\;\cup\; B}$");
drawtext([6,0],"$|\overrightarrow{(x,y)}|\;= \; \sqrt{x^2+y^2}$");
drawtext([13,0],"$\tilde{X}+\hat{Y}\;=\;\underline{X\oplus Y}$");
色
Cinderella TeX は色名を使って \color{...} で式に色をつけることができる。現在用意
されている色の名前は
white, black, red, green, blue, darkred, darkgreen, darkblue, magenta, yellow, cyan,
orange
色記号とそれに続いて書かれた文全体を波括弧でくくると，それらが指示した色で表示さ
れる。
【例】
drawtext([0,0],size->20,color->(0,0,0),
"Sum formula: $
\sum_{\color{darkgreen}i=1}^{\color{darkgreen}n} {\color{darkred}i^2}
\quad = \quad
{\color{blue}{ 2\cdot n^3+ 4\cdot n^2 +n\over 6 }}$"
);
通常の文
TeX では半角スペースは無視される。半角スペースの入った文を表示する場合は，\mbox
70

### Page 71

を使う。
【例】
drawtext([0,0],"$\sum_{\mbox{All i not equal to j}}(i^2+j^2)$");
Unicode
特定の記号が TeX で表現できないことがある。その場合，Cinderella TeX では Unicode
を使う方法がある。 \unicode{...} か \unicodex{...} という記号を用いて TeX のなか
で使う。第１の式では，Unicode を 10 進数で指定する。２番目の式では 16 進数で指定す
る。次の例では，まず sum(...) 関数を用いて Unicode の列を作り，それを TeX で表示し
ている。
chess=sum(0..11,i,"\;\unicode{"+(9812+i)+"}");
drawtext((0,0),size->30,"$"+chess+"$");
このほか，行列の表記，特殊記号，数学記号の表記については，通常のTeXと同様なので，
TeXの説明書などを参照されたい。
71

### Page 72

13 画像の操作とレンダリング
PNG または JPG 形式の画像ファイルを読み込み，幾何要素の点や直線を利用して表示す
ることができる。画像は，移動，回転，拡大・縮小，射影変換ができる。
13.1 メディアブラウザ
Cindyscript では，メディアブラウザを用いて画像を管理する。ファイルメニューの「メ
ディアブラウザ」を選ぶとポップアップウィンドウが出て,＋ボタンを押すと画像ファイルを
読み込むことができてリストに追加できる。−ボタンを押せばリストから削除される。読み
込んだ画像は，内部での名前とプレビューが表示される。画像の名前の初期値は読み込んだ
ファイルの名前だが，ダブルクリックして名前を変更することができる。これは内部的な名
前で，CindyScript ではこの名前を使う。
なお，以下の画面例では，Cindyscriptのマニュアルのものをそのまま使用している。これ
らの絵の著作権は Terzio Verlagexternal にある。
13.2 画像の表示と変換
画像の表示: drawimage(<位置>,<画像名>)
この関数は，メディアブラウザから画像を取り出して，第1引数で示した位置に表示する。
位置は，座標もしくは幾何要素の点の識別名。初期状態では指定した座標が画像の中心にな
るが，これは修飾子によって変更することができる。また，画像の拡大縮小と配置も変える
ことができる。
72

### Page 73

【例】
drawimage(A,"myimage");
drawimage(B,"myimage",scale->1.5,angle->30°);
drawimage(C,"myimage",ref->"lb");
参照点
指定した点に対して画像をどこに置くかを，何通りか指定できる。このとき，この点を「参
照点」という。修飾子 ref, refx, refy を用いて参照点の位置を指定する。参照情報は３
つの異なる方法で与えられる。
・もとの画像の画素数への絶対参照。たとえば，元の画像の画素数が 400 × 800 のとき，修
飾子 ref->[100,200] により，左下4分の1のところが参照点になる。
・比率で参照。この場合，百分率で位置を示す。たとえば，ref->["25%", "25%"] とすれば
左下4分の1のところの参照点を置く。
・2 つの文字で記号的に。ここで x 方向 を l, c, r で，順に 左，中央，右，y 方
向を letters b, c, t で，下，中央，上とする。すると左下は ref->"lb" または
ref->["l","b"] で表される。
位置情報は２つの方向に分けて指定することもできる。たとえば，refx->"l", refx->100
あるいは refx->"10%" のように。次の図はいくつかの参照点を示す。
73

### Page 74

修飾子
修飾子 型 効果
alpha 0.0 ... 1.0 画像の透明度
angle real 参照点周りの回転角
rotation real angle と同じ
scale real 拡大縮小
scale ベクトル それぞれの方向に拡大縮小
scalex real x軸方向へ拡大縮小
scaley real y軸方向へ拡大縮小
flipx bool 垂直方向に反転
flipy bool 水平方向に反転
ref 上記説明参照 参照点の位置指定
refx 上記説明参照 参照点の x 軸方向の位置指定
refy 上記説明参照 参照点の y 軸方向の位置指定
rendering 文字列 fast または nice の文字で表示品質
画像表示: drawimage(<位置>,<位置>,<画像名>)
位置と大きさを２つの参照点で指定して画像を表示する。初期状態では２つの参照点は画
像の下辺の両端となる。この参照点を画像内の他の点にすることもできる。その方法は先ほ
どのものと同じ。
74

### Page 75

【例】
drawimage(A,B,"MyImage");
drawimage(C,D,"MyImage",aspect->1);
drawimage(E,F,"MyImage",flipx->true);
drawimage(G,H,"MyImage",refx1->"20\%",refy1->"50\%",ref2->"rt");
修飾子
修飾子 型 効果
alpha 0.0 ... 1.0 画像の透明度
flipx bool 垂直方向に反転
flipy bool 水平方向に反転
aspect real アスペクト比
ref1 上記参照 １つめの参照点の位置指定
refx1 上記参照 １つめの参照点の x 軸方向の位置指定
refy1 上記参照 １つめの参照点の y 軸方向の位置指定
ref2 上記参照 2つめの参照点の位置指定
refx2 上記参照 2つめの参照点の x 軸方向の位置指定
refy2 上記参照 2つめの参照点の y 軸方向の位置指定
rendering 文字列 fast または nice で表示品質
75

### Page 76

【例】次の例では，変換行列によって2つの参照点を反復的に変化させている。それぞれの
ステップで画像を表示していき，対数螺旋を描く。多くの画像を表示するために一つ問題が
ある。それは表示速度である。場合によってはきれいに表示するか，速く表示するかを選択
する必要があるだろう。そのための修飾子が rendering で， "nice" か "fast" を設定す
る。初期状態では "nice" になっている。
a=[1,0];
b=[2,-1];
w=30°;
m=[[cos(w),-sin(w)],[sin(w),cos(w)]]*0.9;
repeat(100,
drawimage(a,b,"MyImage");
a=m*a;
b=m*b;
);
画像の表示: drawimage(<位置>,<位置>,<位置>,<画像名>)
３つの参照点を用いてアフィン変換をする。初期状態では，画像の底辺の左右と左上の点。
参照点は修飾子で変更することができる。
この関数は，反転や回転のような幾何学的変換をして画像を表示するのに適している。そ
のためには，あらかじめ参照点を変換した点を用意する。次の例では点 A’ , B’ , C ’ は点
A,B,C を直線に関して鏡像変換（反転）した点である。
drawimage(A,B,C,"MyImage"));
drawimage(A’,B’,C’,"MyImage"))
76

### Page 77

修飾子
この関数には次の修飾子が追加される。
修飾子 型 効果
ref3 上記参照 ３つめの参照点の位置指定
refx3 上記参照 ３つめの参照点の x 軸方向の位置指定
refy3 上記参照 ３つめの参照点の ｙ 軸方向の位置指定
画像の表示: drawimage(<位置>,<位置>,<位置>,<位置>,<画像名>)
４つの参照点を指定して射影変換をする。初期状態では参照点は左下から４つの角の点を
反時計回りにとられる。
【例】drawimage(A,B,D,C,"myimage")
次の図ではわかりやすくするために格子を書き加えている。
77

### Page 78

修飾子
この関数には次の修飾子が追加される。
修飾子 型 効果
ref4 上記参照 ４つめの参照点の位置指定
refx4 上記参照 ４つめの参照点の x 軸方向の位置指定
refy4 上記参照 ４つめの参照点の ｙ 軸方向の位置指定
画像を変形する: mapimage(<画像名>,<function>)
この関数は，引数の関数を用いて画像を変形させる。通常，この関数は，ある関数を用い
て２次元ベクトルを２次元ベクトルに写すものとする。complex 修飾子を用いて複素数平面
から複素数平面へ写すこともできる。関数の範囲は x-range と y-range 修飾子で指定する
が，指定がなければ 0.0 と 1.0 の間とされる。この範囲が画像の長方形の縦横幅に対応する。
この範囲ですべての点が写される。この機能は基本的に mapgrid 関数と類似している。
【例】ここでは，x 軸方向を sin 関数を使って変形する。まず，その関数を定義する。次に
mapimage 関数で変形する。図では，わかりやすくするために方眼を描いている。
f(z):=(z\_1*(sin(z\_2)+1.3),z\_2);
mapimage("MyImage",f(\verb|#|),
xrange->(-1,1),
yrange->(0,pi),resolution->30
);
mapgrid(f(\verb|#|),color->(0,0,0),alpha->0.3,
78

### Page 79

xrange->(-1,1),
yrange->(0,pi),resolution->30
);
次の例は前のものと類似している，関数として複素関数を用いている。
r=complex(A);
f(x):=exp(r*x);
mapimage("myimage",f(\verb|#|),
complex->true,
xrange->(0,1),
yrange->(0,pi),resolution->30
);
mapgrid(f(\verb|#|),complex->true,
xrange->(0,1),
yrange->(0,pi),
color->(0,0,0),alpha->0.5,
resolutiony->30,
resolutionx->10,
step->10,size->1
);
修飾子
この関数には次の修飾子がある。
79

### Page 80

修飾子 型 効果
alpha 0.0 ... 1.0 画像の透明度
xrange ベクトル x軸方向の範囲
yrange ベクトル y軸方向の範囲
complex bool 複素関数を用いるフラグ
resolution int 変換後の画像の解像度
画像の大きさを取得する: imagesize(<画像名>)
画像の大きさを返す。戻り値は幅と高さの画素数を示す２つの整数。
画素情報を取得する: imagergb(<画像名>,<整数>,<整数>)
imagergb(<画像名>,x,y) で，(x,y) の位置にある画素の色情報を取得する。戻り値は 4
次元のベクトルで，はじめの3つはRGB値(0〜255)，4番目はアルファ値。
【例】次のコードでは，まず画像を表示してその大きさを取得する。次に，両方向に標本点を
取り，その色と透明度で，粗っぽい点からなる画像を作成する。
drawimage(A,"MyImage",scale->2);
dim=imagesize("MyImage");
forall((0..dim\_1/10)*10,i,err(i);
forall((0..dim\_2/10)*10,j,
col=imagergb("MyImage",i,j);
draw((i,-j)*.03,color->(col\_1,col\_2,col\_3)/255,alpha->col\_4,border->false);
);
)
80

### Page 81

13.3 カスタム画像を作る
ここまでは，メディアブラウザであらかじめ読み込まれた画像についての操作であった
が，Cinderella の描画面から画像を作ることもできる。いったん画像として作ってしまえば，
CindyScript の canvas 関係の関数でそれを操作することができる。これにより，描画のた
めの命令などは見えなくなる。しかし，カスタム画像が作られればそれを描画手順のうちの
一つとして画面上に描くことができる。画像表示は描画と似て，画面の任意の場所に描くこ
とができます。この概念はとても強力だが，基本的な使い方を示すだけにする。
カスタム画像を作る: createimage(<画像名>,<整数>,<整数>)
createimage(<画像名>,width,height) 関数は，指定された画像のイメージバッファを
作成する。最初はそこには何もない。イメージバッファはメディアブラウザのもとで指定し
た名前でアクセス可能となり，drawimage(...) 関数で使えるようになる。
画像の内容を消去: clearimage(<画像名>)
この関数は，画像からすべての内容を消去する。消去後も画像は存在するが，描画された
内容はなく，いわば透明な状態である。
画像の削除: removeimage(<画像名>)
この関数はメディアブラウザから画像を取り除く。これ以降アクセスすることはできなく
なる。
13.4 キャンバスに描く
描画面をキャンバスのようにして，描いた図を CindyScript で画像化することができる。
できた画像は，読み込んだ画像と同様な変形ができる。ここでは，その手順を例示する。
まず，図のように点を取る。点 A,B,C,D はできた画像を射影変形して表示するための点，
矩形EFGHはキャンバスの領域，点Kは作図のための点である。矩形EFGHは，わかりや
すくするために線分で結んであるが，実際には，３点E,F,G だけがあればよい。
81

### Page 82

initialization スロットに，次のようなコードを書くことによって，キャンバスが用意でき
る。"image" という名称で，400×400のサイズの画像を作ることになる。
createimage("image",400,400);
次に，Draw スロットで例として同心円を描く。
linesize(3);
repeat(10,t,drawcircle(K,t*.5));
drawtext(K+[-2,2],"These are",size->20,color->[1,1,0]);
drawtext(K+[-2,-2],"some circles",size->20,color->[1,1,0]);
この図で，矩形EFGHで囲まれた部分（実際にはE,F,Gの３点で指定した長方形の中）が
画像化される。図を確かめたら，上の描画スクリプトを，canvas 関数の中に入れる。このと
き，図は表示されなくなるので，できた画像をdrawimageで表示する。
clearimage("image");
canvas(E,F,G,"image",
linesize(3);
repeat(10,t,drawcircle(K,t*.5));
drawtext(K+[-2,2],"These are",size->20,color->[1,1,0]);
drawtext(K+[-2,-2],"some circles",size->20,color->[1,1,0]);
);
drawimage(A,B,C,D,"image");
82

### Page 83

この例では４点を指定して射影変換を行っているが，１点だけで表示することももちろん
できる。また，キャンバスの画像はビットマップであることに注意する。したがって適切な
解像度を指定しなければならない。上の例で初期値として 80 × 80 のサイズにすると，小さ
な画像を大きく表示することになり結果として粗い画像になる。
この例では，３点でキャンバス領域を指定したが，これらの点を「参照点」といい，１個な
いし３個の参照点を使うことができる。
キャンバスに描く (参照点１つ): canvas(<位置>,<画像名>,<drawing code>)
この関数は ¡画像名¿ の画像をキャンバスとして用い，１つの参照点に対して画像を作る。
修飾子は drawimage(<位置>,<画像名>)と同様。
修飾子
修飾子 型 効果
angle real 参照点周りの回転角
rotation real angle と同じ
scale real 拡大縮小
scale ベクトル それぞれの方向に拡大縮小
scalex real x軸方向へ拡大縮小
scaley real y軸方向へ拡大縮小
flipx bool 垂直方向に反転
flipy bool 水平方向に反転
ref 上記説明参照 参照点の位置指定
refx 上記説明参照 参照点の x 軸方向の位置指定
refy 上記説明参照 参照点の y 軸方向の位置指定
キャンバスに描く (参照点２つ): canvas(<位置>,<位置>,<画像名>,<drawing code>)
この関数は ¡画像名¿ の画像をキャンバスとして用い，２つの参照点に対して画像を作る。
83

### Page 84

修飾子は drawimage(<位置>,<画像名>)と同様，ref2,refx2,refx2 が追加される。
キャンバスに描く (参照点３つ): canvas(<位置>,<位置>,<位置>,<画像名>,<drawing code>)
この関数は ¡画像名¿ の画像をキャンバスとして用い，２つの参照点に対して画像を作る。
修飾子は drawimage(<位置>,<画像名>)と同様，ref3,refx3,refx3 が追加される。
84

### Page 85

14 シェイプ
直線や多角形，円などの基本的な描画に加えて CindyScript によってこれらを結合した図
形ーシェイプーを描くことができる。シェイプは直接は目に見えないが，充填材やアウトラ
インの描画，クリッピングとして使える。シェイプは和集合，積集合，補集合といった集合
の論理演算によって作られる。ここでは，まず基本的な演算について説明し，そのあと，よ
り精巧な例を示す。
14.1 シェイプの初歩
円形のシェイプ: circle(<点>,<半径>)
円形のシェイプを作る。
多角形シェイプ: polygon(<list>)
<list> に頂点のリストを渡して多角形のシェイプを作る。
半平面シェイプ: halfplane(<直線>,<点>)
半平面のシェイプを作る。半平面は境界線 <直線> と，点 <点> によって定義される。境界
線のどちら側であるかがその点で決まり，点が含まれる方がその半平面である。<直線> は３
次元の同次座標か直線オブジェクト。
スクリーンのシェイプ: screen()
すべてのアクティブな描画要素を覆うのに十分に大きい長方形を作る。
14.2 シェイプの結合
それぞれのシェイプは，論理演算によって結合することができる。それには次の３つの演
算がある。
<シェイプ1> ++ <シェイプ2> ２つのシェイプの併合
<シェイプ1> ~~ <シェイプ2> ２つのシェイプの共通部分
<シェイプ1> -- <シェイプ2> ２つのシェイプの差
14.3 シェイプの使い方
シェイプは，充填と境界線描画，クリッピングの３つの方法で使われる。
85

### Page 86

シェイプによる充填: fill(<シェイプ>)
この関数ではシェイプを与えられた色で塗りつぶす。使える修飾子は，colorとalpha。
シェイプを描く: draw(<シェイプ>)
この関数はシェイプの輪郭線を描く。この関数は draw 関数の拡張で，draw と同じ修飾子
が使える。
クリップパスの設定: clip(<シェイプ>)
この関数は，シェイプのクリップパスを設定する。これ以降に描画するものはすべてこの
クリップバスで止めらる。クリップパスは表現スタックに加えられるが，それは grestore()
あるいは greset() で取り除くことができる。
【例】
まず「点を加える」モードで点 A〜F をとっておく。次のコードで３つの異なるシェイ
プー１つの正方形と２つの円が定義され，それらが論理演算によって結合されている。小さ
なシェイプは，細い線でアウトラインが描かれている。
shape1=circle(E,4);
shape2=circle(F,4);
shape3=polygon([A,B,C,D]);
color([0,0,0]);
shape=shape1++shape2++shape3;
fill(shape,color->[1,0.8,0]);
draw(shape,size->3);
draw(shape1);
draw(shape2);
draw(shape3);
次の最初の図がこの結果である。ほかの３つの図は，それぞれ図の上に示した演算で作成
したシェイプ。
shape1++shape2++shape3 shape1~~shape2~~shape3
86

### Page 87

shape1++shape2--shape3 shape1++shape2~~shape3
次のコードはクリップパスの使い方を示す。「点を加える」モードで５つの点 A,B,C,D,E
をとっておく。スクリプトでは，まず 4 つの円を合併したシェイプを定義する。すると，こ
のシェイプが，点Ｅを中心とした同心円のクリッピングパスとして働く。
r=3;
shape=circle(A,r)++circle(B,r)++circle(C,r)++circle(D,r);
clip(shape);
repeat(60,t,
drawcircle(E,t/2,color->[0,.6,0],size->3);
);
greset();
draw(shape,color->[1,1,1],size->2);
87

### Page 88

シェイプは，次の例に示すような反復系のオブジェクトにもなる。ただし，あまり複雑に
すると破綻をきたすので注意。複雑な形はCinderella の動作を遅くしてしまう。
a=complex(A);
b=complex(B);
z=complex(C);
shape=circle([0,0],0);
repeat(50,
shape=shape++circle(gauss(a),|a-b|);
a=a*z;
b=b*z;
);
fill(shape,color->[1,0.7,0]);
draw(shape,color->[0,0,0],size->2);
15 座標系と基底
通常， CindyScript の座標系は Cinderella の図形描画での座標系と同じである。しかし，
特殊関数によって座標系を変えることができる。そのあとは，この修正された画面に対して
描画が行われる。座標変換を行うときは，どこで実際の描画を行っているかを決定するのが
難しいかも知れない。そこで，変換の関数を使いやすくするために，CindyScript は gsave
と grestore の関数を用意している。それは，現在の描画エンジンをスタックに push/pop
する。これは，図形の表現情報の他に，現在の座標変換を含む。
15.1 座標変換
座標系の平行移動: translate(<list>)
この関数は [<real>,<real>] 型の <list> を与えて，このベクトルにより描画する座標
88

### Page 89

系を移動する。
座標系の回転: rotate(<real>)
この関数は，実数 <real> の角だけ座標系を回転する。角は弧度法。度数法で与えたい場
合は ° 演算子を使う。たとえば， rotate(30°) とすれば，座標系を 30° 回転する。
拡大・縮小: scale(<real>)
この関数は <real> によって，拡大・縮小を行う。
これらの変換は，続けて行うこともできる。変換の順序によって結果は異なる。
【例】 座標軸と，頂点の座標が [0,0],[0,1],[1,1],[1,0] である正方形を描く関数
drawaxis() を定義し，座標変換を行って描画する。座標変換は２倍して，x 軸方向に
1，y軸方向に1だけ平行移動，30°回転，という順序でおこなう。描画した図形を移動する
のではなく，座標変換を行ってから描画をすることに注意。
drawaxis():=(
draw([-2,0],[2,0]);
draw([0,-2],[0,2]);
drawpoly([[0,0],[0,1],[1,1],[1,0]],color->[1,0,0]);
);
drawaxis();
scale(2);
translate([2,2]);
rotate(30°);
drawaxis();
89

### Page 90

【例】繰り返して座標変換を行い，正方形を描く。
repeat(90,
drawall(square);
translate((1,1));
scale(0.92);
rotate(30°);
);
15.2 射影基底との関係
setbasis(<basis>)
Cinderellaの幾何学部分は，すべての描画が関わる基底を定められるようになっている。こ
れらの基底とは，平行移動，相似，アフィン，射影で，CindyScript でも使える。 setbasis()
関数は Cinderella で使われる基底を定義する。引数は Cinderella で使われる基底のラベル
でなければならない。 setbasis 関数を適用したあとは，CindyScript の以前の座標変換は
使われなくなるが，それらは gsave で保存しておき， grestore で呼び出すことができる。
【例】まず，図のように４点A,B,C,Dをとり，モードメニューの「特別」ー「基底の定義」を
選ぶ。ガイドに従って，A,B,C,D の４点をクリックし，選択モードにしてこのモードを抜け
ると，射影基底Bas0が定義され，右上にアイコンができる。
90

### Page 91

これは，一辺の長さが１である正方形(単位正方形)の４頂点 [0,0],[0,1],[1,1],[1,0]
が，点 A,B,C,D に対応するような基底であることを意味する。実際，次のスクリプトを実行
すると，単位正方形内の格子を描く。
setbasis(Bas0);
x=(0..10)/10;
drawall(apply(x,([\verb|#|,0],[\verb|#|,1])));
drawall(apply(x,([0,\verb|#|],[1,\verb|#|])));
CindyScript の内部基底を，既存の点に基づく基底に直接関連付けることも可能である。
すると，Cinderella での基底を変えなくて済む。これは，基底を定義するための点を与えれ
て，次の関数で実行できる。
平行移動基底を設定する: setbasis(<点1>)
相似基底を設定する: setbasis(<点1>,<点2>)
アフィン基底を設定する: setbasis(<点1>,<点2>,<点3>)
射影基底を設定する: setbasis(<点1>,<点2>,<点3>,<点4>)
【例】次のコードはこの性質を示すものである。 sq の部分は正方形の格子を描く関数の定義。
91

### Page 92

この格子をいろいろな基底によって描く。
sq:=(draw([0,0],[1,0]);
draw([0,0.25],[1,0.25]);
draw([0,0.5],[1,0.5]);
draw([0,0.75],[1,0.75]);
draw([0,1],[1,1]);
draw([0,0],[0,1]);
draw([0.25,0],[0.25,1]);
draw([0.5,0],[0.5,1]);
draw([0.75,0],[0.75,1]);
draw([1,0],[1,1]);
);
setbasis(A);
sq;
setbasis(B,C);
sq;
setbasis(D,E,F);
sq;
setbasis(G,H,L,K);
sq;
15.3 基底スタック
座標系変換は全体的な表示に影響する。一時的に座標系変換を行い，そのあと以前の状態
に戻したいことはよくある。CindyScript にはそのための関数が用意されている。
図の状態の一時保存: gsave()
92

### Page 93

図の状態を戻す: grestore()
gsave 関数は，すべての図形の状態 (座標変換，大きさ，色，透明度) についての情
報をスタックに保存する。 grestor はこの情報をスタックから引き出す。したがって，
gsave() ..... grestore() の間は，他のコードの部分に影響を与えることがない。
グラフの状態を消去する: greset()
この関数は，スタックに保存されていた座標系やすべての図形に関する色，大きさなどの
情報を消去し，初期状態に戻す。
15.4 レイヤー
ある意味で， Cindy script で描画される図には3番目の次元がある。各々の図は特定の層
（レイヤー）にある。レイヤーは数で指定される。図が描かれるとレイヤーは付随する番号の
順に塗られる。レイヤーが指定されなければ，Cindy script で描画される図は背景層すなわ
ち幾何要素のある層で描画される。初期状態では Cindyscript の draw が実行される前にレ
イヤーは消去される。しかしながら，自動消去されないレイヤーをマークすることも可能で
ある。
描画レイヤーを設定する: layer()
この関数はレイヤーを指定したレベルに設定する。初期状態では描画が行われる前にレイ
ヤーは消去される。通常，Cindyscript で描く図はスクリプトが書かれている順に描かれる
ので，図が重なる場合はあとから書かれた方が上になる。しかし，レイヤーを設定すること
により，重ね合わせを変えることができる。
【例】次のスクリプトでは，通常の描画順で４つにオーバーラップして円盤を描く。（下図左）
cir(x,y):=(
fillcircle((x,y),3,color->(1,.8,0));
drawcircle((x,y),3,color->(0,0,0),size->3);
);
cir(0,0);
cir(1,1);
cir(2,2);
cir(3,3);
それぞれの円盤を描画する前にレイヤー関数が呼ばれると，それぞれの円盤を逆順に描画
することができる。（下図右）
layer(6);cir(0,0);
93

### Page 94

layer(5);cir(1,1);
layer(4);cir(2,2);
layer(3);cir(3,3);
レイヤーを空にする: emptylayer()
この関数はレイヤーを空にする。
レイヤーからすべての図を消去する: clrscr()
この関数は，スクリーンで実行されたすべての図を消去する。図が本当に消去された状態
になっているかどうかを確認することは時々役に立つ。特に，他のスクリプトスロットから
repaint() 関数が呼ばれているときに必要になるだろう。
レイヤーの自動消去: autoclearlayer(<整数>,<ブール値>
レイヤーのフラグの自動消去はこの関数で行なえる。初期状態で，すべてのレイヤーは画
面の再計算の間に自動的に消去される。この自動消去フラグを false にすることでこれを切
り替えることができる。
レイヤーが自動消去されなければすべての描画命令が保存される。Cinderella はビット
マップを保存しないであらゆるステップで画面を描き直すので，レイヤーのために多くの描
画命令を使うとパフォーマンスに影響する。
【例】initialization スロットに次のコードを書くと，消去されないレイヤーを背景あるい
は前面に描くことができ， draw スロットに書くと，何か操作するたびにレイヤーを書き換
える。
autoclearlayer(-4,false);
layer(-4);
repeat(1000,
p = [random(20)-5,random(20)-5];
color([random(),random(),random()]);
94

### Page 95

fillpolygon(apply([[0,0],[1,0],[1,1],[0,1]],p+#),alpha->.2);
);
layer(0);
このコードをInitialization スロットに描くと，レイヤー４で背景を描く。自動消去フラグ
が false なので，次の図のように，他の作業をする間も表示したままになる。これを draw
スロットに書いて同じ効果を得るためには，乱数によってできる異なる長方形と色をすべて
保存しておかなければならない。
15.5 スクリーン境界の決定
screenbounds()
もし射影平面の有限部分だけ使い， 球面表示を使わないのであれば，スクリーン境界を求
めることに意味がある。この関数は，見える範囲の長方形を定義している４つの同次座標の
リストを返す。この関数はユークリッド表示においてのみ有効。
画面解像度の決定: screenresolution()
双曲表示・球面表示と対照的に，ユークリッド表示はいたるところに同じ画面解像度を持
つ。この関数は，原点と [0,1] 間の画素数を与える。同じ図に対していくつかのユークリッ
ド表示があるとき，この関数はすべての画面解像度の最大値を返す。
【例】点に色をつけてチェッカーボードを作ることができる。次のコードは，現在の拡大率に
関わりなくすべての画素に色をつける。画素単位で色をつけることを勧めているわけではな
いが，これが必要なことがあるかもしれない。ほとんどの場合，colorplot 関数が使いやす
く，より高速である。
upperleft=(screenbounds()\_1).xy;
lowerright=(screenbounds()\_3).xy;
width in pixels=screenresolution()*(lowerright.x-upperleft.x);
95

### Page 96

height in pixels=screenresolution()*(upperleft.y-lowerright.y);
repeat(width in pixels/2, x,
start->upperleft.x, stop->lowerright.x,
repeat(height in pixels/2, y,
start->upperleft.y, stop->lowerright.y,
draw([x,y],border->false,size->.5,color->[0,0,0]);
);
);
16 幾何学的演算
16.1 リストと座標
直線のための座標は常に同次座標である。すなわち，３つの数のリストで， [a,b,c] が，
方程式 ax+by +c = 0 を表す。 点の座標はユークリッド座標 (２つの数のリスト [x,y])
か， または同次座標 (３つの数のリスト [x,y,z] で点 [x/z,y/z]) を表す)。戻り値は常に
同次座標。以下の説明の中では，特に断りなく，点の形式の引数は<点>で，直線の形式の引
数は <直線> で表す。<点> と <直線> は両方とも３つの数のリストで表現することができる
ので，両者を区別する方法が必要になる。内部的には，リストは，それが幾何学的にどのよ
うな意味を持つのかというフラグを持っている。その情報は， geotype(<list>) 関数で得
ることができる。この関数は， "Point", "Line", "None" のいずれかを返す。ベクトル
が持つ幾何学的な意味に応じて， draw 関数は対応する図形を描く。
16.2 基本的な幾何学関数
２直線の交点: meet(<直線1>,<直線2>)
この関数は２本の直線の交点を計算し，その同次座標を返す。
２点を通る直線: join(<点1>,<点2>)
この関数は，２点を通る直線を計算し，その同次座標を返す。
平行線を求める: parallel(<点>,<直線>)
平行線を求める: parallel(<直線>,<点>)
この関数では，点と直線を引数として与え (順序は問わない)，その点を通りその直線に平
行な直線を求める。戻り値は直線の同次座標。 この関数はユークリッド幾何に対して適用さ
れる。双曲線幾何と楕円幾何はサポートしていない。この関数は， para(...) と略すこと
96

### Page 97

もできる。
perp 垂線: perpendicular(<点>,<直線>)
垂線: perpendicular(<直線>,<点>)
この関数では，点と直線を引数として与え (順序は問わない)，その点を通りその直線に垂
直な直線を求める。戻り値は直線の同次座標。 この関数はユークリッド幾何に対して適用さ
れる。双曲線幾何と楕円幾何はサポートしていない。この関数は， perp(...) と略すこと
もできる。
組み合わせた例 次のコードを実行すると図のようになる。それぞれの演算の戻り値が図形
のタイプ (点か直線か) を内在しているので，drawall 関数によって自動的に正確に描画さ
れる。
A=[1,1];
B=[2,5];
C=[7,2];
a=join(B,C);
b=join(C,A);
c=join(A,B);
ha=perpendicular(A,a);
hb=perpendicular(B,b);
hc=perpendicular(C,c);
X=meet(ha,hb);
drawall([a,b,c,d,ha,hb,hc,X,A,B,C]);
垂直なベクトル: perpendicular(<list>)
perp 関数の引数が，２つの数からなるリスト１つだけとする。その場合は，リスト [a,b]
は [-b,a] に変換される。それは，もとのベクトルを 90° 回転したものである。
三角形の面積: area(<点1>,<点2>,<点3>)
この関数は， <点1>,<点2>,<点3>を３つの頂点とする三角形の面積を計算する。点の方
向が反時計回りならば面積は正，時計回りならば面積は負になる。３点が同一直線上にある
ときは面積はゼロ。
16.3 有用な線形代数関数
線形代数で使う次の関数は幾何でも有用である。特に３次元のベクトルに適用できる。 そ
の状況 (行列の計算，内積など) については，ベクトルと行列の節を参照されたい。
97

### Page 98

3点の位置ベクトルの行列式: det(<ベクトル1>,<ベクトル2>,<ベクトル3>)
この関数は，３つの３次元ベクトル <ベクトル 1>, <ベクトル 2>, <ベクトル 3> からな
る 3 × 3 行列の行列式を計算する。ベクトルと行列の節にある一般的な行列式と異なり，こ
の方法はパフォーマンスが優れている。
2点の位置ベクトルの外積: cross(<ベクトル1>,<ベクトル2>)
この関数は，２つの３次元ベクトルの外積を計算する。外積は３次元ベクトルで，もとの
２つのベクトルと垂直。
16.4 変換とオブジェクトの型
オブジェクトの型: geotype(<list>)
この関数は，オブジェクトが明確な幾何学的意味を持つかどうかを決定する。戻り値は，
文字列で "Point", "Line", "None" のいずれか。
この関数を，２つの数からなるリストに適用した場合は，常に Point—を返す。
3 つの数からなるリストに適用した場合は，このリストの内部フラグによって
"Point", "Line", または"None" のいずれかを返す。Cinderella で描画した幾何オ
ブジェクトであれば，常にそのフラグを有している。 meet 関数の戻り値は常に "Point" 。
join, parallel, perpendicular 関数の戻り値は常に "Line"。さらに，幾何学的意味は
line と point 関数によって明確に設定することができる。
点の指定: point(<vector>)
この関数は，３つの数のベクトルを，はっきりと "Point"として位置づける。引数が３つ
の数からなるベクトルでなければ無効。
直線の指定: line(<vector>)
この関数は，３つの数のベクトルを，はっきりと "Line" として位置づける。引数が３つ
の数からなるベクトルでなければ無効。
点を複素数に変換:complex(<点>)
この関数は点の座標を複素数に変換する。ここで，ユークリッド座標系はガウスの複素数
平面と同一視され，点 [a,b] は複素数 a+i*bに変換される。
複素数を点に変換: gauss(<点>)
複素数 a+i*b を２つの数のリスト [a,b] に変換する。
98

### Page 99

４点または直線の複比: crossratio(<vector>,<vector>,<vector>,<vector>)
４点の幾何複比を計算する。４点が共線であれば，通常の実数射影平面における複比が計
算される。４点が共線でなければ，複素射影直線の対応した点における複比が計算される。
共線的無限遠点に対しては２つの結果は同等。
４つの数の複比: crossratio(<数>,<数 >,<数 >,<数>)
4つの実数または複素数の複比 (A/B)/(C/D) を計算する。
16.5 幾何学変換と基底
代数的な方法で幾何の変換を扱うことができる。変換は 3 × 3 行列で表される。実際の変
換は，点の同次座標に変換行列を掛けて行われる。この変換行列を計算するためにいくつか
の関数がある。
線対称: linereflect(<直線>)
<直線> に関して対称な点をを求める行列を返す。
【例】次のコードは，作図した直線 a（AB）と点C に対し，対称変換行列を作り，点C の同
次座標に掛けて対称点を求める。結果は緑色の点。
m=linereflect(a);
draw(m*C.homog);
点対称: pointreflect(<点>)
<点> に関する対称点を求める行列を返す。
平行移動: map(<点1>,<点2>)
<点1> を <点2> に写す平行移動を表す行列を返す。
相似変換: map(<点1>,<点2>,<点3>,<点4>)
<点1> を <点2> に，<点3>を<点4> に写す相似変換を表す行列を返す。
99

### Page 100

アフィン変換: map(<点1>,<点2>,<点3>,<点4>,<点5>,<点6>)
<点 1>を<点 2>に，<点 3>を<点 4>に，<点 5>を<点 6> に写すアフィン変換を表す行列を
返す。
射影変換: map(<点1>,<点2>,<点3>,<点4>,<点5>,<点6>,<点7>,<点8>)
<点 1>を<点 2>に，<点 3>を<点 4>に，<点 5>を<点 6>に，<点 7>を<点 8> に写す射影変
換を表す行列を返す。
17 計算
CindyScript は純粋に数的言語である。記号的計算は行なわない。にもかかわらず，通常
記号的システムだけが行えるようないくつかの手続きを行うことができる。たとえば，関数
の微分や接線を計算することができる。
17.1 微分と接線
微分: d(<function>,<var>)
この関数は，第１引数 に与えられた関数の導関数を作る。微分は標準的な実行変数 # につ
いておこなわれるが，変数名を第２引数に指定しする。次のコードが使用例。青の線がもと
の関数 f(x) ，赤の線が第１次導関数 g(x) ，そして黒の線が第２次導関数 h(x) のグラフ。
f(x):=(x-3)*(x-2)*(x-1)*x*.4;
g(x):=d(f(#),x);
h(x):=d(g(#),x);
plot(f(x),size->2);
plot(g(x),color->[0.8,0,0]);
plot(h(x),color->[0,0,0]);
第２次導関数は第１次導関数を微分したものである。しかし注意事項がある。微分関数は
完全に数の原則に基づいている。f(x)が微分可能ならば，導関数はd(f(#),x)で定義される。
ここで，x が微分する変数を示している。導関数の値は，式 (f(x+eps)-f(x-eps))/2eps
によって計算される。 eps は十分小さい数。これは，この点における実際の微分係数に十分
近い値になる。しかし，連続して何度かこの関数を使うと，かなり誤差を生じる。5回も微分
すると結果は使えない。したがって第５次導関数ではもはや理にかなった計算はできない。
修飾子
初期値として，上記の式の eps は 0.0001 に設定されている。この値は，高次導関数の信
頼性と精度のバランス上十分理にかなった値である。この値は修飾子 eps-><数> によって
100

### Page 101

変更することができる。
接線: tangent(<関数>,<値>)
この関数は，微分とよく似ている。しかし，微分係数を計算する代わりに，ある点におけ
る接線の同次座標を計算する。 その点は第２引数で与える。 次のコードでは，放物線のいろ
いろな接線を計算している。
f(x):=(x^2)/4;
repeat(250,start->-30,stop->30,x,
t=tangent(f(#),x);
draw(t,alpha->.3);
);
plot(f(x),size->3,color->[0,0,0]);
tangent 関数の戻り値は 3 次元ベクトルの同次座標である。加えて，直線の内部フラグが
立っている。(「幾何学関数」参照) そのため，自動的に直線が引かれる。
17.2 高度な計算
実数値を推測する: guess(<数>)
推測関数は，浮動小数点数から記号的意味を取り戻すのに使われる。guess 関数は入力と
して数を予想し，文字列を返す。文字列は入力された数を記述する記号的な式。 guess 関数
は，次の形式の文字列を生み出そうとする。
a+b*sqrt(c)
ここで a, b, c は，約 1000 以下の分母と分子で表される有理数。入力された数が十分な精
度で表現できるならば，上記の形で表す。 そうでなければ， guess 関数はそのまま入力値
を返す。
たとえば，guess(0.25) は "1/4" を返す。guess(3.14159) はそのまま "3.14159" を
返す。
guess 関数の背後で働いているのは，いわゆる PSLQ と呼ばれるアルゴリズムである。実
数 x,y,z が与えられたときに，整数関係 ax+by +cz = 0 を発見する実に巧妙なアルゴリ
ズムである。実数 x が２次関係式の解であるかどうかを調べたいならば， a+bx+cx2 = 0
の整数関係を探さなくてはならない。これが， guess 関数が実装しているものである。解は
その整数係数を使って再構成される。
n次方程式の解: roots(<list>)
roots 関数は，１変数の多項式からなる方程式の解を示す。低次の項から高次の項に向
かって順に係数を与える。結果は複素数のこともある。
101

### Page 102

【例】たとえば，方程式 x2 +1 = 0 の解を求めたい場合は，単に roots([1,0,1]) とする。
結果は複素数 [-0-i*1,-0+i*1] である。
次のコードは，３次方程式の解を計算してグラフとともに表示する。
a=0.4;
b=-0.4;
c=-3;
d=-1;
f(x):=a*x^3+b*x^2+c*x+d;
plot(f(x),size->2);
r=roots([d,c,b,a]);
forall(r,draw((#,0)))
18 音声出力 Syntherella
18.1 概要
Syntherella は，Cindyscript によるMIDI インターフェイスである。
音を出すには，中央の C を 60 として半音ずつプラス・マイナスし，playtone(60) と
する。
音量は，これに velocity 修飾子をつける。値は実数で０〜１。たとえば，
playtone(60,velocity->0.5)
楽器をチャンネルに割り当てるには，midichannel(3, intrument->25) あるいは
instruments(25, channel->3) のように記述する。
残響は音を鳴らす時間（秒）を指定する duration 修飾子を用いる。たとえば，
playtone(60,duration->0.1,velocity->1)。
タイミングを取るには，CindyScript の wait(...) 関数を使うか，MIDI シーケ
ンサを使う。CindyScript でこのシーケンサにアクセスするには playmelody 関数か
midiaddtrack,midistart 関数を用いる。
トラックをシーケンサに追加するには，midiaddtrack 関数を用いる。追加されたトラッ
クは midistart 関数によって有効になる。
18.2 単音
単音を鳴らす: playtone(<整数>)
単音を鳴らす。修飾子がないとき，初期設定の楽器音が使われ，鳴る時間は 1 秒で，音量
は 0.5。
102

### Page 103

【例】 playtone(72, duration->4);
bend 修飾子によって，音程が半音単位で 2 半音まで上下できる。音の長さ duration が
0 以下のときは stoptone() で止められるまで鳴り続ける。そのほか，修飾子は次の通り
修飾子 型 効果
velocity 0.0 ... 1.0 音量（ピアノの(cid:20276)盤を叩くときの速度）
amp 0.0 ... 1.0 velocity と同じ
duration <real> 音の長さ。秒単位。
channel 0..15 演奏するチャンネル
reverb 0.0 ... 1.0 残響効果
balance −1.0 ... 1.0 左右のバランス
bend −2.0 ... 2.0 半音の上げ下げ
音を止める: stoptone(<整数>)
特定のキーの音を止める。音が鳴り続けるときに有効。
特定の周波数で鳴らす: playfrequency(<real>)
この関数は引数を周波数 (Hz) （実数）で渡す。より物理的な playsin を使う方がよい場
合もある。
修飾子は playtone と同様だが bend 修飾子はここでは無効である。
【例】
playfrequency(440) で 440 Hz の音を，現在選択されているチャンネルの楽器で鳴ら
す。 playfrequency 関数は，インドのラーガやジャワのガムラン音楽のような非ヨーロッ
パ系の音階をシミュレートするときに使える。
18.3 旋律
旋律の演奏: playmelody(<list>)
playmelody() はリストをシーケンサに加えてすぐに演奏する。この関数が呼ばれるとき，
他のトラックはシーケンサから削除される。リストは，音程と長さを表す整数か文字列，楽
器や音量で構成される。リストの各要素は，音の高さと長さを表す。音の長さは拍で数えら
れる。初期状態では 1分につき60の速さで演奏される。これは， midispeed 関数の修飾子
で変更できる。
【例】ハ長調の音階
103

### Page 104

playmelody([["C",1],["D",1],["E",1],["F",1],["G",1],["A",1],["H",1],["c",5]])
または
playmelody([[60,1],[62,1],[64,1],[65,1],[67,1],[69,1],[71,1],[72,5]])
単音ではなく和音を演奏することもできる。そのためには，同時に鳴らす音をリストにす
る。その形式は[[<音程1>,<音程2>,<音程3>,...],<長さ>] 。
次のコードは，次第に和音を構成する音を増やしながら演奏する。
playmelody([["C",1],[["C","E"],1],[["C","E","G"],1],[["C","E","G","c"],5] ] )
最後に， −1 か ”P” または ”p” を使うことで休符ができる。
ダイナミクスとフレージング
旋律を演奏するために，次のようなダイナミクス（音の強弱）やフレージングがある。そ
れぞれ，その文字列だけのリストにする。
”ppp”: ピアノピアニッシモ
”pp”: ピアニッシモ
”p”: ピアノ
”mp”: メゾピアノ
”mf”: メゾフォルテ
”f”: フォルテ
”ff”: フォルテッシモ
”fff”: フォルテフォルテッシモ
”>”: アクセント
”staccato”: スタッカート
”st”: スタッカート
”legato”: レガート
”le”: レガート
["velocity",<real>]: 音量を <real> にする。実数は 0.0 から 1.0
【例】次のコードは，音階の演奏ををピアニッシモ・スタッカートで始めて，フォルテ・レ
ガートで終わる。
playmelody([["st"],["pp"],["C",1],["D",1],["E",1],["F",1],["le"],["f"],
["G",1],["A",1],["H",1],["c",5]])
位置合わせ
トラックが加えられたとき，シーケンサの演奏位置を示すポインタは０に設定される。
104

### Page 105

"goto" と "gorel" によって，ポインタは絶対位置か相対位置に移動できる。その構文は次
の通り。
・["goto",<real>]: ポインタを，最初から測って <real> の位置に置く。
非負の数とする。
・["gt",<real>]: "goto" と同じ。
・["gorel",<real>]: ポインタの位置を相対的に計算して<real> の位置に置く。
負の値も可だが，結果として負になるような数は禁じられている。
・["gr",<real>]: "gorel" と同じ。
・["||:"]: 繰り返し記号の始め。
・[":||"]: 繰り返し記号の終わり。
・["1."]: 第１カッコ。
・["2."]: 第２カッコ。
【例】
playmelody([
["c",.5],["d",.5],
["$||$:"],["e",1],["g",1],["g",1.5],["a",.5],["g",1],["e",1],["c",1.5],["d",.5],
["1."],["e",1],["e",1],["d",1],["c",1],["d",3],["c",.5],["d",.5],[":$||$"],
["2."],["e",1],["e",1],["d",1],["d",1],["c",4]
],speed->200
);
楽器のコントロール
・["channel",<整数>]: チャンネルを (0...15) の範囲で変更する。
・["ch",<整数>]: channel と同じ。
・["instrument",<整数>]: チャンネルと関連して楽器を(1...128) の範囲で変更する。
・["inst",<整数>]: instrument と同じ。
・[<整数>,<整数>,<整数>,<整数>]: 楽器のコントロールにアクセスする。
最初の数はコントロールコード，2番目はチャンネル，
あとの２つはデータ。
トラックが再開されるときは，楽器は初期値にリセットされる。
修飾子
105

### Page 106

修飾子 型 効果
channel 0..15 演奏するチャンネルの設定
instrument 1 ... 123 楽器の選択
speed <real> 1分間あたりの拍数を設定
loop 0,1,2,3,4 ... 旋律の繰り返し
start <real> 開始位置 (拍数で)
修飾子 loop は演奏が終わったあとの巻き戻しを指定する。この修飾子に続く数は巻き戻
しの回数。したがって，loop->3 とすると，旋律は4回演奏される。 loop->-1 は無限ルー
プと解釈されまる。これが呼ばれたあとは，新しい旋律（空の旋律 playmelody([]) も可）
を加えたときにループが終わりる。 あるいは，midistop() 命令を使うこともできる。
シーケンサにトラックを追加する: midiaddtrack(<list>)
この関数はシーケンサに旋律を追加するがすぐに演奏はしない。シーケンサの開始は
midistart 命令によって行われる。シーケンサが演奏を始めたら，トラックを追加しても
シーケンサは演奏をやりなおさない。トラックはそのまま置き換えられる。さらに，シーケ
ンサと比較して追加されたトラックのタイミングを変えていくいくつかの修飾子がある。
修飾子
修飾子 型 効果
channel 0..15 演奏するチャンネルを選ぶ
instrument 1 ... 123 楽器を選ぶ
speed <real> 1分間あたりの拍数
track 0..10 シーケンサのトラックを選ぶ
start <real> 開始位置(拍)
mode <文字列> add, replace, append の文字でトラックを追加したときの動作
stretch <real> 旋律を追加したときの伸縮(シーケンサと関連)
offset <eral> シーケンサと関連して，旋律を追加したときのシフト量
repeat <real> 旋律がどのくらい追加されるか
シーケンサの開始: midistart()
シーケンサを開始する。修飾子は playmelody と同様で，speed，loop，start が使える。
シーケンサの停止: midistop()
106

### Page 107

MIDI シーケンサを直ちに停止する。
シーケンサの速度の設定: midispeed(<real>)
速度は 1 分あたりの拍数を実数で与える。初期値は 60 です。シーケンサがすでに動いて
いても速度を変えることができる。
シーケンサの速度を問い合わせる: midispeed()
現在のシーケンサの速度を返す。
シーケンサの位置を設定する: midiposition(<real>)
シーケンサの位置を特定の位置に設定する。
シーケンサの開始位置を問い合わせる: midiposition()
シーケンサの現在の位置を返す。シーケンサが動いているとき，この値は連続的に変化
する。
18.4 音色
楽器を選ぶ: instrument(<整数>)
この関数によってチャンネルに楽器を割り当てる。チャンネルが指定されなければ初期値
のチャンネルが使われる。各楽器には， 1 から 128 までのコードが割り当てられている。楽
器とコードの対応については，次の instrumentnames で説明する。修飾子によってチャン
ネルを指定すれば，そのチャンネルの楽器が変更される。
修飾子 型 効果
velocity 0.0 ... 1.0 音量 (ピアノの(cid:20276)盤を叩く速さ)
duration <real> 音の長さ
bend −2.0 ... 2.0 半音単位で上げ下げ
channel 0..15 演奏するチャンネル
reverb 0.0 ... 1.0 残響効果
balance −1.0 ... 1.0 左右のバランス
利用できる楽器を知る: instrumentnames()
この関数は，使われているンピュータで利用できる楽器のリストを返す。標準 MIDI では
次の楽器が使える。
107

### Page 108

Piano: Bass: Reed: Synth Effects:
1 Acoustic Grand Piano 33 Acoustic Bass 65 Soprano Sax 97 FX 1 (rain)
2 Bright Acoustic Piano 34 Electric Bass (finger)66 Alto Sax 98 FX 2 (soundtrack)
3 Electric Grand Piano 35 Electric Bass (pick) 67 Tenor Sax 99 FX 3 (crystal)
4 Honky-tonk Piano 36 Fretless Bass 68 Baritone Sax 100 FX 4 (atmosphere)
5 Electric Piano 1 37 Slap Bass 1 69 Oboe 101 FX 5 (brightness)
6 Electric Piano 2 38 Slap Bass 2 70 English Horn 102 FX 6 (goblins)
7 Harpsichord 39 Synth Bass 1 71 Bassoon 103 FX 7 (echoes)
8 Clavi 40 Synth Bass 2 72 Clarinet 104 FX 8 (sci-fi)
Chromatic Percussion: Strings: Pipe: Ethnic:
9 Celesta 41 Violin 73 Piccolo 105 Sitar
10 Glockenspiel 42 Viola 74 Flute 106 Banjo
11 Music Box 43 Cello 75 Recorder 107 Shamisen
12 Vibraphone 44 Contrabass 76 Pan Flute 108 Koto
13 Marimba 45 Tremolo Strings 77 Blown Bottle 109 Kalimba
14 Xylophone 46 Pizzicato Strings 78 Shakuhachi 110 Bagpipe
15 Tubular Bells 47 Orchestral Harp 79 Whistle 111 Fiddle
16 Dulcimer 48 Timpani 80 Ocarina 112 Shanai
Organ: Ensemble: Synth Lead: Percussive:
17 Organ 49 String Ensemble 1 81 Lead 1 (square) 113 Tinkle Bell
18 Percussive Organ 50 String Ensemble 2 82 Lead 2 (sawtooth) 114 Agogo Bells
19 Rock Organ 51 Synth Strings 1 83 Lead 3 (calliope) 115 Steel Drums
20 Church Organ 52 Synth Strings 2 84 Lead 4 (chiff) 116 Woodblock
21 Reed Organ 53 Voice Aahs 85 Lead 5 (charang) 117 Taiko Drum
22 Accordion 54 Voice Oohs 86 Lead 6 (voice) 118 Melodic Tom
23 Harmonica 55 Synth Voice 87 Lead 7 (fifths) 119 Synth Drum
24 Tango Accordion 56 Orchestra Hit 88 Lead 8 (bass + lead) 120 Reverse Cymbal
Guitar: Brass: Synth Pad: Sound effects:
25 Acoustic Guitar (nylon) 57 Trumpet 89 Pad 1 (new age) 121 Guitar Fret Noise
26 Acoustic Guitar (steel) 58 Trombone 90 Pad 2 (warm) 122 Breath Noise
27 Electric Guitar (jazz) 59 Tuba 91 Pad 3 (polysynth) 123 Seashore
28 Electric Guitar (clean) 60 Muted Trumpet 92 Pad 4 (choir) 124 Bird Tweet
29 Electric Guitar (muted) 61 French horn 93 Pad 5 (bowed) 125 Telephone Ring
30 Overdriven Guitar 62 Brass Section 94 Pad 6 (metallic) 126 Helicopter
31 Distortion Guitar 63 Synth Brass 1 95 Pad 7 (halo) 127 Applause
32 Guitar harmonics 64 Synth Brass 2 96 Pad 8 (sweep) 128 Gunshot
チャンネルを選ぶ: midichannel(<int>)
この関数は， playmelody あるいは playtone で使うチャンネルを選ぶ。修飾子によっ
て，選択したチャンネルの楽器や音色を変えることができる。
108

### Page 109

修飾子 型 効果
velocity 0.0 ... 1.0 音量(ピアノの(cid:20276)盤を叩く速さ)
duration <real> 音の長さ
bend −2.0 ... 2.0 半音単位での音の上げ下げ
instrument 0..15 演奏する楽器の指定
reverb 0.0 ... 1.0 残響効果
balance −1.0 ... 1.0 左右のバランス
チャンネルの音量を設定する: midivolume(<real>)
引数は0.0から1.0までの実数。通常は初期値のチャンネルが対象になるが，修飾子によっ
てチャンネルは変更できる。
修飾子は，channel で 0〜15 （チャンネル番号）あるいは ”all”（すべてのチャンネル）
チャンネルのコントローラを設定する: midicontrol(<整数>,<整数>)
第１の引数はコントローラの番号 (0..127) で，第２の引数はコントローラにセットする値
(0..127) 。コントローラは，残響効果やバランス，楽器に特有の音に影響する。修飾子は，
midivolume と同じ。
18.5 サウンド関数
周波数を指定して音を鳴らす: playsin(<real>)
この関数では一定の振幅で1秒間音を鳴らします。速さや振幅などは修飾子で指定できる。
修飾子 型 効果
amp 0.0 ... 1.0 全体の振幅
damp <real> 指数関数的に減衰する
harmonics <list> 音のスペクトル
duration <real> 鳴らす速さ
stop <real> duration と同じ
line 数または文字 音を関連付けるライン
【例】
playsin(440,damp->3,stop->5)
playsin(440,damp->3,stop->5,harmoics->[0.5,0.3,0.2,0.1])
フーリエ級数によって指数関数的に減衰する音を鳴らす。
0.5*sin(440*2*pi*x)+0.3*sin(2*440*2*pi*x)+0.2*sin(3*440*2*pi*x)
109

### Page 110

+0.1*sin(4*440*2*pi*x)
関数によって定義された音を鳴らす: playfunction(<funct>)
波形を入力して音を鳴らす。時間単位は関数の1単位が1秒にあたる。
修飾子 型 効果
amp 0.0 ... 1.0 全体の振幅
damp <real> 指数関数的に減衰する
start <real> 開始位置
stop <real> 終了位置
duration <real> 鳴らす速さ
mode 文字列 append または replace で新しい音のハンドル
line 数または文字 音を関連付けるライン
silent <bool> 発音しない
export <bool> サンプルデータの書き出し
【例】440Hzの音 playfunction(sin(440*x*pi*2));
減衰する雑音 playfunction(random(),damp->8);
1秒間の正弦波 playfunction(sin(1000*x*2*pi),stop->1/1000,duration->1)
正弦波の４４の標本点のリストを作成し，再生する。
sample=playfunction(sin(1000*x*2*pi),stop->1/1000,silent->true,export->true);
playwave(sample,duration->1);
オーディオデータのリストを再生する: playwave(<list>)
この関数は，オーディオデータのリストを再生する。データの値は − 1.0 から 1.0 の範
囲にあるものとする。サンプリングレートは 44100 Hz で，サンプル音は 1 秒間再生され
る。再生時間は duration 修飾子で指定できる。修飾子は，amp，damp，duration，line
(playfunctionの修飾子参照)
【例】 次のコードでは，playwave で再生する３つのデータを作る。 wait関数によって，３
つの音が同じラインを使うのに時間差を設ける。 playwave 関数を使う前に，オーディオ
データの作成は完了している。
sample0=apply(1..200,sin(\verb|#|*2*pi/200));
sample1=apply(1..100,sin(\verb|#|*2*pi/100));
sample2=apply(1..50,sin(\verb|#|*2*pi/50));
110

### Page 111

playwave(sample0,duration->1,line->1);
wait(400);
playwave(sample1,duration->1,line->1);
wait(400);
playwave(sample2,duration->1,line->1);
再生の停止: stopsound()
すべての音の再生を停止する。
19 ファイル管理
19.1 データの読み込み
ディレクトリを設定する: setdirectory(<文字列>)
これ以降のファイルのディレクトリを設定する。ファイルの読み書きをするときは，対象
となるディレクトリを設定してから行なう。設定しない場合はエラーとなる。
【例】
Windows： setdirectory(C:￥Users￥ユーザー名￥Desktop);
Macintosh： setdirectory(“/Users/ユーザー名/Desktop");
データの読み込み: load(<文字列>)
この関数の引数 はファイル名とする。ディレクトリ名を含んでもよい。 ファイル名が正
しければ，ファイルに含まれる全情報が文字列として返される。データは setdirectory で
指定されたディレクトリから読まれる。
プログラムコードの読み込み: import(<文字列>)
この関数の引数 はファイル名とする。ディレクトリ名を含めることはできない。ファ
イルの内容は CindyScript のコードとして解析され，実行される。こうして，あらかじ
め定義された関数ライブラリを読み込むことができる。 import 関数は CindyScript の
"Initialization" スロットに記述する。
19.2 データの書き出し
テキストデータの書き出しは次の手順で行われる。
1. setdirectory 関数を用いてディレクトリを指定する。
2. ファイルを開く
111

### Page 112

3. ファイルに書く
4. ファイルを閉じる
ファイルを開く: openfile(<文字列>)
指定した名前のファイルを開く。戻り値は書き出しに必要な<ファイル名>。
ファイルに書いて改行する: println(<ファイル名>,<文字列>)
println と同様だが， <ファイル名> で指定したファイルに書き出す。
ファイルに書く: print(<ファイル名>,<文字列>)
print と同様だが <ファイル名> で指定したファイルに書き出す。
ファイルを閉じる: closefile(<ファイル名>)
ファイルを閉じる。引数のファイル名は，openfile() の戻り値。
【例】次の例は，ファイルに書き出す一連の手順を示す。
setdirectory("path");
f=openfile("myFile");
println(f,"ここにいくつかの数があります。");
forall(1..15,print(f,\verb|#|+" "));
println(f,"");
closefile(f);
カレントディレクトリの取得
Cinderella のファイルを開いたとき，そのファイルのあるディレクトリが，変数
loaddirectory に入る。たとえば，デスクトップに置いたファイルを開き，
println(loaddirectory)
を実行すると，コンソールに
/Users/ユーザー名/Desktop/
と表示される。
【注】この内容は，オリジナルのマニュアルには記述されていない。
19.3 HTML との連携
Web ページを開く: openurl(<文字列>)
ブラウザを立ち上げ，<文字列>のWebページを開く。ブラウザは，通常で使っているもの。
112

### Page 113

javascript を呼び出す: javascript(<文字列>)
書き出されたアプレットにおいて，ブラウザの Javascript 環境での命令を呼び出す。この
命令の内容は <文字列> に書く。スタンドアロンのアプリケーションでは何もしない。
【例】次のコードでは，ブラウザ上にポップアップウィンドウを表示してメッセージを出す。
javascript("alert(’Hi from Cinderella!!’)");
19.4 ネットワーク
TCP ポートを開く: openconnection(<文字列>,<int>)
第１引数で指定されたサーバーへの TCP 接続を行い，第２引数で指定されたポートを開
く。戻り値は，このネットワーク接続へのハンドル。
TCP へ書きだす: print(<handle>,<文字列>)
TCPへ書きだす: println(<handle>,<文字列>)
print と println 関数は，ファイルだけでなく openconnectionによって作られるネット
ワークへも書き出しを行なう。
TCP ポートへの出力と消去: flush(<handle>)
与えられた接続への出力バッファを消去する。
TCP 接続からの読み込み: readln(<handle>)
与えられた接続から行を読む。もしデータがなければ5秒後にタイムアウトする。
TCP 接続を閉じる: closeconnection(<handle>)
与えられたハンドルの接続を閉じる。
【例】次のコードでは，Web サーバを開いて，そこからHTMLコードを読み出す。
x=openconnection("cermat.org",80);
println(x,"GET /");
y="";
while(!isundefined(y),y=readln(x);println(y));
closeconnection(x);
113

### Page 114

19.5 コンソールへの出力
テキストの印字: print(<expr>)
この関数は を評価した結果をコンソールに表示する。
テキストの印字: err(<expr>)
この関数は， <expr> を評価した結果をコンソールに表示する。<expr> が変数であれば
変数の値が表示される。
テキストの印字と改行: println(<expr>)
この関数は <expr> を評価して画面に表示して改行する。引数がなければ改行だけ行う。
画面クリア: clearconsole()
コンソール画面からすべての文字を消去してクリアする。
条件の印字: assert(<bool>,<expr>)
この関数は，エラーメッセージを作って表示するのに用いられる。この関数は
if(<bool>,println(<expr>)) を実行するのと同じ。条件が満たされるかどうかを調べて，
エラーメッセージを作成する。
【例】assert(isinteger(k),"k is not an integer");
ステータス行に表示: message(<expr>)
この関数は，ステータス行（ツールバーの下），または，Cinderella・アプレットのための
ブラウザのステータス行で<expr> を評価した結果を表示する。
20 時間とアニメーション
20.1 時間
time 時刻にアクセスする: time()
この関数は４つの整数からなるリスト [h,m,s,ms] を返す。４つの数はコンピュータの時計
で "hour," "minute," "second," "millisecond" に相当する。
日にアクセスする: date()
この関数は３つの整数からなるリスト [y,m,d] を返す。 ３つの数は，コンピュータのカ
レンダーの "year," "month," "day" に相当する。
114

### Page 115

時刻表示: seconds()
この関数は， resetclock() の実行後に経過した時間を返す。時間は１単位が１秒になるよ
うに調整される。時計の精度はミリ秒。
内部時計のリセット: resetclock()
seconds 関数の値をリセットする。
待ち時間: wait(<real>)
パラメータで与えられたミリ秒単位ですべてのスクリプトの実行を止める。
20.2 アニメーションのコントロール
アニメーションを始める: playanimation()
アニメーションを始める。CindyLab の物理シミュレーションも同様。
アニメーションの一時停止: pauseanimation()
アニメーションを一時停止する。
アニメーション停止: stopanimation()
アニメーションを停止する。幾何学要素などの状態は初めの状態に戻る。
21 ユーザー入力
Cindyscript に よ り ，マ ウ ス や キ ー ボ ー ド に よ る 入 力 が で き る 。そ の と き ，
"Mouse Down," "Mouse Up," "Mouse Click," "Mouse Drag," "Key Typed" の
各スロットを使う。また，加速度センサが搭載されていればこれを利用することができる。
21.1 マウスとキーボード
マウスの位置: mouse()
マウスボタンが押されたとき，マウスの位置を表すベクトルを返す。ベクトルは同次座標。
(無限遠点も考慮する) ２次元のユークリッド座標が必要であれば， mouse().xy によって座
標が得られる。
キー入力: key()
キーボードで打たれた文字列を返す。
あるキーが押されたか: iskeydown(<整数>)
115

### Page 116

この関数は，ある特定のキーが押されたならばブール値 true を返す。そのキーは整数の引
数で与える。キーの番号は，たとえば 65, 66, 66, .... が ’A’, ’B’, ’C’,... に対応する。 ’shift’,
’crtl’ と ’alt’ は 16, 17, 18 である。
押されたキーのリスト: keydownlist()
この関数は，押されたキーのリストを返す。
21.2 加速度センサにおける AMS データ
AMS データの取得: amsdata()
この関数は AMS センサの生のデータを取得する。
調整された AMS データの取得: calibratedamsdata()
この関数は， AMS センサの調整されたデータを取得する。調整されたデータは，空間に
おけるパソコンの位置をベクトルデータとしたもの。
22 CindyLab との連携
22.1 シミュレーション環境
simulation()
この関数はシミュレーション環境へのハンドルを与える。この関数で，たとえば，運動や
位置エネルギーにアクセスできる。
・friction シミュレーション全体の摩擦力 (実数, 読み書き可)
・gravity シミュレーション全体の重力 (実数, 読み書き可)
・kinetic シミュレーション全体の運動エネルギー (実数, 読み出しのみ)
・ke 同上 (実数, 読み出しのみ)
・potential シミュレーション全体の位置エネルギー (実数, 読み出しのみ)
・pe 同上 (実数, 読み出しのみ)
力の適用: addforce(<質量>,<vector>)
力を存在する質点 に適用する。これは， Integration Tick スロットに置かなければなら
ない。
力の設定: setforce(<質量>,<vector>)
力 を存在する質点 に設定する。これは， Integration Tick スロットに置かなければな
らない。
力の探索粒子: force(<vector>)
この関数は，特定の場所で粒子に及ぼす力をテストするのに使うことができる。ベクトル
116

### Page 117

は位置を表す。関数はこの位置での力を２次元ベクトルで返す。修飾子が使われないならば，
探針となる粒子は，質量が1，電荷が1，半径が1であるとみなされる。
【注】もとのマニュアルには，ここに例が載っているが，仕様変更のためか，最近の版ではう
まく動かないようなので割愛する。
修飾子: 質量と電荷，半径を明示することも可能。これらはその名前の修飾子で設定される。
これらのうち少なくとも１つが設定されたならば，残りのものは 0 に設定される。 したがっ
て， force((0,0),charge->2) は，電荷2，質量0，半径0の粒子で，点 point [0,0] の
力をテストする。
117

### Page 118

23 Cindy3D
Cinderella でレイトレーシングを用いた空間図形を描くには，同梱されている Cindy3D
プラグインを用いる。Initailiazarion スロットの先頭に次の１行を書く。
use("Cindy3D");
これで Cindy3D の各関数が使えるようになる。スクリプトを書いて実行すると別ウィン
ドウが開いて描画がされる。
【重要な注意】
Cindy3D は，ファイルメニューの「HTMLに書き出す」でHTMLファイルに書き出して
も CindyJS では使えない。CindyJS で 3D を扱うには，HTML ファイルを直接編集する必
要がある。
23.1 設定
以下の関数は初期値の設定なので，最初に一度だけ実行すればよく， Initialization スロッ
トにuse("Cindy3D"); に続いて記述すればよい。
色の初期設定：color3d([R,G,B])
すべてのオブジェクトの表示色の初期値をRGB値に設定する。
【例】 color3d([0.8,0.8,0]); 表示色を少し暗い黄色に設定する。
点の色の初期設定：pointcolor3d([R,G,B])
点の表示色の初期値をRGB値に設定する。
線の色の初期設定：linecolor3d([R,G,B])
線の表示色の初期値をRGB値に設定する。
面の色の初期設定：surfacecolor3d([R,G,B])
面の表示色の初期値をRGB値に設定する。
透明度の初期設定：alpha3d(<real>) または surfacealpha3d(<real>)
面の透明度の初期値を設定する。引数は0以上1以下の実数。
118

### Page 119

光沢の初期設定：shininess3d(<real>)
すべてのオブジェクトの光沢の初期値を<real>に変更する。
点の光沢の初期設定：pointshininess3d(<real>)
点の光沢の初期値を<real>に変更する。
線の光沢の初期設定：lineshininess3d(<real>)
線の光沢の初期値を<real>に変更する。
面の光沢の初期設定：surfaceshininess3d(<real>)
面の光沢の初期値を<real>に変更する。
サイズの初期設定：size3d(<real>)
点と線のサイズの初期値を<real>に変更する。
点のサイズの初期設定：pointsize3d(<real>)
点のサイズの初期値を<real>に変更する。
線の太さの初期設定：linesize3d(<real>)
線のサイズの初期値を<real>に変更する。
23.2 描画関数
以下の関数は Draw スロットに記述する。
Cindy3D の描画開始：begin3d()
Cindy3D の描画終了：end3d()
Cindy3D の描画関数の使い始めと使い終わりを宣言する。Cindy3D の描画関数は、
begin3d() から end3d() までの間に書かれたものが実行される。
現在の描画設定の保存：gsave3d()
現在の描画に関する諸設定をスタックに保存する。
描画設定の復帰：grestore3d()
スタックに保存された描画に関する諸設定を呼び出して、その状態に復帰する。
点を描く：draw3d(<point>)
119

### Page 120

座標 <point> に点を打つ。
修飾子 値 効果
size ＜real ＞ 点の大きさを指定する
color [＜real ＞,＜real ＞,＜real ＞] 色をRGBで指定する
shininess ＜real ＞ 光沢を指定する
線を描く：draw3d(<point1>,<point2>)
線分，反直線，直線を描く。線の種類は type 修飾子で指定する。指定がなければ線分が描
かれる。２つの引数は、線の種類に応じて解釈される。
線種 point1 point2
線分 始めの端点 終わりの端点
反直線 始点 通る点
直線 直線上の点 直線上のもう一つの点
修飾子 値 効果
type ＜string ＞ segment,ray,line のいずれか
size ＜real ＞ 線の太さを指定する
color [＜real ＞,＜real ＞,＜real ＞] 線の色をRGB値でを指定する
shininess ＜real ＞ 光沢を指定する
【例】次の例は3種類の線を描画する。
・ (0,0,0) と (1,0,0) を端点とする線分
draw3d([0,0,0],[1,0,0],color->[1,0,0])
・ (0,0,0) と (0,1,0) を端点とする緑色の線分
draw3d([0,0,0],[0,1,0],type->"segment",color->[0,1,0])
・(0,0,0) を始点として、(0,0,1) を通る青の半直線
draw3d([0,0,0],[0,0,1],type->"ray",color->[0,0,1])
・ (1,1,1) と (2,1,1) を通る黄色の直線
draw3d([1,1,1],[2,1,1],type->"line",color->[1,1,0])
120

### Page 121

点を結ぶ：connect3d(<list>)
<list>で与えられた各点を線分で結ぶ。
修飾子 値 効果
size ＜real ＞ 線の太さを指定する
color [＜real ＞,＜real ＞,＜real ＞] 色をRGBで指定する
shininess ＜real ＞ 光沢を指定する
多角形を描く：drawpoly3d(<list>)
<list>で与えられた各点を線分で結んで多角形を描く。
修飾子 値 効果
size ＜real ＞ 線の太さを指定する
color [＜real ＞,＜real ＞,＜real ＞] 色をRGBで指定する
shininess ＜real ＞ 光沢を指定する
多角形の面を描く：fillpoly3d(<list>)
<list>で与えられた各点を線分で結んで多角形の面を描く。
修飾子 値 効果
size ＜real ＞ 面の大きさを指定する
color [＜real ＞,＜real ＞,＜real ＞] 色をRGBで指定する
shininess ＜real ＞ 光沢を指定する
alpha ＜real ＞ 透明度を指定する
121

### Page 122

法線ベクトルを指定して多角形の面を描く：fillpoly3d(<list1>,<list2>)
ユーザー定義の法線ベクトルによる多角形の面を描く。法線ベクトルは、光の当たり方を
計算するものである。
<list1>は多角形の頂点の座標，<list2> は多角形の各頂点の法線ベクトル。 <list1>
と <list2> の長さは一致する必要がある。
修飾子 値 効果
size ＜real ＞ 面の大きさを指定する
color [＜real ＞,＜real ＞,＜real ＞] 色をRGBで指定する
shininess ＜real ＞ 光沢を指定する
alpha ＜real ＞ 透明度を指定する
円盤を描く：fillcircle3d(<point>,<vec>,<real>)
<point>を中心、<vec>を法線ベクトル、<real>を半径とする円盤を描く。
修飾子 値 効果
size ＜real ＞ 面の大きさを指定する
color [＜real ＞,＜real ＞,＜real ＞] 色をRGBで指定する
shininess ＜real ＞ 光沢を指定する
alpha ＜real ＞ 透明度を指定する
【例】座標軸と円盤を描く。
Initialization スロットに次のコードを書く。以後の例も同様。
use("Cindy3D");
background3d([0.9,0.9,1]);
renderhints3d(quality->4);
lookat3d([4,4,4],[0,0,0],[-1,-1,0]);
drawスロットに次のコードを書く。
renderhints3d(quality->4);
begin3d();
draw3d([0,0,0],[3,0,0],color->[1,0,0],size->0.3); // 座標軸
122

### Page 123

draw3d([0,0,0],[0,3,0],color->[0,1,0],size->0.3);
draw3d([0,0,0],[0,0,3],color->[0,0,1],size->0.3);
fillcircle3d([sqrt(3)/6,sqrt(3)/6,sqrt(3)/6],[1,1,1],
sqrt(3)/2,color->[1,0,0],alpha->0.3);
end3d()
renderhints3d(quality->4) はレンダリングの品質を指定する関数。（後述）
左が実行結果。右はマウスで画面上をドラッグし，回転したもの。
球面を描く：drawsphere3d(<point>,<real>)
<point>を中心、<real>を半径とする球面を描く。
修飾子 値 効果
size ＜real ＞ 面の大きさを指定する
color [＜real ＞,＜real ＞,＜real ＞] 色をRGBで指定する
shininess ＜real ＞ 光沢を指定する
alpha ＜real ＞ 透明度を指定する
網目上の曲面を描く：mesh3d(<int1>,<int2>,<list>)
曲面を、m行n列の格子点でできる網目状に区切る。（メッシュモデル）
<int1> 格子点の行数 m
<int2> 格子点の列数 n
<list> 格子点のリスト
リストは2次元の格子点のリストを平坦化したもので，リストの長さは m × n 。
【例】図は、５行７列の格子点からなる放物線状の面。修飾子の効果を比較するため、かなり
荒い網目にしてある。
123

### Page 124

begin3d();
pt=apply(-2..2,s,
apply(-3..3,t,
y = s/3;
x = t/3;
z = x^2+y^2;
(x,y,z);
);
);
pt=flatten(pt,levels->1);
mesh3d(5,7,pt);
end3d()
apply 関数のネストにより作成した格子点のリストを、flattenn() により平坦化して引
数に与えている。
修飾子 値 効果
法線のタイプを指定する。値は
nomaltype ＜string ＞
”perface” , ”pervertex”
topology を指定する。値は
topology ＜string ＞ ”open”, ”closerows”, ”closecolumns”,
”closeboth” のいずれか
size ＜real ＞ 面の大きさを指定する
color [＜real ＞,＜real ＞,＜real ＞] 色をRGBで指定する
shininess ＜real ＞ 光沢を指定する
alpha ＜real ＞ 透明度を指定する
「normaltype」修飾子は，各面の法線の計算方法を指定する。指定がなければ「perface 」
として処理される。
124

### Page 125

nomaltype 説明
各面の法線はその面上の三角形の法線。その結果、面の端で光の
perface
当たり方が不連続になり、格子構造が明らかになる。
各面の法線はその面上の三角形の頂点の３本の法線をとり、その
pervertex 一次結合によって計算される。その結果、面の端での光の当たり
方が連続的になり、格子構造が見えなくなる。
perface pervertex
topology 修飾子は面の端の状態を指定する。指定がなければ、open として処理される。
topology 説明
端点もしくは面の端の点までが面になる。その結果、(m-1) ×
open
(n-1) 個の矩形ができる。 面は両サイドと１つの境界を持つ。
各行の最初と最後の頂点が結合されて対応する面ができる。その
closerows 結果、(m-1) × n 個の矩形ができる。面は両サイドと２つの境界
を持つ。
各列の最初と最後の頂点が結合されて対応する面ができる。その
closecolumns 結果、m × (n-1) 個の矩形ができる。面は両サイドと２つの境界
を持つ。
各行の最初と最後および各列の最初と最後の頂点が結合されて対
closeboth 応する面ができる。その結果、m×n 個の矩形ができる。面は両
サイドを持ち境界はない。
125

### Page 126

closerows closecolumns
法線ベクトルを指定して網目を描く：mesh3d(<int1>,<int2>,<list1>,<list2>)
ユーザー定義による法線ベクトルによって網目を描く。
<int1> 格子点の行数： m <int2>：格子点の列数 n <list>：格子点のリスト
<list2> 各格子点での法線ベクトルのリスト。
リストの長さはいずれも m × n 。
修飾子 値 効果
topology を指定する。
topology ＜string ＞ 値は open, closerows, closecolumns,
closeboth のいずれか
size ＜real ＞ 面の大きさを指定する
color [＜real ＞,＜real ＞,＜real ＞] 色をRGBで指定する
shininess ＜real ＞ 光沢を指定する
alpha ＜real ＞ 透明度を指定する
23.3 光の当て方と表現
背景の色を設定する：background3d(<colorvec>)
背景の色 <colorvec> をRGB値で設定する。
カメラの位置：lookat3d(<point1>,<point2>,<vec>)
３Ｄグラフィクスの表示は、空間に置いたカメラで物体を写していると考える。この関数
は、カメラの位置と向きを設定する。カメラにはレンズがついていて、レンズの向き（視線
の方向）で物を見ていると考える。
<point1>：カメラの位置 <point2>：回転の中心 <vec>：視線の方向
126

### Page 127

画角の設定 ：fieldofview3d(<real>)
カメラの画角を設定する。実際のカメラの画角と同じ。画角が小さいと望遠（被写体が大
きく写る）、大きいと広角（小さく写る）になる。初期設定は45°。
カメラ深度の設定：depthrange3d(<real1>,<real2>)
カメラの最小・最大深度を設定する。カメラの深度とは、カメラ面（カメラを通り、視線
方向に垂直な面）と点の距離。カメラ深度に入らないものは表示されない。第 1 引数が最小
値、第2引数が最大値。
レンダリングのヒントを設定する：renderhints3d()
レンダリングの過程における様々な比率のヒントを設定する。
修飾子 値 効果
quality ＜int ＞ 品質レベルを選ぶ。値は 0 以上 8 以下
レンダリングモードを指定する。
renderMode ＜string ＞
値は ”sinple” か ”raycated”
sampleRate ＜int ＞ ピクセルごとのサンプル数を設定。1以上の整数。
ピクセルにおける最大の screen space error を
screenError ＜real ＞
設定する。値は 0より大きな実数
”quality” 修飾子は規定の品質レベルのいずれかを選ぶ。レベル 0 は最低の品質だが、最
小のリソースですむ。最大の品質は 8 で、非常によい品質だが多くのリソースを必要とする。
あらかじめ品質レベルが設定されているのは、個々のレンダリングヒントを操作することな
く、全体の品質を簡単に管理できるようにするため。要請された品質レベルがサポートされ
ない（例えばハードウェアの制限やリソースの制約のため）とき、Cindy3D は下位のレベル
に移行するかもしれない。
quality->1 quality->4
127

### Page 128

”renderMode” 修飾子は、オブジェクトのレンダリングについて指定する。”simple”の場
合は、すべてのオブジェクトは三角形の網目としてレンダリングされる。このモードでは
シェーディングは頂点ごとに行われ、上図左のように粗削りになる。 ”raycasted”の場合は、
点・直線・球面はレイ・キャスティングを用いた連続面としてレンダリングされる。また、
シェーディングは点ごとに行われる。上図右のようになる。 ”raycasted” モードでは高品質
が得られるがハードウェアの条件によっては時間がかかる。
”screenError” 修飾子は、スクリーン・スペース・エラーをデティール・アルゴリズムの
レベルに設定する。 ”simple” モードでは、 点・直線・球面は三角形の網目で近似される。
最適化のために、小さい、あるいは遠いオブジェクトはレンダリング時間を節約するために
少しの三角形網目にする。これを ”level of detail”と呼ぶ。 Cindy3D は、それぞれのプリ
ミティブに対して、異なる三角形網目ごとに決められた定数を用いている。あるプリミティ
ブに対しどの定数を用いるかは、各網目をスクリーン上に仮想的に投影し、ピクセルごと
に最大の三角形の大きさを計測して決定される。それから、最大と予測される三角形サイ
ズが「screenError」の下にある最も小さな網目が、プリミティブを生成するために使われ
る。これは、「screenError」の低い値がより高い品質となることを意味する。この修飾子は
”raycasted”レンダリングモードのもとでは無効になる。
”samplingRate” 修飾子は、オブジェクトのシルエットの滑らかさに影響する。サンプリン
グ・レートは、出力イメージの各々のピクセルに対するサンプルの数を定める。最終的なピク
セルの色はそれらのサンプルの平均値。サンプリングレートが高いほど、記憶領域と時間を
消費するがオブジェクトシルエットはより滑らかになる。要請されたサンプリング・レート
をサポートできないとき（例えばハードウェアの制限やリソースの制約のための）、Cindy3D
は低いサンプリング・レートに移行するかもしれない。
※訳者の実験では、品質は quality の例で示した 2 通りくらいで、数値を変えてもあまり
変化はなかった。（ハードウェアの制限などによるかもしれない）renderMode の ”simple”
, ”raycasted” の違いも同様。あとの２つの修飾子の効果については翻訳時点では不明
だった。デフォルトでは quality->1 なので、 renderhints3d(quality->4) もしくは
renderhints3d(renderMode->"raycasted") で運用するのがよさそうだ。
点光源の設定：pointlight3d(<int>)
<int> は，光源の番号で0以上７以下の整数。
点光源を発生または修正する。指定された光源がすでに存在するならば修飾子によって指
定された状態に修正し、利用可能にする。そうでなければ、指定された点光源を作る。修飾
子がなければ初期値が使われる。点光源は８つまで作ることができ、それぞれに番号を振る。
128

### Page 129

修飾子 値 効果
周囲の色をRGB 値で指定された色にする
ambient [R,G,B]
(初期値は [0,0,0])
拡散する光の色を RGB 値で指定された色にする
diffuse [R,G,B]
(初期値は [1,1,1])
反射光の色を RGB 値で指定された色にする
specular [R,G,B]
(初期値は [1,1,1])
position ＜point ＞ 点の位置 (初期値は [0,0,0])
位置がカメラフレームに依存するか、絶対位置
frame ＜string ＞ かを指定する。値は”camera” か ”world” で、
初期値は ”camera”
点光源の指定なし 点光源１ diffuse->[1,1,0]
点光源2 position->[8,0,0],diffuse->[0,0,1]) 点光源１と２
方向光源の設定：directionallight3d(<int>)
<int>は，方向光源の番号で0以上７以下の整数。
方向光源を発生または修正する。 指定された方向光源がすでに存在するならば修飾子に
129

### Page 130

よって指定された状態に修正し、利用可能にする。そうでなければ、指定された方向光源を
作る。修飾子がなければ初期値が使われる。
修飾子 値 効果
周囲の色をRGB 値で指定された色にする
ambient [R,G,B]
(初期値は [0,0,0])
拡散する光の色を RGB 値で指定された色にする
diffuse [R,G,B]
(初期値は [1,1,1])
反射光の色を RGB 値で指定された色にする
specular [R,G,B]
(初期値は [1,1,1])
direction ＜vec＞ 光の方向 (初期値は [0,-1,0])
方向がカメラフレームに依存するか、絶対的か
frame ＜string ＞ を指定する。値は”camera” か ”world” で、初
期値は ”camera”
方向光源の指定なし 方向光源１ diffuse->[1,1,0]
方向光源2 direction->[8,0,0],diffuse->[0,0,1]) 方向光源１と２
130

### Page 131

スポットライトの設定：spotlight3d(<int>)
<int>は，光源の番号で0以上７以下の整数。
スポットライトを発生または修正する。 指定された光源がすでに存在するならば修飾子に
よって指定された状態に修正し、利用可能にする。そうでなければ、指定された光源を作る。
修飾子がなければ初期値が使われる。
修飾子 値 効果
周囲の色をRGB 値で指定された色にする
ambient [R,G,B]
(初期値は [0,0,0])
拡散する光の色を RGB 値で指定された色にする
diffuse [R,G,B]
(初期値は [1,1,1])
反射光の色を RGB 値で指定された色にする
specular [R,G,B]
(初期値は [1,1,1])
position ＜point ＞ 点の位置 (初期値は [0,0,0])
direction ＜vec＞ 光の方向 (初期値は [0,-1,0])
スポットコーンのカットオフ角。ラジアンで指
cutoffAngle ＜real ＞ π π
定。 0 から 初期値は
2 4
exponent ＜real ＞ 減衰指数。値は 0以上128未満。初期値は０
方向がカメラフレームに依存するか、絶対位置
frame ＜string ＞ かを指定する。値は”camera” か ”world” で、
初期値は ”camera”
光源を無効にする：disablelight3d(<int>)
<int>は，光源の番号で0以上７以下の整数。
与えられた番号の光源を無効にする。
131

### Page 132

24 CindyJS
CindyJS コンテンツを作成するには、Cinderella でコンテンツを作成してファイルメ
ニューから「HTML に書き出す」か，直接 HTML ファイルをテキストエディタなどで編集
する。ただし，Cinderella とは完全互換ではないので，Cinderella で作ったものがそのまま
HTMLで動くとは限らない。また，その逆もある。
24.1 CindyJS の HTML 基本構造
HTMLファイルをテキストエディタなどで編集する場合の最小構造は次の通りである。
<!DOCTYPE html>
<html>
<head>
<script type="text/javascript"
src="https://cindyjs.org/dist/latest/Cindy.js"></script>
<title>タイトル</title>
<script id="csinit" type="text/x-cindyscript">
初期設定
</script>
<script id="csdraw" type="text/x-cindyscript">
メインコード
</script>
<script type="text/javascript">
CindyJS({
scripts: "cs*",
autoplay: true,
geometry: [
幾何要素
],
ports: [{
id: "CSCanvas",
width: 500,
height: 500,
transform: [{
visibleRect: [0, 1, 1, 0]
}]
132

### Page 133

}]
});
</script>
</head>
<body>
<div id="CSCanvas"></div>
</body>
</html>
以下に，この内容について解説する。
24.1.1 CindyJS ランタイムのロード
<script type=・・・/latest/Cindy.js"></script>で CindyJS のサイトから最新の
ランタイムをロードする。Cinderella から書き出した場合は，CSS をロードする次の行が
入る。
<link rel="stylesheet" href="https://cindyjs.org/dist/v0.8/CindyJS.css">
CindyJS のサイトから Cindy.js と CindyJS.css をダウンロードして置いた場合は，同
じディレクトリであれば
<link rel="stylesheet" href="CindyJS.css">
<script type="text/javascript" src="Cindy.js"></script>
と書けばよい。
ヘッダには，この他，スタイルシートの内容などの事項を書くことができる。
また，CindyGL などを使う場合も同様に記述する。
24.1.2 スクリプトの記述
<script id="csinit" type="text/x-cindyscript">
には，CindyScript の初期設定を書く。Cinderella で Initialization スロットに書く内容
だ。内部時計を取得する seconds() を使う場合は，ここに resetclock(); を書く。
<script id="csdraw" type="text/x-cindyscript">
には，drawスロットに書く内容を記述する。
この他次の id が使える。CindyScript の各スロットに応じている。
133

### Page 134

csmove いくつかの要素が移動したとき呼び出される
csmousedown マウスボタンが押された後に呼び出される
csmousemove マウスが動かされたときに呼び出される
csmousedrag マウスがドラッグされたときに呼び出される
csmouseup マウスボタンが離されたら呼び出される
csmouseclick マウスボタンをクリックすると呼び出されます
cskeydown キーが押されたときに呼び出される
cstick 時間をとったアニメーションを実行する
csmultidown マルチタッチで指が下がった後に呼び出される
csmultidrag マルチタッチでドラッグしたときに呼び出される
csmultiup マルチタッチで指が離された場合に呼び出される
24.1.3 CindyJS の初期化
CindyJS() はCindyJS の初期化関数。以下のパラメータを持つ。
scripts
scripts: "cs*" は、前述の cs で始まるすべてのスクリプトがアプレットに使用される
ことをいう。"csinit" などだ。
アニメーションautoplay:true は、新しいフレームがレンダリングされたときに常に Draw
スクリプトを実行する必要があると述べている。このオプションがなければ、構造に何かが
変わった場合にのみ、画像は再描画される。
この他，次のオプションがある。
・controls は、アニメーション制御ボタン (再生、一時停止、停止) を表示するかどうかを
制御するブール値。
・speed はアニメーション速度。デフォルトは1。
幾何要素
geometry ブロックは幾何要素についての記述で，作図ツールでとる点や線分などの情報
が入る。たとえば，
{name:"A", kind:"P", type:"Free", pos:[-4,4]}
は，自由点A を座標 [-4,4] に取ることを表す。
ports
ports ブロックは出力ポートを指定する。次の項目からなる。
134

### Page 135

id 描画キャンバスの要素id
element 描画キャンバスのDOM 要素
width, height キャンバスの寸法
background キャンバスに使用するCSS の背景色。初期値は透明。
transform 座標系変換を指定する。オプションについては後述。省略可。
fill ”window”ウィンドウのinnerWidth とinnerHeight と
一致するようにキャンバスのサイズを調整する。
grid ユーザー単位でグリッドサイズを指定する。
欠落またはゼロの値は、グリッドが描画されない。
snap ブール値でスナップモードの指定。デフォルトはfalse。
axes 座標軸を描画するかどうかを示すブール値。デフォルトはfalse。
ports の transform のオプション
・{scale :<number>]}
スケール量
・{translate:[<number>,<number>]}
平行移動量
・{scaleAndOrigin:[<number>,<number>,<number>]}
事前状態を参照せずに変換を指定する。最初の数字はスケーリング係数で、他の 2 つは原
点の位置
・{visibleRect:[<number>,<number>,<number>,<number>] }
ウィジェットのサイズを変更するとうまく相互作用する方法で、以前の状態を参照せずに
変換を指定する。指定された座標は、ユーザー座標で指定された目に見える長方形の左、上、
右、下の座標。座標系は、この長方形が完全に見え、ウィジェット内の中央に配置されるよ
うに選択される。
この他に，defaultAppearance などのパラメータがある。Cinderella で簡単なスクリプ
トを書いて，HTML文書に書き出してみるとよい。
ここまでがHTMLのヘッダで，そのあとに<body> を書く。
<body> には，<div id="CSCanvas"></div> の他に，説明文など通常の HTML の文書
を書くことができる。
24.2 CindyJS の HTML 文書の実例
次の例は，マンデルブロ集合を描くための，CindyJS のHTML文書である。
135

### Page 136

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>mandelbloat set</title>
<script type="text/javascript"
src="https://cindyjs.org/dist/latest/Cindy.js"></script>
<script id="csdraw" type="text/x-cindyscript">
N = 30;
f(x):=(
c = complex(x); //-0.75; //center -0.75+0*i
z = 0;
n = 0;
repeat(N, k,
if(|z| <= 2,
z=z*z+c;
n = k;
);
);
hue(n/N)
);
colorplot(f(#));
</script>
<script type="text/javascript">
CindyJS({
scripts: "cs*",
autoplay: true,
ports: [{
id: "CSCanvas",
width: 500,
height: 500,
transform: [{
visibleRect: [-2, 2, 2, -2]
}]
}]
136

### Page 137

});
</script>
</head>
<body>
<div id="CSCanvas"></div>
</body>
</html>
Cinderella で，２点 A(-2,-2) , B(2,2) を作図し，CIndyScript のDrawスロットに次
のコードを書いて実行し，HTMLに書き出したものと比較すると，Cinderella からの書き出
しでどのような情報が追加されているかがわかるだろう。
N = 30;
f(x):=(
c = complex(x);
z = 0;
n = 0;
repeat(N, k,
if(|z| <= 2,
z=z*z+c;
n = k;
);
);
hue(n/N);
);
colorplot(f(#),A,B,pxlres->1);
137

### Page 138

25 索引
制御
if もし〜ならば〜
trigger 条件を満たせば実行
while While 繰り返し
repeat 繰り返し
forall すべての要素に対して繰り返し
eval 式の強制的な評価
変数の管理
clear 変数をクリア
keys オブジェクトまたは変数に関連したローカルキーのリストを返す
createvar 局所変数の作成
removevar 局所変数の削除
regional l局所変数を作る。引数の数は任意
出力
print 値を印字する
println 印字して改行する
clearconsole コンソールをクリア
err デバッグ用の印字
assert エラーチェックの印字
format 数を整形する
message ステータス行にメッセージを表示する
算術関数
sqrt 平方根
exp 指数関数
log 自然対数
sin 正弦
cos 余弦
tan 正接
arcsin 正弦の逆関数
arccos 余弦の逆関数
arctan 正接の逆関数
arctan2 ベクトル(x,y) のなす角
add 和
sub 差
138

### Page 139

mult 積
div 商
mod 剰余
pow べき乗
abs 絶対値
round 四捨五入
floor その数以下の最大の整数
ceil その数以上の最小の整数
re 複素数の実部
im 複素数の虚部
conjugate 共役複素数
random 一様乱数
randominteger 整数の一様乱数
randombool ブール値の乱数true またはfalse
randomnormal 正規乱数
seedrandom 乱数の種(seed) の設定
ブール関数
not 論理否定
and 論理積
or 論理和
xor 排他的論理和
型の判定
isinteger 整数か
isreal 実数か
iscomplex 複素数か
iseven 偶数か
isodd 奇数か
islist リストか
ismatrix 行列か
isnumbervector 数ベクトルか
isnumbermatrix 数行列か
isstring 文字列か
isgeometric 幾何学要素か
isselected 選択されているか
ispoint 幾何の点か
isline 直線か
iscircle 円か
139

### Page 140

isconic 円錐曲線か
ismass 質点か
issun 恒星か
isspring バネか
isundefined 未定義要素か
文字関数
text 文字列への変換
parse CindyScript の式として文字列を解析
substring 文字列の抜きだし
replace 文字列の置換
tokenize 文字列の分解
indexof 文字列の検索
length 文字列の長さ
format 数を整形する
guess 文字列の解析
sort リストの並べ替え
fontfamilies 使用可能なフォントのリストを得る
unicode ユニコードを文字列に変換する
candisplay 文字列が現在のシステムフォントで表示できるかどうかテストする
微積分
d 関数の微分
tangent 接線を計算する
guess 浮動小数点数から記号的意味を推測する
roots ｎ次方程式の解を与える
基本的なリスト処理
take リストの要素へのアクセス
length リストの長さ
contains 内容のテスト
append 要素の後方追加
prepend 要素の前方追加
concat リストの連結
common リストの共通部分
remove リストからの要素の削除
リストの要素の走査
forall 全要素を走査する
apply 全要素に式を適用する
select 条件を満たす要素を選び出す
140

### Page 141

高度なリスト処理
pairs リストの要素のすべてのペアを作る
triples リストの要素のすべての3つの組を作る
directproduct 2つのリストの直積
consecutive リストの連続する要素のペアからなるチェーンを作る
cycle 連続する２つずつの要素のペアで輪を作る
reverse リストの要素を逆順にする
set リストの要素を単一化した集合を作る
sort リストの要素を並べ替える
flatten ネストされたリストの平坦化
幾何学要素のリスト
allelements すべての要素のリストを作る
allpoints すべての点のリストを作る
alllines すべての直線のリストを作る
allsegments すべての線分のリストを作る
allcircles すべての円のリストを作る
allconics すべての円錐曲線のリストを作る
allmasses すべての質点のリストを作る
allsprings すべてのバネのリストを作る
リストの算術演算
sum 要素の総和を求める
product 要素をすべて掛け合わせる
min 要素の最小値を求める
max 要素の最大値を求める
ベクトルと行列の操作
zerovector 零ベクトルを生成する
zeromatrix 零行列を作る
rowmatrix 行ベクトルから行列への変換
columnmatrix 列ベクトルから行列への変換
matrixrowcolumn 行と列の数を2つの数の要素からなるリストとして返す
row 行をベクトルとして返す
column 列をベクトルとして返す
submatrix 小行列を作る
transpose 転置行列を返す
dist ベクトルの距離を返す
det 正方行列の行列式を返す
hermiteanproduct ２つのベクトルのエルミート内積を返す
141

### Page 142

inverse 正方行列の逆行列を返す
adj 正方行列の余因子行列を返す
eigenvalues 正方行列の固有値を返す
eigenvectors 正方行列の固有ベクトルを返す
linearsolve 一次方程式の解を返す
convexhull3d ３次元の凸多面体を作る。
描画関数
draw 点，線分を描く
drawpoly 多角形を描く
fillpoly 中を塗った多角形を描く
drawcircle 中心と半径を与えて円を描く
fillcircle 中を塗った円を描く
drawall リストのすべての要素を描画する
connect リストの点をつなぐ
drawtext 文字列を表示する
drawtable 表を描く
repaint 画面の再描画
描画の外観を設定する
pointsize 点の大きさ
linesize 線の太さ
textsize 文字の大きさ
pointcolor 点の色
linecolor 線の色
textcolor 文字の色
color すべての色
alpha すべての不透明度のアルファ値
gsave 色，アルファ値，幅，変換をスタックに入れる
grestore 色，アルファ値，幅，変換をスタックから出す
greset 色，アルファ値，幅，変換のスタックを空にする
色の関数
red 赤のRGBベクトルを返す
green 緑のRGBベクトルを返す
blue 青のRGBベクトルを返す
grey 灰色のRGBベクトルを返す
hue 色相のRGBベクトルを返す
関数プロット
plot 関数をプロットする
142

### Page 143

fillplot 積分のようにハイライトさせてプロットする
colorplot 関数の値によって色をプロットする
drawfield ベクトル場を描画する
drawfieldcomplex 複素ベクトル場を描画する
drawforces 力の場を表示する
drawcurves 物理のオシログラフを描く
画像の操作
drawimage 画像を表示する
mapimage 画像を変形する
imagesize 画像の大きさを取得する
imagergb 画素の色情報を取得する
createimage カスタム画像を作る
clearimage 画像の内容を消去する
removeimage 画像を削除する
canvas キャンバスに描く
シェイプ
circle 円形のシェイプを作る
polygon 多角形シェイプを作る
halfplane 半平面シェイプを作る
screen スクリーンのシェイプを作る
fill シェイプを塗りつぶす
draw シェイプの輪郭線を描く
clip シェイプのクリップパスの設定
幾何変換
translate 座標系全体を平行移動
rotate 座標系全体を回転
scale 座標系全体を拡大・縮小
setbasis 座標系全体の基底を変換
幾何関数
moveto 点の位置を変える
meet 直線の交点を求める
join ２点を結ぶ
perp 垂直な２次元ベクトルを返す
perp 点を通り直線に垂直な直線を求める
perpendicular 点を通り直線に垂直な直線を求める
para 点を通り直線に平行な直線を求める
parallel 点を通り直線に平行な直線を求める
143

### Page 144

cross ２つの３次元ベクトルの外積を返す
dist ２点間の距離を返す
area ３点で与えられた三角形の面積を返す
det 3×3行列の行列式を計算する
crossratio ４点の複比を計算する
complex xy 座標を複素数に変換する
gauss 複素数を点の座標に変換する
point 数ベクトルを点として位置づける
line 数ベクトルを直線として位置づける
geotype ベクトルの幾何学的意味を返す
map 幾何変換を表す行列を返す
pointreflect 点に関する対称点を求める行列を返す
linereflect 直線に関して対称な点をを求める行列を返す
incidences 幾何要素にインシデントである要素のリストを返す
locusdata 軌跡上の点の座標のリストを返す
インスペクタ
inspect 利用できる属性のリストを作る
inspect 属性を読み出す・設定する
要素の作成と消去
createpoint 位置とラベルを指定して点を加える
create 幾何要素を作成する
removeelement 幾何の要素をそれに従属する点とともに消去する
algorithm 幾何要素の作図手順を得る
inputs 幾何要素を定義するために必要な要素のリストを得る
element 引数の名前の幾何要素へのハンドルを得る
MIDI
playtone MIDI の単音を鳴らす
stoptone 音を止める
playfrequency 特定の周波数で鳴らす
playmelody メロディを鳴らす
midiaddtrack シーケンサにトラックを追加する
midistart シーケンサの開始
midistop シーケンサの停止
midispeed シーケンサの速度設定
midispeed シーケンサの速度を問い合わせる
midiposition シーケンサの位置を設定する
midiposition シーケンサの開始位置を得る
144

### Page 145

instrument 楽器を選ぶ
instrumentnames 利用できる楽器のリストを得る
midichannel チャンネルを設定する
midivolume チャンネルの音量を設定する
midicontrol チャンネルのコントローラを設定する
サンプルーオーディオ
playsin 特定の周波数の音を鳴らす
playfunction 数式で定義した音を鳴らす
playwave オーディオデータのリストを再生する
stopsound すべての音の再生を停止する
マウスとキーボードからの入力
mover 最後に動かされた点を返す
mouse マウスボタンが押されたときのマウスの位置を返す
elementsatmouse マウスカーソルの近くにある要素のリストを返す
key キーボードで打たれた文字列を返す
iskeydown あるキーが押されたかどうか問い合わせる
keydownlist 押されたキーのリストを返す
amsdata 重力センサからデータを得る
calibratedamsdata 調整されたAMS データを取得する
時間
resetclock 内部時計のリセット
seconds リセット後の経過時間
time 現在の時刻
date 現在の日付
wait ミリ秒単位で指定された時間，実行を止めて待つ
ファイル入出力
setdirectory ファイルのディレクトリを設定する
load データの読み込み
import プログラムコードの読み込み
openfile ファイルを開いてハンドルを返す
closefile ファイルを閉じる
print ファイルに書く
println ファイルに書いて改行する
ネットワーク
openurl Web ページをブラウザで開く
物理シミュレーション
simulation シミュレーションへのハンドル提供
145

### Page 146

force 力の探索粒子を設定する
addforce 力を存在する質点に適用する
setforce 力を存在する質点に設定する
アニメーション
playanimation アニメーションを開始する
pauseanimation アニメーションをいったん停止する
stopanimation アニメーションを終わる
Cindy3D
gsave3d 現在の描画設定の保存
grestore3d 描画設定の復帰
draw3d 点，線を描く
connect3d 点を結ぶ
drawpoly3d 多角形を描く
fillpoly3d 多角形の面を描く
fillcircle3d 円盤を描く
drawsphere3d 球面を描く
mesh3d 網目状の曲面を描く
background3d 背景の色を設定する
lookat3d カメラの位置
fieldofview3d 画角の設定
depthrange3d カメラ深度の設定
renderhints3d レンダリングのヒントを設定
pointlight3d 点光源の設定
directionallight3d 方向光源の設定
spotlight3d スポットライトの設定
disablelight3d 光源を無効にする
146

